import{CULLFACE_FRONT as e}from"../platform/graphics/constants.js";import{ShaderProcessorOptions as s}from"../platform/graphics/shader-processor-options.js";import{SHADER_FORWARDHDR as t,GAMMA_SRGBHDR as r,GAMMA_NONE as a,TONEMAP_LINEAR as n,LAYERID_SKYBOX as o}from"./constants.js";import{createBox as i}from"./procedural.js";import{GraphNode as m}from"./graph-node.js";import{Material as p}from"./materials/material.js";import{MeshInstance as c}from"./mesh-instance.js";import{getProgramLibrary as h}from"./shader-lib/get-program-library.js";import{skybox as y}from"./shader-lib/programs/skybox.js";class g{constructor(g,l,b){this.meshInstance=void 0;const d=new p;d.getShaderVariant=function(e,o,i,m,p,c,d,u){const f=b.cubemap?{type:"cubemap",encoding:b.encoding,useIntensity:1!==l.skyboxIntensity||l.physicalUnits,mip:b.fixCubemapSeams?l.skyboxMip:0,fixSeams:b.fixCubemapSeams,gamma:p===t?l.gammaCorrection?r:a:l.gammaCorrection,toneMapping:p===t?n:l.toneMapping}:{type:"envAtlas",encoding:b.encoding,useIntensity:1!==l.skyboxIntensity||l.physicalUnits,gamma:p===t?l.gammaCorrection?r:a:l.gammaCorrection,toneMapping:p===t?n:l.toneMapping},x=new s(d,u),I=h(g);return I.register("skybox",y),I.getProgram("skybox",f,x)},b.cubemap?d.setParameter("texture_cubeMap",b):(d.setParameter("texture_envAtlas",b),d.setParameter("mipLevel",l._skyboxMip)),d.cull=e,d.depthWrite=!1;const u=l.layers.getLayerById(o);if(u){const e=new m("Skybox"),s=i(g),t=new c(s,d,e);this.meshInstance=t,t.cull=!1,t._noDepthDrawGl1=!0,t.pick=!1,u.addMeshInstances([t]),this.skyLayer=u}}destroy(){this.meshInstance&&(this.skyLayer&&this.skyLayer.removeMeshInstances([this.meshInstance]),this.meshInstance.destroy(),this.meshInstance=null)}}export{g as Sky};
