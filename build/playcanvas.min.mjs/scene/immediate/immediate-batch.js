import{Mat4 as s}from"../../math/mat4.js";import{PRIMITIVE_LINES as t}from"../../graphics/constants.js";import{Mesh as o}from"../mesh.js";import{MeshInstance as h}from"../mesh-instance.js";import{GraphNode as i}from"../graph-node.js";const e=new i;e.worldTransform=s.IDENTITY,e._dirtyWorld=e._dirtyNormal=!1;class n{constructor(s,t,h){this.material=t,this.layer=h,this.positions=[],this.colors=[],this.mesh=new o(s),this.meshInstance=null}addLines(s,t){const o=this.positions,h=s.length;for(let t=0;t<h;t++){const h=s[t];o.push(h.x,h.y,h.z)}const i=this.colors;if(t.length)for(let s=0;s<h;s++){const o=t[s];i.push(o.r,o.g,o.b,o.a)}else for(let s=0;s<h;s++)i.push(t.r,t.g,t.b,t.a)}addLinesArrays(s,t){const o=this.positions;for(let t=0;t<s.length;t+=3)o.push(s[t],s[t+1],s[t+2]);const h=this.colors;if(t.length)for(let s=0;s<t.length;s+=4)h.push(t[s],t[s+1],t[s+2],t[s+3]);else{const o=s.length/3;for(let s=0;s<o;s++)h.push(t.r,t.g,t.b,t.a)}}onPreRender(s,o){this.positions.length>0&&this.material.transparent===o&&(this.mesh.setPositions(this.positions),this.mesh.setColors(this.colors),this.mesh.update(t,!1),this.meshInstance||(this.meshInstance=new h(this.mesh,this.material,e)),this.positions.length=0,this.colors.length=0,s.list.push(this.meshInstance),s.length++)}}export{n as ImmediateBatch};
