import{FloatPacking as t}from"../core/math/float-packing.js";import{Texture as e}from"../platform/graphics/texture.js";import{DeviceCache as r}from"../platform/graphics/device-cache.js";import{ADDRESS_CLAMP_TO_EDGE as o,TEXTURETYPE_DEFAULT as s,FILTER_LINEAR as a,FILTER_NEAREST as n,PIXELFORMAT_RGBA32F as c,PIXELFORMAT_RGBA16F as l}from"../platform/graphics/constants.js";class i{constructor(t,e){this.texture0=t,this.texture1=e}destroy(){var t,e;null==(t=this.texture0)||t.destroy(),null==(e=this.texture1)||e.destroy()}}const u=new r;class p{static createTexture(t,r,c,l=""){return new e(t,{width:c,height:c,format:r,addressU:o,addressV:o,type:s,magFilter:a,minFilter:n,anisotropy:1,name:`AreaLightLUT${l}`})}static applyTextures(t,e,r){u.remove(t),u.get(t,(()=>new i(e,e===r?null:r))),t.scope.resolve("areaLightsLutTex1").setValue(e),t.scope.resolve("areaLightsLutTex2").setValue(r)}static createPlaceholder(t){const e=p.createTexture(t,t.areaLightLutFormat,2,"placeholder");e.lock().fill(0),e.unlock(),p.applyTextures(t,e,e)}static set(e,r,o){function s(t,e,r){const o=p.createTexture(t,r,64);return o.lock().set(e),o.unlock(),o}function a(t,e,r){const o=t.length,s=new Float32Array(o);for(let a=0;a<o;a++){const o=a%4;s[a]=(t[a]+e[o])*r[o]}return s}function n(e){const r=e.length,o=new Uint16Array(r),s=t.float2Half;for(let t=0;t<r;t++)o[t]=s(e[t]);return o}function i(t){const e=t.length,r=new Uint8ClampedArray(e);for(let o=0;o<e;o++)r[o]=255*t[o];return r}const u=r,h=o;let f,m;const g=e.areaLightLutFormat;if(g===c)f=u,m=h;else if(g===l)f=n(u),m=n(h);else{const t=[-.306897,0,0,0],e=[1.442787,1,1,1];f=i(a(u,[0,.2976,.01381,0],[.999,3.08737,1.6546,.603249])),m=i(a(h,t,e))}const x=s(e,f,g),d=s(e,m,g);p.applyTextures(e,x,d)}}export{p as AreaLightLuts};
