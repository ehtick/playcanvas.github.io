import{PIXELFORMAT_RGBA32F as e,PIXELFORMAT_RGBA16F as t,PIXELFORMAT_DEPTH as r,PIXELFORMAT_R8_G8_B8_A8 as a,FILTER_NEAREST as s,FILTER_LINEAR as o,ADDRESS_CLAMP_TO_EDGE as i,FUNC_LESS as n}from"../../graphics/constants.js";import{RenderTarget as h}from"../../graphics/render-target.js";import{Texture as c}from"../../graphics/texture.js";import{SHADOW_VSM32 as d,SHADOW_VSM16 as l,SHADOW_PCF5 as p,SHADOW_PCF3 as u,LIGHTTYPE_OMNI as m}from"../constants.js";class g{constructor(e,t){this.texture=e,this.cached=!1,this.renderTargets=t}destroy(){this.texture&&(this.texture.destroy(),this.texture=null);const e=this.renderTargets;for(let t=0;t<e.length;t++)e[t].destroy();this.renderTargets.length=0}static getShadowFormat(s,o){return o===d?e:o===l?t:o===p||o===u&&s.webgl2?r:a}static getShadowFiltering(e,t){return t!==u||e.webgl2?t===d?e.extTextureFloatLinear?o:s:t===l?e.extTextureHalfFloatLinear?o:s:o:s}static create(e,t){let r=null;return r=t._type===m?this.createCubemap(e,t._shadowResolution):this.create2dMap(e,t._shadowResolution,t._shadowType),r}static createAtlas(e,t,r){const a=this.create2dMap(e,t,r),s=a.renderTargets,o=s[0];for(let e=0;e<5;e++)s.push(o);return a}static create2dMap(e,t,r){const a=this.getShadowFormat(e,r),s=this.getShadowFiltering(e,r),o=new c(e,{format:a,width:t,height:t,mipmaps:!1,minFilter:s,magFilter:s,addressU:i,addressV:i,name:"ShadowMap2D"});let d=null;return r===p||r===u&&e.webgl2?(o.compareOnRead=!0,o.compareFunc=n,d=new h({depthBuffer:o})):d=new h({colorBuffer:o,depth:!0}),new g(o,[d])}static createCubemap(e,t){const r=new c(e,{format:a,width:t,height:t,cubemap:!0,mipmaps:!1,minFilter:s,magFilter:s,addressU:i,addressV:i,name:"ShadowMapCube"}),o=[];for(let e=0;e<6;e++){const t=new h({colorBuffer:r,face:e,depth:!0});o.push(t)}return new g(r,o)}}export{g as ShadowMap};
