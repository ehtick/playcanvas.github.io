import"../core/tracing.js";import{EventHandler as t}from"../core/event-handler.js";import{ScriptHandler as e}from"../resources/script.js";import{script as r}from"../framework/script.js";import{AppBase as o}from"../framework/app-base.js";import{ScriptAttributes as s}from"./script-attributes.js";import{ScriptType as n}from"./script-type.js";const i=new Set(["system","entity","create","destroy","swap","move","scripts","_scripts","_scriptsIndex","_scriptsData","enabled","_oldState","onEnable","onDisable","onPostStateChange","_onSetEnabled","_checkState","_onBeforeRemove","_onInitializeAttributes","_onInitialize","_onPostInitialize","_onUpdate","_onPostUpdate","_callbacks","has","get","on","off","fire","once","hasEvent"]);function a(e,o){if(r.legacy)return null;if(i.has(e))throw new Error(`script name: '${e}' is reserved, please change script name`);const a=function(e){t.prototype.initEventHandler.call(this),n.prototype.initScriptType.call(this,e)};return(a.prototype=Object.create(n.prototype)).constructor=a,a.extend=n.extend,a.attributes=new s(a),p(a,e,o),a}const c={};function p(t,r,s){if(t.legacy)return;if("function"!=typeof t)throw new Error(`script class: '${t}' must be a constructor function (i.e. class).`);if(!(t.prototype instanceof n))throw new Error(`script class: '${n.__getScriptName(t)}' does not extend pc.ScriptType.`);if(r=r||t.__name||n.__getScriptName(t),i.has(r))throw new Error(`script name: '${r}' is reserved, please change script name`);t.__name=r;(s?s.scripts:o.getApplication().scripts).add(t),e._push(t)}s.reservedNames.forEach(((t,e,r)=>{c[t]=1})),a.reservedAttributes=c;export{a as createScript,p as registerScript};
