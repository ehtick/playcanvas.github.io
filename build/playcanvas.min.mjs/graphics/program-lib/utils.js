import{DEVICETYPE_WEBGPU as e,SEMANTIC_POSITION as r,SEMANTIC_NORMAL as t,SEMANTIC_TANGENT as o,SEMANTIC_TEXCOORD0 as n,SEMANTIC_TEXCOORD1 as s,SEMANTIC_TEXCOORD2 as a,SEMANTIC_TEXCOORD3 as d,SEMANTIC_TEXCOORD4 as i,SEMANTIC_TEXCOORD5 as x,SEMANTIC_TEXCOORD6 as c,SEMANTIC_TEXCOORD7 as m,SEMANTIC_COLOR as u,SEMANTIC_BLENDINDICES as v,SEMANTIC_BLENDWEIGHT as f}from"../constants.js";import{Shader as b}from"../shader.js";import{shaderChunks as _}from"./chunks/chunks.js";import{getProgramLibrary as g}from"../program-library.js";import{precisionCode as p,versionCode as l,dummyFragmentCode as h}from"./programs/common.js";const S={vertex_position:r,vertex_normal:t,vertex_tangent:o,vertex_texCoord0:n,vertex_texCoord1:s,vertex_texCoord2:a,vertex_texCoord3:d,vertex_texCoord4:i,vertex_texCoord5:x,vertex_texCoord6:c,vertex_texCoord7:m,vertex_color:u,vertex_boneIndices:v,vertex_boneWeights:f};function C(e){const r={};let t=0,o=e.indexOf("attribute");for(;o>=0&&!(o>0&&"/"===e[o-1]);){const n=e.indexOf(";",o),s=e.lastIndexOf(" ",n),a=e.substring(s+1,n),d=S[a];void 0!==d?r[a]=d:(r[a]="ATTR"+t,t++),o=e.indexOf("attribute",o+1)}return r}function w(r,t,o,n=!1){let s=_[t],a=p(r)+"\n"+_[o];const d=C(s);return r.deviceType===e?(s=l(r)+_.webgpuVS+s,a=l(r)+_.webgpuPS+a):r.webgl2&&(s=l(r)+_.gles3VS+s,a=l(r)+_.gles3PS+a),new b(r,{attributes:d,vshader:s,fshader:a,useTransformFeedback:n,name:`${t}_${o}`})}function T(r,t,o,n,s=!1,a=""){const d=g(r)._cache,i=d[n];if(void 0!==i)return i;o=p(r)+"\n"+(o||h());const x=C(t);return r.deviceType===e?(t=l(r)+_.webgpuVS+t,o=l(r)+_.webgpuPS+o):r.webgl2&&(t=l(r)+_.gles3VS+t,o=l(r)+_.gles3PS+o),d[n]=new b(r,{name:n,attributes:x,vshader:t,fshader:a+o,useTransformFeedback:s}),d[n]}_.collectAttribs=C,_.createShader=w,_.createShaderFromCode=T;export{C as collectAttribs,w as createShader,T as createShaderFromCode};
