import"../../../core/tracing.js";import{PIXELFORMAT_RGB8 as t,ADDRESS_CLAMP_TO_EDGE as a,ADDRESS_REPEAT as e,PIXELFORMAT_DXT1 as r,PIXELFORMAT_DXT5 as o,PIXELFORMAT_RGBA16F as s,PIXELFORMAT_RGBA32F as l,PIXELFORMAT_ETC1 as m,PIXELFORMAT_PVRTC_2BPP_RGB_1 as n,PIXELFORMAT_PVRTC_2BPP_RGBA_1 as h,PIXELFORMAT_PVRTC_4BPP_RGB_1 as i,PIXELFORMAT_PVRTC_4BPP_RGBA_1 as f,PIXELFORMAT_RGBA8 as c}from"../../../platform/graphics/constants.js";import{Texture as p}from"../../../platform/graphics/texture.js";import{Asset as d}from"../../asset/asset.js";class x{constructor(t){this.maxRetries=0}load(t,a,e){d.fetchArrayBuffer(t.load,a,e,this.maxRetries)}open(d,x,M){const u=new Uint32Array(x,0,32),w=u[4],y=u[3],g=Math.max(u[7],1),A=4===u[20],j=u[21],v=u[22],U=65024===u[28],_=827611204,R=825438800,b=825439312;let B,F=!1,V=!1,k=!1,q=!1,z=null,C=1;if(A?j===_?(z=r,F=!0):894720068===j?(z=o,F=!0):113===j?(z=s,C=2):116===j?(z=l,C=4):826496069===j?(z=m,F=!0,V=!0):j===R||825504336===j?(z=j===R?n:h,F=!0,k=!0):j!==b&&825504848!==j||(z=j===b?i:f,F=!0,q=!0):32===v&&(z=c),!z)return B=new p(M,{width:4,height:4,format:t,name:"dds-legacy-empty"}),B;B=new p(M,{name:d,addressU:U?a:e,addressV:U?a:e,width:w,height:y,format:z,cubemap:U,mipmaps:g>1});let D=128;const E=U?6:1;let G;const H=j===_?8:16;let I,J,K;for(let t=0;t<E;t++){let a=w,e=y;for(let r=0;r<g;r++){F?V?G=Math.floor((a+3)/4)*Math.floor((e+3)/4)*8:k?G=Math.max(a,16)*Math.max(e,8)/4:q?G=Math.max(a,8)*Math.max(e,8)/2:(I=Math.floor((a+4-1)/4),J=Math.floor((e+4-1)/4),K=I*J,G=K*H):G=a*e*4;const o=z===l?new Float32Array(x,D,G):z===s?new Uint16Array(x,D,G):new Uint8Array(x,D,G);U?(B._levels[r]||(B._levels[r]=[]),B._levels[r][t]=o):B._levels[r]=o,D+=G*C,a=Math.max(.5*a,1),e=Math.max(.5*e,1)}}return B.upload(),B}}export{x as DdsParser};
