import{Vec2 as e}from"../../../math/vec2.js";import{Vec4 as t}from"../../../math/vec4.js";import{Component as i}from"../component.js";import{ComponentSystem as n}from"../system.js";import{LayoutGroupComponent as o}from"./component.js";import{LayoutGroupComponentData as r}from"./data.js";const s=["enabled"];class a extends n{constructor(e){super(e),this.id="layoutgroup",this.ComponentType=o,this.DataType=r,this.schema=s,this._reflowQueue=[],this.on("beforeremove",this._onRemoveComponent,this),this.app.systems.on("postUpdate",this._onPostUpdate,this)}initializeComponentData(i,n,o){void 0!==n.enabled&&(i.enabled=n.enabled),void 0!==n.orientation&&(i.orientation=n.orientation),void 0!==n.reverseX&&(i.reverseX=n.reverseX),void 0!==n.reverseY&&(i.reverseY=n.reverseY),void 0!==n.alignment&&(i.alignment=Array.isArray(n.alignment)?new e(n.alignment):n.alignment),void 0!==n.padding&&(i.padding=Array.isArray(n.padding)?new t(n.padding):n.padding),void 0!==n.spacing&&(i.spacing=Array.isArray(n.spacing)?new e(n.spacing):n.spacing),void 0!==n.widthFitting&&(i.widthFitting=n.widthFitting),void 0!==n.heightFitting&&(i.heightFitting=n.heightFitting),void 0!==n.wrap&&(i.wrap=n.wrap),super.initializeComponentData(i,n,o)}cloneComponent(e,t){const i=e.layoutgroup;return this.addComponent(t,{enabled:i.enabled,orientation:i.orientation,reverseX:i.reverseX,reverseY:i.reverseY,alignment:i.alignment,padding:i.padding,spacing:i.spacing,widthFitting:i.widthFitting,heightFitting:i.heightFitting,wrap:i.wrap})}scheduleReflow(e){-1===this._reflowQueue.indexOf(e)&&this._reflowQueue.push(e)}_onPostUpdate(){this._processReflowQueue()}_processReflowQueue(){if(0===this._reflowQueue.length)return;let e=0;for(;this._reflowQueue.length>0;){const t=this._reflowQueue.slice();this._reflowQueue.length=0,t.sort((function(e,t){return e.entity.graphDepth-t.entity.graphDepth}));for(let e=0;e<t.length;++e)t[e].reflow();if(++e>=100){console.warn("Max reflow iterations limit reached, bailing.");break}}}_onRemoveComponent(e,t){t.onRemove()}destroy(){super.destroy(),this.app.systems.off("postUpdate",this._onPostUpdate,this)}}i._buildAccessors(o.prototype,s);export{a as LayoutGroupComponentSystem};
