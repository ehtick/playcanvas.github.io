import{Color as e}from"../../../math/color.js";import{Vec2 as o}from"../../../math/vec2.js";import{LIGHTSHAPE_PUNCTUAL as t,LIGHTTYPE_DIRECTIONAL as n,LIGHTTYPE_OMNI as s,LIGHTTYPE_SPOT as r}from"../../../scene/constants.js";import{Light as i}from"../../../scene/light.js";import{ComponentSystem as a}from"../system.js";import{LightComponent as c,_lightProps as p}from"./component.js";import{LightComponentData as l}from"./data.js";const m={directional:n,omni:s,point:s,spot:r};class y extends a{constructor(e){super(e),this.id="light",this.ComponentType=c,this.DataType=l,this.on("beforeremove",this._onRemoveComponent,this)}initializeComponentData(n,s){const r=p,a={};for(let e=0,o=r.length;e<o;e++){const o=r[e];a[o]=s[o]}a.type||(a.type=n.data.type),n.data.type=a.type,a.layers&&Array.isArray(a.layers)&&(a.layers=a.layers.slice(0)),a.color&&Array.isArray(a.color)&&(a.color=new e(a.color[0],a.color[1],a.color[2])),a.cookieOffset&&a.cookieOffset instanceof Array&&(a.cookieOffset=new o(a.cookieOffset[0],a.cookieOffset[1])),a.cookieScale&&a.cookieScale instanceof Array&&(a.cookieScale=new o(a.cookieScale[0],a.cookieScale[1])),a.enable&&(console.warn("WARNING: enable: Property is deprecated. Set enabled property instead."),a.enabled=a.enable),a.shape||(a.shape=t);const c=new i(this.app.graphicsDevice);c.type=m[a.type],c._node=n.entity,c._scene=this.app.scene,n.data.light=c,super.initializeComponentData(n,a,r)}_onRemoveComponent(e,o){o.onRemove()}cloneComponent(e,o){const t=e.light,n=[];let s;const r=p;for(let e=0;e<r.length;e++)s=r[e],"light"!==s&&(t[s]&&t[s].clone?n[s]=t[s].clone():n[s]=t[s]);return this.addComponent(o,n)}changeType(e,o,t){o!==t&&(e.light.type=m[t])}}export{y as LightComponentSystem};
