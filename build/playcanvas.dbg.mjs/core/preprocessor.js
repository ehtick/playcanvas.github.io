/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from './debug.js';

const TRACEID = 'Preprocessor';
const KEYWORD = /[ \t]*#(ifn?def|if|endif|else|elif|define|undef|extension)/g;
const DEFINE = /define[ \t]+([^\n]+)\r?(?:\n|$)/g;
const EXTENSION = /extension[ \t]+([\w-]+)[ \t]*:[ \t]*enable/g;
const UNDEF = /undef[ \t]+([^\n]+)\r?(?:\n|$)/g;
const IF = /(ifdef|ifndef|if)[ \t]*([^\r\n]+)\r?\n/g;
const ENDIF = /(endif|else|elif)([ \t]+[^\r\n]+)?\r?(?:\n|$)/g;
const IDENTIFIER = /([\w-]+)/;
const DEFINED = /(!|\s)?defined\(([\w-]+)\)/;
const INVALID = /[><=|&+-]/g;

class Preprocessor {
  static run(source) {
    source = source.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm, '$1');
    source = source.split(/\r?\n/).map(line => line.trimEnd()).join('\n');
    source = this._preprocess(source);

    if (source !== null) {
      source = source.split(/\r?\n/).map(line => line.trim() === '' ? '' : line).join('\n');
      source = source.replace(/(\n\n){3,}/gm, '\n\n');
    }

    return source;
  }

  static _preprocess(source) {
    const originalSource = source;
    const stack = [];
    let error = false;
    const defines = new Map();
    let match;

    while ((match = KEYWORD.exec(source)) !== null) {
      const keyword = match[1];

      switch (keyword) {
        case 'define':
          {
            DEFINE.lastIndex = match.index;
            const define = DEFINE.exec(source);
            Debug.assert(define, `Invalid [${keyword}]: ${source.substring(match.index, match.index + 100)}...`);
            error || (error = define === null);
            const expression = define[1];
            IDENTIFIER.lastIndex = define.index;
            const identifierValue = IDENTIFIER.exec(expression);
            const identifier = identifierValue[1];
            let value = expression.substring(identifier.length).trim();
            if (value === "") value = "true";

            const keep = Preprocessor._keep(stack);

            if (keep) {
              defines.set(identifier, value);
            }

            Debug.trace(TRACEID, `${keyword}: [${identifier}] ${value} ${keep ? "" : "IGNORED"}`);
            KEYWORD.lastIndex = define.index + define[0].length;
            break;
          }

        case 'undef':
          {
            UNDEF.lastIndex = match.index;
            const undef = UNDEF.exec(source);
            const identifier = undef[1].trim();

            const keep = Preprocessor._keep(stack);

            if (keep) {
              defines.delete(identifier);
            }

            Debug.trace(TRACEID, `${keyword}: [${identifier}] ${keep ? "" : "IGNORED"}`);
            KEYWORD.lastIndex = undef.index + undef[0].length;
            break;
          }

        case 'extension':
          {
            EXTENSION.lastIndex = match.index;
            const extension = EXTENSION.exec(source);
            Debug.assert(extension, `Invalid [${keyword}]: ${source.substring(match.index, match.index + 100)}...`);
            error || (error = extension === null);

            if (extension) {
              const identifier = extension[1];

              const keep = Preprocessor._keep(stack);

              if (keep) {
                defines.set(identifier, "true");
              }

              Debug.trace(TRACEID, `${keyword}: [${identifier}] ${keep ? "" : "IGNORED"}`);
            }

            KEYWORD.lastIndex = extension.index + extension[0].length;
            break;
          }

        case 'ifdef':
        case 'ifndef':
        case 'if':
          {
            IF.lastIndex = match.index;
            const iff = IF.exec(source);
            const expression = iff[2];
            const evaluated = Preprocessor.evaluate(expression, defines);
            error || (error = evaluated.error);
            let result = evaluated.result;

            if (keyword === 'ifndef') {
              result = !result;
            }

            stack.push({
              anyKeep: result,
              keep: result,
              start: match.index,
              end: IF.lastIndex
            });
            Debug.trace(TRACEID, `${keyword}: [${expression}] => ${result}`);
            KEYWORD.lastIndex = iff.index + iff[0].length;
            break;
          }

        case 'endif':
        case 'else':
        case 'elif':
          {
            ENDIF.lastIndex = match.index;
            const endif = ENDIF.exec(source);
            const blockInfo = stack.pop();
            const blockCode = blockInfo.keep ? source.substring(blockInfo.end, match.index) : "";
            Debug.trace(TRACEID, `${keyword}: [previous block] => ${blockCode !== ""}`);
            source = source.substring(0, blockInfo.start) + blockCode + source.substring(ENDIF.lastIndex);
            KEYWORD.lastIndex = blockInfo.start + blockCode.length;
            const endifCommand = endif[1];

            if (endifCommand === 'else' || endifCommand === 'elif') {
              let result = false;

              if (!blockInfo.anyKeep) {
                if (endifCommand === 'else') {
                  result = !blockInfo.keep;
                } else {
                  const evaluated = Preprocessor.evaluate(endif[2], defines);
                  result = evaluated.result;
                  error || (error = evaluated.error);
                }
              }

              stack.push({
                anyKeep: blockInfo.anyKeep || result,
                keep: result,
                start: KEYWORD.lastIndex,
                end: KEYWORD.lastIndex
              });
              Debug.trace(TRACEID, `${keyword}: [${endif[2]}] => ${result}`);
            }

            break;
          }
      }
    }

    if (error) {
      console.warn("Failed to preprocess shader: ", {
        source: originalSource
      });
      return originalSource;
    }

    return source;
  }

  static _keep(stack) {
    for (let i = 0; i < stack.length; i++) {
      if (!stack[i].keep) return false;
    }

    return true;
  }

  static evaluate(expression, defines) {
    const correct = INVALID.exec(expression) === null;
    Debug.assert(correct, `Resolving expression like this is not supported: ${expression}`);
    let invert = false;
    const defined = DEFINED.exec(expression);

    if (defined) {
      invert = defined[1] === '!';
      expression = defined[2];
    }

    expression = expression.trim();
    let exists = defines.has(expression);

    if (invert) {
      exists = !exists;
    }

    return {
      result: exists,
      error: !correct
    };
  }

}

export { Preprocessor };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlcHJvY2Vzc29yLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29yZS9wcmVwcm9jZXNzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuL2RlYnVnLmpzJztcblxuLy8gaWQgZm9yIGRlYnVnIHRyYWNpbmdcbmNvbnN0IFRSQUNFSUQgPSAnUHJlcHJvY2Vzc29yJztcblxuLy8gYWNjZXB0ZWQga2V5d29yZHNcbmNvbnN0IEtFWVdPUkQgPSAvWyBcXHRdKiMoaWZuP2RlZnxpZnxlbmRpZnxlbHNlfGVsaWZ8ZGVmaW5lfHVuZGVmfGV4dGVuc2lvbikvZztcblxuLy8gI2RlZmluZSBFWFBSRVNTSU9OXG5jb25zdCBERUZJTkUgPSAvZGVmaW5lWyBcXHRdKyhbXlxcbl0rKVxccj8oPzpcXG58JCkvZztcblxuLy8gI2V4dGVuc2lvbiBJREVOVElGSUVSIDogZW5hYmxlZFxuY29uc3QgRVhURU5TSU9OID0gL2V4dGVuc2lvblsgXFx0XSsoW1xcdy1dKylbIFxcdF0qOlsgXFx0XSplbmFibGUvZztcblxuLy8gI3VuZGVmIEVYUFJFU1NJT05cbmNvbnN0IFVOREVGID0gL3VuZGVmWyBcXHRdKyhbXlxcbl0rKVxccj8oPzpcXG58JCkvZztcblxuLy8gI2lmZGVmLyNpZm5kZWYgU09NRURFRklORSwgI2lmIEVYUFJFU1NJT05cbmNvbnN0IElGID0gLyhpZmRlZnxpZm5kZWZ8aWYpWyBcXHRdKihbXlxcclxcbl0rKVxccj9cXG4vZztcblxuLy8gI2VuZGlmLyNlbHNlIG9yICNlbGlmIEVYUFJFU1NJT05cbmNvbnN0IEVORElGID0gLyhlbmRpZnxlbHNlfGVsaWYpKFsgXFx0XStbXlxcclxcbl0rKT9cXHI/KD86XFxufCQpL2c7XG5cbi8vIGlkZW50aWZpZXJcbmNvbnN0IElERU5USUZJRVIgPSAvKFtcXHctXSspLztcblxuLy8gWyFdZGVmaW5lZChFWFBSRVNTSU9OKVxuY29uc3QgREVGSU5FRCA9IC8oIXxcXHMpP2RlZmluZWRcXCgoW1xcdy1dKylcXCkvO1xuXG4vLyBjdXJyZW50bHkgdW5zdXBwb3J0ZWQgY2hhcmFjdGVycyBpbiB0aGUgZXhwcmVzc2lvbjogfCAmIDwgPiA9ICsgLVxuY29uc3QgSU5WQUxJRCA9IC9bPjw9fCYrLV0vZztcblxuLyoqXG4gKiBQdXJlIHN0YXRpYyBjbGFzcyBpbXBsZW1lbnRpbmcgc3Vic2V0IG9mIEMtc3R5bGUgcHJlcHJvY2Vzc29yLlxuICogaW5zcGlyZWQgYnk6IGh0dHBzOi8vZ2l0aHViLmNvbS9kY29kZUlPL1ByZXByb2Nlc3Nvci5qc1xuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgUHJlcHJvY2Vzc29yIHtcbiAgICAvKipcbiAgICAgKiBSdW4gYy1saWtlIHByb3Byb2Nlc3NvciBvbiB0aGUgc291cmNlIGNvZGUsIGFuZCByZXNvbHZlcyB0aGUgY29kZSBiYXNlZCBvbiB0aGUgZGVmaW5lcyBhbmQgaWZkZWZzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIC0gVGhlIHNvdXJjZSBjb2RlIHRvIHdvcmsgb24uXG4gICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBSZXR1cm5zIHByZXByb2Nlc3NlZCBzb3VyY2UgY29kZSwgb3IgbnVsbCBpbiBjYXNlIG9mIGVycm9yLlxuICAgICAqL1xuICAgIHN0YXRpYyBydW4oc291cmNlKSB7XG5cbiAgICAgICAgLy8gc3RyaXBzIGNvbW1lbnRzLCBoYW5kbGVzIC8vIGFuZCBtYW55IGNhc2VzIG9mIC8qXG4gICAgICAgIHNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKC9cXC9cXCpbXFxzXFxTXSo/XFwqXFwvfChbXlxcXFw6XXxeKVxcL1xcLy4qJC9nbSwgJyQxJyk7XG5cbiAgICAgICAgLy8gcmlnaHQgdHJpbSBlYWNoIGxpbmVcbiAgICAgICAgc291cmNlID0gc291cmNlLnNwbGl0KC9cXHI/XFxuLylcbiAgICAgICAgICAgIC5tYXAobGluZSA9PiBsaW5lLnRyaW1FbmQoKSlcbiAgICAgICAgICAgIC5qb2luKCdcXG4nKTtcblxuICAgICAgICAvLyBwcm9wcm9jZXNzIGRlZmluZXMgLyBpZmRlZnMgLi5cbiAgICAgICAgc291cmNlID0gdGhpcy5fcHJlcHJvY2Vzcyhzb3VyY2UpO1xuXG4gICAgICAgIGlmIChzb3VyY2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGNvbnZlcnQgbGluZXMgd2l0aCBvbmx5IHdoaXRlIHNwYWNlIGludG8gZW1wdHkgc3RyaW5nXG4gICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoL1xccj9cXG4vKVxuICAgICAgICAgICAgICAgIC5tYXAobGluZSA9PiAobGluZS50cmltKCkgPT09ICcnID8gJycgOiBsaW5lKSlcbiAgICAgICAgICAgICAgICAuam9pbignXFxuJyk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBtb3JlIHRoYW4gMSBjb25zZWN1dGl2ZSBlbXB0eSBsaW5lc1xuICAgICAgICAgICAgc291cmNlID0gc291cmNlLnJlcGxhY2UoLyhcXG5cXG4pezMsfS9nbSwgJ1xcblxcbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgX3ByZXByb2Nlc3Moc291cmNlKSB7XG5cbiAgICAgICAgY29uc3Qgb3JpZ2luYWxTb3VyY2UgPSBzb3VyY2U7XG5cbiAgICAgICAgLy8gc3RhY2ssIHN0b3JpbmcgaW5mbyBhYm91dCBpZmRlZiBibG9ja3NcbiAgICAgICAgY29uc3Qgc3RhY2sgPSBbXTtcblxuICAgICAgICAvLyB0cnVlIGlmIHRoZSBmdW5jdGlvbiBlbmNvdW50ZXIgYSBwcm9ibGVtXG4gICAgICAgIGxldCBlcnJvciA9IGZhbHNlO1xuXG4gICAgICAgIC8vIGFjdGl2ZSBkZWZpbmVzLCBtYXBzIGRlZmluZSBuYW1lIHRvIGl0cyB2YWx1ZVxuICAgICAgICAvKiogQHR5cGUge01hcDxzdHJpbmcsIHN0cmluZz59ICovXG4gICAgICAgIGNvbnN0IGRlZmluZXMgPSBuZXcgTWFwKCk7XG5cbiAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICB3aGlsZSAoKG1hdGNoID0gS0VZV09SRC5leGVjKHNvdXJjZSkpICE9PSBudWxsKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGtleXdvcmQgPSBtYXRjaFsxXTtcbiAgICAgICAgICAgIHN3aXRjaCAoa2V5d29yZCkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RlZmluZSc6IHtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZWFkIHRoZSByZXN0IG9mIHRoZSBkZWZpbmUgbGluZVxuICAgICAgICAgICAgICAgICAgICBERUZJTkUubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmluZSA9IERFRklORS5leGVjKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydChkZWZpbmUsIGBJbnZhbGlkIFske2tleXdvcmR9XTogJHtzb3VyY2Uuc3Vic3RyaW5nKG1hdGNoLmluZGV4LCBtYXRjaC5pbmRleCArIDEwMCl9Li4uYCk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yIHx8PSBkZWZpbmUgPT09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSBkZWZpbmVbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc3BsaXQgaXQgdG8gaWRlbnRpZmllciBuYW1lIGFuZCBhIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIElERU5USUZJRVIubGFzdEluZGV4ID0gZGVmaW5lLmluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGVudGlmaWVyVmFsdWUgPSBJREVOVElGSUVSLmV4ZWMoZXhwcmVzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBpZGVudGlmaWVyVmFsdWVbMV07XG4gICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGV4cHJlc3Npb24uc3Vic3RyaW5nKGlkZW50aWZpZXIubGVuZ3RoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCJcIikgdmFsdWUgPSBcInRydWVcIjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhcmUgd2UgaW5zaWRlIGlmLWJsb2NrcyB0aGF0IGFyZSBhY2NlcHRlZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZWVwID0gUHJlcHJvY2Vzc29yLl9rZWVwKHN0YWNrKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoa2VlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lcy5zZXQoaWRlbnRpZmllciwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRCwgYCR7a2V5d29yZH06IFske2lkZW50aWZpZXJ9XSAke3ZhbHVlfSAke2tlZXAgPyBcIlwiIDogXCJJR05PUkVEXCJ9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgb24gdGhlIG5leHQgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IGRlZmluZS5pbmRleCArIGRlZmluZVswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhc2UgJ3VuZGVmJzoge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlYWQgdGhlIHJlc3Qgb2YgdGhlIGRlZmluZSBsaW5lXG4gICAgICAgICAgICAgICAgICAgIFVOREVGLmxhc3RJbmRleCA9IG1hdGNoLmluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB1bmRlZiA9IFVOREVGLmV4ZWMoc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IHVuZGVmWzFdLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhcmUgd2UgaW5zaWRlIGlmLWJsb2NrcyB0aGF0IGFyZSBhY2NlcHRlZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZWVwID0gUHJlcHJvY2Vzc29yLl9rZWVwKHN0YWNrKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgaXQgZnJvbSBkZWZpbmVzXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZWVwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZpbmVzLmRlbGV0ZShpZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSUQsIGAke2tleXdvcmR9OiBbJHtpZGVudGlmaWVyfV0gJHtrZWVwID8gXCJcIiA6IFwiSUdOT1JFRFwifWApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlIG9uIHRoZSBuZXh0IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgS0VZV09SRC5sYXN0SW5kZXggPSB1bmRlZi5pbmRleCArIHVuZGVmWzBdLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzoge1xuICAgICAgICAgICAgICAgICAgICBFWFRFTlNJT04ubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IEVYVEVOU0lPTi5leGVjKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydChleHRlbnNpb24sIGBJbnZhbGlkIFske2tleXdvcmR9XTogJHtzb3VyY2Uuc3Vic3RyaW5nKG1hdGNoLmluZGV4LCBtYXRjaC5pbmRleCArIDEwMCl9Li4uYCk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yIHx8PSBleHRlbnNpb24gPT09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHRlbnNpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBleHRlbnNpb25bMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFyZSB3ZSBpbnNpZGUgaWYtYmxvY2tzIHRoYXQgYXJlIGFjY2VwdGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZWVwID0gUHJlcHJvY2Vzc29yLl9rZWVwKHN0YWNrKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtlZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZpbmVzLnNldChpZGVudGlmaWVyLCBcInRydWVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSUQsIGAke2tleXdvcmR9OiBbJHtpZGVudGlmaWVyfV0gJHtrZWVwID8gXCJcIiA6IFwiSUdOT1JFRFwifWApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgb24gdGhlIG5leHQgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IGV4dGVuc2lvbi5pbmRleCArIGV4dGVuc2lvblswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhc2UgJ2lmZGVmJzpcbiAgICAgICAgICAgICAgICBjYXNlICdpZm5kZWYnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2lmJzoge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlYWQgdGhlIGlmIGxpbmVcbiAgICAgICAgICAgICAgICAgICAgSUYubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlmZiA9IElGLmV4ZWMoc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IGlmZlsyXTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBldmFsdWF0ZSBleHByZXNzaW9uXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRlZCA9IFByZXByb2Nlc3Nvci5ldmFsdWF0ZShleHByZXNzaW9uLCBkZWZpbmVzKTtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgfHw9IGV2YWx1YXRlZC5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGV2YWx1YXRlZC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXl3b3JkID09PSAnaWZuZGVmJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gIXJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBpbmZvIHRvIHRoZSBzdGFjayAodG8gYmUgaGFuZGxlZCBsYXRlcilcbiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbnlLZWVwOiByZXN1bHQsICAgICAgICAvLyB0cnVlIGlmIGFueSBicmFuY2ggd2FzIGFscmVhZHkgYWNjZXB0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGtlZXA6IHJlc3VsdCwgICAgICAgICAgIC8vIHRydWUgaWYgdGhpcyBicmFuY2ggaXMgYmVpbmcgdGFrZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBtYXRjaC5pbmRleCwgICAgIC8vIHN0YXJ0IGluZGV4IGlmIElGIGxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogSUYubGFzdEluZGV4ICAgICAgIC8vIGVuZCBpbmRleCBvZiBJRiBsaW5lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSUQsIGAke2tleXdvcmR9OiBbJHtleHByZXNzaW9ufV0gPT4gJHtyZXN1bHR9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgb24gdGhlIG5leHQgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IGlmZi5pbmRleCArIGlmZlswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhc2UgJ2VuZGlmJzpcbiAgICAgICAgICAgICAgICBjYXNlICdlbHNlJzpcbiAgICAgICAgICAgICAgICBjYXNlICdlbGlmJzoge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoIHRoZSBlbmRpZlxuICAgICAgICAgICAgICAgICAgICBFTkRJRi5sYXN0SW5kZXggPSBtYXRjaC5pbmRleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kaWYgPSBFTkRJRi5leGVjKHNvdXJjZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvY2tJbmZvID0gc3RhY2sucG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29kZSBiZXR3ZWVuIGlmIGFuZCBlbmRpZlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9ja0NvZGUgPSBibG9ja0luZm8ua2VlcCA/IHNvdXJjZS5zdWJzdHJpbmcoYmxvY2tJbmZvLmVuZCwgbWF0Y2guaW5kZXgpIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRCwgYCR7a2V5d29yZH06IFtwcmV2aW91cyBibG9ja10gPT4gJHtibG9ja0NvZGUgIT09IFwiXCJ9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY3V0IG91dCB0aGUgSUYgYW5kIEVORElGIGxpbmVzLCBsZWF2ZSBibG9jayBpZiByZXF1aXJlZFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3Vic3RyaW5nKDAsIGJsb2NrSW5mby5zdGFydCkgKyBibG9ja0NvZGUgKyBzb3VyY2Uuc3Vic3RyaW5nKEVORElGLmxhc3RJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIEtFWVdPUkQubGFzdEluZGV4ID0gYmxvY2tJbmZvLnN0YXJ0ICsgYmxvY2tDb2RlLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZWxzZSBpZlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRpZkNvbW1hbmQgPSBlbmRpZlsxXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZGlmQ29tbWFuZCA9PT0gJ2Vsc2UnIHx8IGVuZGlmQ29tbWFuZCA9PT0gJ2VsaWYnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGFueSBicmFuY2ggd2FzIGFscmVhZHkgYWNjZXB0ZWQsIGFsbCBlbHNlIGJyYW5jaGVzIG5lZWQgdG8gZmFpbCByZWdhcmRsZXNzIG9mIHRoZSByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYmxvY2tJbmZvLmFueUtlZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5kaWZDb21tYW5kID09PSAnZWxzZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gIWJsb2NrSW5mby5rZWVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRlZCA9IFByZXByb2Nlc3Nvci5ldmFsdWF0ZShlbmRpZlsyXSwgZGVmaW5lcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGV2YWx1YXRlZC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yIHx8PSBldmFsdWF0ZWQuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYmFjayB0byBzdGFja1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55S2VlcDogYmxvY2tJbmZvLmFueUtlZXAgfHwgcmVzdWx0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXA6IHJlc3VsdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogS0VZV09SRC5sYXN0SW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBLRVlXT1JELmxhc3RJbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlELCBgJHtrZXl3b3JkfTogWyR7ZW5kaWZbMl19XSA9PiAke3Jlc3VsdH1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIHByZXByb2Nlc3Mgc2hhZGVyOiBcIiwgeyBzb3VyY2U6IG9yaWdpbmFsU291cmNlIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsU291cmNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9XG5cbiAgICAvLyBmdW5jdGlvbiByZXR1cm5zIHRydWUgaWYgdGhlIGV2YWx1YXRpb24gaXMgaW5zaWRlIGtlZXAgYnJhbmNoZXNcbiAgICBzdGF0aWMgX2tlZXAoc3RhY2spIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGFjay5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCFzdGFja1tpXS5rZWVwKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZlcnkgc2ltcGxlIGV4cHJlc3Npb24gZXZhbHVhdGlvbiwgaGFuZGxlcyBjYXNlczpcbiAgICAgKiBleHByZXNzaW9uXG4gICAgICogZGVmaW5lZChleHByZXNzaW9uKVxuICAgICAqICFkZWZpbmVkKGV4cHJlc3Npb24pXG4gICAgICpcbiAgICAgKiBCdXQgZG9lcyBub3QgaGFuZGxlIG1vcmUgY29tcGxleCBjYXNlcywgd2hpY2ggd291bGQgcmVxdWlyZSBtb3JlIGNvbXBsZXggc3lzdGVtOlxuICAgICAqIGRlZmluZWQoQSkgfHwgZGVmaW5lZChCKVxuICAgICAqL1xuICAgIHN0YXRpYyBldmFsdWF0ZShleHByZXNzaW9uLCBkZWZpbmVzKSB7XG5cbiAgICAgICAgY29uc3QgY29ycmVjdCA9IElOVkFMSUQuZXhlYyhleHByZXNzaW9uKSA9PT0gbnVsbDtcbiAgICAgICAgRGVidWcuYXNzZXJ0KGNvcnJlY3QsIGBSZXNvbHZpbmcgZXhwcmVzc2lvbiBsaWtlIHRoaXMgaXMgbm90IHN1cHBvcnRlZDogJHtleHByZXNzaW9ufWApO1xuXG4gICAgICAgIC8vIGlmIHRoZSBmb3JtYXQgaXMgZGVmaW5lZChleHByZXNzaW9uKSwgZXh0cmFjdCBleHByZXNzaW9uXG4gICAgICAgIGxldCBpbnZlcnQgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgZGVmaW5lZCA9IERFRklORUQuZXhlYyhleHByZXNzaW9uKTtcbiAgICAgICAgaWYgKGRlZmluZWQpIHtcbiAgICAgICAgICAgIGludmVydCA9IGRlZmluZWRbMV0gPT09ICchJztcbiAgICAgICAgICAgIGV4cHJlc3Npb24gPSBkZWZpbmVkWzJdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGVzdCBpZiBleHByZXNzaW9uIGRlZmluZSBleGlzdHNcbiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24udHJpbSgpO1xuICAgICAgICBsZXQgZXhpc3RzID0gZGVmaW5lcy5oYXMoZXhwcmVzc2lvbik7XG5cbiAgICAgICAgLy8gaGFuZGxlIGludmVyc2lvblxuICAgICAgICBpZiAoaW52ZXJ0KSB7XG4gICAgICAgICAgICBleGlzdHMgPSAhZXhpc3RzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3VsdDogZXhpc3RzLFxuICAgICAgICAgICAgZXJyb3I6ICFjb3JyZWN0XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBQcmVwcm9jZXNzb3IgfTtcbiJdLCJuYW1lcyI6WyJUUkFDRUlEIiwiS0VZV09SRCIsIkRFRklORSIsIkVYVEVOU0lPTiIsIlVOREVGIiwiSUYiLCJFTkRJRiIsIklERU5USUZJRVIiLCJERUZJTkVEIiwiSU5WQUxJRCIsIlByZXByb2Nlc3NvciIsInJ1biIsInNvdXJjZSIsInJlcGxhY2UiLCJzcGxpdCIsIm1hcCIsImxpbmUiLCJ0cmltRW5kIiwiam9pbiIsIl9wcmVwcm9jZXNzIiwidHJpbSIsIm9yaWdpbmFsU291cmNlIiwic3RhY2siLCJlcnJvciIsImRlZmluZXMiLCJNYXAiLCJtYXRjaCIsImV4ZWMiLCJrZXl3b3JkIiwibGFzdEluZGV4IiwiaW5kZXgiLCJkZWZpbmUiLCJEZWJ1ZyIsImFzc2VydCIsInN1YnN0cmluZyIsImV4cHJlc3Npb24iLCJpZGVudGlmaWVyVmFsdWUiLCJpZGVudGlmaWVyIiwidmFsdWUiLCJsZW5ndGgiLCJrZWVwIiwiX2tlZXAiLCJzZXQiLCJ0cmFjZSIsInVuZGVmIiwiZGVsZXRlIiwiZXh0ZW5zaW9uIiwiaWZmIiwiZXZhbHVhdGVkIiwiZXZhbHVhdGUiLCJyZXN1bHQiLCJwdXNoIiwiYW55S2VlcCIsInN0YXJ0IiwiZW5kIiwiZW5kaWYiLCJibG9ja0luZm8iLCJwb3AiLCJibG9ja0NvZGUiLCJlbmRpZkNvbW1hbmQiLCJjb25zb2xlIiwi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
