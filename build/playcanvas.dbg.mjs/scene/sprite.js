/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../core/event-handler.js';
import { Vec2 } from '../math/vec2.js';
import { SPRITE_RENDERMODE_SIMPLE, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from './constants.js';
import { createMesh } from './procedural.js';

const spriteNormals = [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1];
const spriteIndices = [0, 1, 3, 2, 3, 1];

class Sprite extends EventHandler {
  constructor(device, options) {
    super();
    this._device = device;
    this._pixelsPerUnit = options && options.pixelsPerUnit !== undefined ? options.pixelsPerUnit : 1;
    this._renderMode = options && options.renderMode !== undefined ? options.renderMode : SPRITE_RENDERMODE_SIMPLE;
    this._atlas = options && options.atlas !== undefined ? options.atlas : null;
    this._frameKeys = options && options.frameKeys !== undefined ? options.frameKeys : null;
    this._meshes = [];
    this._updatingProperties = false;
    this._meshesDirty = false;

    if (this._atlas && this._frameKeys) {
      this._createMeshes();
    }
  }

  set frameKeys(value) {
    this._frameKeys = value;

    if (this._atlas && this._frameKeys) {
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }

    this.fire('set:frameKeys', value);
  }

  get frameKeys() {
    return this._frameKeys;
  }

  set atlas(value) {
    if (value === this._atlas) return;

    if (this._atlas) {
      this._atlas.off('set:frames', this._onSetFrames, this);

      this._atlas.off('set:frame', this._onFrameChanged, this);

      this._atlas.off('remove:frame', this._onFrameRemoved, this);
    }

    this._atlas = value;

    if (this._atlas && this._frameKeys) {
      this._atlas.on('set:frames', this._onSetFrames, this);

      this._atlas.on('set:frame', this._onFrameChanged, this);

      this._atlas.on('remove:frame', this._onFrameRemoved, this);

      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }

    this.fire('set:atlas', value);
  }

  get atlas() {
    return this._atlas;
  }

  set pixelsPerUnit(value) {
    if (this._pixelsPerUnit === value) return;
    this._pixelsPerUnit = value;
    this.fire('set:pixelsPerUnit', value);

    if (this._atlas && this._frameKeys && this.renderMode === SPRITE_RENDERMODE_SIMPLE) {
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
  }

  get pixelsPerUnit() {
    return this._pixelsPerUnit;
  }

  set renderMode(value) {
    if (this._renderMode === value) return;
    const prev = this._renderMode;
    this._renderMode = value;
    this.fire('set:renderMode', value);

    if (prev === SPRITE_RENDERMODE_SIMPLE || value === SPRITE_RENDERMODE_SIMPLE) {
      if (this._atlas && this._frameKeys) {
        if (this._updatingProperties) {
          this._meshesDirty = true;
        } else {
          this._createMeshes();
        }
      }
    }
  }

  get renderMode() {
    return this._renderMode;
  }

  get meshes() {
    return this._meshes;
  }

  _createMeshes() {
    const len = this._meshes.length;

    for (let i = 0; i < len; i++) {
      const mesh = this._meshes[i];

      if (mesh) {
        mesh.destroy();
      }
    }

    const count = this._frameKeys.length;
    this._meshes = new Array(count);
    const createMeshFunc = this.renderMode === SPRITE_RENDERMODE_SLICED || this._renderMode === SPRITE_RENDERMODE_TILED ? this._create9SliceMesh : this._createSimpleMesh;

    for (let i = 0; i < count; i++) {
      const frame = this._atlas.frames[this._frameKeys[i]];
      this._meshes[i] = frame ? createMeshFunc.call(this, frame) : null;
    }

    this.fire('set:meshes');
  }

  _createSimpleMesh(frame) {
    const rect = frame.rect;
    const texWidth = this._atlas.texture.width;
    const texHeight = this._atlas.texture.height;
    const w = rect.z / this._pixelsPerUnit;
    const h = rect.w / this._pixelsPerUnit;
    const hp = frame.pivot.x;
    const vp = frame.pivot.y;
    const positions = [-hp * w, -vp * h, 0, (1 - hp) * w, -vp * h, 0, (1 - hp) * w, (1 - vp) * h, 0, -hp * w, (1 - vp) * h, 0];
    const lu = rect.x / texWidth;
    const bv = 1.0 - rect.y / texHeight;
    const ru = (rect.x + rect.z) / texWidth;
    const tv = 1.0 - (rect.y + rect.w) / texHeight;
    const uvs = [lu, bv, ru, bv, ru, tv, lu, tv];
    const mesh = createMesh(this._device, positions, {
      uvs: uvs,
      normals: spriteNormals,
      indices: spriteIndices
    });
    return mesh;
  }

  _create9SliceMesh() {
    const he = Vec2.ONE;
    const ws = 3;
    const ls = 3;
    const positions = [];
    const normals = [];
    const uvs = [];
    const indices = [];
    let vcounter = 0;

    for (let i = 0; i <= ws; i++) {
      const u = i === 0 || i === ws ? 0 : 1;

      for (let j = 0; j <= ls; j++) {
        const x = -he.x + 2.0 * he.x * (i <= 1 ? 0 : 3) / ws;
        const y = 0.0;
        const z = -(-he.y + 2.0 * he.y * (j <= 1 ? 0 : 3) / ls);
        const v = j === 0 || j === ls ? 0 : 1;
        positions.push(-x, y, z);
        normals.push(0.0, 1.0, 0.0);
        uvs.push(u, v);

        if (i < ws && j < ls) {
          indices.push(vcounter + ls + 1, vcounter + 1, vcounter);
          indices.push(vcounter + ls + 1, vcounter + ls + 2, vcounter + 1);
        }

        vcounter++;
      }
    }

    const options = {
      normals: normals,
      uvs: uvs,
      indices: indices
    };
    return createMesh(this._device, positions, options);
  }

  _onSetFrames(frames) {
    if (this._updatingProperties) {
      this._meshesDirty = true;
    } else {
      this._createMeshes();
    }
  }

  _onFrameChanged(frameKey, frame) {
    const idx = this._frameKeys.indexOf(frameKey);

    if (idx < 0) return;

    if (frame) {
      if (this.renderMode === SPRITE_RENDERMODE_SIMPLE) {
        this._meshes[idx] = this._createSimpleMesh(frame);
      }
    } else {
      this._meshes[idx] = null;
    }

    this.fire('set:meshes');
  }

  _onFrameRemoved(frameKey) {
    const idx = this._frameKeys.indexOf(frameKey);

    if (idx < 0) return;
    this._meshes[idx] = null;
    this.fire('set:meshes');
  }

  startUpdate() {
    this._updatingProperties = true;
    this._meshesDirty = false;
  }

  endUpdate() {
    this._updatingProperties = false;

    if (this._meshesDirty && this._atlas && this._frameKeys) {
      this._createMeshes();
    }

    this._meshesDirty = false;
  }

  destroy() {
    for (const mesh of this._meshes) {
      if (mesh) mesh.destroy();
    }

    this._meshes.length = 0;
  }

}

export { Sprite };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaXRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2NlbmUvc3ByaXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5cbmltcG9ydCB7IFZlYzIgfSBmcm9tICcuLi9tYXRoL3ZlYzIuanMnO1xuXG5pbXBvcnQgeyBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUsIFNQUklURV9SRU5ERVJNT0RFX1NMSUNFRCwgU1BSSVRFX1JFTkRFUk1PREVfVElMRUQgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBjcmVhdGVNZXNoIH0gZnJvbSAnLi9wcm9jZWR1cmFsLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL2dyYXBoaWNzL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBHcmFwaGljc0RldmljZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vbWVzaC5qcycpLk1lc2h9IE1lc2ggKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL3RleHR1cmUtYXRsYXMuanMnKS5UZXh0dXJlQXRsYXN9IFRleHR1cmVBdGxhcyAqL1xuXG4vLyBub3JtYWxzIGFyZSB0aGUgc2FtZSBmb3IgZXZlcnkgbWVzaFxuY29uc3Qgc3ByaXRlTm9ybWFscyA9IFtcbiAgICAwLCAwLCAxLFxuICAgIDAsIDAsIDEsXG4gICAgMCwgMCwgMSxcbiAgICAwLCAwLCAxXG5dO1xuXG4vLyBpbmRpY2VzIGFyZSB0aGUgc2FtZSBmb3IgZXZlcnkgbWVzaFxuY29uc3Qgc3ByaXRlSW5kaWNlcyA9IFtcbiAgICAwLCAxLCAzLFxuICAgIDIsIDMsIDFcbl07XG5cbi8qKlxuICogQSBTcHJpdGUgY29udGFpbnMgcmVmZXJlbmNlcyB0byBvbmUgb3IgbW9yZSBmcmFtZXMgb2YgYSB7QGxpbmsgVGV4dHVyZUF0bGFzfS4gSXQgY2FuIGJlIHVzZWQgYnlcbiAqIHRoZSB7QGxpbmsgU3ByaXRlQ29tcG9uZW50fSBvciB0aGUge0BsaW5rIEVsZW1lbnRDb21wb25lbnR9IHRvIHJlbmRlciBhIHNpbmdsZSBmcmFtZSBvciBhIHNwcml0ZVxuICogYW5pbWF0aW9uLlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgU3ByaXRlIGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU3ByaXRlIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtHcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlIGdyYXBoaWNzIGRldmljZSBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIE9wdGlvbnMgZm9yIGNyZWF0aW5nIHRoZSBTcHJpdGUuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnBpeGVsc1BlclVuaXRdIC0gVGhlIG51bWJlciBvZiBwaXhlbHMgdGhhdCBtYXAgdG8gb25lIFBsYXlDYW52YXNcbiAgICAgKiB1bml0LiBEZWZhdWx0cyB0byAxLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5yZW5kZXJNb2RlXSAtIFRoZSByZW5kZXJpbmcgbW9kZSBvZiB0aGUgc3ByaXRlLiBDYW4gYmU6XG4gICAgICpcbiAgICAgKiAtIHtAbGluayBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEV9XG4gICAgICogLSB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEfVxuICAgICAqIC0ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1RJTEVEfVxuICAgICAqXG4gICAgICogRGVmYXVsdHMgdG8ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRX0uXG4gICAgICogQHBhcmFtIHtUZXh0dXJlQXRsYXN9IFtvcHRpb25zLmF0bGFzXSAtIFRoZSB0ZXh0dXJlIGF0bGFzLiBEZWZhdWx0cyB0byBudWxsLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IFtvcHRpb25zLmZyYW1lS2V5c10gLSBUaGUga2V5cyBvZiB0aGUgZnJhbWVzIGluIHRoZSBzcHJpdGUgYXRsYXMgdGhhdCB0aGlzXG4gICAgICogc3ByaXRlIGlzIHVzaW5nLiBEZWZhdWx0cyB0byBudWxsLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGRldmljZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuX2RldmljZSA9IGRldmljZTtcbiAgICAgICAgdGhpcy5fcGl4ZWxzUGVyVW5pdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5waXhlbHNQZXJVbml0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnBpeGVsc1BlclVuaXQgOiAxO1xuICAgICAgICB0aGlzLl9yZW5kZXJNb2RlID0gb3B0aW9ucyAmJiBvcHRpb25zLnJlbmRlck1vZGUgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucmVuZGVyTW9kZSA6IFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRTtcbiAgICAgICAgdGhpcy5fYXRsYXMgPSBvcHRpb25zICYmIG9wdGlvbnMuYXRsYXMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYXRsYXMgOiBudWxsO1xuICAgICAgICB0aGlzLl9mcmFtZUtleXMgPSBvcHRpb25zICYmIG9wdGlvbnMuZnJhbWVLZXlzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmZyYW1lS2V5cyA6IG51bGw7XG4gICAgICAgIHRoaXMuX21lc2hlcyA9IFtdO1xuXG4gICAgICAgIC8vIHNldCB0byB0cnVlIHRvIHVwZGF0ZSBtdWx0aXBsZVxuICAgICAgICAvLyBwcm9wZXJ0aWVzIHdpdGhvdXQgcmUtY3JlYXRpbmcgbWVzaGVzXG4gICAgICAgIHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcyA9IGZhbHNlO1xuICAgICAgICAvLyBpZiB0cnVlLCBlbmRVcGRhdGUoKSB3aWxsIHJlLWNyZWF0ZSBtZXNoZXMgd2hlbiBpdCdzIGNhbGxlZFxuICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGtleXMgb2YgdGhlIGZyYW1lcyBpbiB0aGUgc3ByaXRlIGF0bGFzIHRoYXQgdGhpcyBzcHJpdGUgaXMgdXNpbmcuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nW119XG4gICAgICovXG4gICAgc2V0IGZyYW1lS2V5cyh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9mcmFtZUtleXMgPSB2YWx1ZTtcblxuICAgICAgICBpZiAodGhpcy5fYXRsYXMgJiYgdGhpcy5fZnJhbWVLZXlzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVNZXNoZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OmZyYW1lS2V5cycsIHZhbHVlKTtcbiAgICB9XG5cbiAgICBnZXQgZnJhbWVLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVLZXlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSB0ZXh0dXJlIGF0bGFzLlxuICAgICAqXG4gICAgICogQHR5cGUge1RleHR1cmVBdGxhc31cbiAgICAgKi9cbiAgICBzZXQgYXRsYXModmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB0aGlzLl9hdGxhcykgcmV0dXJuO1xuXG4gICAgICAgIGlmICh0aGlzLl9hdGxhcykge1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub2ZmKCdzZXQ6ZnJhbWVzJywgdGhpcy5fb25TZXRGcmFtZXMsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub2ZmKCdzZXQ6ZnJhbWUnLCB0aGlzLl9vbkZyYW1lQ2hhbmdlZCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vZmYoJ3JlbW92ZTpmcmFtZScsIHRoaXMuX29uRnJhbWVSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2F0bGFzID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2F0bGFzLm9uKCdzZXQ6ZnJhbWVzJywgdGhpcy5fb25TZXRGcmFtZXMsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub24oJ3NldDpmcmFtZScsIHRoaXMuX29uRnJhbWVDaGFuZ2VkLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2F0bGFzLm9uKCdyZW1vdmU6ZnJhbWUnLCB0aGlzLl9vbkZyYW1lUmVtb3ZlZCwgdGhpcyk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6YXRsYXMnLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgZ2V0IGF0bGFzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXRsYXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBwaXhlbHMgdGhhdCBtYXAgdG8gb25lIFBsYXlDYW52YXMgdW5pdC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHBpeGVsc1BlclVuaXQodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BpeGVsc1BlclVuaXQgPT09IHZhbHVlKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fcGl4ZWxzUGVyVW5pdCA9IHZhbHVlO1xuICAgICAgICB0aGlzLmZpcmUoJ3NldDpwaXhlbHNQZXJVbml0JywgdmFsdWUpO1xuXG4gICAgICAgIC8vIHNpbXBsZSBtb2RlIHVzZXMgcGl4ZWxzUGVyVW5pdCB0byBjcmVhdGUgdGhlIG1lc2ggc28gcmUtY3JlYXRlIHRob3NlIG1lc2hlc1xuICAgICAgICBpZiAodGhpcy5fYXRsYXMgJiYgdGhpcy5fZnJhbWVLZXlzICYmIHRoaXMucmVuZGVyTW9kZSA9PT0gU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVNZXNoZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBwaXhlbHNQZXJVbml0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGl4ZWxzUGVyVW5pdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcmVuZGVyaW5nIG1vZGUgb2YgdGhlIHNwcml0ZS4gQ2FuIGJlOlxuICAgICAqXG4gICAgICogLSB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFfVxuICAgICAqIC0ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1NMSUNFRH1cbiAgICAgKiAtIHtAbGluayBTUFJJVEVfUkVOREVSTU9ERV9USUxFRH1cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHJlbmRlck1vZGUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3JlbmRlck1vZGUgPT09IHZhbHVlKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLl9yZW5kZXJNb2RlO1xuICAgICAgICB0aGlzLl9yZW5kZXJNb2RlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OnJlbmRlck1vZGUnLCB2YWx1ZSk7XG5cbiAgICAgICAgLy8gcmUtY3JlYXRlIHRoZSBtZXNoZXMgaWYgd2UncmUgZ29pbmcgZnJvbSBzaW1wbGUgdG8gOS1zbGljZWQgb3IgdmljZSB2ZXJzYVxuICAgICAgICBpZiAocHJldiA9PT0gU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFIHx8IHZhbHVlID09PSBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVNZXNoZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcmVuZGVyTW9kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlck1vZGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQW4gYXJyYXkgdGhhdCBjb250YWlucyBhIG1lc2ggZm9yIGVhY2ggZnJhbWUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7TWVzaFtdfVxuICAgICAqL1xuICAgIGdldCBtZXNoZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tZXNoZXM7XG4gICAgfVxuXG4gICAgX2NyZWF0ZU1lc2hlcygpIHtcbiAgICAgICAgLy8gZGVzdHJveSBvbGQgbWVzaGVzXG4gICAgICAgIGNvbnN0IGxlbiA9IHRoaXMuX21lc2hlcy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc2ggPSB0aGlzLl9tZXNoZXNbaV07XG4gICAgICAgICAgICBpZiAobWVzaCkge1xuICAgICAgICAgICAgICAgIG1lc2guZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2xlYXIgbWVzaGVzIGFycmF5XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5fZnJhbWVLZXlzLmxlbmd0aDtcbiAgICAgICAgdGhpcy5fbWVzaGVzID0gbmV3IEFycmF5KGNvdW50KTtcblxuICAgICAgICAvLyBnZXQgZnVuY3Rpb24gdG8gY3JlYXRlIG1lc2hlc1xuICAgICAgICBjb25zdCBjcmVhdGVNZXNoRnVuYyA9ICh0aGlzLnJlbmRlck1vZGUgPT09IFNQUklURV9SRU5ERVJNT0RFX1NMSUNFRCB8fCB0aGlzLl9yZW5kZXJNb2RlID09PSBTUFJJVEVfUkVOREVSTU9ERV9USUxFRCA/IHRoaXMuX2NyZWF0ZTlTbGljZU1lc2ggOiB0aGlzLl9jcmVhdGVTaW1wbGVNZXNoKTtcblxuICAgICAgICAvLyBjcmVhdGUgYSBtZXNoIGZvciBlYWNoIGZyYW1lIGluIHRoZSBzcHJpdGVcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuX2F0bGFzLmZyYW1lc1t0aGlzLl9mcmFtZUtleXNbaV1dO1xuICAgICAgICAgICAgdGhpcy5fbWVzaGVzW2ldID0gZnJhbWUgPyBjcmVhdGVNZXNoRnVuYy5jYWxsKHRoaXMsIGZyYW1lKSA6IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZpcmUoJ3NldDptZXNoZXMnKTtcbiAgICB9XG5cbiAgICBfY3JlYXRlU2ltcGxlTWVzaChmcmFtZSkge1xuICAgICAgICBjb25zdCByZWN0ID0gZnJhbWUucmVjdDtcbiAgICAgICAgY29uc3QgdGV4V2lkdGggPSB0aGlzLl9hdGxhcy50ZXh0dXJlLndpZHRoO1xuICAgICAgICBjb25zdCB0ZXhIZWlnaHQgPSB0aGlzLl9hdGxhcy50ZXh0dXJlLmhlaWdodDtcblxuICAgICAgICBjb25zdCB3ID0gcmVjdC56IC8gdGhpcy5fcGl4ZWxzUGVyVW5pdDtcbiAgICAgICAgY29uc3QgaCA9IHJlY3QudyAvIHRoaXMuX3BpeGVsc1BlclVuaXQ7XG4gICAgICAgIGNvbnN0IGhwID0gZnJhbWUucGl2b3QueDtcbiAgICAgICAgY29uc3QgdnAgPSBmcmFtZS5waXZvdC55O1xuXG4gICAgICAgIC8vIHBvc2l0aW9ucyBiYXNlZCBvbiBwaXZvdCBhbmQgc2l6ZSBvZiBmcmFtZVxuICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBbXG4gICAgICAgICAgICAtaHAgKiB3LCAgICAgIC12cCAqIGgsICAgICAgMCxcbiAgICAgICAgICAgICgxIC0gaHApICogdywgLXZwICogaCwgICAgICAwLFxuICAgICAgICAgICAgKDEgLSBocCkgKiB3LCAoMSAtIHZwKSAqIGgsIDAsXG4gICAgICAgICAgICAtaHAgKiB3LCAgICAgICgxIC0gdnApICogaCwgMFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIHV2cyBiYXNlZCBvbiBmcmFtZSByZWN0XG4gICAgICAgIC8vIHV2c1xuICAgICAgICBjb25zdCBsdSA9IHJlY3QueCAvIHRleFdpZHRoO1xuICAgICAgICBjb25zdCBidiA9IDEuMCAtIHJlY3QueSAvIHRleEhlaWdodDtcbiAgICAgICAgY29uc3QgcnUgPSAocmVjdC54ICsgcmVjdC56KSAvIHRleFdpZHRoO1xuICAgICAgICBjb25zdCB0diA9IDEuMCAtIChyZWN0LnkgKyByZWN0LncpIC8gdGV4SGVpZ2h0O1xuXG4gICAgICAgIGNvbnN0IHV2cyA9IFtcbiAgICAgICAgICAgIGx1LCBidixcbiAgICAgICAgICAgIHJ1LCBidixcbiAgICAgICAgICAgIHJ1LCB0dixcbiAgICAgICAgICAgIGx1LCB0dlxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IG1lc2ggPSBjcmVhdGVNZXNoKHRoaXMuX2RldmljZSwgcG9zaXRpb25zLCB7XG4gICAgICAgICAgICB1dnM6IHV2cyxcbiAgICAgICAgICAgIG5vcm1hbHM6IHNwcml0ZU5vcm1hbHMsXG4gICAgICAgICAgICBpbmRpY2VzOiBzcHJpdGVJbmRpY2VzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBtZXNoO1xuICAgIH1cblxuICAgIF9jcmVhdGU5U2xpY2VNZXNoKCkge1xuICAgICAgICAvLyBDaGVjayB0aGUgc3VwcGxpZWQgb3B0aW9ucyBhbmQgcHJvdmlkZSBkZWZhdWx0cyBmb3IgdW5zcGVjaWZpZWQgb25lc1xuICAgICAgICBjb25zdCBoZSA9IFZlYzIuT05FO1xuICAgICAgICBjb25zdCB3cyA9IDM7XG4gICAgICAgIGNvbnN0IGxzID0gMztcblxuICAgICAgICAvLyBWYXJpYWJsZSBkZWNsYXJhdGlvbnNcbiAgICAgICAgY29uc3QgcG9zaXRpb25zID0gW107XG4gICAgICAgIGNvbnN0IG5vcm1hbHMgPSBbXTtcbiAgICAgICAgY29uc3QgdXZzID0gW107XG4gICAgICAgIGNvbnN0IGluZGljZXMgPSBbXTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBwbGFuZSBhcyBmb2xsb3dzIChhc3NpZ25lZCBVVnMgZGVub3RlZCBhdCBjb3JuZXJzKTpcbiAgICAgICAgLy8gKDAsMSl4LS0tLS0tLS0teCgxLDEpXG4gICAgICAgIC8vICAgICAgfCAgICAgICAgIHxcbiAgICAgICAgLy8gICAgICB8ICAgICAgICAgfFxuICAgICAgICAvLyAgICAgIHwgICAgTy0tWCB8bGVuZ3RoXG4gICAgICAgIC8vICAgICAgfCAgICB8ICAgIHxcbiAgICAgICAgLy8gICAgICB8ICAgIFogICAgfFxuICAgICAgICAvLyAoMCwwKXgtLS0tLS0tLS14KDEsMClcbiAgICAgICAgLy8gd2lkdGhcbiAgICAgICAgbGV0IHZjb3VudGVyID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gd3M7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdSA9IChpID09PSAwIHx8IGkgPT09IHdzKSA/IDAgOiAxO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSBsczsgaisrKSB7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gLWhlLnggKyAyLjAgKiBoZS54ICogKGkgPD0gMSA/IDAgOiAzKSAvIHdzO1xuICAgICAgICAgICAgICAgIGNvbnN0IHkgPSAwLjA7XG4gICAgICAgICAgICAgICAgY29uc3QgeiA9IC0oLWhlLnkgKyAyLjAgKiBoZS55ICogKGogPD0gMSA/IDAgOiAzKSAvIGxzKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHYgPSAoaiA9PT0gMCB8fCBqID09PSBscykgPyAwIDogMTtcblxuICAgICAgICAgICAgICAgIHBvc2l0aW9ucy5wdXNoKC14LCB5LCB6KTtcbiAgICAgICAgICAgICAgICBub3JtYWxzLnB1c2goMC4wLCAxLjAsIDAuMCk7XG4gICAgICAgICAgICAgICAgdXZzLnB1c2godSwgdik7XG5cbiAgICAgICAgICAgICAgICBpZiAoKGkgPCB3cykgJiYgKGogPCBscykpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKHZjb3VudGVyICsgbHMgKyAxLCB2Y291bnRlciArIDEsIHZjb3VudGVyKTtcbiAgICAgICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKHZjb3VudGVyICsgbHMgKyAxLCB2Y291bnRlciArIGxzICsgMiwgdmNvdW50ZXIgKyAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2Y291bnRlcisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG5vcm1hbHM6IG5vcm1hbHMsIC8vIGNyYXNoZXMgd2l0aG91dCBub3JtYWxzIG9uIG1hYz9cbiAgICAgICAgICAgIHV2czogdXZzLFxuICAgICAgICAgICAgaW5kaWNlczogaW5kaWNlc1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBjcmVhdGVNZXNoKHRoaXMuX2RldmljZSwgcG9zaXRpb25zLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBfb25TZXRGcmFtZXMoZnJhbWVzKSB7XG4gICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uRnJhbWVDaGFuZ2VkKGZyYW1lS2V5LCBmcmFtZSkge1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9mcmFtZUtleXMuaW5kZXhPZihmcmFtZUtleSk7XG4gICAgICAgIGlmIChpZHggPCAwKSByZXR1cm47XG5cbiAgICAgICAgaWYgKGZyYW1lKSB7XG4gICAgICAgICAgICAvLyBvbmx5IHJlLWNyZWF0ZSBmcmFtZSBmb3Igc2ltcGxlIHJlbmRlciBtb2RlLCBzaW5jZVxuICAgICAgICAgICAgLy8gOS1zbGljZWQgbWVzaGVzIGRvbid0IG5lZWQgZnJhbWUgaW5mbyB0byBjcmVhdGUgdGhlaXIgbWVzaFxuICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyTW9kZSA9PT0gU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWVzaGVzW2lkeF0gPSB0aGlzLl9jcmVhdGVTaW1wbGVNZXNoKGZyYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX21lc2hlc1tpZHhdID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyZSgnc2V0Om1lc2hlcycpO1xuICAgIH1cblxuICAgIF9vbkZyYW1lUmVtb3ZlZChmcmFtZUtleSkge1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9mcmFtZUtleXMuaW5kZXhPZihmcmFtZUtleSk7XG4gICAgICAgIGlmIChpZHggPCAwKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fbWVzaGVzW2lkeF0gPSBudWxsO1xuICAgICAgICB0aGlzLmZpcmUoJ3NldDptZXNoZXMnKTtcbiAgICB9XG5cbiAgICBzdGFydFVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBlbmRVcGRhdGUoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcyA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5fbWVzaGVzRGlydHkgJiYgdGhpcy5fYXRsYXMgJiYgdGhpcy5fZnJhbWVLZXlzKSB7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVNZXNoZXMoKTtcblxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnJlZSB1cCB0aGUgbWVzaGVzIGNyZWF0ZWQgYnkgdGhlIHNwcml0ZS5cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBmb3IgKGNvbnN0IG1lc2ggb2YgdGhpcy5fbWVzaGVzKSB7XG4gICAgICAgICAgICBpZiAobWVzaClcbiAgICAgICAgICAgICAgICBtZXNoLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tZXNoZXMubGVuZ3RoID0gMDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFNwcml0ZSB9O1xuIl0sIm5hbWVzIjpbInNwcml0ZU5vcm1hbHMiLCJzcHJpdGVJbmRpY2VzIiwiU3ByaXRlIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJkZXZpY2UiLCJvcHRpb25zIiwiX2RldmljZSIsIl9waXhlbHNQZXJVbml0IiwicGl4ZWxzUGVyVW5pdCIsInVuZGVmaW5lZCIsIl9yZW5kZXJNb2RlIiwicmVuZGVyTW9kZSIsIlNQUklURV9SRU5ERVJNT0RFX1NJTVBMRSIsIl9hdGxhcyIsImF0bGFzIiwiX2ZyYW1lS2V5cyIsImZyYW1lS2V5cyIsIl9tZXNoZXMiLCJfdXBkYXRpbmdQcm9wZXJ0aWVzIiwiX21lc2hlc0RpcnR5IiwiX2NyZWF0ZU1lc2hlcyIsInZhbHVlIiwiZmlyZSIsIm9mZiIsIl9vblNldEZyYW1lcyIsIl9vbkZyYW1lQ2hhbmdlZCIsIl9vbkZyYW1lUmVtb3ZlZCIsIm9uIiwicHJldiIsIm1lc2hlcyIsImxlbiIsImxlbmd0aCIsImkiLCJtZXNoIiwiZGVzdHJveSIsImNvdW50IiwiQXJyYXkiLCJjcmVhdGVNZXNoRnVuYyIsIlNQUklURV9SRU5ERVJNT0RFX1NMSUNFRCIsIlNQUklURV9SRU5ERVJNT0RFX1RJTEVEIiwiX2NyZWF0ZTlTbGljZU1lc2giLCJfY3JlYXRlU2ltcGxlTWVzaCIsImZyYW1lIiwiZnJhbWVzIiwiY2FsbCIsInJlY3QiLCJ0ZXhXaWR0aCIsInRleHR1cmUiLCJ3aWR0aCIsInRleEhlaWdodCIsImhlaWdodCIsInciLCJ6IiwiaCIsImhwIiwicGl2b3QiLCJ4IiwidnAiLCJ5IiwicG9zaXRpb25zIiwibHUiLCJidiIsInJ1IiwidHYiLCJ1dnMiLCJjcmVhdGVNZXNoIiwibm9ybWFscyIsImluZGljZXMiLCJoZSIsIlZlYzIiLCJPTkUiLCJ3cyIsImxzIiwidmNvdW50ZXIiLCJ1IiwiaiIsInYiLCJwdXNoIiwiZnJhbWVLZXkiLCJpZHgiLCJpbmRleE9mIiwic3RhcnRVcGRhdGUiLCJlbmRVcGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFZQSxNQUFNQSxhQUFhLEdBQUcsQ0FDbEIsQ0FEa0IsRUFDZixDQURlLEVBQ1osQ0FEWSxFQUVsQixDQUZrQixFQUVmLENBRmUsRUFFWixDQUZZLEVBR2xCLENBSGtCLEVBR2YsQ0FIZSxFQUdaLENBSFksRUFJbEIsQ0FKa0IsRUFJZixDQUplLEVBSVosQ0FKWSxDQUF0QixDQUFBO0FBUUEsTUFBTUMsYUFBYSxHQUFHLENBQ2xCLENBRGtCLEVB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
