/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../core/event-handler.js';
import { Vec2 } from '../core/math/vec2.js';
import { SPRITE_RENDERMODE_SIMPLE, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from './constants.js';
import { createMesh } from './procedural.js';

const spriteNormals = [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1];

const spriteIndices = [0, 1, 3, 2, 3, 1];

class Sprite extends EventHandler {
  constructor(device, options) {
    super();
    this._device = device;
    this._pixelsPerUnit = options && options.pixelsPerUnit !== undefined ? options.pixelsPerUnit : 1;
    this._renderMode = options && options.renderMode !== undefined ? options.renderMode : SPRITE_RENDERMODE_SIMPLE;
    this._atlas = options && options.atlas !== undefined ? options.atlas : null;
    this._frameKeys = options && options.frameKeys !== undefined ? options.frameKeys : null;
    this._meshes = [];

    this._updatingProperties = false;
    this._meshesDirty = false;
    if (this._atlas && this._frameKeys) {
      this._createMeshes();
    }
  }

  set frameKeys(value) {
    this._frameKeys = value;
    if (this._atlas && this._frameKeys) {
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
    this.fire('set:frameKeys', value);
  }
  get frameKeys() {
    return this._frameKeys;
  }

  set atlas(value) {
    if (value === this._atlas) return;
    if (this._atlas) {
      this._atlas.off('set:frames', this._onSetFrames, this);
      this._atlas.off('set:frame', this._onFrameChanged, this);
      this._atlas.off('remove:frame', this._onFrameRemoved, this);
    }
    this._atlas = value;
    if (this._atlas && this._frameKeys) {
      this._atlas.on('set:frames', this._onSetFrames, this);
      this._atlas.on('set:frame', this._onFrameChanged, this);
      this._atlas.on('remove:frame', this._onFrameRemoved, this);
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
    this.fire('set:atlas', value);
  }
  get atlas() {
    return this._atlas;
  }

  set pixelsPerUnit(value) {
    if (this._pixelsPerUnit === value) return;
    this._pixelsPerUnit = value;
    this.fire('set:pixelsPerUnit', value);

    if (this._atlas && this._frameKeys && this.renderMode === SPRITE_RENDERMODE_SIMPLE) {
      if (this._updatingProperties) {
        this._meshesDirty = true;
      } else {
        this._createMeshes();
      }
    }
  }
  get pixelsPerUnit() {
    return this._pixelsPerUnit;
  }

  set renderMode(value) {
    if (this._renderMode === value) return;
    const prev = this._renderMode;
    this._renderMode = value;
    this.fire('set:renderMode', value);

    if (prev === SPRITE_RENDERMODE_SIMPLE || value === SPRITE_RENDERMODE_SIMPLE) {
      if (this._atlas && this._frameKeys) {
        if (this._updatingProperties) {
          this._meshesDirty = true;
        } else {
          this._createMeshes();
        }
      }
    }
  }
  get renderMode() {
    return this._renderMode;
  }

  get meshes() {
    return this._meshes;
  }
  _createMeshes() {
    const len = this._meshes.length;
    for (let i = 0; i < len; i++) {
      const mesh = this._meshes[i];
      if (mesh) {
        mesh.destroy();
      }
    }

    const count = this._frameKeys.length;
    this._meshes = new Array(count);

    const createMeshFunc = this.renderMode === SPRITE_RENDERMODE_SLICED || this._renderMode === SPRITE_RENDERMODE_TILED ? this._create9SliceMesh : this._createSimpleMesh;

    for (let i = 0; i < count; i++) {
      const frame = this._atlas.frames[this._frameKeys[i]];
      this._meshes[i] = frame ? createMeshFunc.call(this, frame) : null;
    }
    this.fire('set:meshes');
  }
  _createSimpleMesh(frame) {
    const rect = frame.rect;
    const texWidth = this._atlas.texture.width;
    const texHeight = this._atlas.texture.height;
    const w = rect.z / this._pixelsPerUnit;
    const h = rect.w / this._pixelsPerUnit;
    const hp = frame.pivot.x;
    const vp = frame.pivot.y;

    const positions = [-hp * w, -vp * h, 0, (1 - hp) * w, -vp * h, 0, (1 - hp) * w, (1 - vp) * h, 0, -hp * w, (1 - vp) * h, 0];

    const lu = rect.x / texWidth;
    const bv = 1.0 - rect.y / texHeight;
    const ru = (rect.x + rect.z) / texWidth;
    const tv = 1.0 - (rect.y + rect.w) / texHeight;
    const uvs = [lu, bv, ru, bv, ru, tv, lu, tv];
    const mesh = createMesh(this._device, positions, {
      uvs: uvs,
      normals: spriteNormals,
      indices: spriteIndices
    });
    return mesh;
  }
  _create9SliceMesh() {
    const he = Vec2.ONE;
    const ws = 3;
    const ls = 3;

    const positions = [];
    const normals = [];
    const uvs = [];
    const indices = [];

    let vcounter = 0;
    for (let i = 0; i <= ws; i++) {
      const u = i === 0 || i === ws ? 0 : 1;
      for (let j = 0; j <= ls; j++) {
        const x = -he.x + 2.0 * he.x * (i <= 1 ? 0 : 3) / ws;
        const y = 0.0;
        const z = -(-he.y + 2.0 * he.y * (j <= 1 ? 0 : 3) / ls);
        const v = j === 0 || j === ls ? 0 : 1;
        positions.push(-x, y, z);
        normals.push(0.0, 1.0, 0.0);
        uvs.push(u, v);
        if (i < ws && j < ls) {
          indices.push(vcounter + ls + 1, vcounter + 1, vcounter);
          indices.push(vcounter + ls + 1, vcounter + ls + 2, vcounter + 1);
        }
        vcounter++;
      }
    }
    const options = {
      normals: normals,
      uvs: uvs,
      indices: indices
    };
    return createMesh(this._device, positions, options);
  }
  _onSetFrames(frames) {
    if (this._updatingProperties) {
      this._meshesDirty = true;
    } else {
      this._createMeshes();
    }
  }
  _onFrameChanged(frameKey, frame) {
    const idx = this._frameKeys.indexOf(frameKey);
    if (idx < 0) return;
    if (frame) {
      if (this.renderMode === SPRITE_RENDERMODE_SIMPLE) {
        this._meshes[idx] = this._createSimpleMesh(frame);
      }
    } else {
      this._meshes[idx] = null;
    }
    this.fire('set:meshes');
  }
  _onFrameRemoved(frameKey) {
    const idx = this._frameKeys.indexOf(frameKey);
    if (idx < 0) return;
    this._meshes[idx] = null;
    this.fire('set:meshes');
  }
  startUpdate() {
    this._updatingProperties = true;
    this._meshesDirty = false;
  }
  endUpdate() {
    this._updatingProperties = false;
    if (this._meshesDirty && this._atlas && this._frameKeys) {
      this._createMeshes();
    }
    this._meshesDirty = false;
  }

  destroy() {
    for (const mesh of this._meshes) {
      if (mesh) mesh.destroy();
    }
    this._meshes.length = 0;
  }
}

export { Sprite };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaXRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2NlbmUvc3ByaXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5pbXBvcnQgeyBWZWMyIH0gZnJvbSAnLi4vY29yZS9tYXRoL3ZlYzIuanMnO1xuXG5pbXBvcnQgeyBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUsIFNQUklURV9SRU5ERVJNT0RFX1NMSUNFRCwgU1BSSVRFX1JFTkRFUk1PREVfVElMRUQgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBjcmVhdGVNZXNoIH0gZnJvbSAnLi9wcm9jZWR1cmFsLmpzJztcblxuLy8gbm9ybWFscyBhcmUgdGhlIHNhbWUgZm9yIGV2ZXJ5IG1lc2hcbmNvbnN0IHNwcml0ZU5vcm1hbHMgPSBbXG4gICAgMCwgMCwgMSxcbiAgICAwLCAwLCAxLFxuICAgIDAsIDAsIDEsXG4gICAgMCwgMCwgMVxuXTtcblxuLy8gaW5kaWNlcyBhcmUgdGhlIHNhbWUgZm9yIGV2ZXJ5IG1lc2hcbmNvbnN0IHNwcml0ZUluZGljZXMgPSBbXG4gICAgMCwgMSwgMyxcbiAgICAyLCAzLCAxXG5dO1xuXG4vKipcbiAqIEEgU3ByaXRlIGNvbnRhaW5zIHJlZmVyZW5jZXMgdG8gb25lIG9yIG1vcmUgZnJhbWVzIG9mIGEge0BsaW5rIFRleHR1cmVBdGxhc30uIEl0IGNhbiBiZSB1c2VkIGJ5XG4gKiB0aGUge0BsaW5rIFNwcml0ZUNvbXBvbmVudH0gb3IgdGhlIHtAbGluayBFbGVtZW50Q29tcG9uZW50fSB0byByZW5kZXIgYSBzaW5nbGUgZnJhbWUgb3IgYSBzcHJpdGVcbiAqIGFuaW1hdGlvbi5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIFNwcml0ZSBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNwcml0ZSBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9wbGF0Zm9ybS9ncmFwaGljcy9ncmFwaGljcy1kZXZpY2UuanMnKS5HcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlXG4gICAgICogZ3JhcGhpY3MgZGV2aWNlIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnNdIC0gT3B0aW9ucyBmb3IgY3JlYXRpbmcgdGhlIFNwcml0ZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMucGl4ZWxzUGVyVW5pdF0gLSBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGF0IG1hcCB0byBvbmUgUGxheUNhbnZhc1xuICAgICAqIHVuaXQuIERlZmF1bHRzIHRvIDEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnJlbmRlck1vZGVdIC0gVGhlIHJlbmRlcmluZyBtb2RlIG9mIHRoZSBzcHJpdGUuIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRX1cbiAgICAgKiAtIHtAbGluayBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUR9XG4gICAgICogLSB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfVElMRUR9XG4gICAgICpcbiAgICAgKiBEZWZhdWx0cyB0byB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFfS5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi90ZXh0dXJlLWF0bGFzLmpzJykuVGV4dHVyZUF0bGFzfSBbb3B0aW9ucy5hdGxhc10gLSBUaGUgdGV4dHVyZSBhdGxhcy5cbiAgICAgKiBEZWZhdWx0cyB0byBudWxsLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IFtvcHRpb25zLmZyYW1lS2V5c10gLSBUaGUga2V5cyBvZiB0aGUgZnJhbWVzIGluIHRoZSBzcHJpdGUgYXRsYXMgdGhhdCB0aGlzXG4gICAgICogc3ByaXRlIGlzIHVzaW5nLiBEZWZhdWx0cyB0byBudWxsLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGRldmljZSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuX2RldmljZSA9IGRldmljZTtcbiAgICAgICAgdGhpcy5fcGl4ZWxzUGVyVW5pdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5waXhlbHNQZXJVbml0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnBpeGVsc1BlclVuaXQgOiAxO1xuICAgICAgICB0aGlzLl9yZW5kZXJNb2RlID0gb3B0aW9ucyAmJiBvcHRpb25zLnJlbmRlck1vZGUgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucmVuZGVyTW9kZSA6IFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRTtcbiAgICAgICAgdGhpcy5fYXRsYXMgPSBvcHRpb25zICYmIG9wdGlvbnMuYXRsYXMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYXRsYXMgOiBudWxsO1xuICAgICAgICB0aGlzLl9mcmFtZUtleXMgPSBvcHRpb25zICYmIG9wdGlvbnMuZnJhbWVLZXlzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmZyYW1lS2V5cyA6IG51bGw7XG4gICAgICAgIHRoaXMuX21lc2hlcyA9IFtdO1xuXG4gICAgICAgIC8vIHNldCB0byB0cnVlIHRvIHVwZGF0ZSBtdWx0aXBsZVxuICAgICAgICAvLyBwcm9wZXJ0aWVzIHdpdGhvdXQgcmUtY3JlYXRpbmcgbWVzaGVzXG4gICAgICAgIHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcyA9IGZhbHNlO1xuICAgICAgICAvLyBpZiB0cnVlLCBlbmRVcGRhdGUoKSB3aWxsIHJlLWNyZWF0ZSBtZXNoZXMgd2hlbiBpdCdzIGNhbGxlZFxuICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIGtleXMgb2YgdGhlIGZyYW1lcyBpbiB0aGUgc3ByaXRlIGF0bGFzIHRoYXQgdGhpcyBzcHJpdGUgaXMgdXNpbmcuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nW119XG4gICAgICovXG4gICAgc2V0IGZyYW1lS2V5cyh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9mcmFtZUtleXMgPSB2YWx1ZTtcblxuICAgICAgICBpZiAodGhpcy5fYXRsYXMgJiYgdGhpcy5fZnJhbWVLZXlzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVNZXNoZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OmZyYW1lS2V5cycsIHZhbHVlKTtcbiAgICB9XG5cbiAgICBnZXQgZnJhbWVLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVLZXlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSB0ZXh0dXJlIGF0bGFzLlxuICAgICAqXG4gICAgICogQHR5cGUge2ltcG9ydCgnLi90ZXh0dXJlLWF0bGFzLmpzJykuVGV4dHVyZUF0bGFzfVxuICAgICAqL1xuICAgIHNldCBhdGxhcyh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT09IHRoaXMuX2F0bGFzKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHRoaXMuX2F0bGFzKSB7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vZmYoJ3NldDpmcmFtZXMnLCB0aGlzLl9vblNldEZyYW1lcywgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vZmYoJ3NldDpmcmFtZScsIHRoaXMuX29uRnJhbWVDaGFuZ2VkLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2F0bGFzLm9mZigncmVtb3ZlOmZyYW1lJywgdGhpcy5fb25GcmFtZVJlbW92ZWQsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fYXRsYXMgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2F0bGFzICYmIHRoaXMuX2ZyYW1lS2V5cykge1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub24oJ3NldDpmcmFtZXMnLCB0aGlzLl9vblNldEZyYW1lcywgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9hdGxhcy5vbignc2V0OmZyYW1lJywgdGhpcy5fb25GcmFtZUNoYW5nZWQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fYXRsYXMub24oJ3JlbW92ZTpmcmFtZScsIHRoaXMuX29uRnJhbWVSZW1vdmVkLCB0aGlzKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTWVzaGVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZpcmUoJ3NldDphdGxhcycsIHZhbHVlKTtcbiAgICB9XG5cbiAgICBnZXQgYXRsYXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdGxhcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGF0IG1hcCB0byBvbmUgUGxheUNhbnZhcyB1bml0LlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgcGl4ZWxzUGVyVW5pdCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5fcGl4ZWxzUGVyVW5pdCA9PT0gdmFsdWUpIHJldHVybjtcblxuICAgICAgICB0aGlzLl9waXhlbHNQZXJVbml0ID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OnBpeGVsc1BlclVuaXQnLCB2YWx1ZSk7XG5cbiAgICAgICAgLy8gc2ltcGxlIG1vZGUgdXNlcyBwaXhlbHNQZXJVbml0IHRvIGNyZWF0ZSB0aGUgbWVzaCBzbyByZS1jcmVhdGUgdGhvc2UgbWVzaGVzXG4gICAgICAgIGlmICh0aGlzLl9hdGxhcyAmJiB0aGlzLl9mcmFtZUtleXMgJiYgdGhpcy5yZW5kZXJNb2RlID09PSBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHBpeGVsc1BlclVuaXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9waXhlbHNQZXJVbml0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSByZW5kZXJpbmcgbW9kZSBvZiB0aGUgc3ByaXRlLiBDYW4gYmU6XG4gICAgICpcbiAgICAgKiAtIHtAbGluayBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEV9XG4gICAgICogLSB7QGxpbmsgU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEfVxuICAgICAqIC0ge0BsaW5rIFNQUklURV9SRU5ERVJNT0RFX1RJTEVEfVxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgcmVuZGVyTW9kZSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5fcmVuZGVyTW9kZSA9PT0gdmFsdWUpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuX3JlbmRlck1vZGU7XG4gICAgICAgIHRoaXMuX3JlbmRlck1vZGUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6cmVuZGVyTW9kZScsIHZhbHVlKTtcblxuICAgICAgICAvLyByZS1jcmVhdGUgdGhlIG1lc2hlcyBpZiB3ZSdyZSBnb2luZyBmcm9tIHNpbXBsZSB0byA5LXNsaWNlZCBvciB2aWNlIHZlcnNhXG4gICAgICAgIGlmIChwcmV2ID09PSBTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUgfHwgdmFsdWUgPT09IFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2F0bGFzICYmIHRoaXMuX2ZyYW1lS2V5cykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVzaGVzRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU1lc2hlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCByZW5kZXJNb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyTW9kZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBbiBhcnJheSB0aGF0IGNvbnRhaW5zIGEgbWVzaCBmb3IgZWFjaCBmcmFtZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtpbXBvcnQoJy4vbWVzaC5qcycpLk1lc2hbXX1cbiAgICAgKi9cbiAgICBnZXQgbWVzaGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWVzaGVzO1xuICAgIH1cblxuICAgIF9jcmVhdGVNZXNoZXMoKSB7XG4gICAgICAgIC8vIGRlc3Ryb3kgb2xkIG1lc2hlc1xuICAgICAgICBjb25zdCBsZW4gPSB0aGlzLl9tZXNoZXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNoID0gdGhpcy5fbWVzaGVzW2ldO1xuICAgICAgICAgICAgaWYgKG1lc2gpIHtcbiAgICAgICAgICAgICAgICBtZXNoLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNsZWFyIG1lc2hlcyBhcnJheVxuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuX2ZyYW1lS2V5cy5sZW5ndGg7XG4gICAgICAgIHRoaXMuX21lc2hlcyA9IG5ldyBBcnJheShjb3VudCk7XG5cbiAgICAgICAgLy8gZ2V0IGZ1bmN0aW9uIHRvIGNyZWF0ZSBtZXNoZXNcbiAgICAgICAgY29uc3QgY3JlYXRlTWVzaEZ1bmMgPSAodGhpcy5yZW5kZXJNb2RlID09PSBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUQgfHwgdGhpcy5fcmVuZGVyTW9kZSA9PT0gU1BSSVRFX1JFTkRFUk1PREVfVElMRUQgPyB0aGlzLl9jcmVhdGU5U2xpY2VNZXNoIDogdGhpcy5fY3JlYXRlU2ltcGxlTWVzaCk7XG5cbiAgICAgICAgLy8gY3JlYXRlIGEgbWVzaCBmb3IgZWFjaCBmcmFtZSBpbiB0aGUgc3ByaXRlXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLl9hdGxhcy5mcmFtZXNbdGhpcy5fZnJhbWVLZXlzW2ldXTtcbiAgICAgICAgICAgIHRoaXMuX21lc2hlc1tpXSA9IGZyYW1lID8gY3JlYXRlTWVzaEZ1bmMuY2FsbCh0aGlzLCBmcmFtZSkgOiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6bWVzaGVzJyk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZVNpbXBsZU1lc2goZnJhbWUpIHtcbiAgICAgICAgY29uc3QgcmVjdCA9IGZyYW1lLnJlY3Q7XG4gICAgICAgIGNvbnN0IHRleFdpZHRoID0gdGhpcy5fYXRsYXMudGV4dHVyZS53aWR0aDtcbiAgICAgICAgY29uc3QgdGV4SGVpZ2h0ID0gdGhpcy5fYXRsYXMudGV4dHVyZS5oZWlnaHQ7XG5cbiAgICAgICAgY29uc3QgdyA9IHJlY3QueiAvIHRoaXMuX3BpeGVsc1BlclVuaXQ7XG4gICAgICAgIGNvbnN0IGggPSByZWN0LncgLyB0aGlzLl9waXhlbHNQZXJVbml0O1xuICAgICAgICBjb25zdCBocCA9IGZyYW1lLnBpdm90Lng7XG4gICAgICAgIGNvbnN0IHZwID0gZnJhbWUucGl2b3QueTtcblxuICAgICAgICAvLyBwb3NpdGlvbnMgYmFzZWQgb24gcGl2b3QgYW5kIHNpemUgb2YgZnJhbWVcbiAgICAgICAgY29uc3QgcG9zaXRpb25zID0gW1xuICAgICAgICAgICAgLWhwICogdywgICAgICAtdnAgKiBoLCAgICAgIDAsXG4gICAgICAgICAgICAoMSAtIGhwKSAqIHcsIC12cCAqIGgsICAgICAgMCxcbiAgICAgICAgICAgICgxIC0gaHApICogdywgKDEgLSB2cCkgKiBoLCAwLFxuICAgICAgICAgICAgLWhwICogdywgICAgICAoMSAtIHZwKSAqIGgsIDBcbiAgICAgICAgXTtcblxuICAgICAgICAvLyB1dnMgYmFzZWQgb24gZnJhbWUgcmVjdFxuICAgICAgICAvLyB1dnNcbiAgICAgICAgY29uc3QgbHUgPSByZWN0LnggLyB0ZXhXaWR0aDtcbiAgICAgICAgY29uc3QgYnYgPSAxLjAgLSByZWN0LnkgLyB0ZXhIZWlnaHQ7XG4gICAgICAgIGNvbnN0IHJ1ID0gKHJlY3QueCArIHJlY3QueikgLyB0ZXhXaWR0aDtcbiAgICAgICAgY29uc3QgdHYgPSAxLjAgLSAocmVjdC55ICsgcmVjdC53KSAvIHRleEhlaWdodDtcblxuICAgICAgICBjb25zdCB1dnMgPSBbXG4gICAgICAgICAgICBsdSwgYnYsXG4gICAgICAgICAgICBydSwgYnYsXG4gICAgICAgICAgICBydSwgdHYsXG4gICAgICAgICAgICBsdSwgdHZcbiAgICAgICAgXTtcblxuICAgICAgICBjb25zdCBtZXNoID0gY3JlYXRlTWVzaCh0aGlzLl9kZXZpY2UsIHBvc2l0aW9ucywge1xuICAgICAgICAgICAgdXZzOiB1dnMsXG4gICAgICAgICAgICBub3JtYWxzOiBzcHJpdGVOb3JtYWxzLFxuICAgICAgICAgICAgaW5kaWNlczogc3ByaXRlSW5kaWNlc1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbWVzaDtcbiAgICB9XG5cbiAgICBfY3JlYXRlOVNsaWNlTWVzaCgpIHtcbiAgICAgICAgLy8gQ2hlY2sgdGhlIHN1cHBsaWVkIG9wdGlvbnMgYW5kIHByb3ZpZGUgZGVmYXVsdHMgZm9yIHVuc3BlY2lmaWVkIG9uZXNcbiAgICAgICAgY29uc3QgaGUgPSBWZWMyLk9ORTtcbiAgICAgICAgY29uc3Qgd3MgPSAzO1xuICAgICAgICBjb25zdCBscyA9IDM7XG5cbiAgICAgICAgLy8gVmFyaWFibGUgZGVjbGFyYXRpb25zXG4gICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IFtdO1xuICAgICAgICBjb25zdCBub3JtYWxzID0gW107XG4gICAgICAgIGNvbnN0IHV2cyA9IFtdO1xuICAgICAgICBjb25zdCBpbmRpY2VzID0gW107XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgcGxhbmUgYXMgZm9sbG93cyAoYXNzaWduZWQgVVZzIGRlbm90ZWQgYXQgY29ybmVycyk6XG4gICAgICAgIC8vICgwLDEpeC0tLS0tLS0tLXgoMSwxKVxuICAgICAgICAvLyAgICAgIHwgICAgICAgICB8XG4gICAgICAgIC8vICAgICAgfCAgICAgICAgIHxcbiAgICAgICAgLy8gICAgICB8ICAgIE8tLVggfGxlbmd0aFxuICAgICAgICAvLyAgICAgIHwgICAgfCAgICB8XG4gICAgICAgIC8vICAgICAgfCAgICBaICAgIHxcbiAgICAgICAgLy8gKDAsMCl4LS0tLS0tLS0teCgxLDApXG4gICAgICAgIC8vIHdpZHRoXG4gICAgICAgIGxldCB2Y291bnRlciA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHdzOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSAoaSA9PT0gMCB8fCBpID09PSB3cykgPyAwIDogMTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gbHM7IGorKykge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IC1oZS54ICsgMi4wICogaGUueCAqIChpIDw9IDEgPyAwIDogMykgLyB3cztcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gMC4wO1xuICAgICAgICAgICAgICAgIGNvbnN0IHogPSAtKC1oZS55ICsgMi4wICogaGUueSAqIChqIDw9IDEgPyAwIDogMykgLyBscyk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB2ID0gKGogPT09IDAgfHwgaiA9PT0gbHMpID8gMCA6IDE7XG5cbiAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaCgteCwgeSwgeik7XG4gICAgICAgICAgICAgICAgbm9ybWFscy5wdXNoKDAuMCwgMS4wLCAwLjApO1xuICAgICAgICAgICAgICAgIHV2cy5wdXNoKHUsIHYpO1xuXG4gICAgICAgICAgICAgICAgaWYgKChpIDwgd3MpICYmIChqIDwgbHMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZGljZXMucHVzaCh2Y291bnRlciArIGxzICsgMSwgdmNvdW50ZXIgKyAxLCB2Y291bnRlcik7XG4gICAgICAgICAgICAgICAgICAgIGluZGljZXMucHVzaCh2Y291bnRlciArIGxzICsgMSwgdmNvdW50ZXIgKyBscyArIDIsIHZjb3VudGVyICsgMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmNvdW50ZXIrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBub3JtYWxzOiBub3JtYWxzLCAvLyBjcmFzaGVzIHdpdGhvdXQgbm9ybWFscyBvbiBtYWM/XG4gICAgICAgICAgICB1dnM6IHV2cyxcbiAgICAgICAgICAgIGluZGljZXM6IGluZGljZXNcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gY3JlYXRlTWVzaCh0aGlzLl9kZXZpY2UsIHBvc2l0aW9ucywgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgX29uU2V0RnJhbWVzKGZyYW1lcykge1xuICAgICAgICBpZiAodGhpcy5fdXBkYXRpbmdQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVNZXNoZXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9vbkZyYW1lQ2hhbmdlZChmcmFtZUtleSwgZnJhbWUpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5fZnJhbWVLZXlzLmluZGV4T2YoZnJhbWVLZXkpO1xuICAgICAgICBpZiAoaWR4IDwgMCkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChmcmFtZSkge1xuICAgICAgICAgICAgLy8gb25seSByZS1jcmVhdGUgZnJhbWUgZm9yIHNpbXBsZSByZW5kZXIgbW9kZSwgc2luY2VcbiAgICAgICAgICAgIC8vIDktc2xpY2VkIG1lc2hlcyBkb24ndCBuZWVkIGZyYW1lIGluZm8gdG8gY3JlYXRlIHRoZWlyIG1lc2hcbiAgICAgICAgICAgIGlmICh0aGlzLnJlbmRlck1vZGUgPT09IFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX21lc2hlc1tpZHhdID0gdGhpcy5fY3JlYXRlU2ltcGxlTWVzaChmcmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9tZXNoZXNbaWR4XSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZpcmUoJ3NldDptZXNoZXMnKTtcbiAgICB9XG5cbiAgICBfb25GcmFtZVJlbW92ZWQoZnJhbWVLZXkpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5fZnJhbWVLZXlzLmluZGV4T2YoZnJhbWVLZXkpO1xuICAgICAgICBpZiAoaWR4IDwgMCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuX21lc2hlc1tpZHhdID0gbnVsbDtcbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6bWVzaGVzJyk7XG4gICAgfVxuXG4gICAgc3RhcnRVcGRhdGUoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0aW5nUHJvcGVydGllcyA9IHRydWU7XG4gICAgICAgIHRoaXMuX21lc2hlc0RpcnR5ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgZW5kVXBkYXRlKCkge1xuICAgICAgICB0aGlzLl91cGRhdGluZ1Byb3BlcnRpZXMgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuX21lc2hlc0RpcnR5ICYmIHRoaXMuX2F0bGFzICYmIHRoaXMuX2ZyYW1lS2V5cykge1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlTWVzaGVzKCk7XG5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tZXNoZXNEaXJ0eSA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZyZWUgdXAgdGhlIG1lc2hlcyBjcmVhdGVkIGJ5IHRoZSBzcHJpdGUuXG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgZm9yIChjb25zdCBtZXNoIG9mIHRoaXMuX21lc2hlcykge1xuICAgICAgICAgICAgaWYgKG1lc2gpXG4gICAgICAgICAgICAgICAgbWVzaC5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbWVzaGVzLmxlbmd0aCA9IDA7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTcHJpdGUgfTtcbiJdLCJuYW1lcyI6WyJzcHJpdGVOb3JtYWxzIiwic3ByaXRlSW5kaWNlcyIsIlNwcml0ZSIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiZGV2aWNlIiwib3B0aW9ucyIsIl9kZXZpY2UiLCJfcGl4ZWxzUGVyVW5pdCIsInBpeGVsc1BlclVuaXQiLCJ1bmRlZmluZWQiLCJfcmVuZGVyTW9kZSIsInJlbmRlck1vZGUiLCJTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUiLCJfYXRsYXMiLCJhdGxhcyIsIl9mcmFtZUtleXMiLCJmcmFtZUtleXMiLCJfbWVzaGVzIiwiX3VwZGF0aW5nUHJvcGVydGllcyIsIl9tZXNoZXNEaXJ0eSIsIl9jcmVhdGVNZXNoZXMiLCJ2YWx1ZSIsImZpcmUiLCJvZmYiLCJfb25TZXRGcmFtZXMiLCJfb25GcmFtZUNoYW5nZWQiLCJfb25GcmFtZVJlbW92ZWQiLCJvbiIsInByZXYiLCJtZXNoZXMiLCJsZW4iLCJsZW5ndGgiLCJpIiwibWVzaCIsImRlc3Ryb3kiLCJjb3VudCIsIkFycmF5IiwiY3JlYXRlTWVzaEZ1bmMiLCJTUFJJVEVfUkVOREVSTU9ERV9TTElDRUQiLCJTUFJJVEVfUkVOREVSTU9ERV9USUxFRCIsIl9jcmVhdGU5U2xpY2VNZXNoIiwiX2NyZWF0ZVNpbXBsZU1lc2giLCJmcmFtZSIsImZyYW1lcyIsImNhbGwiLCJyZWN0IiwidGV4V2lkdGgiLCJ0ZXh0dXJlIiwid2lkdGgiLCJ0ZXhIZWlnaHQiLCJoZWlnaHQiLCJ3IiwieiIsImgiLCJocCIsInBpdm90IiwieCIsInZwIiwieSIsInBvc2l0aW9ucyIsImx1IiwiYnYiLCJydSIsInR2IiwidXZzIiwiY3JlYXRlTWVzaCIsIm5vcm1hbHMiLCJpbmRpY2VzIiwiaGUiLCJWZWMyIiwiT05FIiwid3MiLCJscyIsInZjb3VudGVyIiwidSIsImoiLCJ2IiwicHVzaCIsImZyYW1lS2V5IiwiaWR4IiwiaW5kZXhPZiIsInN0YXJ0VXBkYXRlIiwiZW5kVXBkYXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBT0EsTUFBTUEsYUFBYSxHQUFHLENBQ2xCLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUNQLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUNQLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUNQLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUNWLENBQUE7O0FBR0QsTUFBTUMsYUFBYSxHQUFHLENBQ2xCLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUNQLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUNWLENBQUE7O0FBU0QsTUFBTUMsTUFBTSxT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
