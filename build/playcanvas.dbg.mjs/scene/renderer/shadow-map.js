/**
 * @license
 * PlayCanvas Engine v1.63.0-dev revision 9f3635a4e (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, PIXELFORMAT_DEPTH, PIXELFORMAT_RGBA8, FILTER_NEAREST, FILTER_LINEAR, TEXHINT_SHADOWMAP, ADDRESS_CLAMP_TO_EDGE, FUNC_LESS } from '../../platform/graphics/constants.js';
import { RenderTarget } from '../../platform/graphics/render-target.js';
import { Texture } from '../../platform/graphics/texture.js';
import { SHADOW_VSM32, SHADOW_VSM16, SHADOW_PCF5, SHADOW_PCF3, LIGHTTYPE_OMNI } from '../constants.js';

class ShadowMap {
  constructor(texture, targets) {
    // the actual texture buffer that is shared by shadow map render targets
    this.texture = texture;

    // set to true if the shadow map is owned by the shadow map cache
    this.cached = false;

    // an array of render targets:
    // 1 for directional and spot light
    // 6 for omni light
    this.renderTargets = targets;
  }
  destroy() {
    // single texture is shared by all render targets, destroy it once
    if (this.texture) {
      this.texture.destroy();
      this.texture = null;
    }
    const targets = this.renderTargets;
    for (let i = 0; i < targets.length; i++) {
      targets[i].destroy();
    }
    this.renderTargets.length = 0;
  }
  static getShadowFormat(device, shadowType) {
    if (shadowType === SHADOW_VSM32) {
      return PIXELFORMAT_RGBA32F;
    } else if (shadowType === SHADOW_VSM16) {
      return PIXELFORMAT_RGBA16F;
    } else if (shadowType === SHADOW_PCF5) {
      return PIXELFORMAT_DEPTH;
    } else if (shadowType === SHADOW_PCF3 && device.supportsDepthShadow) {
      return PIXELFORMAT_DEPTH;
    }
    return PIXELFORMAT_RGBA8;
  }
  static getShadowFiltering(device, shadowType) {
    if (shadowType === SHADOW_PCF3 && !device.supportsDepthShadow) {
      return FILTER_NEAREST;
    } else if (shadowType === SHADOW_VSM32) {
      return device.extTextureFloatLinear ? FILTER_LINEAR : FILTER_NEAREST;
    } else if (shadowType === SHADOW_VSM16) {
      return device.extTextureHalfFloatLinear ? FILTER_LINEAR : FILTER_NEAREST;
    }
    return FILTER_LINEAR;
  }
  static create(device, light) {
    let shadowMap = null;
    if (light._type === LIGHTTYPE_OMNI) {
      shadowMap = this.createCubemap(device, light._shadowResolution);
    } else {
      shadowMap = this.create2dMap(device, light._shadowResolution, light._shadowType);
    }
    return shadowMap;
  }

  // creates a shadow map which is used by the light texture atlas for clustered lighting
  static createAtlas(device, resolution, shadowType) {
    const shadowMap = this.create2dMap(device, resolution, shadowType);

    // copy the target 5 more times to allow unified access for point light faces
    const targets = shadowMap.renderTargets;
    const rt = targets[0];
    for (let i = 0; i < 5; i++) {
      targets.push(rt);
    }
    return shadowMap;
  }
  static create2dMap(device, size, shadowType) {
    const format = this.getShadowFormat(device, shadowType);
    const filter = this.getShadowFiltering(device, shadowType);
    const texture = new Texture(device, {
      profilerHint: TEXHINT_SHADOWMAP,
      format: format,
      width: size,
      height: size,
      mipmaps: false,
      minFilter: filter,
      magFilter: filter,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      name: 'ShadowMap2D'
    });
    let target = null;
    if (shadowType === SHADOW_PCF5 || shadowType === SHADOW_PCF3 && device.supportsDepthShadow) {
      // enable hardware PCF when sampling the depth texture
      texture.compareOnRead = true;
      texture.compareFunc = FUNC_LESS;

      // depthbuffer only
      target = new RenderTarget({
        depthBuffer: texture
      });
    } else {
      // encoded rgba depth
      target = new RenderTarget({
        colorBuffer: texture,
        depth: true
      });
    }

    // TODO: this is temporary, and will be handle on generic level for all render targets for WebGPU
    if (device.isWebGPU) {
      target.flipY = true;
    }
    return new ShadowMap(texture, [target]);
  }
  static createCubemap(device, size) {
    const cubemap = new Texture(device, {
      profilerHint: TEXHINT_SHADOWMAP,
      format: PIXELFORMAT_RGBA8,
      width: size,
      height: size,
      cubemap: true,
      mipmaps: false,
      minFilter: FILTER_NEAREST,
      magFilter: FILTER_NEAREST,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      name: 'ShadowMapCube'
    });
    const targets = [];
    for (let i = 0; i < 6; i++) {
      const target = new RenderTarget({
        colorBuffer: cubemap,
        face: i,
        depth: true
      });
      targets.push(target);
    }
    return new ShadowMap(cubemap, targets);
  }
}

export { ShadowMap };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZG93LW1hcC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NjZW5lL3JlbmRlcmVyL3NoYWRvdy1tYXAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgRklMVEVSX0xJTkVBUiwgRklMVEVSX05FQVJFU1QsXG4gICAgRlVOQ19MRVNTLFxuICAgIFBJWEVMRk9STUFUX0RFUFRILCBQSVhFTEZPUk1BVF9SR0JBOCwgUElYRUxGT1JNQVRfUkdCQTE2RiwgUElYRUxGT1JNQVRfUkdCQTMyRixcbiAgICBURVhISU5UX1NIQURPV01BUFxufSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgUmVuZGVyVGFyZ2V0IH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qcyc7XG5pbXBvcnQgeyBUZXh0dXJlIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvdGV4dHVyZS5qcyc7XG5cbmltcG9ydCB7XG4gICAgTElHSFRUWVBFX09NTkksXG4gICAgU0hBRE9XX1BDRjMsIFNIQURPV19QQ0Y1LCBTSEFET1dfVlNNMTYsIFNIQURPV19WU00zMlxufSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuXG5cbmNsYXNzIFNoYWRvd01hcCB7XG4gICAgY29uc3RydWN0b3IodGV4dHVyZSwgdGFyZ2V0cykge1xuXG4gICAgICAgIC8vIHRoZSBhY3R1YWwgdGV4dHVyZSBidWZmZXIgdGhhdCBpcyBzaGFyZWQgYnkgc2hhZG93IG1hcCByZW5kZXIgdGFyZ2V0c1xuICAgICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlO1xuXG4gICAgICAgIC8vIHNldCB0byB0cnVlIGlmIHRoZSBzaGFkb3cgbWFwIGlzIG93bmVkIGJ5IHRoZSBzaGFkb3cgbWFwIGNhY2hlXG4gICAgICAgIHRoaXMuY2FjaGVkID0gZmFsc2U7XG5cbiAgICAgICAgLy8gYW4gYXJyYXkgb2YgcmVuZGVyIHRhcmdldHM6XG4gICAgICAgIC8vIDEgZm9yIGRpcmVjdGlvbmFsIGFuZCBzcG90IGxpZ2h0XG4gICAgICAgIC8vIDYgZm9yIG9tbmkgbGlnaHRcbiAgICAgICAgdGhpcy5yZW5kZXJUYXJnZXRzID0gdGFyZ2V0cztcbiAgICB9XG5cbiAgICBkZXN0cm95KCkge1xuXG4gICAgICAgIC8vIHNpbmdsZSB0ZXh0dXJlIGlzIHNoYXJlZCBieSBhbGwgcmVuZGVyIHRhcmdldHMsIGRlc3Ryb3kgaXQgb25jZVxuICAgICAgICBpZiAodGhpcy50ZXh0dXJlKSB7XG4gICAgICAgICAgICB0aGlzLnRleHR1cmUuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy50ZXh0dXJlID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSB0aGlzLnJlbmRlclRhcmdldHM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGFyZ2V0c1tpXS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW5kZXJUYXJnZXRzLmxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFNoYWRvd0Zvcm1hdChkZXZpY2UsIHNoYWRvd1R5cGUpIHtcbiAgICAgICAgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19WU00zMikge1xuICAgICAgICAgICAgcmV0dXJuIFBJWEVMRk9STUFUX1JHQkEzMkY7XG4gICAgICAgIH0gZWxzZSBpZiAoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1ZTTTE2KSB7XG4gICAgICAgICAgICByZXR1cm4gUElYRUxGT1JNQVRfUkdCQTE2RjtcbiAgICAgICAgfSBlbHNlIGlmIChzaGFkb3dUeXBlID09PSBTSEFET1dfUENGNSkge1xuICAgICAgICAgICAgcmV0dXJuIFBJWEVMRk9STUFUX0RFUFRIO1xuICAgICAgICB9IGVsc2UgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ0YzICYmIGRldmljZS5zdXBwb3J0c0RlcHRoU2hhZG93KSB7XG4gICAgICAgICAgICByZXR1cm4gUElYRUxGT1JNQVRfREVQVEg7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUElYRUxGT1JNQVRfUkdCQTg7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFNoYWRvd0ZpbHRlcmluZyhkZXZpY2UsIHNoYWRvd1R5cGUpIHtcbiAgICAgICAgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ0YzICYmICFkZXZpY2Uuc3VwcG9ydHNEZXB0aFNoYWRvdykge1xuICAgICAgICAgICAgcmV0dXJuIEZJTFRFUl9ORUFSRVNUO1xuICAgICAgICB9IGVsc2UgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19WU00zMikge1xuICAgICAgICAgICAgcmV0dXJuIGRldmljZS5leHRUZXh0dXJlRmxvYXRMaW5lYXIgPyBGSUxURVJfTElORUFSIDogRklMVEVSX05FQVJFU1Q7XG4gICAgICAgIH0gZWxzZSBpZiAoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1ZTTTE2KSB7XG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlLmV4dFRleHR1cmVIYWxmRmxvYXRMaW5lYXIgPyBGSUxURVJfTElORUFSIDogRklMVEVSX05FQVJFU1Q7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEZJTFRFUl9MSU5FQVI7XG4gICAgfVxuXG4gICAgc3RhdGljIGNyZWF0ZShkZXZpY2UsIGxpZ2h0KSB7XG5cbiAgICAgICAgbGV0IHNoYWRvd01hcCA9IG51bGw7XG4gICAgICAgIGlmIChsaWdodC5fdHlwZSA9PT0gTElHSFRUWVBFX09NTkkpIHtcbiAgICAgICAgICAgIHNoYWRvd01hcCA9IHRoaXMuY3JlYXRlQ3ViZW1hcChkZXZpY2UsIGxpZ2h0Ll9zaGFkb3dSZXNvbHV0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNoYWRvd01hcCA9IHRoaXMuY3JlYXRlMmRNYXAoZGV2aWNlLCBsaWdodC5fc2hhZG93UmVzb2x1dGlvbiwgbGlnaHQuX3NoYWRvd1R5cGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNoYWRvd01hcDtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGVzIGEgc2hhZG93IG1hcCB3aGljaCBpcyB1c2VkIGJ5IHRoZSBsaWdodCB0ZXh0dXJlIGF0bGFzIGZvciBjbHVzdGVyZWQgbGlnaHRpbmdcbiAgICBzdGF0aWMgY3JlYXRlQXRsYXMoZGV2aWNlLCByZXNvbHV0aW9uLCBzaGFkb3dUeXBlKSB7XG4gICAgICAgIGNvbnN0IHNoYWRvd01hcCA9IHRoaXMuY3JlYXRlMmRNYXAoZGV2aWNlLCByZXNvbHV0aW9uLCBzaGFkb3dUeXBlKTtcblxuICAgICAgICAvLyBjb3B5IHRoZSB0YXJnZXQgNSBtb3JlIHRpbWVzIHRvIGFsbG93IHVuaWZpZWQgYWNjZXNzIGZvciBwb2ludCBsaWdodCBmYWNlc1xuICAgICAgICBjb25zdCB0YXJnZXRzID0gc2hhZG93TWFwLnJlbmRlclRhcmdldHM7XG4gICAgICAgIGNvbnN0IHJ0ID0gdGFyZ2V0c1swXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgICAgIHRhcmdldHMucHVzaChydCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2hhZG93TWFwO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGUyZE1hcChkZXZpY2UsIHNpemUsIHNoYWRvd1R5cGUpIHtcblxuICAgICAgICBjb25zdCBmb3JtYXQgPSB0aGlzLmdldFNoYWRvd0Zvcm1hdChkZXZpY2UsIHNoYWRvd1R5cGUpO1xuICAgICAgICBjb25zdCBmaWx0ZXIgPSB0aGlzLmdldFNoYWRvd0ZpbHRlcmluZyhkZXZpY2UsIHNoYWRvd1R5cGUpO1xuXG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZShkZXZpY2UsIHtcbiAgICAgICAgICAgIC8vICNpZiBfUFJPRklMRVJcbiAgICAgICAgICAgIHByb2ZpbGVySGludDogVEVYSElOVF9TSEFET1dNQVAsXG4gICAgICAgICAgICAvLyAjZW5kaWZcbiAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LFxuICAgICAgICAgICAgd2lkdGg6IHNpemUsXG4gICAgICAgICAgICBoZWlnaHQ6IHNpemUsXG4gICAgICAgICAgICBtaXBtYXBzOiBmYWxzZSxcbiAgICAgICAgICAgIG1pbkZpbHRlcjogZmlsdGVyLFxuICAgICAgICAgICAgbWFnRmlsdGVyOiBmaWx0ZXIsXG4gICAgICAgICAgICBhZGRyZXNzVTogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgYWRkcmVzc1Y6IEFERFJFU1NfQ0xBTVBfVE9fRURHRSxcbiAgICAgICAgICAgIG5hbWU6ICdTaGFkb3dNYXAyRCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHRhcmdldCA9IG51bGw7XG4gICAgICAgIGlmIChzaGFkb3dUeXBlID09PSBTSEFET1dfUENGNSB8fCAoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDRjMgJiYgZGV2aWNlLnN1cHBvcnRzRGVwdGhTaGFkb3cpKSB7XG5cbiAgICAgICAgICAgIC8vIGVuYWJsZSBoYXJkd2FyZSBQQ0Ygd2hlbiBzYW1wbGluZyB0aGUgZGVwdGggdGV4dHVyZVxuICAgICAgICAgICAgdGV4dHVyZS5jb21wYXJlT25SZWFkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRleHR1cmUuY29tcGFyZUZ1bmMgPSBGVU5DX0xFU1M7XG5cbiAgICAgICAgICAgIC8vIGRlcHRoYnVmZmVyIG9ubHlcbiAgICAgICAgICAgIHRhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgICAgIGRlcHRoQnVmZmVyOiB0ZXh0dXJlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGVuY29kZWQgcmdiYSBkZXB0aFxuICAgICAgICAgICAgdGFyZ2V0ID0gbmV3IFJlbmRlclRhcmdldCh7XG4gICAgICAgICAgICAgICAgY29sb3JCdWZmZXI6IHRleHR1cmUsXG4gICAgICAgICAgICAgICAgZGVwdGg6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVE9ETzogdGhpcyBpcyB0ZW1wb3JhcnksIGFuZCB3aWxsIGJlIGhhbmRsZSBvbiBnZW5lcmljIGxldmVsIGZvciBhbGwgcmVuZGVyIHRhcmdldHMgZm9yIFdlYkdQVVxuICAgICAgICBpZiAoZGV2aWNlLmlzV2ViR1BVKSB7XG4gICAgICAgICAgICB0YXJnZXQuZmxpcFkgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBTaGFkb3dNYXAodGV4dHVyZSwgW3RhcmdldF0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVDdWJlbWFwKGRldmljZSwgc2l6ZSkge1xuICAgICAgICBjb25zdCBjdWJlbWFwID0gbmV3IFRleHR1cmUoZGV2aWNlLCB7XG4gICAgICAgICAgICAvLyAjaWYgX1BST0ZJTEVSXG4gICAgICAgICAgICBwcm9maWxlckhpbnQ6IFRFWEhJTlRfU0hBRE9XTUFQLFxuICAgICAgICAgICAgLy8gI2VuZGlmXG4gICAgICAgICAgICBmb3JtYXQ6IFBJWEVMRk9STUFUX1JHQkE4LFxuICAgICAgICAgICAgd2lkdGg6IHNpemUsXG4gICAgICAgICAgICBoZWlnaHQ6IHNpemUsXG4gICAgICAgICAgICBjdWJlbWFwOiB0cnVlLFxuICAgICAgICAgICAgbWlwbWFwczogZmFsc2UsXG4gICAgICAgICAgICBtaW5GaWx0ZXI6IEZJTFRFUl9ORUFSRVNULFxuICAgICAgICAgICAgbWFnRmlsdGVyOiBGSUxURVJfTkVBUkVTVCxcbiAgICAgICAgICAgIGFkZHJlc3NVOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBhZGRyZXNzVjogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgbmFtZTogJ1NoYWRvd01hcEN1YmUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgICAgIGNvbG9yQnVmZmVyOiBjdWJlbWFwLFxuICAgICAgICAgICAgICAgIGZhY2U6IGksXG4gICAgICAgICAgICAgICAgZGVwdGg6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGFyZ2V0cy5wdXNoKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTaGFkb3dNYXAoY3ViZW1hcCwgdGFyZ2V0cyk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTaGFkb3dNYXAgfTtcbiJdLCJuYW1lcyI6WyJTaGFkb3dNYXAiLCJjb25zdHJ1Y3RvciIsInRleHR1cmUiLCJ0YXJnZXRzIiwiY2FjaGVkIiwicmVuZGVyVGFyZ2V0cyIsImRlc3Ryb3kiLCJpIiwibGVuZ3RoIiwiZ2V0U2hhZG93Rm9ybWF0IiwiZGV2aWNlIiwic2hhZG93VHlwZSIsIlNIQURPV19WU00zMiIsIlBJWEVMRk9STUFUX1JHQkEzMkYiLCJTSEFET1dfVlNNMTYiLCJQSVhFTEZPUk1BVF9SR0JBMTZGIiwiU0hBRE9XX1BDRjUiLCJQSVhFTEZPUk1BVF9ERVBUSCIsIlNIQURPV19QQ0YzIiwic3VwcG9ydHNEZXB0aFNoYWRvdyIsIlBJWEVMRk9STUFUX1JHQkE4IiwiZ2V0U2hhZG93RmlsdGVyaW5nIiwiRklMVEVSX05FQVJFU1QiLCJleHRUZXh0dXJlRmxvYXRMaW5lYXIiLCJGSUxURVJfTElORUFSIiwiZXh0VGV4dHVyZUhhbGZGbG9hdExpbmVhciIsImNyZWF0ZSIsImxpZ2h0Iiwic2hhZG93TWFwIiwiX3R5cGUiLCJMSUdIVFRZUEVfT01OSSIsImNyZWF0ZUN1YmVtYXAiLCJfc2hhZG93UmVzb2x1dGlvbiIsImNyZWF0ZTJkTWFwIiwiX3NoYWRvd1R5cGUiLCJjcmVhdGVBdGxhcyIsInJlc29sdXRpb24iLCJydCIsInB1c2giLCJzaXplIiwiZm9ybWF0IiwiZmlsdGVyIiwiVGV4dHVyZSIsInByb2ZpbGVySGludCIsIlRFWEhJTlRfU0hBRE9XTUFQIiwid2lkdGgiLCJoZWlnaHQiLCJtaXBtYXBzIiwibWluRmlsdGVyIiwibWFnRmlsdGVyIiwiYWRkcmVzc1UiLCJBRERSRVNTX0NMQU1QX1RPX0VER0UiLCJhZGRyZXNzViIsIm5hbWUiLCJ0YXJnZXQiLCJjb21wYXJlT25SZWFkIiwiY29tcGFyZUZ1bmMiLCJGVU5DX0xFU1MiLCJSZW5kZXJUYXJnZXQiLCJkZXB0aEJ1ZmZlciIsImNvbG9yQnVmZmVyIiwiZGVwdGgiLCJpc1dlYkdQVSIsImZsaXBZIiwiY3ViZW1hcCIsImZhY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFnQkEsTUFBTUEsU0FBUyxDQUFDO0FBQ1pDLEVBQUFBLFdBQVdBLENBQUNDLE9BQU8sRUFBRUMsT0FBTyxFQUFFO0FBRTFCO0lBQ0EsSUFBSSxDQUFDRCxPQUFPLEdBQUdBLE9BQU8sQ0FBQTs7QUFFdEI7SUFDQSxJQUFJLENBQUNFLE1BQU0sR0FBRyxLQUFLLENBQUE7O0FBRW5CO0FBQ0E7QUFDQTtJQUNBLElBQUksQ0FBQ0MsYUFBYSxHQUFHRixPQUFPLENBQUE7QUFDaEMsR0FBQTtBQUVBRyxFQUFBQSxPQUFPQSxHQUFHO0FBRU47SUFDQSxJQUFJLElBQUksQ0FBQ0osT0FBTyxFQUFFO0FBQ2QsTUFBQSxJQUFJLENBQUNBLE9BQU8sQ0FBQ0ksT0FBTyxFQUFFLENBQUE7TUFDdEIsSUFBSSxDQUFDSixPQUFPLEdBQUcsSUFBSSxDQUFBO0FBQ3ZCLEtBQUE7QUFFQSxJQUFBLE1BQU1DLE9BQU8sR0FBRyxJQUFJLENBQUNFLGFBQWEsQ0FBQTtBQUNsQyxJQUFBLEtBQUssSUFBSUUsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHSixPQUFPLENBQUNLLE1BQU0sRUFBRUQsQ0FBQyxFQUFFLEVBQUU7QUFDckNKLE1BQUFBLE9BQU8sQ0FBQ0ksQ0FBQyxDQUFDLENBQUNE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
