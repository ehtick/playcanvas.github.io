import { DebugHelper, Debug } from '../../core/debug.js';
import { math } from '../../core/math/math.js';
import { Vec3 } from '../../core/math/vec3.js';
import { Mat4 } from '../../core/math/mat4.js';
import { BoundingBox } from '../../core/shape/bounding-box.js';
import { SHADOWUPDATE_NONE, SHADOWUPDATE_THISFRAME, LIGHTTYPE_DIRECTIONAL } from '../constants.js';
import { RenderPass } from '../../platform/graphics/render-pass.js';
import { ShadowMap } from './shadow-map.js';

const visibleSceneAabb = new BoundingBox();
const center = new Vec3();
const shadowCamView = new Mat4();
const aabbPoints = [new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3()];

// evaluate depth range the aabb takes in the space of the camera
const _depthRange = {
  min: 0,
  max: 0
};
function getDepthRange(cameraViewMatrix, aabbMin, aabbMax) {
  aabbPoints[0].x = aabbPoints[1].x = aabbPoints[2].x = aabbPoints[3].x = aabbMin.x;
  aabbPoints[1].y = aabbPoints[3].y = aabbPoints[7].y = aabbPoints[5].y = aabbMin.y;
  aabbPoints[2].z = aabbPoints[3].z = aabbPoints[6].z = aabbPoints[7].z = aabbMin.z;
  aabbPoints[4].x = aabbPoints[5].x = aabbPoints[6].x = aabbPoints[7].x = aabbMax.x;
  aabbPoints[0].y = aabbPoints[2].y = aabbPoints[4].y = aabbPoints[6].y = aabbMax.y;
  aabbPoints[0].z = aabbPoints[1].z = aabbPoints[4].z = aabbPoints[5].z = aabbMax.z;
  let minz = 9999999999;
  let maxz = -9999999999;
  for (let i = 0; i < 8; ++i) {
    cameraViewMatrix.transformPoint(aabbPoints[i], aabbPoints[i]);
    const z = aabbPoints[i].z;
    if (z < minz) minz = z;
    if (z > maxz) maxz = z;
  }
  _depthRange.min = minz;
  _depthRange.max = maxz;
  return _depthRange;
}

/**
 * @ignore
 */
class ShadowRendererDirectional {
  constructor(renderer, shadowRenderer) {
    /** @type {import('./renderer.js').Renderer} */
    this.renderer = void 0;
    /** @type {import('./shadow-renderer.js').ShadowRenderer} */
    this.shadowRenderer = void 0;
    /** @type {import('../../platform/graphics/graphics-device.js').GraphicsDevice} */
    this.device = void 0;
    this.renderer = renderer;
    this.shadowRenderer = shadowRenderer;
    this.device = renderer.device;
  }

  // cull directional shadow map
  cull(light, drawCalls, camera) {
    // force light visibility if function was manually called
    light.visibleThisFrame = true;
    if (!light._shadowMap) {
      light._shadowMap = ShadowMap.create(this.device, light);
    }

    // generate splits for the cascades
    const nearDist = camera._nearClip;
    this.generateSplitDistances(light, nearDist, Math.min(camera._farClip, light.shadowDistance));
    const shadowUpdateOverrides = light.shadowUpdateOverrides;
    for (let cascade = 0; cascade < light.numCascades; cascade++) {
      // if manually controlling cascade rendering and the cascade does not render this frame
      if ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[cascade]) === SHADOWUPDATE_NONE) {
        break;
      }
      const lightRenderData = light.getRenderData(camera, cascade);
      const shadowCam = lightRenderData.shadowCamera;

      // assign render target
      // Note: this is done during rendering for all shadow maps, but do it here for the case shadow rendering for the directional light
      // is disabled - we need shadow map to be assigned for rendering to work even in this case. This needs further refactoring - as when
      // shadow rendering is set to SHADOWUPDATE_NONE, we should not even execute shadow map culling
      shadowCam.renderTarget = light._shadowMap.renderTargets[0];

      // viewport
      lightRenderData.shadowViewport.copy(light.cascades[cascade]);
      lightRenderData.shadowScissor.copy(light.cascades[cascade]);
      const shadowCamNode = shadowCam._node;
      const lightNode = light._node;
      shadowCamNode.setPosition(lightNode.getPosition());

      // Camera looks down the negative Z, and directional light points down the negative Y
      shadowCamNode.setRotation(lightNode.getRotation());
      shadowCamNode.rotateLocal(-90, 0, 0);

      // get camera's frustum corners for the cascade, convert them to world space and find their center
      const frustumNearDist = cascade === 0 ? nearDist : light._shadowCascadeDistances[cascade - 1];
      const frustumFarDist = light._shadowCascadeDistances[cascade];
      const frustumPoints = camera.getFrustumCorners(frustumNearDist, frustumFarDist);
      center.set(0, 0, 0);
      const cameraWorldMat = camera.node.getWorldTransform();
      for (let i = 0; i < 8; i++) {
        cameraWorldMat.transformPoint(frustumPoints[i], frustumPoints[i]);
        center.add(frustumPoints[i]);
      }
      center.mulScalar(1 / 8);

      // radius of the world space bounding sphere for the frustum slice
      let radius = 0;
      for (let i = 0; i < 8; i++) {
        const dist = frustumPoints[i].sub(center).length();
        if (dist > radius) radius = dist;
      }

      // axis of light coordinate system
      const right = shadowCamNode.right;
      const up = shadowCamNode.up;
      const lightDir = shadowCamNode.forward;

      // transform the sphere's center into the center of the shadow map, pixel aligned.
      // this makes the shadow map stable and avoids shimmering on the edges when the camera moves
      const sizeRatio = 0.25 * light._shadowResolution / radius;
      const x = Math.ceil(center.dot(up) * sizeRatio) / sizeRatio;
      const y = Math.ceil(center.dot(right) * sizeRatio) / sizeRatio;
      const scaledUp = up.mulScalar(x);
      const scaledRight = right.mulScalar(y);
      const dot = center.dot(lightDir);
      const scaledDir = lightDir.mulScalar(dot);
      center.add2(scaledUp, scaledRight).add(scaledDir);

      // look at the center from far away to include all casters during culling
      shadowCamNode.setPosition(center);
      shadowCamNode.translateLocal(0, 0, 1000000);
      shadowCam.nearClip = 0.01;
      shadowCam.farClip = 2000000;
      shadowCam.orthoHeight = radius;

      // cull shadow casters
      this.renderer.updateCameraFrustum(shadowCam);
      this.shadowRenderer.cullShadowCasters(drawCalls, lightRenderData.visibleCasters, shadowCam);

      // find out AABB of visible shadow casters
      let emptyAabb = true;
      const visibleCasters = lightRenderData.visibleCasters;
      for (let i = 0; i < visibleCasters.length; i++) {
        const meshInstance = visibleCasters[i];
        if (emptyAabb) {
          emptyAabb = false;
          visibleSceneAabb.copy(meshInstance.aabb);
        } else {
          visibleSceneAabb.add(meshInstance.aabb);
        }
      }

      // calculate depth range of the caster's AABB from the point of view of the shadow camera
      shadowCamView.copy(shadowCamNode.getWorldTransform()).invert();
      const depthRange = getDepthRange(shadowCamView, visibleSceneAabb.getMin(), visibleSceneAabb.getMax());
      lightRenderData.depthRangeCompensation = (depthRange.max - depthRange.min) / light.shadowDistance;

      // adjust shadow camera's near and far plane to the depth range of casters to maximize precision
      // of values stored in the shadow map. Make it slightly larger to avoid clipping on near / far plane.
      shadowCamNode.translateLocal(0, 0, depthRange.max + 0.1);
      shadowCam.farClip = depthRange.max - depthRange.min + 0.2;
    }
  }

  // function to generate frustum split distances
  generateSplitDistances(light, nearDist, farDist) {
    light._shadowCascadeDistances.fill(farDist);
    for (let i = 1; i < light.numCascades; i++) {
      //  lerp between linear and logarithmic distance, called practical split distance
      const fraction = i / light.numCascades;
      const linearDist = nearDist + (farDist - nearDist) * fraction;
      const logDist = nearDist * (farDist / nearDist) ** fraction;
      const dist = math.lerp(linearDist, logDist, light.cascadeDistribution);
      light._shadowCascadeDistances[i - 1] = dist;
    }
  }
  addLightRenderPasses(frameGraph, light, camera) {
    // shadow cascades have more faces rendered within a singe render pass
    const faceCount = light.numShadowFaces;
    const shadowUpdateOverrides = light.shadowUpdateOverrides;

    // prepare render targets / cameras for rendering
    let allCascadesRendering = true;
    let shadowCamera;
    for (let face = 0; face < faceCount; face++) {
      if ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[face]) === SHADOWUPDATE_NONE) allCascadesRendering = false;
      shadowCamera = this.shadowRenderer.prepareFace(light, camera, face);
    }
    const renderPass = new RenderPass(this.device, () => {
      // inside the render pass, render all faces
      for (let face = 0; face < faceCount; face++) {
        if ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[face]) !== SHADOWUPDATE_NONE) {
          this.shadowRenderer.renderFace(light, camera, face, !allCascadesRendering);
        }
        if ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[face]) === SHADOWUPDATE_THISFRAME) {
          shadowUpdateOverrides[face] = SHADOWUPDATE_NONE;
        }
      }
    });
    renderPass.after = () => {
      // after the pass is done, apply VSM blur if needed
      this.shadowRenderer.renderVsm(light, camera);
    };

    // setup render pass using any of the cameras, they all have the same pass related properties
    this.shadowRenderer.setupRenderPass(renderPass, shadowCamera, allCascadesRendering);
    DebugHelper.setName(renderPass, `DirShadow-${light._node.name}`);
    frameGraph.addRenderPass(renderPass);
  }

  /**
   * Builds a frame graph for rendering of directional shadows for the render action.
   *
   * @param {import('../frame-graph.js').FrameGraph} frameGraph - The frame-graph that is built.
   * @param {import('../composition/render-action.js').RenderAction} renderAction - The render
   * action.
   * @param {import('../../framework/components/camera/component.js').CameraComponent} camera - The camera.
   */
  buildFrameGraph(frameGraph, renderAction, camera) {
    // create required render passes per light
    const lights = renderAction.directionalLights;
    for (let i = 0; i < lights.length; i++) {
      const light = lights[i];
      Debug.assert(light && light._type === LIGHTTYPE_DIRECTIONAL);
      if (this.shadowRenderer.needsShadowRendering(light)) {
        this.addLightRenderPasses(frameGraph, light, camera.camera);
      }
    }
  }
}

export { ShadowRendererDirectional };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZG93LXJlbmRlcmVyLWRpcmVjdGlvbmFsLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvcmVuZGVyZXIvc2hhZG93LXJlbmRlcmVyLWRpcmVjdGlvbmFsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnLCBEZWJ1Z0hlbHBlciB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgbWF0aCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9tYXRoLmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjMy5qcyc7XG5pbXBvcnQgeyBNYXQ0IH0gZnJvbSAnLi4vLi4vY29yZS9tYXRoL21hdDQuanMnO1xuaW1wb3J0IHsgQm91bmRpbmdCb3ggfSBmcm9tICcuLi8uLi9jb3JlL3NoYXBlL2JvdW5kaW5nLWJveC5qcyc7XG5cbmltcG9ydCB7XG4gICAgTElHSFRUWVBFX0RJUkVDVElPTkFMLCBTSEFET1dVUERBVEVfTk9ORSwgU0hBRE9XVVBEQVRFX1RISVNGUkFNRVxufSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgUmVuZGVyUGFzcyB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3JlbmRlci1wYXNzLmpzJztcblxuaW1wb3J0IHsgU2hhZG93TWFwIH0gZnJvbSAnLi9zaGFkb3ctbWFwLmpzJztcblxuY29uc3QgdmlzaWJsZVNjZW5lQWFiYiA9IG5ldyBCb3VuZGluZ0JveCgpO1xuY29uc3QgY2VudGVyID0gbmV3IFZlYzMoKTtcbmNvbnN0IHNoYWRvd0NhbVZpZXcgPSBuZXcgTWF0NCgpO1xuXG5jb25zdCBhYWJiUG9pbnRzID0gW1xuICAgIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksXG4gICAgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKVxuXTtcblxuLy8gZXZhbHVhdGUgZGVwdGggcmFuZ2UgdGhlIGFhYmIgdGFrZXMgaW4gdGhlIHNwYWNlIG9mIHRoZSBjYW1lcmFcbmNvbnN0IF9kZXB0aFJhbmdlID0geyBtaW46IDAsIG1heDogMCB9O1xuZnVuY3Rpb24gZ2V0RGVwdGhSYW5nZShjYW1lcmFWaWV3TWF0cml4LCBhYWJiTWluLCBhYWJiTWF4KSB7XG4gICAgYWFiYlBvaW50c1swXS54ID0gYWFiYlBvaW50c1sxXS54ID0gYWFiYlBvaW50c1syXS54ID0gYWFiYlBvaW50c1szXS54ID0gYWFiYk1pbi54O1xuICAgIGFhYmJQb2ludHNbMV0ueSA9IGFhYmJQb2ludHNbM10ueSA9IGFhYmJQb2ludHNbN10ueSA9IGFhYmJQb2ludHNbNV0ueSA9IGFhYmJNaW4ueTtcbiAgICBhYWJiUG9pbnRzWzJdLnogPSBhYWJiUG9pbnRzWzNdLnogPSBhYWJiUG9pbnRzWzZdLnogPSBhYWJiUG9pbnRzWzddLnogPSBhYWJiTWluLno7XG4gICAgYWFiYlBvaW50c1s0XS54ID0gYWFiYlBvaW50c1s1XS54ID0gYWFiYlBvaW50c1s2XS54ID0gYWFiYlBvaW50c1s3XS54ID0gYWFiYk1heC54O1xuICAgIGFhYmJQb2ludHNbMF0ueSA9IGFhYmJQb2ludHNbMl0ueSA9IGFhYmJQb2ludHNbNF0ueSA9IGFhYmJQb2ludHNbNl0ueSA9IGFhYmJNYXgueTtcbiAgICBhYWJiUG9pbnRzWzBdLnogPSBhYWJiUG9pbnRzWzFdLnogPSBhYWJiUG9pbnRzWzRdLnogPSBhYWJiUG9pbnRzWzVdLnogPSBhYWJiTWF4Lno7XG5cbiAgICBsZXQgbWlueiA9IDk5OTk5OTk5OTk7XG4gICAgbGV0IG1heHogPSAtOTk5OTk5OTk5OTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgKytpKSB7XG4gICAgICAgIGNhbWVyYVZpZXdNYXRyaXgudHJhbnNmb3JtUG9pbnQoYWFiYlBvaW50c1tpXSwgYWFiYlBvaW50c1tpXSk7XG4gICAgICAgIGNvbnN0IHogPSBhYWJiUG9pbnRzW2ldLno7XG4gICAgICAgIGlmICh6IDwgbWlueikgbWlueiA9IHo7XG4gICAgICAgIGlmICh6ID4gbWF4eikgbWF4eiA9IHo7XG4gICAgfVxuXG4gICAgX2RlcHRoUmFuZ2UubWluID0gbWluejtcbiAgICBfZGVwdGhSYW5nZS5tYXggPSBtYXh6O1xuICAgIHJldHVybiBfZGVwdGhSYW5nZTtcbn1cblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFNoYWRvd1JlbmRlcmVyRGlyZWN0aW9uYWwge1xuICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuL3JlbmRlcmVyLmpzJykuUmVuZGVyZXJ9ICovXG4gICAgcmVuZGVyZXI7XG5cbiAgICAvKiogQHR5cGUge2ltcG9ydCgnLi9zaGFkb3ctcmVuZGVyZXIuanMnKS5TaGFkb3dSZW5kZXJlcn0gKi9cbiAgICBzaGFkb3dSZW5kZXJlcjtcblxuICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9ncmFwaGljcy1kZXZpY2UuanMnKS5HcmFwaGljc0RldmljZX0gKi9cbiAgICBkZXZpY2U7XG5cbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgc2hhZG93UmVuZGVyZXIpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLnNoYWRvd1JlbmRlcmVyID0gc2hhZG93UmVuZGVyZXI7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gcmVuZGVyZXIuZGV2aWNlO1xuICAgIH1cblxuICAgIC8vIGN1bGwgZGlyZWN0aW9uYWwgc2hhZG93IG1hcFxuICAgIGN1bGwobGlnaHQsIGRyYXdDYWxscywgY2FtZXJhKSB7XG5cbiAgICAgICAgLy8gZm9yY2UgbGlnaHQgdmlzaWJpbGl0eSBpZiBmdW5jdGlvbiB3YXMgbWFudWFsbHkgY2FsbGVkXG4gICAgICAgIGxpZ2h0LnZpc2libGVUaGlzRnJhbWUgPSB0cnVlO1xuXG4gICAgICAgIGlmICghbGlnaHQuX3NoYWRvd01hcCkge1xuICAgICAgICAgICAgbGlnaHQuX3NoYWRvd01hcCA9IFNoYWRvd01hcC5jcmVhdGUodGhpcy5kZXZpY2UsIGxpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGdlbmVyYXRlIHNwbGl0cyBmb3IgdGhlIGNhc2NhZGVzXG4gICAgICAgIGNvbnN0IG5lYXJEaXN0ID0gY2FtZXJhLl9uZWFyQ2xpcDtcbiAgICAgICAgdGhpcy5nZW5lcmF0ZVNwbGl0RGlzdGFuY2VzKGxpZ2h0LCBuZWFyRGlzdCwgTWF0aC5taW4oY2FtZXJhLl9mYXJDbGlwLCBsaWdodC5zaGFkb3dEaXN0YW5jZSkpO1xuXG4gICAgICAgIGNvbnN0IHNoYWRvd1VwZGF0ZU92ZXJyaWRlcyA9IGxpZ2h0LnNoYWRvd1VwZGF0ZU92ZXJyaWRlcztcbiAgICAgICAgZm9yIChsZXQgY2FzY2FkZSA9IDA7IGNhc2NhZGUgPCBsaWdodC5udW1DYXNjYWRlczsgY2FzY2FkZSsrKSB7XG5cbiAgICAgICAgICAgIC8vIGlmIG1hbnVhbGx5IGNvbnRyb2xsaW5nIGNhc2NhZGUgcmVuZGVyaW5nIGFuZCB0aGUgY2FzY2FkZSBkb2VzIG5vdCByZW5kZXIgdGhpcyBmcmFtZVxuICAgICAgICAgICAgaWYgKHNoYWRvd1VwZGF0ZU92ZXJyaWRlcz8uW2Nhc2NhZGVdID09PSBTSEFET1dVUERBVEVfTk9ORSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBsaWdodFJlbmRlckRhdGEgPSBsaWdodC5nZXRSZW5kZXJEYXRhKGNhbWVyYSwgY2FzY2FkZSk7XG4gICAgICAgICAgICBjb25zdCBzaGFkb3dDYW0gPSBsaWdodFJlbmRlckRhdGEuc2hhZG93Q2FtZXJhO1xuXG4gICAgICAgICAgICAvLyBhc3NpZ24gcmVuZGVyIHRhcmdldFxuICAgICAgICAgICAgLy8gTm90ZTogdGhpcyBpcyBkb25lIGR1cmluZyByZW5kZXJpbmcgZm9yIGFsbCBzaGFkb3cgbWFwcywgYnV0IGRvIGl0IGhlcmUgZm9yIHRoZSBjYXNlIHNoYWRvdyByZW5kZXJpbmcgZm9yIHRoZSBkaXJlY3Rpb25hbCBsaWdodFxuICAgICAgICAgICAgLy8gaXMgZGlzYWJsZWQgLSB3ZSBuZWVkIHNoYWRvdyBtYXAgdG8gYmUgYXNzaWduZWQgZm9yIHJlbmRlcmluZyB0byB3b3JrIGV2ZW4gaW4gdGhpcyBjYXNlLiBUaGlzIG5lZWRzIGZ1cnRoZXIgcmVmYWN0b3JpbmcgLSBhcyB3aGVuXG4gICAgICAgICAgICAvLyBzaGFkb3cgcmVuZGVyaW5nIGlzIHNldCB0byBTSEFET1dVUERBVEVfTk9ORSwgd2Ugc2hvdWxkIG5vdCBldmVuIGV4ZWN1dGUgc2hhZG93IG1hcCBjdWxsaW5nXG4gICAgICAgICAgICBzaGFkb3dDYW0ucmVuZGVyVGFyZ2V0ID0gbGlnaHQuX3NoYWRvd01hcC5yZW5kZXJUYXJnZXRzWzBdO1xuXG4gICAgICAgICAgICAvLyB2aWV3cG9ydFxuICAgICAgICAgICAgbGlnaHRSZW5kZXJEYXRhLnNoYWRvd1ZpZXdwb3J0LmNvcHkobGlnaHQuY2FzY2FkZXNbY2FzY2FkZV0pO1xuICAgICAgICAgICAgbGlnaHRSZW5kZXJEYXRhLnNoYWRvd1NjaXNzb3IuY29weShsaWdodC5jYXNjYWRlc1tjYXNjYWRlXSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNoYWRvd0NhbU5vZGUgPSBzaGFkb3dDYW0uX25vZGU7XG4gICAgICAgICAgICBjb25zdCBsaWdodE5vZGUgPSBsaWdodC5fbm9kZTtcblxuICAgICAgICAgICAgc2hhZG93Q2FtTm9kZS5zZXRQb3NpdGlvbihsaWdodE5vZGUuZ2V0UG9zaXRpb24oKSk7XG5cbiAgICAgICAgICAgIC8vIENhbWVyYSBsb29rcyBkb3duIHRoZSBuZWdhdGl2ZSBaLCBhbmQgZGlyZWN0aW9uYWwgbGlnaHQgcG9pbnRzIGRvd24gdGhlIG5lZ2F0aXZlIFlcbiAgICAgICAgICAgIHNoYWRvd0NhbU5vZGUuc2V0Um90YXRpb24obGlnaHROb2RlLmdldFJvdGF0aW9uKCkpO1xuICAgICAgICAgICAgc2hhZG93Q2FtTm9kZS5yb3RhdGVMb2NhbCgtOTAsIDAsIDApO1xuXG4gICAgICAgICAgICAvLyBnZXQgY2FtZXJhJ3MgZnJ1c3R1bSBjb3JuZXJzIGZvciB0aGUgY2FzY2FkZSwgY29udmVydCB0aGVtIHRvIHdvcmxkIHNwYWNlIGFuZCBmaW5kIHRoZWlyIGNlbnRlclxuICAgICAgICAgICAgY29uc3QgZnJ1c3R1bU5lYXJEaXN0ID0gY2FzY2FkZSA9PT0gMCA/IG5lYXJEaXN0IDogbGlnaHQuX3NoYWRvd0Nhc2NhZGVEaXN0YW5jZXNbY2FzY2FkZSAtIDFdO1xuICAgICAgICAgICAgY29uc3QgZnJ1c3R1bUZhckRpc3QgPSBsaWdodC5fc2hhZG93Q2FzY2FkZURpc3RhbmNlc1tjYXNjYWRlXTtcbiAgICAgICAgICAgIGNvbnN0IGZydXN0dW1Qb2ludHMgPSBjYW1lcmEuZ2V0RnJ1c3R1bUNvcm5lcnMoZnJ1c3R1bU5lYXJEaXN0LCBmcnVzdHVtRmFyRGlzdCk7XG4gICAgICAgICAgICBjZW50ZXIuc2V0KDAsIDAsIDApO1xuICAgICAgICAgICAgY29uc3QgY2FtZXJhV29ybGRNYXQgPSBjYW1lcmEubm9kZS5nZXRXb3JsZFRyYW5zZm9ybSgpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHtcbiAgICAgICAgICAgICAgICBjYW1lcmFXb3JsZE1hdC50cmFuc2Zvcm1Qb2ludChmcnVzdHVtUG9pbnRzW2ldLCBmcnVzdHVtUG9pbnRzW2ldKTtcbiAgICAgICAgICAgICAgICBjZW50ZXIuYWRkKGZydXN0dW1Qb2ludHNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2VudGVyLm11bFNjYWxhcigxIC8gOCk7XG5cbiAgICAgICAgICAgIC8vIHJhZGl1cyBvZiB0aGUgd29ybGQgc3BhY2UgYm91bmRpbmcgc3BoZXJlIGZvciB0aGUgZnJ1c3R1bSBzbGljZVxuICAgICAgICAgICAgbGV0IHJhZGl1cyA9IDA7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBmcnVzdHVtUG9pbnRzW2ldLnN1YihjZW50ZXIpLmxlbmd0aCgpO1xuICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gcmFkaXVzKVxuICAgICAgICAgICAgICAgICAgICByYWRpdXMgPSBkaXN0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBheGlzIG9mIGxpZ2h0IGNvb3JkaW5hdGUgc3lzdGVtXG4gICAgICAgICAgICBjb25zdCByaWdodCA9IHNoYWRvd0NhbU5vZGUucmlnaHQ7XG4gICAgICAgICAgICBjb25zdCB1cCA9IHNoYWRvd0NhbU5vZGUudXA7XG4gICAgICAgICAgICBjb25zdCBsaWdodERpciA9IHNoYWRvd0NhbU5vZGUuZm9yd2FyZDtcblxuICAgICAgICAgICAgLy8gdHJhbnNmb3JtIHRoZSBzcGhlcmUncyBjZW50ZXIgaW50byB0aGUgY2VudGVyIG9mIHRoZSBzaGFkb3cgbWFwLCBwaXhlbCBhbGlnbmVkLlxuICAgICAgICAgICAgLy8gdGhpcyBtYWtlcyB0aGUgc2hhZG93IG1hcCBzdGFibGUgYW5kIGF2b2lkcyBzaGltbWVyaW5nIG9uIHRoZSBlZGdlcyB3aGVuIHRoZSBjYW1lcmEgbW92ZXNcbiAgICAgICAgICAgIGNvbnN0IHNpemVSYXRpbyA9IDAuMjUgKiBsaWdodC5fc2hhZG93UmVzb2x1dGlvbiAvIHJhZGl1cztcbiAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLmNlaWwoY2VudGVyLmRvdCh1cCkgKiBzaXplUmF0aW8pIC8gc2l6ZVJhdGlvO1xuICAgICAgICAgICAgY29uc3QgeSA9IE1hdGguY2VpbChjZW50ZXIuZG90KHJpZ2h0KSAqIHNpemVSYXRpbykgLyBzaXplUmF0aW87XG5cbiAgICAgICAgICAgIGNvbnN0IHNjYWxlZFVwID0gdXAubXVsU2NhbGFyKHgpO1xuICAgICAgICAgICAgY29uc3Qgc2NhbGVkUmlnaHQgPSByaWdodC5tdWxTY2FsYXIoeSk7XG4gICAgICAgICAgICBjb25zdCBkb3QgPSBjZW50ZXIuZG90KGxpZ2h0RGlyKTtcbiAgICAgICAgICAgIGNvbnN0IHNjYWxlZERpciA9IGxpZ2h0RGlyLm11bFNjYWxhcihkb3QpO1xuICAgICAgICAgICAgY2VudGVyLmFkZDIoc2NhbGVkVXAsIHNjYWxlZFJpZ2h0KS5hZGQoc2NhbGVkRGlyKTtcblxuICAgICAgICAgICAgLy8gbG9vayBhdCB0aGUgY2VudGVyIGZyb20gZmFyIGF3YXkgdG8gaW5jbHVkZSBhbGwgY2FzdGVycyBkdXJpbmcgY3VsbGluZ1xuICAgICAgICAgICAgc2hhZG93Q2FtTm9kZS5zZXRQb3NpdGlvbihjZW50ZXIpO1xuICAgICAgICAgICAgc2hhZG93Q2FtTm9kZS50cmFuc2xhdGVMb2NhbCgwLCAwLCAxMDAwMDAwKTtcbiAgICAgICAgICAgIHNoYWRvd0NhbS5uZWFyQ2xpcCA9IDAuMDE7XG4gICAgICAgICAgICBzaGFkb3dDYW0uZmFyQ2xpcCA9IDIwMDAwMDA7XG4gICAgICAgICAgICBzaGFkb3dDYW0ub3J0aG9IZWlnaHQgPSByYWRpdXM7XG5cbiAgICAgICAgICAgIC8vIGN1bGwgc2hhZG93IGNhc3RlcnNcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIudXBkYXRlQ2FtZXJhRnJ1c3R1bShzaGFkb3dDYW0pO1xuICAgICAgICAgICAgdGhpcy5zaGFkb3dSZW5kZXJlci5jdWxsU2hhZG93Q2FzdGVycyhkcmF3Q2FsbHMsIGxpZ2h0UmVuZGVyRGF0YS52aXNpYmxlQ2FzdGVycywgc2hhZG93Q2FtKTtcblxuICAgICAgICAgICAgLy8gZmluZCBvdXQgQUFCQiBvZiB2aXNpYmxlIHNoYWRvdyBjYXN0ZXJzXG4gICAgICAgICAgICBsZXQgZW1wdHlBYWJiID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IHZpc2libGVDYXN0ZXJzID0gbGlnaHRSZW5kZXJEYXRhLnZpc2libGVDYXN0ZXJzO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aXNpYmxlQ2FzdGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc2hJbnN0YW5jZSA9IHZpc2libGVDYXN0ZXJzW2ldO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVtcHR5QWFiYikge1xuICAgICAgICAgICAgICAgICAgICBlbXB0eUFhYmIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZVNjZW5lQWFiYi5jb3B5KG1lc2hJbnN0YW5jZS5hYWJiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlU2NlbmVBYWJiLmFkZChtZXNoSW5zdGFuY2UuYWFiYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjYWxjdWxhdGUgZGVwdGggcmFuZ2Ugb2YgdGhlIGNhc3RlcidzIEFBQkIgZnJvbSB0aGUgcG9pbnQgb2YgdmlldyBvZiB0aGUgc2hhZG93IGNhbWVyYVxuICAgICAgICAgICAgc2hhZG93Q2FtVmlldy5jb3B5KHNoYWRvd0NhbU5vZGUuZ2V0V29ybGRUcmFuc2Zvcm0oKSkuaW52ZXJ0KCk7XG4gICAgICAgICAgICBjb25zdCBkZXB0aFJhbmdlID0gZ2V0RGVwdGhSYW5nZShzaGFkb3dDYW1WaWV3LCB2aXNpYmxlU2NlbmVBYWJiLmdldE1pbigpLCB2aXNpYmxlU2NlbmVBYWJiLmdldE1heCgpKTtcbiAgICAgICAgICAgIGxpZ2h0UmVuZGVyRGF0YS5kZXB0aFJhbmdlQ29tcGVuc2F0aW9uID0gKGRlcHRoUmFuZ2UubWF4IC0gZGVwdGhSYW5nZS5taW4pIC8gbGlnaHQuc2hhZG93RGlzdGFuY2U7XG5cbiAgICAgICAgICAgIC8vIGFkanVzdCBzaGFkb3cgY2FtZXJhJ3MgbmVhciBhbmQgZmFyIHBsYW5lIHRvIHRoZSBkZXB0aCByYW5nZSBvZiBjYXN0ZXJzIHRvIG1heGltaXplIHByZWNpc2lvblxuICAgICAgICAgICAgLy8gb2YgdmFsdWVzIHN0b3JlZCBpbiB0aGUgc2hhZG93IG1hcC4gTWFrZSBpdCBzbGlnaHRseSBsYXJnZXIgdG8gYXZvaWQgY2xpcHBpbmcgb24gbmVhciAvIGZhciBwbGFuZS5cbiAgICAgICAgICAgIHNoYWRvd0NhbU5vZGUudHJhbnNsYXRlTG9jYWwoMCwgMCwgZGVwdGhSYW5nZS5tYXggKyAwLjEpO1xuICAgICAgICAgICAgc2hhZG93Q2FtLmZhckNsaXAgPSBkZXB0aFJhbmdlLm1heCAtIGRlcHRoUmFuZ2UubWluICsgMC4yO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gZnVuY3Rpb24gdG8gZ2VuZXJhdGUgZnJ1c3R1bSBzcGxpdCBkaXN0YW5jZXNcbiAgICBnZW5lcmF0ZVNwbGl0RGlzdGFuY2VzKGxpZ2h0LCBuZWFyRGlzdCwgZmFyRGlzdCkge1xuXG4gICAgICAgIGxpZ2h0Ll9zaGFkb3dDYXNjYWRlRGlzdGFuY2VzLmZpbGwoZmFyRGlzdCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGlnaHQubnVtQ2FzY2FkZXM7IGkrKykge1xuXG4gICAgICAgICAgICAvLyAgbGVycCBiZXR3ZWVuIGxpbmVhciBhbmQgbG9nYXJpdGhtaWMgZGlzdGFuY2UsIGNhbGxlZCBwcmFjdGljYWwgc3BsaXQgZGlzdGFuY2VcbiAgICAgICAgICAgIGNvbnN0IGZyYWN0aW9uID0gaSAvIGxpZ2h0Lm51bUNhc2NhZGVzO1xuICAgICAgICAgICAgY29uc3QgbGluZWFyRGlzdCA9IG5lYXJEaXN0ICsgKGZhckRpc3QgLSBuZWFyRGlzdCkgKiBmcmFjdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IGxvZ0Rpc3QgPSBuZWFyRGlzdCAqIChmYXJEaXN0IC8gbmVhckRpc3QpICoqIGZyYWN0aW9uO1xuICAgICAgICAgICAgY29uc3QgZGlzdCA9IG1hdGgubGVycChsaW5lYXJEaXN0LCBsb2dEaXN0LCBsaWdodC5jYXNjYWRlRGlzdHJpYnV0aW9uKTtcbiAgICAgICAgICAgIGxpZ2h0Ll9zaGFkb3dDYXNjYWRlRGlzdGFuY2VzW2kgLSAxXSA9IGRpc3Q7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRMaWdodFJlbmRlclBhc3NlcyhmcmFtZUdyYXBoLCBsaWdodCwgY2FtZXJhKSB7XG5cbiAgICAgICAgLy8gc2hhZG93IGNhc2NhZGVzIGhhdmUgbW9yZSBmYWNlcyByZW5kZXJlZCB3aXRoaW4gYSBzaW5nZSByZW5kZXIgcGFzc1xuICAgICAgICBjb25zdCBmYWNlQ291bnQgPSBsaWdodC5udW1TaGFkb3dGYWNlcztcbiAgICAgICAgY29uc3Qgc2hhZG93VXBkYXRlT3ZlcnJpZGVzID0gbGlnaHQuc2hhZG93VXBkYXRlT3ZlcnJpZGVzO1xuXG4gICAgICAgIC8vIHByZXBhcmUgcmVuZGVyIHRhcmdldHMgLyBjYW1lcmFzIGZvciByZW5kZXJpbmdcbiAgICAgICAgbGV0IGFsbENhc2NhZGVzUmVuZGVyaW5nID0gdHJ1ZTtcbiAgICAgICAgbGV0IHNoYWRvd0NhbWVyYTtcbiAgICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBmYWNlQ291bnQ7IGZhY2UrKykge1xuXG4gICAgICAgICAgICBpZiAoc2hhZG93VXBkYXRlT3ZlcnJpZGVzPy5bZmFjZV0gPT09IFNIQURPV1VQREFURV9OT05FKVxuICAgICAgICAgICAgICAgIGFsbENhc2NhZGVzUmVuZGVyaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHNoYWRvd0NhbWVyYSA9IHRoaXMuc2hhZG93UmVuZGVyZXIucHJlcGFyZUZhY2UobGlnaHQsIGNhbWVyYSwgZmFjZSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZW5kZXJQYXNzID0gbmV3IFJlbmRlclBhc3ModGhpcy5kZXZpY2UsICgpID0+IHtcblxuICAgICAgICAgICAgLy8gaW5zaWRlIHRoZSByZW5kZXIgcGFzcywgcmVuZGVyIGFsbCBmYWNlc1xuICAgICAgICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBmYWNlQ291bnQ7IGZhY2UrKykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNoYWRvd1VwZGF0ZU92ZXJyaWRlcz8uW2ZhY2VdICE9PSBTSEFET1dVUERBVEVfTk9ORSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1JlbmRlcmVyLnJlbmRlckZhY2UobGlnaHQsIGNhbWVyYSwgZmFjZSwgIWFsbENhc2NhZGVzUmVuZGVyaW5nKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2hhZG93VXBkYXRlT3ZlcnJpZGVzPy5bZmFjZV0gPT09IFNIQURPV1VQREFURV9USElTRlJBTUUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2hhZG93VXBkYXRlT3ZlcnJpZGVzW2ZhY2VdID0gU0hBRE9XVVBEQVRFX05PTkU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZW5kZXJQYXNzLmFmdGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8gYWZ0ZXIgdGhlIHBhc3MgaXMgZG9uZSwgYXBwbHkgVlNNIGJsdXIgaWYgbmVlZGVkXG4gICAgICAgICAgICB0aGlzLnNoYWRvd1JlbmRlcmVyLnJlbmRlclZzbShsaWdodCwgY2FtZXJhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzZXR1cCByZW5kZXIgcGFzcyB1c2luZyBhbnkgb2YgdGhlIGNhbWVyYXMsIHRoZXkgYWxsIGhhdmUgdGhlIHNhbWUgcGFzcyByZWxhdGVkIHByb3BlcnRpZXNcbiAgICAgICAgdGhpcy5zaGFkb3dSZW5kZXJlci5zZXR1cFJlbmRlclBhc3MocmVuZGVyUGFzcywgc2hhZG93Q2FtZXJhLCBhbGxDYXNjYWRlc1JlbmRlcmluZyk7XG4gICAgICAgIERlYnVnSGVscGVyLnNldE5hbWUocmVuZGVyUGFzcywgYERpclNoYWRvdy0ke2xpZ2h0Ll9ub2RlLm5hbWV9YCk7XG5cbiAgICAgICAgZnJhbWVHcmFwaC5hZGRSZW5kZXJQYXNzKHJlbmRlclBhc3MpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyBhIGZyYW1lIGdyYXBoIGZvciByZW5kZXJpbmcgb2YgZGlyZWN0aW9uYWwgc2hhZG93cyBmb3IgdGhlIHJlbmRlciBhY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vZnJhbWUtZ3JhcGguanMnKS5GcmFtZUdyYXBofSBmcmFtZUdyYXBoIC0gVGhlIGZyYW1lLWdyYXBoIHRoYXQgaXMgYnVpbHQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2NvbXBvc2l0aW9uL3JlbmRlci1hY3Rpb24uanMnKS5SZW5kZXJBY3Rpb259IHJlbmRlckFjdGlvbiAtIFRoZSByZW5kZXJcbiAgICAgKiBhY3Rpb24uXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uLy4uL2ZyYW1ld29yay9jb21wb25lbnRzL2NhbWVyYS9jb21wb25lbnQuanMnKS5DYW1lcmFDb21wb25lbnR9IGNhbWVyYSAtIFRoZSBjYW1lcmEuXG4gICAgICovXG4gICAgYnVpbGRGcmFtZUdyYXBoKGZyYW1lR3JhcGgsIHJlbmRlckFjdGlvbiwgY2FtZXJhKSB7XG5cbiAgICAgICAgLy8gY3JlYXRlIHJlcXVpcmVkIHJlbmRlciBwYXNzZXMgcGVyIGxpZ2h0XG4gICAgICAgIGNvbnN0IGxpZ2h0cyA9IHJlbmRlckFjdGlvbi5kaXJlY3Rpb25hbExpZ2h0cztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaWdodHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGxpZ2h0ID0gbGlnaHRzW2ldO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGxpZ2h0ICYmIGxpZ2h0Ll90eXBlID09PSBMSUdIVFRZUEVfRElSRUNUSU9OQUwpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zaGFkb3dSZW5kZXJlci5uZWVkc1NoYWRvd1JlbmRlcmluZyhsaWdodCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZExpZ2h0UmVuZGVyUGFzc2VzKGZyYW1lR3JhcGgsIGxpZ2h0LCBjYW1lcmEuY2FtZXJhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgU2hhZG93UmVuZGVyZXJEaXJlY3Rpb25hbCB9O1xuIl0sIm5hbWVzIjpbInZpc2libGVTY2VuZUFhYmIiLCJCb3VuZGluZ0JveCIsImNlbnRlciIsIlZlYzMiLCJzaGFkb3dDYW1WaWV3IiwiTWF0NCIsImFhYmJQb2ludHMiLCJfZGVwdGhSYW5nZSIsIm1pbiIsIm1heCIsImdldERlcHRoUmFuZ2UiLCJjYW1lcmFWaWV3TWF0cml4IiwiYWFiYk1pbiIsImFhYmJNYXgiLCJ4IiwieSIsInoiLCJtaW56IiwibWF4eiIsImkiLCJ0cmFuc2Zvcm1Qb2ludCIsIlNoYWRvd1JlbmRlcmVyRGlyZWN0aW9uYWwiLCJjb25zdHJ1Y3RvciIsInJlbmRlcmVyIiwic2hhZG93UmVuZGVyZXIiLCJkZXZpY2UiLCJjdWxsIiwibGlnaHQiLCJkcmF3Q2FsbHMiLCJjYW1lcmEiLCJ2aXNpYmxlVGhpc0ZyYW1lIiwiX3NoYWRvd01hcCIsIlNoYWRvd01hcCIsImNyZWF0ZSIsIm5lYXJEaXN0IiwiX25lYXJDbGlwIiwiZ2VuZXJhdGVTcGxpdERpc3RhbmNlcyIsIk1hdGgiLCJfZmFyQ2xpcCIsInNoYWRvd0Rpc3RhbmNlIiwic2hhZG93VXBkYXRlT3ZlcnJpZGVzIiwiY2FzY2FkZSIsIm51bUNhc2NhZGVzIiwiU0hBRE9XVVBEQVRFX05PTkUiLCJsaWdodFJlbmRlckRhdGEiLCJnZXRSZW5kZXJEYXRhIiwic2hhZG93Q2FtIiwic2hhZG93Q2FtZXJhIiwicmVuZGVyVGFyZ2V0IiwicmVuZGVyVGFyZ2V0cyIsInNoYWRvd1ZpZXdwb3J0IiwiY29weSIsImNhc2NhZGVzIiwic2hhZG93U2Npc3NvciIsInNoYWRvd0NhbU5vZGUiLCJfbm9kZSIsImxpZ2h0Tm9kZSIsInNldFBvc2l0aW9uIiwiZ2V0UG9zaXRpb24iLCJzZXRSb3RhdGlvbiIsImdldFJvdGF0aW9uIiwicm90YXRlTG9jYWwiLCJmcnVzdHVtTmVhckRpc3QiLCJfc2hhZG93Q2FzY2FkZURpc3RhbmNlcyIsImZydXN0dW1GYXJEaXN0IiwiZnJ1c3R1bVBvaW50cyIsImdldEZydXN0dW1Db3JuZXJzIiwic2V0IiwiY2FtZXJhV29ybGRNYXQiLCJub2RlIiwiZ2V0V29ybGRUcmFuc2Zvcm0iLCJhZGQiLCJtdWxTY2FsYXIiLCJyYWRpdXMiLCJkaXN0Iiwic3ViIiwibGVuZ3RoIiwicmlnaHQiLCJ1cCIsImxpZ2h0RGlyIiwiZm9yd2FyZCIsInNpemVSYXRpbyIsIl9zaGFkb3dSZXNvbHV0aW9uIiwiY2VpbCIsImRvdCIsInNjYWxlZFVwIiwic2NhbGVkUmlnaHQiLCJzY2FsZWREaXIiLCJhZGQyIiwidHJhbnNsYXRlTG9jYWwiLCJuZWFyQ2xpcCIsImZhckNsaXAiLCJvcnRob0hlaWdodCIsInVwZGF0ZUNhbWVyYUZydXN0dW0iLCJjdWxsU2hhZG93Q2FzdGVycyIsInZpc2libGVDYXN0ZXJzIiwiZW1wdHlBYWJiIiwibWVzaEluc3RhbmNlIiwiYWFiYiIsImludmVydCIsImRlcHRoUmFuZ2UiLCJnZXRNaW4iLCJnZXRNYXgiLCJkZXB0aFJhbmdlQ29tcGVuc2F0aW9uIiwiZmFyRGlzdCIsImZpbGwiLCJmcmFjdGlvbiIsImxpbmVhckRpc3QiLCJsb2dEaXN0IiwibWF0aCIsImxlcnAiLCJjYXNjYWRlRGlzdHJpYnV0aW9uIiwiYWRkTGlnaHRSZW5kZXJQYXNzZXMiLCJmcmFtZUdyYXBoIiwiZmFjZUNvdW50IiwibnVtU2hhZG93RmFjZXMiLCJhbGxDYXNjYWRlc1JlbmRlcmluZyIsImZhY2UiLCJwcmVwYXJlRmFjZSIsInJlbmRlclBhc3MiLCJSZW5kZXJQYXNzIiwicmVuZGVyRmFjZSIsIlNIQURPV1VQREFURV9USElTRlJBTUUiLCJhZnRlciIsInJlbmRlclZzbSIsInNldHVwUmVuZGVyUGFzcyIsIkRlYnVnSGVscGVyIiwic2V0TmFtZSIsIm5hbWUiLCJhZGRSZW5kZXJQYXNzIiwiYnVpbGRGcmFtZUdyYXBoIiwicmVuZGVyQWN0aW9uIiwibGlnaHRzIiwiZGlyZWN0aW9uYWxMaWdodHMiLCJEZWJ1ZyIsImFzc2VydCIsIl90eXBlIiwiTElHSFRUWVBFX0RJUkVDVElPTkFMIiwibmVl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
