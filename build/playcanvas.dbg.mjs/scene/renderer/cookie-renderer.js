/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Vec4 } from '../../math/vec4.js';
import { Mat4 } from '../../math/mat4.js';
import { PIXELFORMAT_R8_G8_B8_A8, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE } from '../../graphics/constants.js';
import { Texture } from '../../graphics/texture.js';
import { createShaderFromCode } from '../../graphics/program-lib/utils.js';
import { drawQuadWithShader } from '../../graphics/simple-post-effect.js';
import { DebugGraphics } from '../../graphics/debug-graphics.js';
import { LIGHTTYPE_OMNI } from '../constants.js';
import { LightCamera } from './light-camera.js';

const textureBlitVertexShader = `
    attribute vec2 vertex_position;
    varying vec2 uv0;
    void main(void) {
        gl_Position = vec4(vertex_position, 0.5, 1.0);
        uv0 = vertex_position.xy * 0.5 + 0.5;
    }`;
const textureBlitFragmentShader = `
    varying vec2 uv0;
    uniform sampler2D blitTexture;
    void main(void) {
        gl_FragColor = texture2D(blitTexture, uv0);
    }`;
const textureCubeBlitFragmentShader = `
    varying vec2 uv0;
    uniform samplerCube blitTexture;
    uniform mat4 invViewProj;
    void main(void) {
        vec4 projPos = vec4(uv0 * 2.0 - 1.0, 0.5, 1.0);
        vec4 worldPos = invViewProj * projPos;
        gl_FragColor = textureCube(blitTexture, worldPos.xyz);
    }`;

const _viewport = new Vec4();

class CookieRenderer {
  constructor(device, lightTextureAtlas) {
    this.device = device;
    this.lightTextureAtlas = lightTextureAtlas;
    this.blitShader2d = null;
    this.blitShaderCube = null;
    this.blitTextureId = null;
    this.invViewProjId = null;
  }

  destroy() {}

  getShader(shader, fragment) {
    if (!this[shader]) this[shader] = createShaderFromCode(this.device, textureBlitVertexShader, fragment, `cookie_renderer_${shader}`);
    if (!this.blitTextureId) this.blitTextureId = this.device.scope.resolve('blitTexture');
    if (!this.invViewProjId) this.invViewProjId = this.device.scope.resolve('invViewProj');
    return this[shader];
  }

  get shader2d() {
    return this.getShader('blitShader2d', textureBlitFragmentShader);
  }

  get shaderCube() {
    return this.getShader('blitShaderCube', textureCubeBlitFragmentShader);
  }

  static createTexture(device, resolution) {
    const texture = new Texture(device, {
      name: 'CookieAtlas',
      width: resolution,
      height: resolution,
      format: PIXELFORMAT_R8_G8_B8_A8,
      cubemap: false,
      mipmaps: false,
      minFilter: FILTER_NEAREST,
      magFilter: FILTER_NEAREST,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE
    });
    return texture;
  }

  initInvViewProjMatrices() {
    if (!CookieRenderer._invViewProjMatrices) {
      CookieRenderer._invViewProjMatrices = [];

      for (let face = 0; face < 6; face++) {
        const camera = LightCamera.create(null, LIGHTTYPE_OMNI, face);
        const projMat = camera.projectionMatrix;
        const viewMat = camera.node.getLocalTransform().clone().invert();
        CookieRenderer._invViewProjMatrices[face] = new Mat4().mul2(projMat, viewMat).invert();
      }
    }
  }

  render(light, renderTarget) {
    if (light.enabled && light.cookie && light.visibleThisFrame) {
      DebugGraphics.pushGpuMarker(this.device, `COOKIE ${light._node.name}`);
      const faceCount = light.numShadowFaces;
      const shader = faceCount > 1 ? this.shaderCube : this.shader2d;
      const device = this.device;

      if (faceCount > 1) {
        this.initInvViewProjMatrices();
      }

      this.blitTextureId.setValue(light.cookie);

      for (let face = 0; face < faceCount; face++) {
        _viewport.copy(light.atlasViewport);

        if (faceCount > 1) {
          const smallSize = _viewport.z / 3;
          const offset = this.lightTextureAtlas.cubeSlotsOffsets[face];
          _viewport.x += smallSize * offset.x;
          _viewport.y += smallSize * offset.y;
          _viewport.z = smallSize;
          _viewport.w = smallSize;
          this.invViewProjId.setValue(CookieRenderer._invViewProjMatrices[face].data);
        }

        _viewport.mulScalar(renderTarget.colorBuffer.width);

        drawQuadWithShader(device, renderTarget, shader, _viewport);
      }

      DebugGraphics.popGpuMarker(this.device);
    }
  }

}

CookieRenderer._invViewProjMatrices = null;

export { CookieRenderer };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLXJlbmRlcmVyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvcmVuZGVyZXIvY29va2llLXJlbmRlcmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZlYzQgfSBmcm9tICcuLi8uLi9tYXRoL3ZlYzQuanMnO1xuaW1wb3J0IHsgTWF0NCB9IGZyb20gJy4uLy4uL21hdGgvbWF0NC5qcyc7XG5cbmltcG9ydCB7IEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgRklMVEVSX05FQVJFU1QsIFBJWEVMRk9STUFUX1I4X0c4X0I4X0E4IH0gZnJvbSAnLi4vLi4vZ3JhcGhpY3MvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi8uLi9ncmFwaGljcy90ZXh0dXJlLmpzJztcbmltcG9ydCB7IGNyZWF0ZVNoYWRlckZyb21Db2RlIH0gZnJvbSAnLi4vLi4vZ3JhcGhpY3MvcHJvZ3JhbS1saWIvdXRpbHMuanMnO1xuaW1wb3J0IHsgZHJhd1F1YWRXaXRoU2hhZGVyIH0gZnJvbSAnLi4vLi4vZ3JhcGhpY3Mvc2ltcGxlLXBvc3QtZWZmZWN0LmpzJztcbmltcG9ydCB7IERlYnVnR3JhcGhpY3MgfSBmcm9tICcuLi8uLi9ncmFwaGljcy9kZWJ1Zy1ncmFwaGljcy5qcyc7XG5cbmltcG9ydCB7IExJR0hUVFlQRV9PTU5JIH0gZnJvbSAnLi4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IExpZ2h0Q2FtZXJhIH0gZnJvbSAnLi9saWdodC1jYW1lcmEuanMnO1xuXG5jb25zdCB0ZXh0dXJlQmxpdFZlcnRleFNoYWRlciA9IGBcbiAgICBhdHRyaWJ1dGUgdmVjMiB2ZXJ0ZXhfcG9zaXRpb247XG4gICAgdmFyeWluZyB2ZWMyIHV2MDtcbiAgICB2b2lkIG1haW4odm9pZCkge1xuICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQodmVydGV4X3Bvc2l0aW9uLCAwLjUsIDEuMCk7XG4gICAgICAgIHV2MCA9IHZlcnRleF9wb3NpdGlvbi54eSAqIDAuNSArIDAuNTtcbiAgICB9YDtcblxuY29uc3QgdGV4dHVyZUJsaXRGcmFnbWVudFNoYWRlciA9IGBcbiAgICB2YXJ5aW5nIHZlYzIgdXYwO1xuICAgIHVuaWZvcm0gc2FtcGxlcjJEIGJsaXRUZXh0dXJlO1xuICAgIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChibGl0VGV4dHVyZSwgdXYwKTtcbiAgICB9YDtcblxuLy8gc2hhZGVyIHJ1bnMgZm9yIGVhY2ggZmFjZSwgd2l0aCBpblZpZXdQcm9qIG1hdHJpeCByZXByZXNlbnRpbmcgYSBmYWNlIGNhbWVyYVxuY29uc3QgdGV4dHVyZUN1YmVCbGl0RnJhZ21lbnRTaGFkZXIgPSBgXG4gICAgdmFyeWluZyB2ZWMyIHV2MDtcbiAgICB1bmlmb3JtIHNhbXBsZXJDdWJlIGJsaXRUZXh0dXJlO1xuICAgIHVuaWZvcm0gbWF0NCBpbnZWaWV3UHJvajtcbiAgICB2b2lkIG1haW4odm9pZCkge1xuICAgICAgICB2ZWM0IHByb2pQb3MgPSB2ZWM0KHV2MCAqIDIuMCAtIDEuMCwgMC41LCAxLjApO1xuICAgICAgICB2ZWM0IHdvcmxkUG9zID0gaW52Vmlld1Byb2ogKiBwcm9qUG9zO1xuICAgICAgICBnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlQ3ViZShibGl0VGV4dHVyZSwgd29ybGRQb3MueHl6KTtcbiAgICB9YDtcblxuY29uc3QgX3ZpZXdwb3J0ID0gbmV3IFZlYzQoKTtcblxuLy8gaGVscGVyIGNsYXNzIHVzZWQgYnkgY2x1c3RlcmVkIGxpZ2h0aW5nIHN5c3RlbSB0byByZW5kZXIgY29va2llcyBpbnRvIHRoZSB0ZXh0dXJlIGF0bGFzLCBzaW1pbGFybHkgdG8gc2hhZG93IHJlbmRlcmVyXG5jbGFzcyBDb29raWVSZW5kZXJlciB7XG4gICAgY29uc3RydWN0b3IoZGV2aWNlLCBsaWdodFRleHR1cmVBdGxhcykge1xuICAgICAgICB0aGlzLmRldmljZSA9IGRldmljZTtcbiAgICAgICAgdGhpcy5saWdodFRleHR1cmVBdGxhcyA9IGxpZ2h0VGV4dHVyZUF0bGFzO1xuXG4gICAgICAgIHRoaXMuYmxpdFNoYWRlcjJkID0gbnVsbDtcbiAgICAgICAgdGhpcy5ibGl0U2hhZGVyQ3ViZSA9IG51bGw7XG4gICAgICAgIHRoaXMuYmxpdFRleHR1cmVJZCA9IG51bGw7XG4gICAgICAgIHRoaXMuaW52Vmlld1Byb2pJZCA9IG51bGw7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICB9XG5cbiAgICBnZXRTaGFkZXIoc2hhZGVyLCBmcmFnbWVudCkge1xuXG4gICAgICAgIGlmICghdGhpc1tzaGFkZXJdKVxuICAgICAgICAgICAgdGhpc1tzaGFkZXJdID0gY3JlYXRlU2hhZGVyRnJvbUNvZGUodGhpcy5kZXZpY2UsIHRleHR1cmVCbGl0VmVydGV4U2hhZGVyLCBmcmFnbWVudCwgYGNvb2tpZV9yZW5kZXJlcl8ke3NoYWRlcn1gKTtcblxuICAgICAgICBpZiAoIXRoaXMuYmxpdFRleHR1cmVJZClcbiAgICAgICAgICAgIHRoaXMuYmxpdFRleHR1cmVJZCA9IHRoaXMuZGV2aWNlLnNjb3BlLnJlc29sdmUoJ2JsaXRUZXh0dXJlJyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmludlZpZXdQcm9qSWQpXG4gICAgICAgICAgICB0aGlzLmludlZpZXdQcm9qSWQgPSB0aGlzLmRldmljZS5zY29wZS5yZXNvbHZlKCdpbnZWaWV3UHJvaicpO1xuXG4gICAgICAgIHJldHVybiB0aGlzW3NoYWRlcl07XG4gICAgfVxuXG4gICAgZ2V0IHNoYWRlcjJkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGFkZXIoJ2JsaXRTaGFkZXIyZCcsIHRleHR1cmVCbGl0RnJhZ21lbnRTaGFkZXIpO1xuICAgIH1cblxuICAgIGdldCBzaGFkZXJDdWJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGFkZXIoJ2JsaXRTaGFkZXJDdWJlJywgdGV4dHVyZUN1YmVCbGl0RnJhZ21lbnRTaGFkZXIpO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVUZXh0dXJlKGRldmljZSwgcmVzb2x1dGlvbikge1xuXG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZShkZXZpY2UsIHtcbiAgICAgICAgICAgIG5hbWU6ICdDb29raWVBdGxhcycsXG4gICAgICAgICAgICB3aWR0aDogcmVzb2x1dGlvbixcbiAgICAgICAgICAgIGhlaWdodDogcmVzb2x1dGlvbixcbiAgICAgICAgICAgIGZvcm1hdDogUElYRUxGT1JNQVRfUjhfRzhfQjhfQTgsXG4gICAgICAgICAgICBjdWJlbWFwOiBmYWxzZSxcbiAgICAgICAgICAgIG1pcG1hcHM6IGZhbHNlLFxuICAgICAgICAgICAgbWluRmlsdGVyOiBGSUxURVJfTkVBUkVTVCxcbiAgICAgICAgICAgIG1hZ0ZpbHRlcjogRklMVEVSX05FQVJFU1QsXG4gICAgICAgICAgICBhZGRyZXNzVTogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgYWRkcmVzc1Y6IEFERFJFU1NfQ0xBTVBfVE9fRURHRVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGV4dHVyZTtcbiAgICB9XG5cbiAgICAvLyBmb3IgcmVuZGVyaW5nIG9mIGNvb2tpZXMsIHN0b3JlIGludmVyc2UgdmlldyBwcm9qZWN0aW9uIG1hdHJpY2VzIGZvciA2IGZhY2VzLCBhbGxvd2luZyBjdWJlbWFwIGZhY2VzIHRvIGJlIGNvcGllZCBpbnRvIHRoZSBhdGxhc1xuICAgIHN0YXRpYyBfaW52Vmlld1Byb2pNYXRyaWNlcyA9IG51bGw7XG5cbiAgICBpbml0SW52Vmlld1Byb2pNYXRyaWNlcygpIHtcbiAgICAgICAgaWYgKCFDb29raWVSZW5kZXJlci5faW52Vmlld1Byb2pNYXRyaWNlcykge1xuICAgICAgICAgICAgQ29va2llUmVuZGVyZXIuX2ludlZpZXdQcm9qTWF0cmljZXMgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCA2OyBmYWNlKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmEgPSBMaWdodENhbWVyYS5jcmVhdGUobnVsbCwgTElHSFRUWVBFX09NTkksIGZhY2UpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2pNYXQgPSBjYW1lcmEucHJvamVjdGlvbk1hdHJpeDtcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3TWF0ID0gY2FtZXJhLm5vZGUuZ2V0TG9jYWxUcmFuc2Zvcm0oKS5jbG9uZSgpLmludmVydCgpO1xuICAgICAgICAgICAgICAgIENvb2tpZVJlbmRlcmVyLl9pbnZWaWV3UHJvak1hdHJpY2VzW2ZhY2VdID0gbmV3IE1hdDQoKS5tdWwyKHByb2pNYXQsIHZpZXdNYXQpLmludmVydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVuZGVyKGxpZ2h0LCByZW5kZXJUYXJnZXQpIHtcblxuICAgICAgICBpZiAobGlnaHQuZW5hYmxlZCAmJiBsaWdodC5jb29raWUgJiYgbGlnaHQudmlzaWJsZVRoaXNGcmFtZSkge1xuXG4gICAgICAgICAgICBEZWJ1Z0dyYXBoaWNzLnB1c2hHcHVNYXJrZXIodGhpcy5kZXZpY2UsIGBDT09LSUUgJHtsaWdodC5fbm9kZS5uYW1lfWApO1xuXG4gICAgICAgICAgICBjb25zdCBmYWNlQ291bnQgPSBsaWdodC5udW1TaGFkb3dGYWNlcztcbiAgICAgICAgICAgIGNvbnN0IHNoYWRlciA9IGZhY2VDb3VudCA+IDEgPyB0aGlzLnNoYWRlckN1YmUgOiB0aGlzLnNoYWRlcjJkO1xuICAgICAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpcy5kZXZpY2U7XG5cbiAgICAgICAgICAgIGlmIChmYWNlQ291bnQgPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbml0SW52Vmlld1Byb2pNYXRyaWNlcygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzb3VyY2UgdGV4dHVyZVxuICAgICAgICAgICAgdGhpcy5ibGl0VGV4dHVyZUlkLnNldFZhbHVlKGxpZ2h0LmNvb2tpZSk7XG5cbiAgICAgICAgICAgIC8vIHJlbmRlciBpdCB0byBhIHZpZXdwb3J0IG9mIHRoZSB0YXJnZXRcbiAgICAgICAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgZmFjZUNvdW50OyBmYWNlKyspIHtcblxuICAgICAgICAgICAgICAgIF92aWV3cG9ydC5jb3B5KGxpZ2h0LmF0bGFzVmlld3BvcnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZhY2VDb3VudCA+IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBmb3IgY3ViZW1hcCwgcmVuZGVyIHRvIG9uZSBvZiB0aGUgM3gzIHN1Yi1hcmVhc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzbWFsbFNpemUgPSBfdmlld3BvcnQueiAvIDM7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMubGlnaHRUZXh0dXJlQXRsYXMuY3ViZVNsb3RzT2Zmc2V0c1tmYWNlXTtcbiAgICAgICAgICAgICAgICAgICAgX3ZpZXdwb3J0LnggKz0gc21hbGxTaXplICogb2Zmc2V0Lng7XG4gICAgICAgICAgICAgICAgICAgIF92aWV3cG9ydC55ICs9IHNtYWxsU2l6ZSAqIG9mZnNldC55O1xuICAgICAgICAgICAgICAgICAgICBfdmlld3BvcnQueiA9IHNtYWxsU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgX3ZpZXdwb3J0LncgPSBzbWFsbFNpemU7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY3ViZW1hcCBmYWNlIHByb2plY3Rpb24gdW5pZm9ybVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmludlZpZXdQcm9qSWQuc2V0VmFsdWUoQ29va2llUmVuZGVyZXIuX2ludlZpZXdQcm9qTWF0cmljZXNbZmFjZV0uZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3ZpZXdwb3J0Lm11bFNjYWxhcihyZW5kZXJUYXJnZXQuY29sb3JCdWZmZXIud2lkdGgpO1xuICAgICAgICAgICAgICAgIGRyYXdRdWFkV2l0aFNoYWRlcihkZXZpY2UsIHJlbmRlclRhcmdldCwgc2hhZGVyLCBfdmlld3BvcnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcih0aGlzLmRldmljZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IENvb2tpZVJlbmRlcmVyIH07XG4iXSwibmFtZXMiOlsidGV4dHVyZUJsaXRWZXJ0ZXhTaGFkZXIiLCJ0ZXh0dXJlQmxpdEZyYWdtZW50U2hhZGVyIiwidGV4dHVyZUN1YmVCbGl0RnJhZ21lbnRTaGFkZXIiLCJfdmlld3BvcnQiLCJWZWM0IiwiQ29va2llUmVuZGVyZXIiLCJjb25zdHJ1Y3RvciIsImRldmljZSIsImxpZ2h0VGV4dHVyZUF0bGFzIiwiYmxpdFNoYWRlcjJkIiwiYmxpdFNoYWRlckN1YmUiLCJibGl0VGV4dHVyZUlkIiwiaW52Vmlld1Byb2pJZCIsImRlc3Ryb3kiLCJnZXRTaGFkZXIiLCJzaGFkZXIiLCJmcmFnbWVudCIsImNyZWF0ZVNoYWRlckZyb21Db2RlIiwic2NvcGUiLCJyZXNvbHZlIiwic2hhZGVyMmQiLCJzaGFkZXJDdWJlIiwiY3JlYXRlVGV4dHVyZSIsInJlc29sdXRpb24iLCJ0ZXh0dXJlIiwiVGV4dHVyZSIsIm5hbWUiLCJ3aWR0aCIsImhlaWdodCIsImZvcm1hdCIsIlBJWEVMRk9STUFUX1I4X0c4X0I4X0E4IiwiY3ViZW1hcCIsIm1pcG1hcHMiLCJtaW5GaWx0ZXIiLCJGSUxURVJfTkVBUkVTVCIsIm1hZ0ZpbHRlciIsImFkZHJlc3NVIiwiQUREUkVTU19DTEFNUF9UT19FREdFIiwiYWRkcmVzc1YiLCJpbml0SW52Vmlld1Byb2pNYXRyaWNlcyIsIl9pbnZWaWV3UHJvak1hdHJpY2VzIiwiZmFjZSIsImNhbWVyYSIsIkxpZ2h0Q2FtZXJhIiwiY3JlYXRlIiwiTElHSFRUWVBFX09NTkkiLCJwcm9qTWF0IiwicHJvamVjdGlvbk1hdHJpeCIsInZpZXdNYXQiLCJub2RlIiwiZ2V0TG9jYWxUcmFuc2Zvcm0iLCJjbG9uZSIsImludmVydCIsIk1hdDQiLCJtdWwyIiwicmVuZGVyIiwibGlnaHQiLCJyZW5kZXJUYXJnZXQiLCJlbmFibGVkIiwiY29va2llIiwidmlzaWJsZVRoaXNGcmFtZSIsIkRlYnVnR3JhcGhpY3MiLCJwdXNoR3B1TWFya2VyIiwiX25vZGUiLCJmYWNlQ291bnQiLCJudW1TaGFkb3dGYWNlcyIsInNldFZhbHVlIiwiY29weSIsImF0bGFzVmlld3BvcnQiLCJzbWFsbFNpemUiLCJ6Iiwib2Zmc2V0IiwiY3ViZVNsb3RzT2Zmc2V0cyIsIngiLCJ5IiwidyIsImRhdGEiLCJtdWxTY2FsYXIiLCJjb2xvckJ1ZmZlciIsImRyYXdRdWFkV2l0aFNoYWRlciIsInBvcEdwdU1hcmtlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBWUEsTUFBTUEsdUJBQXVCLEdBQUksQ0FBQTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FOQSxDQUFBLENBQUE7QUFRQSxNQUFNQyx5QkFBeUIsR0FBSSxDQUFBO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FMQSxDQUFBLENBQUE7QUFRQSxNQUFNQyw2QkFBNkIsR0FBSSxDQUFBO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FSQSxDQUFBLENBQUE7O0FBVUEsTUFBTUMsU0FBUyxHQUFHLElBQUlDLElBQUosRUFBbEIsQ0FBQTs7QUFHQSxNQUFNQyxjQUFOLENBQXFCO0FBQ2pCQyxFQUFBQSxXQUFXLENBQUNDLE1BQUQsRUFBU0MsaUJBQVQsRUFBNEI7SUFDbkMsSUFBS0QsQ0FBQUEsTUFBTCxHQUFjQSxNQUFkLENBQUE7SUFDQSxJQUFLQyxDQUFBQSxpQkFBTCxHQUF5QkEsaUJBQXpCLENBQUE7SUFFQSxJQUFLQyxDQUFBQSxZQUFMLEdBQW9CLElBQXBCLENBQUE7SUFDQSxJQUFLQyxDQUFBQSxjQUFMLEdBQXNCLElBQXRCLENBQUE7SUFDQSxJQUFLQyxD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
