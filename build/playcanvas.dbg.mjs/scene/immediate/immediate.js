/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { PRIMITIVE_TRISTRIP } from '../../platform/graphics/constants.js';
import { BLEND_NORMAL } from '../constants.js';
import { GraphNode } from '../graph-node.js';
import { Mesh } from '../mesh.js';
import { MeshInstance } from '../mesh-instance.js';
import { BasicMaterial } from '../materials/basic-material.js';
import { createShaderFromCode } from '../shader-lib/utils.js';
import { shaderChunks } from '../shader-lib/chunks/chunks.js';
import { ImmediateBatches } from './immediate-batches.js';

const tempPoints = [];
class Immediate {
  constructor(device) {
    this.device = device;
    this.quadMesh = null;
    this.textureShader = null;
    this.depthTextureShader = null;
    this.cubeLocalPos = null;
    this.cubeWorldPos = null;

    // map of Layer to ImmediateBatches, storing line batches for a layer
    this.batchesMap = new Map();

    // set of all batches that were used in the frame
    this.allBatches = new Set();

    // set of all layers updated during this frame
    this.updatedLayers = new Set();

    // line materials
    this._materialDepth = null;
    this._materialNoDepth = null;

    // map of meshes instances added to a layer. The key is layer, the value is an array of mesh instances
    this.layerMeshInstances = new Map();
  }

  // creates material for line rendering
  createMaterial(depthTest) {
    const material = new BasicMaterial();
    material.vertexColors = true;
    material.blend = true;
    material.blendType = BLEND_NORMAL;
    material.depthTest = depthTest;
    material.update();
    return material;
  }

  // material for line rendering with depth testing on
  get materialDepth() {
    if (!this._materialDepth) {
      this._materialDepth = this.createMaterial(true);
    }
    return this._materialDepth;
  }

  // material for line rendering with depth testing off
  get materialNoDepth() {
    if (!this._materialNoDepth) {
      this._materialNoDepth = this.createMaterial(false);
    }
    return this._materialNoDepth;
  }

  // returns a batch for rendering lines to a layer with required depth testing state
  getBatch(layer, depthTest) {
    // get batches for the layer
    let batches = this.batchesMap.get(layer);
    if (!batches) {
      batches = new ImmediateBatches(this.device);
      this.batchesMap.set(layer, batches);
    }

    // add it for rendering
    this.allBatches.add(batches);

    // get batch for the material
    const material = depthTest ? this.materialDepth : this.materialNoDepth;
    return batches.getBatch(material, layer);
  }

  // shared vertex shader for textured quad rendering
  static getTextureVS() {
    return `
            attribute vec2 vertex_position;
            uniform mat4 matrix_model;
            varying vec2 uv0;
            void main(void) {
                gl_Position = matrix_model * vec4(vertex_position, 0, 1);
                uv0 = vertex_position.xy + 0.5;
            }
        `;
  }

  // shader used to display texture
  getTextureShader() {
    if (!this.textureShader) {
      const fshader = `
                varying vec2 uv0;
                uniform sampler2D colorMap;
                void main (void) {
                    gl_FragColor = vec4(texture2D(colorMap, uv0).xyz, 1);
                }
            `;
      this.textureShader = createShaderFromCode(this.device, Immediate.getTextureVS(), fshader, 'DebugTextureShader');
    }
    return this.textureShader;
  }

  // shader used to display depth texture
  getDepthTextureShader() {
    if (!this.depthTextureShader) {
      const fshader = `
                ${shaderChunks.screenDepthPS}
                varying vec2 uv0;
                void main() {
                    float depth = getLinearScreenDepth(uv0) * camera_params.x;
                    gl_FragColor = vec4(vec3(depth), 1.0);
                }
            `;
      this.depthTextureShader = createShaderFromCode(this.device, Immediate.getTextureVS(), fshader, 'DebugDepthTextureShader');
    }
    return this.depthTextureShader;
  }

  // creates mesh used to render a quad
  getQuadMesh() {
    if (!this.quadMesh) {
      this.quadMesh = new Mesh(this.device);
      this.quadMesh.setPositions([-0.5, -0.5, 0, 0.5, -0.5, 0, -0.5, 0.5, 0, 0.5, 0.5, 0]);
      this.quadMesh.update(PRIMITIVE_TRISTRIP);
    }
    return this.quadMesh;
  }

  // Draw mesh at this frame
  drawMesh(material, matrix, mesh, meshInstance, layer) {
    // create a mesh instance for the mesh if needed
    if (!meshInstance) {
      const graphNode = this.getGraphNode(matrix);
      meshInstance = new MeshInstance(mesh, material, graphNode);
    }

    // add the mesh instance to an array per layer, they get added to layers before rendering
    let layerMeshInstances = this.layerMeshInstances.get(layer);
    if (!layerMeshInstances) {
      layerMeshInstances = [];
      this.layerMeshInstances.set(layer, layerMeshInstances);
    }
    layerMeshInstances.push(meshInstance);
  }
  drawWireAlignedBox(min, max, color, depthTest, layer) {
    tempPoints.push(min.x, min.y, min.z, min.x, max.y, min.z, min.x, max.y, min.z, max.x, max.y, min.z, max.x, max.y, min.z, max.x, min.y, min.z, max.x, min.y, min.z, min.x, min.y, min.z, min.x, min.y, max.z, min.x, max.y, max.z, min.x, max.y, max.z, max.x, max.y, max.z, max.x, max.y, max.z, max.x, min.y, max.z, max.x, min.y, max.z, min.x, min.y, max.z, min.x, min.y, min.z, min.x, min.y, max.z, min.x, max.y, min.z, min.x, max.y, max.z, max.x, max.y, min.z, max.x, max.y, max.z, max.x, min.y, min.z, max.x, min.y, max.z);
    const batch = this.getBatch(layer, depthTest);
    batch.addLinesArrays(tempPoints, color);
    tempPoints.length = 0;
  }
  drawWireSphere(center, radius, color, numSegments, depthTest, layer) {
    const step = 2 * Math.PI / numSegments;
    let angle = 0;
    for (let i = 0; i < numSegments; i++) {
      const sin0 = Math.sin(angle);
      const cos0 = Math.cos(angle);
      angle += step;
      const sin1 = Math.sin(angle);
      const cos1 = Math.cos(angle);
      tempPoints.push(center.x + radius * sin0, center.y, center.z + radius * cos0);
      tempPoints.push(center.x + radius * sin1, center.y, center.z + radius * cos1);
      tempPoints.push(center.x + radius * sin0, center.y + radius * cos0, center.z);
      tempPoints.push(center.x + radius * sin1, center.y + radius * cos1, center.z);
      tempPoints.push(center.x, center.y + radius * sin0, center.z + radius * cos0);
      tempPoints.push(center.x, center.y + radius * sin1, center.z + radius * cos1);
    }
    const batch = this.getBatch(layer, depthTest);
    batch.addLinesArrays(tempPoints, color);
    tempPoints.length = 0;
  }
  getGraphNode(matrix) {
    const graphNode = new GraphNode('ImmediateDebug');
    graphNode.worldTransform = matrix;
    graphNode._dirtyWorld = graphNode._dirtyNormal = false;
    return graphNode;
  }

  // This is called just before the layer is rendered to allow lines for the layer to be added from inside
  // the frame getting rendered
  onPreRenderLayer(layer, visibleList, transparent) {
    // update line batches for the specified sub-layer
    this.batchesMap.forEach((batches, batchLayer) => {
      if (batchLayer === layer) {
        batches.onPreRender(visibleList, transparent);
      }
    });

    // only update meshes once for each layer (they're not per sub-layer at the moment)
    if (!this.updatedLayers.has(layer)) {
      this.updatedLayers.add(layer);

      // add mesh instances for specified layer to visible list
      const meshInstances = this.layerMeshInstances.get(layer);
      if (meshInstances) {
        for (let i = 0; i < meshInstances.length; i++) {
          visibleList.list[visibleList.length + i] = meshInstances[i];
        }
        visibleList.length += meshInstances.length;
        meshInstances.length = 0;
      }
    }
  }

  // called after the frame was rendered, clears data
  onPostRender() {
    // clean up line batches
    this.allBatches.clear();

    // all batches need updating next frame
    this.updatedLayers.clear();
  }
}

export { Immediate };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1tZWRpYXRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvaW1tZWRpYXRlL2ltbWVkaWF0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQUklNSVRJVkVfVFJJU1RSSVAgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQgeyBCTEVORF9OT1JNQUwgfSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgR3JhcGhOb2RlIH0gZnJvbSAnLi4vZ3JhcGgtbm9kZS5qcyc7XG5pbXBvcnQgeyBNZXNoIH0gZnJvbSAnLi4vbWVzaC5qcyc7XG5pbXBvcnQgeyBNZXNoSW5zdGFuY2UgfSBmcm9tICcuLi9tZXNoLWluc3RhbmNlLmpzJztcbmltcG9ydCB7IEJhc2ljTWF0ZXJpYWwgfSBmcm9tICcuLi9tYXRlcmlhbHMvYmFzaWMtbWF0ZXJpYWwuanMnO1xuaW1wb3J0IHsgY3JlYXRlU2hhZGVyRnJvbUNvZGUgfSBmcm9tICcuLi9zaGFkZXItbGliL3V0aWxzLmpzJztcbmltcG9ydCB7IHNoYWRlckNodW5rcyB9IGZyb20gJy4uL3NoYWRlci1saWIvY2h1bmtzL2NodW5rcy5qcyc7XG5pbXBvcnQgeyBJbW1lZGlhdGVCYXRjaGVzIH0gZnJvbSAnLi9pbW1lZGlhdGUtYmF0Y2hlcy5qcyc7XG5cbmNvbnN0IHRlbXBQb2ludHMgPSBbXTtcblxuY2xhc3MgSW1tZWRpYXRlIHtcbiAgICBjb25zdHJ1Y3RvcihkZXZpY2UpIHtcbiAgICAgICAgdGhpcy5kZXZpY2UgPSBkZXZpY2U7XG4gICAgICAgIHRoaXMucXVhZE1lc2ggPSBudWxsO1xuICAgICAgICB0aGlzLnRleHR1cmVTaGFkZXIgPSBudWxsO1xuICAgICAgICB0aGlzLmRlcHRoVGV4dHVyZVNoYWRlciA9IG51bGw7XG4gICAgICAgIHRoaXMuY3ViZUxvY2FsUG9zID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdWJlV29ybGRQb3MgPSBudWxsO1xuXG4gICAgICAgIC8vIG1hcCBvZiBMYXllciB0byBJbW1lZGlhdGVCYXRjaGVzLCBzdG9yaW5nIGxpbmUgYmF0Y2hlcyBmb3IgYSBsYXllclxuICAgICAgICB0aGlzLmJhdGNoZXNNYXAgPSBuZXcgTWFwKCk7XG5cbiAgICAgICAgLy8gc2V0IG9mIGFsbCBiYXRjaGVzIHRoYXQgd2VyZSB1c2VkIGluIHRoZSBmcmFtZVxuICAgICAgICB0aGlzLmFsbEJhdGNoZXMgPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgLy8gc2V0IG9mIGFsbCBsYXllcnMgdXBkYXRlZCBkdXJpbmcgdGhpcyBmcmFtZVxuICAgICAgICB0aGlzLnVwZGF0ZWRMYXllcnMgPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgLy8gbGluZSBtYXRlcmlhbHNcbiAgICAgICAgdGhpcy5fbWF0ZXJpYWxEZXB0aCA9IG51bGw7XG4gICAgICAgIHRoaXMuX21hdGVyaWFsTm9EZXB0aCA9IG51bGw7XG5cbiAgICAgICAgLy8gbWFwIG9mIG1lc2hlcyBpbnN0YW5jZXMgYWRkZWQgdG8gYSBsYXllci4gVGhlIGtleSBpcyBsYXllciwgdGhlIHZhbHVlIGlzIGFuIGFycmF5IG9mIG1lc2ggaW5zdGFuY2VzXG4gICAgICAgIHRoaXMubGF5ZXJNZXNoSW5zdGFuY2VzID0gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZXMgbWF0ZXJpYWwgZm9yIGxpbmUgcmVuZGVyaW5nXG4gICAgY3JlYXRlTWF0ZXJpYWwoZGVwdGhUZXN0KSB7XG4gICAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IEJhc2ljTWF0ZXJpYWwoKTtcbiAgICAgICAgbWF0ZXJpYWwudmVydGV4Q29sb3JzID0gdHJ1ZTtcbiAgICAgICAgbWF0ZXJpYWwuYmxlbmQgPSB0cnVlO1xuICAgICAgICBtYXRlcmlhbC5ibGVuZFR5cGUgPSBCTEVORF9OT1JNQUw7XG4gICAgICAgIG1hdGVyaWFsLmRlcHRoVGVzdCA9IGRlcHRoVGVzdDtcbiAgICAgICAgbWF0ZXJpYWwudXBkYXRlKCk7XG4gICAgICAgIHJldHVybiBtYXRlcmlhbDtcbiAgICB9XG5cbiAgICAvLyBtYXRlcmlhbCBmb3IgbGluZSByZW5kZXJpbmcgd2l0aCBkZXB0aCB0ZXN0aW5nIG9uXG4gICAgZ2V0IG1hdGVyaWFsRGVwdGgoKSB7XG4gICAgICAgIGlmICghdGhpcy5fbWF0ZXJpYWxEZXB0aCkge1xuICAgICAgICAgICAgdGhpcy5fbWF0ZXJpYWxEZXB0aCA9IHRoaXMuY3JlYXRlTWF0ZXJpYWwodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX21hdGVyaWFsRGVwdGg7XG4gICAgfVxuXG4gICAgLy8gbWF0ZXJpYWwgZm9yIGxpbmUgcmVuZGVyaW5nIHdpdGggZGVwdGggdGVzdGluZyBvZmZcbiAgICBnZXQgbWF0ZXJpYWxOb0RlcHRoKCkge1xuICAgICAgICBpZiAoIXRoaXMuX21hdGVyaWFsTm9EZXB0aCkge1xuICAgICAgICAgICAgdGhpcy5fbWF0ZXJpYWxOb0RlcHRoID0gdGhpcy5jcmVhdGVNYXRlcmlhbChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX21hdGVyaWFsTm9EZXB0aDtcbiAgICB9XG5cbiAgICAvLyByZXR1cm5zIGEgYmF0Y2ggZm9yIHJlbmRlcmluZyBsaW5lcyB0byBhIGxheWVyIHdpdGggcmVxdWlyZWQgZGVwdGggdGVzdGluZyBzdGF0ZVxuICAgIGdldEJhdGNoKGxheWVyLCBkZXB0aFRlc3QpIHtcblxuICAgICAgICAvLyBnZXQgYmF0Y2hlcyBmb3IgdGhlIGxheWVyXG4gICAgICAgIGxldCBiYXRjaGVzID0gdGhpcy5iYXRjaGVzTWFwLmdldChsYXllcik7XG4gICAgICAgIGlmICghYmF0Y2hlcykge1xuICAgICAgICAgICAgYmF0Y2hlcyA9IG5ldyBJbW1lZGlhdGVCYXRjaGVzKHRoaXMuZGV2aWNlKTtcbiAgICAgICAgICAgIHRoaXMuYmF0Y2hlc01hcC5zZXQobGF5ZXIsIGJhdGNoZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWRkIGl0IGZvciByZW5kZXJpbmdcbiAgICAgICAgdGhpcy5hbGxCYXRjaGVzLmFkZChiYXRjaGVzKTtcblxuICAgICAgICAvLyBnZXQgYmF0Y2ggZm9yIHRoZSBtYXRlcmlhbFxuICAgICAgICBjb25zdCBtYXRlcmlhbCA9IGRlcHRoVGVzdCA/IHRoaXMubWF0ZXJpYWxEZXB0aCA6IHRoaXMubWF0ZXJpYWxOb0RlcHRoO1xuICAgICAgICByZXR1cm4gYmF0Y2hlcy5nZXRCYXRjaChtYXRlcmlhbCwgbGF5ZXIpO1xuICAgIH1cblxuICAgIC8vIHNoYXJlZCB2ZXJ0ZXggc2hhZGVyIGZvciB0ZXh0dXJlZCBxdWFkIHJlbmRlcmluZ1xuICAgIHN0YXRpYyBnZXRUZXh0dXJlVlMoKSB7XG4gICAgICAgIHJldHVybiBgXG4gICAgICAgICAgICBhdHRyaWJ1dGUgdmVjMiB2ZXJ0ZXhfcG9zaXRpb247XG4gICAgICAgICAgICB1bmlmb3JtIG1hdDQgbWF0cml4X21vZGVsO1xuICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHV2MDtcbiAgICAgICAgICAgIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSBtYXRyaXhfbW9kZWwgKiB2ZWM0KHZlcnRleF9wb3NpdGlvbiwgMCwgMSk7XG4gICAgICAgICAgICAgICAgdXYwID0gdmVydGV4X3Bvc2l0aW9uLnh5ICsgMC41O1xuICAgICAgICAgICAgfVxuICAgICAgICBgO1xuICAgIH1cblxuICAgIC8vIHNoYWRlciB1c2VkIHRvIGRpc3BsYXkgdGV4dHVyZVxuICAgIGdldFRleHR1cmVTaGFkZXIoKSB7XG4gICAgICAgIGlmICghdGhpcy50ZXh0dXJlU2hhZGVyKSB7XG4gICAgICAgICAgICBjb25zdCBmc2hhZGVyID0gYFxuICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB1djA7XG4gICAgICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgY29sb3JNYXA7XG4gICAgICAgICAgICAgICAgdm9pZCBtYWluICh2b2lkKSB7XG4gICAgICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQodGV4dHVyZTJEKGNvbG9yTWFwLCB1djApLnh5eiwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgYDtcblxuICAgICAgICAgICAgdGhpcy50ZXh0dXJlU2hhZGVyID0gY3JlYXRlU2hhZGVyRnJvbUNvZGUodGhpcy5kZXZpY2UsIEltbWVkaWF0ZS5nZXRUZXh0dXJlVlMoKSwgZnNoYWRlciwgJ0RlYnVnVGV4dHVyZVNoYWRlcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dHVyZVNoYWRlcjtcbiAgICB9XG5cbiAgICAvLyBzaGFkZXIgdXNlZCB0byBkaXNwbGF5IGRlcHRoIHRleHR1cmVcbiAgICBnZXREZXB0aFRleHR1cmVTaGFkZXIoKSB7XG4gICAgICAgIGlmICghdGhpcy5kZXB0aFRleHR1cmVTaGFkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZzaGFkZXIgPSBgXG4gICAgICAgICAgICAgICAgJHtzaGFkZXJDaHVua3Muc2NyZWVuRGVwdGhQU31cbiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdXYwO1xuICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZGVwdGggPSBnZXRMaW5lYXJTY3JlZW5EZXB0aCh1djApICogY2FtZXJhX3BhcmFtcy54O1xuICAgICAgICAgICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KHZlYzMoZGVwdGgpLCAxLjApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGA7XG5cbiAgICAgICAgICAgIHRoaXMuZGVwdGhUZXh0dXJlU2hhZGVyID0gY3JlYXRlU2hhZGVyRnJvbUNvZGUodGhpcy5kZXZpY2UsIEltbWVkaWF0ZS5nZXRUZXh0dXJlVlMoKSwgZnNoYWRlciwgJ0RlYnVnRGVwdGhUZXh0dXJlU2hhZGVyJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5kZXB0aFRleHR1cmVTaGFkZXI7XG4gICAgfVxuXG4gICAgLy8gY3JlYXRlcyBtZXNoIHVzZWQgdG8gcmVuZGVyIGEgcXVhZFxuICAgIGdldFF1YWRNZXNoKCkge1xuICAgICAgICBpZiAoIXRoaXMucXVhZE1lc2gpIHtcbiAgICAgICAgICAgIHRoaXMucXVhZE1lc2ggPSBuZXcgTWVzaCh0aGlzLmRldmljZSk7XG4gICAgICAgICAgICB0aGlzLnF1YWRNZXNoLnNldFBvc2l0aW9ucyhbXG4gICAgICAgICAgICAgICAgLTAuNSwgLTAuNSwgMCxcbiAgICAgICAgICAgICAgICAwLjUsIC0wLjUsIDAsXG4gICAgICAgICAgICAgICAgLTAuNSwgMC41LCAwLFxuICAgICAgICAgICAgICAgIDAuNSwgMC41LCAwXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHRoaXMucXVhZE1lc2gudXBkYXRlKFBSSU1JVElWRV9UUklTVFJJUCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucXVhZE1lc2g7XG4gICAgfVxuXG4gICAgLy8gRHJhdyBtZXNoIGF0IHRoaXMgZnJhbWVcbiAgICBkcmF3TWVzaChtYXRlcmlhbCwgbWF0cml4LCBtZXNoLCBtZXNoSW5zdGFuY2UsIGxheWVyKSB7XG5cbiAgICAgICAgLy8gY3JlYXRlIGEgbWVzaCBpbnN0YW5jZSBmb3IgdGhlIG1lc2ggaWYgbmVlZGVkXG4gICAgICAgIGlmICghbWVzaEluc3RhbmNlKSB7XG4gICAgICAgICAgICBjb25zdCBncmFwaE5vZGUgPSB0aGlzLmdldEdyYXBoTm9kZShtYXRyaXgpO1xuICAgICAgICAgICAgbWVzaEluc3RhbmNlID0gbmV3IE1lc2hJbnN0YW5jZShtZXNoLCBtYXRlcmlhbCwgZ3JhcGhOb2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCB0aGUgbWVzaCBpbnN0YW5jZSB0byBhbiBhcnJheSBwZXIgbGF5ZXIsIHRoZXkgZ2V0IGFkZGVkIHRvIGxheWVycyBiZWZvcmUgcmVuZGVyaW5nXG4gICAgICAgIGxldCBsYXllck1lc2hJbnN0YW5jZXMgPSB0aGlzLmxheWVyTWVzaEluc3RhbmNlcy5nZXQobGF5ZXIpO1xuICAgICAgICBpZiAoIWxheWVyTWVzaEluc3RhbmNlcykge1xuICAgICAgICAgICAgbGF5ZXJNZXNoSW5zdGFuY2VzID0gW107XG4gICAgICAgICAgICB0aGlzLmxheWVyTWVzaEluc3RhbmNlcy5zZXQobGF5ZXIsIGxheWVyTWVzaEluc3RhbmNlcyk7XG4gICAgICAgIH1cbiAgICAgICAgbGF5ZXJNZXNoSW5zdGFuY2VzLnB1c2gobWVzaEluc3RhbmNlKTtcbiAgICB9XG5cbiAgICBkcmF3V2lyZUFsaWduZWRCb3gobWluLCBtYXgsIGNvbG9yLCBkZXB0aFRlc3QsIGxheWVyKSB7XG4gICAgICAgIHRlbXBQb2ludHMucHVzaChcbiAgICAgICAgICAgIG1pbi54LCBtaW4ueSwgbWluLnosIG1pbi54LCBtYXgueSwgbWluLnosXG4gICAgICAgICAgICBtaW4ueCwgbWF4LnksIG1pbi56LCBtYXgueCwgbWF4LnksIG1pbi56LFxuICAgICAgICAgICAgbWF4LngsIG1heC55LCBtaW4ueiwgbWF4LngsIG1pbi55LCBtaW4ueixcbiAgICAgICAgICAgIG1heC54LCBtaW4ueSwgbWluLnosIG1pbi54LCBtaW4ueSwgbWluLnosXG4gICAgICAgICAgICBtaW4ueCwgbWluLnksIG1heC56LCBtaW4ueCwgbWF4LnksIG1heC56LFxuICAgICAgICAgICAgbWluLngsIG1heC55LCBtYXgueiwgbWF4LngsIG1heC55LCBtYXgueixcbiAgICAgICAgICAgIG1heC54LCBtYXgueSwgbWF4LnosIG1heC54LCBtaW4ueSwgbWF4LnosXG4gICAgICAgICAgICBtYXgueCwgbWluLnksIG1heC56LCBtaW4ueCwgbWluLnksIG1heC56LFxuICAgICAgICAgICAgbWluLngsIG1pbi55LCBtaW4ueiwgbWluLngsIG1pbi55LCBtYXgueixcbiAgICAgICAgICAgIG1pbi54LCBtYXgueSwgbWluLnosIG1pbi54LCBtYXgueSwgbWF4LnosXG4gICAgICAgICAgICBtYXgueCwgbWF4LnksIG1pbi56LCBtYXgueCwgbWF4LnksIG1heC56LFxuICAgICAgICAgICAgbWF4LngsIG1pbi55LCBtaW4ueiwgbWF4LngsIG1pbi55LCBtYXguelxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5nZXRCYXRjaChsYXllciwgZGVwdGhUZXN0KTtcbiAgICAgICAgYmF0Y2guYWRkTGluZXNBcnJheXModGVtcFBvaW50cywgY29sb3IpO1xuICAgICAgICB0ZW1wUG9pbnRzLmxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgZHJhd1dpcmVTcGhlcmUoY2VudGVyLCByYWRpdXMsIGNvbG9yLCBudW1TZWdtZW50cywgZGVwdGhUZXN0LCBsYXllcikge1xuXG4gICAgICAgIGNvbnN0IHN0ZXAgPSAyICogTWF0aC5QSSAvIG51bVNlZ21lbnRzO1xuICAgICAgICBsZXQgYW5nbGUgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU2VnbWVudHM7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgc2luMCA9IE1hdGguc2luKGFuZ2xlKTtcbiAgICAgICAgICAgIGNvbnN0IGNvczAgPSBNYXRoLmNvcyhhbmdsZSk7XG4gICAgICAgICAgICBhbmdsZSArPSBzdGVwO1xuICAgICAgICAgICAgY29uc3Qgc2luMSA9IE1hdGguc2luKGFuZ2xlKTtcbiAgICAgICAgICAgIGNvbnN0IGNvczEgPSBNYXRoLmNvcyhhbmdsZSk7XG5cbiAgICAgICAgICAgIHRlbXBQb2ludHMucHVzaChjZW50ZXIueCArIHJhZGl1cyAqIHNpbjAsIGNlbnRlci55LCBjZW50ZXIueiArIHJhZGl1cyAqIGNvczApO1xuICAgICAgICAgICAgdGVtcFBvaW50cy5wdXNoKGNlbnRlci54ICsgcmFkaXVzICogc2luMSwgY2VudGVyLnksIGNlbnRlci56ICsgcmFkaXVzICogY29zMSk7XG4gICAgICAgICAgICB0ZW1wUG9pbnRzLnB1c2goY2VudGVyLnggKyByYWRpdXMgKiBzaW4wLCBjZW50ZXIueSArIHJhZGl1cyAqIGNvczAsIGNlbnRlci56KTtcbiAgICAgICAgICAgIHRlbXBQb2ludHMucHVzaChjZW50ZXIueCArIHJhZGl1cyAqIHNpbjEsIGNlbnRlci55ICsgcmFkaXVzICogY29zMSwgY2VudGVyLnopO1xuICAgICAgICAgICAgdGVtcFBvaW50cy5wdXNoKGNlbnRlci54LCBjZW50ZXIueSArIHJhZGl1cyAqIHNpbjAsIGNlbnRlci56ICsgcmFkaXVzICogY29zMCk7XG4gICAgICAgICAgICB0ZW1wUG9pbnRzLnB1c2goY2VudGVyLngsIGNlbnRlci55ICsgcmFkaXVzICogc2luMSwgY2VudGVyLnogKyByYWRpdXMgKiBjb3MxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5nZXRCYXRjaChsYXllciwgZGVwdGhUZXN0KTtcbiAgICAgICAgYmF0Y2guYWRkTGluZXNBcnJheXModGVtcFBvaW50cywgY29sb3IpO1xuICAgICAgICB0ZW1wUG9pbnRzLmxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgZ2V0R3JhcGhOb2RlKG1hdHJpeCkge1xuICAgICAgICBjb25zdCBncmFwaE5vZGUgPSBuZXcgR3JhcGhOb2RlKCdJbW1lZGlhdGVEZWJ1ZycpO1xuICAgICAgICBncmFwaE5vZGUud29ybGRUcmFuc2Zvcm0gPSBtYXRyaXg7XG4gICAgICAgIGdyYXBoTm9kZS5fZGlydHlXb3JsZCA9IGdyYXBoTm9kZS5fZGlydHlOb3JtYWwgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm4gZ3JhcGhOb2RlO1xuICAgIH1cblxuICAgIC8vIFRoaXMgaXMgY2FsbGVkIGp1c3QgYmVmb3JlIHRoZSBsYXllciBpcyByZW5kZXJlZCB0byBhbGxvdyBsaW5lcyBmb3IgdGhlIGxheWVyIHRvIGJlIGFkZGVkIGZyb20gaW5zaWRlXG4gICAgLy8gdGhlIGZyYW1lIGdldHRpbmcgcmVuZGVyZWRcbiAgICBvblByZVJlbmRlckxheWVyKGxheWVyLCB2aXNpYmxlTGlzdCwgdHJhbnNwYXJlbnQpIHtcblxuICAgICAgICAvLyB1cGRhdGUgbGluZSBiYXRjaGVzIGZvciB0aGUgc3BlY2lmaWVkIHN1Yi1sYXllclxuICAgICAgICB0aGlzLmJhdGNoZXNNYXAuZm9yRWFjaCgoYmF0Y2hlcywgYmF0Y2hMYXllcikgPT4ge1xuICAgICAgICAgICAgaWYgKGJhdGNoTGF5ZXIgPT09IGxheWVyKSB7XG4gICAgICAgICAgICAgICAgYmF0Y2hlcy5vblByZVJlbmRlcih2aXNpYmxlTGlzdCwgdHJhbnNwYXJlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBvbmx5IHVwZGF0ZSBtZXNoZXMgb25jZSBmb3IgZWFjaCBsYXllciAodGhleSdyZSBub3QgcGVyIHN1Yi1sYXllciBhdCB0aGUgbW9tZW50KVxuICAgICAgICBpZiAoIXRoaXMudXBkYXRlZExheWVycy5oYXMobGF5ZXIpKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZWRMYXllcnMuYWRkKGxheWVyKTtcblxuICAgICAgICAgICAgLy8gYWRkIG1lc2ggaW5zdGFuY2VzIGZvciBzcGVjaWZpZWQgbGF5ZXIgdG8gdmlzaWJsZSBsaXN0XG4gICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2VzID0gdGhpcy5sYXllck1lc2hJbnN0YW5jZXMuZ2V0KGxheWVyKTtcbiAgICAgICAgICAgIGlmIChtZXNoSW5zdGFuY2VzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXNoSW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2libGVMaXN0Lmxpc3RbdmlzaWJsZUxpc3QubGVuZ3RoICsgaV0gPSBtZXNoSW5zdGFuY2VzW2ldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2aXNpYmxlTGlzdC5sZW5ndGggKz0gbWVzaEluc3RhbmNlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgbWVzaEluc3RhbmNlcy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gY2FsbGVkIGFmdGVyIHRoZSBmcmFtZSB3YXMgcmVuZGVyZWQsIGNsZWFycyBkYXRhXG4gICAgb25Qb3N0UmVuZGVyKCkge1xuXG4gICAgICAgIC8vIGNsZWFuIHVwIGxpbmUgYmF0Y2hlc1xuICAgICAgICB0aGlzLmFsbEJhdGNoZXMuY2xlYXIoKTtcblxuICAgICAgICAvLyBhbGwgYmF0Y2hlcyBuZWVkIHVwZGF0aW5nIG5leHQgZnJhbWVcbiAgICAgICAgdGhpcy51cGRhdGVkTGF5ZXJzLmNsZWFyKCk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBJbW1lZGlhdGUgfTtcbiJdLCJuYW1lcyI6WyJ0ZW1wUG9pbnRzIiwiSW1tZWRpYXRlIiwiY29uc3RydWN0b3IiLCJkZXZpY2UiLCJxdWFkTWVzaCIsInRleHR1cmVTaGFkZXIiLCJkZXB0aFRleHR1cmVTaGFkZXIiLCJjdWJlTG9jYWxQb3MiLCJjdWJlV29ybGRQb3MiLCJiYXRjaGVzTWFwIiwiTWFwIiwiYWxsQmF0Y2hlcyIsIlNldCIsInVwZGF0ZWRMYXllcnMiLCJfbWF0ZXJpYWxEZXB0aCIsIl9tYXRlcmlhbE5vRGVwdGgiLCJsYXllck1lc2hJbnN0YW5jZXMiLCJjcmVhdGVNYXRlcmlhbCIsImRlcHRoVGVzdCIsIm1hdGVyaWFsIiwiQmFzaWNNYXRlcmlhbCIsInZlcnRleENvbG9ycyIsImJsZW5kIiwiYmxlbmRUeXBlIiwiQkxFTkRfTk9STUFMIiwidXBkYXRlIiwibWF0ZXJpYWxEZXB0aCIsIm1hdGVyaWFsTm9EZXB0aCIsImdldEJhdGNoIiwibGF5ZXIiLCJiYXRjaGVzIiwiZ2V0IiwiSW1tZWRpYXRlQmF0Y2hlcyIsInNldCIsImFkZCIsImdldFRleHR1cmVWUyIsImdldFRleHR1cmVTaGFkZXIiLCJmc2hhZGVyIiwiY3JlYXRlU2hhZGVyRnJvbUNvZGUiLCJnZXREZXB0aFRleHR1cmVTaGFkZXIiLCJzaGFkZXJDaHVua3MiLCJzY3JlZW5EZXB0aFBTIiwiZ2V0UXVhZE1lc2giLCJNZXNoIiwic2V0UG9zaXRpb25zIiwiUFJJTUlUSVZFX1RSSVNUUklQIiwiZHJhd01lc2giLCJtYXRyaXgiLCJtZXNoIiwibWVzaEluc3RhbmNlIiwiZ3JhcGhOb2RlIiwiZ2V0R3JhcGhOb2RlIiwiTWVzaEluc3RhbmNlIiwicHVzaCIsImRyYXdXaXJlQWxpZ25lZEJveCIsIm1pbiIsIm1heCIsImNvbG9yIiwieCIsInkiLCJ6IiwiYmF0Y2giLCJhZGRMaW5lc0FycmF5cyIsImxlbmd0aCIsImRyYXdXaXJlU3BoZXJlIiwiY2VudGVyIiwicmFkaXVzIiwibnVtU2VnbWVudHMiLCJzdGVwIiwiTWF0aCIsIlBJIiwiYW5nbGUiLCJpIiwic2luMCIsInNpbiIsImNvczAiLCJjb3MiLCJzaW4xIiwiY29zMSIsIkdyYXBoTm9kZSIsIndvcmxkVHJhbnNmb3JtIiwiX2RpcnR5V29ybGQiLCJfZGlydHlOb3JtYWwiLCJvblByZVJlbmRlckxheWVyIiwidmlzaWJsZUxpc3QiLCJ0cmFuc3BhcmVudCIsImZvckVhY2giLCJiYXRjaExheWVyIiwib25QcmVSZW5kZXIiLCJoYXMiLCJtZXNoSW5zdGFuY2VzIiwibGlzdCIsIm9uUG9zdFJlbmRlciIsImNsZWFyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFXQSxNQUFNQSxVQUFVLEdBQUcsRUFBRSxDQUFBO0FBRXJCLE1BQU1DLFNBQVMsQ0FBQztFQUNaQyxXQUFXLENBQUNDLE1BQU0sRUFBRTtJQUNoQixJQUFJLENBQUNBLE1BQU0sR0FBR0EsTUFBTSxDQUFBO0lBQ3BCLElBQUksQ0FBQ0MsUUFBUSxHQUFHLElBQUksQ0FBQTtJQUNwQixJQUFJLENBQUNDLGFBQWEsR0FBRyxJQUFJLENBQUE7SUFDekIsSUFBSSxDQUFDQyxrQkFBa0IsR0FBRyxJQUFJLENBQUE7SUFDOUIsSUFBSSxDQUFDQyxZQUFZLEdBQUcsSUFBSSxDQUFBO0lBQ3hCLElBQUksQ0FBQ0MsWUFBWSxHQUFH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QUFFSixHQUFHLENBQUNLLENBQUMsRUFDeENMLEdBQUcsQ0FBQ0csQ0FBQyxFQUFFRixHQUFHLENBQUNHLENBQUMsRUFBRUosR0FBRyxDQUFDSyxDQUFDLEVBQUVKLEdBQUcsQ0FBQ0UsQ0FBQyxFQUFFRixHQUFHLENBQUNHLENBQUMsRUFBRUosR0FBRyxDQUFDSyxDQUFDLEVBQ3hDSixHQUFHLENBQUNFLENBQUMsRUFBRUYsR0FBRyxDQUFDRyxDQUFDLEVBQUVKLEdBQUcsQ0FBQ0ssQ0FBQyxFQUFFSixHQUFHLENBQUNFLENBQUMsRUFBRUgsR0FBRyxDQUFDSSxDQUFDLEVBQUVKLEdBQUcsQ0FBQ0ssQ0FBQyxFQUN4Q0osR0FBRyxDQUFDRSxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksQ0FBQyxFQUFFSixHQUFHLENBQUNLLENBQUMsRUFBRUwsR0FBRyxDQUFDRyxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksQ0FBQyxFQUFFSixHQUFHLENBQUNLLENBQUMsRUFDeENMLEdBQUcsQ0FBQ0csQ0FBQyxFQUFFSCxHQUFHLENBQUNJLENBQUMsRUFBRUgsR0FBRyxDQUFDSSxDQUFDLEVBQUVMLEdBQUcsQ0FBQ0csQ0FBQyxFQUFFRixHQUFHLENBQUNHLENBQUMsRUFBRUgsR0FBRyxDQUFDSSxDQUFDLEVBQ3hDTCxHQUFHLENBQUNHLENBQUMsRUFBRUYsR0FBRyxDQUFDRyxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksQ0FBQyxFQUFFSixHQUFHLENBQUNFLENBQUMsRUFBRUYsR0FBRyxDQUFDRyxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksQ0FBQyxFQUN4Q0osR0FBRyxDQUFDRSxDQUFDLEVBQUVGLEdBQUcsQ0FBQ0csQ0FBQyxFQUFFSCxHQUFHLENBQUNJLENBQUMsRUFBRUosR0FBRyxDQUFDRSxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksQ0FBQyxFQUFFSCxHQUFHLENBQUNJLENBQUMsRUFDeENKLEdBQUcsQ0FBQ0UsQ0FBQyxFQUFFSCxHQUFHLENBQUNJLENBQUMsRUFBRUgsR0FBRyxDQUFDSSxDQUFDLEVBQUVMLEdBQUcsQ0FB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
