/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, BLENDMODE_ONE, BLENDEQUATION_ADD } from '../graphics/constants.js';
import { createShaderFromCode } from '../graphics/program-lib/utils.js';
import { drawQuadWithShader } from '../graphics/simple-post-effect.js';
import { RenderTarget } from '../graphics/render-target.js';
import { DebugGraphics } from '../graphics/debug-graphics.js';
import { Debug } from '../core/debug.js';
import { Morph } from './morph.js';

const textureMorphVertexShader = `
    attribute vec2 vertex_position;
    varying vec2 uv0;
    void main(void) {
        gl_Position = vec4(vertex_position, 0.5, 1.0);
        uv0 = vertex_position.xy * 0.5 + 0.5;
    }
    `;

class MorphInstance {
  constructor(morph) {
    this.morph = morph;
    morph.incRefCount();
    this.device = morph.device;
    this._weights = [];
    this._weightMap = new Map();

    for (let v = 0; v < morph._targets.length; v++) {
      const target = morph._targets[v];

      if (target.name) {
        this._weightMap.set(target.name, v);
      }

      this.setWeight(v, target.defaultWeight);
    }

    this._activeTargets = [];

    if (morph.useTextureMorph) {
      this.shaderCache = {};
      this.maxSubmitCount = this.device.maxTextures;
      this._shaderMorphWeights = new Float32Array(this.maxSubmitCount);

      const createRT = (name, textureVar) => {
        const format = morph._renderTextureFormat === Morph.FORMAT_FLOAT ? PIXELFORMAT_RGBA32F : PIXELFORMAT_RGBA16F;
        this[textureVar] = morph._createTexture(name, format);
        return new RenderTarget({
          colorBuffer: this[textureVar],
          depth: false
        });
      };

      if (morph.morphPositions) {
        this.rtPositions = createRT('MorphRTPos', 'texturePositions');
      }

      if (morph.morphNormals) {
        this.rtNormals = createRT('MorphRTNrm', 'textureNormals');
      }

      this._textureParams = new Float32Array([morph.morphTextureWidth, morph.morphTextureHeight, 1 / morph.morphTextureWidth, 1 / morph.morphTextureHeight]);

      for (let i = 0; i < this.maxSubmitCount; i++) {
        this['morphBlendTex' + i] = this.device.scope.resolve('morphBlendTex' + i);
      }

      this.morphFactor = this.device.scope.resolve('morphFactor[0]');
      this.zeroTextures = false;
    } else {
      this.maxSubmitCount = 8;
      this._shaderMorphWeights = new Float32Array(this.maxSubmitCount);
      this._shaderMorphWeightsA = new Float32Array(this._shaderMorphWeights.buffer, 0, 4);
      this._shaderMorphWeightsB = new Float32Array(this._shaderMorphWeights.buffer, 4 * 4, 4);
      this._activeVertexBuffers = new Array(this.maxSubmitCount);
    }
  }

  destroy() {
    this.shader = null;
    const morph = this.morph;

    if (morph) {
      this.morph = null;
      morph.decRefCount();

      if (morph.refCount < 1) {
        morph.destroy();
      }
    }

    if (this.rtPositions) {
      this.rtPositions.destroy();
      this.rtPositions = null;
    }

    if (this.texturePositions) {
      this.texturePositions.destroy();
      this.texturePositions = null;
    }

    if (this.rtNormals) {
      this.rtNormals.destroy();
      this.rtNormals = null;
    }

    if (this.textureNormals) {
      this.textureNormals.destroy();
      this.textureNormals = null;
    }
  }

  clone() {
    return new MorphInstance(this.morph);
  }

  _getWeightIndex(key) {
    if (typeof key === 'string') {
      const index = this._weightMap.get(key);

      if (index === undefined) {
        Debug.error(`Cannot find morph target with name: ${key}.`);
      }

      return index;
    }

    return key;
  }

  getWeight(key) {
    const index = this._getWeightIndex(key);

    return this._weights[index];
  }

  setWeight(key, weight) {
    const index = this._getWeightIndex(key);

    Debug.assert(index >= 0 && index < this.morph._targets.length);
    this._weights[index] = weight;
    this._dirty = true;
  }

  _getFragmentShader(numTextures) {
    let fragmentShader = '';

    if (numTextures > 0) {
      fragmentShader += 'varying vec2 uv0;\n' + 'uniform highp float morphFactor[' + numTextures + '];\n';
    }

    for (let i = 0; i < numTextures; i++) {
      fragmentShader += 'uniform highp sampler2D morphBlendTex' + i + ';\n';
    }

    fragmentShader += 'void main (void) {\n' + '    highp vec4 color = vec4(0, 0, 0, 1);\n';

    for (let i = 0; i < numTextures; i++) {
      fragmentShader += '    color.xyz += morphFactor[' + i + '] * texture2D(morphBlendTex' + i + ', uv0).xyz;\n';
    }

    fragmentShader += '    gl_FragColor = color;\n' + '}\n';
    return fragmentShader;
  }

  _getShader(count) {
    let shader = this.shaderCache[count];

    if (!shader) {
      const fs = this._getFragmentShader(count);

      shader = createShaderFromCode(this.device, textureMorphVertexShader, fs, 'textureMorph' + count);
      this.shaderCache[count] = shader;
    }

    return shader;
  }

  _updateTextureRenderTarget(renderTarget, srcTextureName) {
    const device = this.device;

    const submitBatch = (usedCount, blending) => {
      this.morphFactor.setValue(this._shaderMorphWeights);
      device.setBlending(blending);

      if (blending) {
        device.setBlendFunction(BLENDMODE_ONE, BLENDMODE_ONE);
        device.setBlendEquation(BLENDEQUATION_ADD);
      }

      const shader = this._getShader(usedCount);

      drawQuadWithShader(device, renderTarget, shader, undefined, undefined, blending);
    };

    let usedCount = 0;
    let blending = false;
    const count = this._activeTargets.length;

    for (let i = 0; i < count; i++) {
      const activeTarget = this._activeTargets[i];
      const tex = activeTarget.target[srcTextureName];

      if (tex) {
        this['morphBlendTex' + usedCount].setValue(tex);
        this._shaderMorphWeights[usedCount] = activeTarget.weight;
        usedCount++;

        if (usedCount >= this.maxSubmitCount) {
          submitBatch(usedCount, blending);
          usedCount = 0;
          blending = true;
        }
      }
    }

    if (usedCount > 0 || count === 0 && !this.zeroTextures) {
      submitBatch(usedCount, blending);
    }
  }

  _updateTextureMorph() {
    const device = this.device;
    DebugGraphics.pushGpuMarker(device, 'MorphUpdate');

    if (this._activeTargets.length > 0 || !this.zeroTextures) {
      this._updateTextureRenderTarget(this.rtPositions, 'texturePositions');

      this._updateTextureRenderTarget(this.rtNormals, 'textureNormals');

      this.zeroTextures = this._activeTargets.length === 0;
    }

    DebugGraphics.popGpuMarker(device);
  }

  _updateVertexMorph() {
    const count = this.maxSubmitCount;

    for (let i = 0; i < count; i++) {
      this._shaderMorphWeights[i] = 0;
      this._activeVertexBuffers[i] = null;
    }

    let posIndex = 0;
    let nrmIndex = this.morph.morphPositions ? 4 : 0;

    for (let i = 0; i < this._activeTargets.length; i++) {
      const target = this._activeTargets[i].target;

      if (target._vertexBufferPositions) {
        this._activeVertexBuffers[posIndex] = target._vertexBufferPositions;
        this._shaderMorphWeights[posIndex] = this._activeTargets[i].weight;
        posIndex++;
      }

      if (target._vertexBufferNormals) {
        this._activeVertexBuffers[nrmIndex] = target._vertexBufferNormals;
        this._shaderMorphWeights[nrmIndex] = this._activeTargets[i].weight;
        nrmIndex++;
      }
    }
  }

  update() {
    this._dirty = false;
    const targets = this.morph._targets;
    let activeCount = 0;
    const epsilon = 0.00001;

    for (let i = 0; i < targets.length; i++) {
      const absWeight = Math.abs(this.getWeight(i));

      if (absWeight > epsilon) {
        if (this._activeTargets.length <= activeCount) {
          this._activeTargets[activeCount] = {};
        }

        const activeTarget = this._activeTargets[activeCount++];
        activeTarget.absWeight = absWeight;
        activeTarget.weight = this.getWeight(i);
        activeTarget.target = targets[i];
      }
    }

    this._activeTargets.length = activeCount;
    const maxActiveTargets = this.morph.maxActiveTargets;

    if (this._activeTargets.length > maxActiveTargets) {
      this._activeTargets.sort(function (l, r) {
        return l.absWeight < r.absWeight ? 1 : r.absWeight < l.absWeight ? -1 : 0;
      });

      this._activeTargets.length = maxActiveTargets;
    }

    if (this.morph.useTextureMorph) {
      this._updateTextureMorph();
    } else {
      this._updateVertexMorph();
    }
  }

}

export { MorphInstance };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ycGgtaW5zdGFuY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zY2VuZS9tb3JwaC1pbnN0YW5jZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCTEVOREVRVUFUSU9OX0FERCwgQkxFTkRNT0RFX09ORSwgUElYRUxGT1JNQVRfUkdCQTMyRiwgUElYRUxGT1JNQVRfUkdCQTE2RiB9IGZyb20gJy4uL2dyYXBoaWNzL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBjcmVhdGVTaGFkZXJGcm9tQ29kZSB9IGZyb20gJy4uL2dyYXBoaWNzL3Byb2dyYW0tbGliL3V0aWxzLmpzJztcbmltcG9ydCB7IGRyYXdRdWFkV2l0aFNoYWRlciB9IGZyb20gJy4uL2dyYXBoaWNzL3NpbXBsZS1wb3N0LWVmZmVjdC5qcyc7XG5pbXBvcnQgeyBSZW5kZXJUYXJnZXQgfSBmcm9tICcuLi9ncmFwaGljcy9yZW5kZXItdGFyZ2V0LmpzJztcbmltcG9ydCB7IERlYnVnR3JhcGhpY3MgfSBmcm9tICcuLi9ncmFwaGljcy9kZWJ1Zy1ncmFwaGljcy5qcyc7XG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuXG5pbXBvcnQgeyBNb3JwaCB9IGZyb20gJy4vbW9ycGguanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vZ3JhcGhpY3Mvc2hhZGVyLmpzJykuU2hhZGVyfSBTaGFkZXIgKi9cblxuLy8gdmVydGV4IHNoYWRlciB1c2VkIHRvIGFkZCBtb3JwaCB0YXJnZXRzIGZyb20gdGV4dHVyZXMgaW50byByZW5kZXIgdGFyZ2V0XG5jb25zdCB0ZXh0dXJlTW9ycGhWZXJ0ZXhTaGFkZXIgPSBgXG4gICAgYXR0cmlidXRlIHZlYzIgdmVydGV4X3Bvc2l0aW9uO1xuICAgIHZhcnlpbmcgdmVjMiB1djA7XG4gICAgdm9pZCBtYWluKHZvaWQpIHtcbiAgICAgICAgZ2xfUG9zaXRpb24gPSB2ZWM0KHZlcnRleF9wb3NpdGlvbiwgMC41LCAxLjApO1xuICAgICAgICB1djAgPSB2ZXJ0ZXhfcG9zaXRpb24ueHkgKiAwLjUgKyAwLjU7XG4gICAgfVxuICAgIGA7XG5cbi8qKlxuICogQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIE1vcnBofS4gQ29udGFpbnMgd2VpZ2h0cyB0byBhc3NpZ24gdG8gZXZlcnkge0BsaW5rIE1vcnBoVGFyZ2V0fSwgbWFuYWdlc1xuICogc2VsZWN0aW9uIG9mIGFjdGl2ZSBtb3JwaCB0YXJnZXRzLlxuICovXG5jbGFzcyBNb3JwaEluc3RhbmNlIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgTW9ycGhJbnN0YW5jZSBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TW9ycGh9IG1vcnBoIC0gVGhlIHtAbGluayBNb3JwaH0gdG8gaW5zdGFuY2UuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobW9ycGgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtb3JwaCB3aXRoIGl0cyB0YXJnZXRzLCB3aGljaCBpcyBiZWluZyBpbnN0YW5jZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtNb3JwaH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubW9ycGggPSBtb3JwaDtcbiAgICAgICAgbW9ycGguaW5jUmVmQ291bnQoKTtcbiAgICAgICAgdGhpcy5kZXZpY2UgPSBtb3JwaC5kZXZpY2U7XG5cbiAgICAgICAgLy8gd2VpZ2h0c1xuICAgICAgICB0aGlzLl93ZWlnaHRzID0gW107XG4gICAgICAgIHRoaXMuX3dlaWdodE1hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgZm9yIChsZXQgdiA9IDA7IHYgPCBtb3JwaC5fdGFyZ2V0cy5sZW5ndGg7IHYrKykge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gbW9ycGguX3RhcmdldHNbdl07XG4gICAgICAgICAgICBpZiAodGFyZ2V0Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl93ZWlnaHRNYXAuc2V0KHRhcmdldC5uYW1lLCB2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0V2VpZ2h0KHYsIHRhcmdldC5kZWZhdWx0V2VpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRlbXBvcmFyeSBhcnJheSBvZiB0YXJnZXRzIHdpdGggbm9uLXplcm8gd2VpZ2h0XG4gICAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldHMgPSBbXTtcblxuICAgICAgICBpZiAobW9ycGgudXNlVGV4dHVyZU1vcnBoKSB7XG5cbiAgICAgICAgICAgIC8vIHNoYWRlciBjYWNoZVxuICAgICAgICAgICAgdGhpcy5zaGFkZXJDYWNoZSA9IHt9O1xuXG4gICAgICAgICAgICAvLyBtYXggbnVtYmVyIG9mIG1vcnBoIHRhcmdldHMgcmVuZGVyZWQgYXQgYSB0aW1lIChlYWNoIHVzZXMgc2luZ2xlIHRleHR1cmUgc2xvdClcbiAgICAgICAgICAgIHRoaXMubWF4U3VibWl0Q291bnQgPSB0aGlzLmRldmljZS5tYXhUZXh0dXJlcztcblxuICAgICAgICAgICAgLy8gYXJyYXkgZm9yIG1heCBudW1iZXIgb2Ygd2VpZ2h0c1xuICAgICAgICAgICAgdGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLm1heFN1Ym1pdENvdW50KTtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIHJlbmRlciB0YXJnZXRzIHRvIG1vcnBoIHRhcmdldHMgaW50b1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlUlQgPSAobmFtZSwgdGV4dHVyZVZhcikgPT4ge1xuXG4gICAgICAgICAgICAgICAgLy8gcmVuZGVyIHRvIGFwcHJvcHJpYXRlLCBSR0JBIGZvcm1hdHMsIHdlIGNhbm5vdCByZW5kZXIgdG8gUkdCIGZsb2F0IC8gaGFsZiBmbG9hdCBmb3JtYXQgaW4gV0ViR0xcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXQgPSBtb3JwaC5fcmVuZGVyVGV4dHVyZUZvcm1hdCA9PT0gTW9ycGguRk9STUFUX0ZMT0FUID8gUElYRUxGT1JNQVRfUkdCQTMyRiA6IFBJWEVMRk9STUFUX1JHQkExNkY7XG4gICAgICAgICAgICAgICAgdGhpc1t0ZXh0dXJlVmFyXSA9IG1vcnBoLl9jcmVhdGVUZXh0dXJlKG5hbWUsIGZvcm1hdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgICAgICAgICBjb2xvckJ1ZmZlcjogdGhpc1t0ZXh0dXJlVmFyXSxcbiAgICAgICAgICAgICAgICAgICAgZGVwdGg6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobW9ycGgubW9ycGhQb3NpdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJ0UG9zaXRpb25zID0gY3JlYXRlUlQoJ01vcnBoUlRQb3MnLCAndGV4dHVyZVBvc2l0aW9ucycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9ycGgubW9ycGhOb3JtYWxzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ydE5vcm1hbHMgPSBjcmVhdGVSVCgnTW9ycGhSVE5ybScsICd0ZXh0dXJlTm9ybWFscycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB0ZXh0dXJlIHBhcmFtc1xuICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVBhcmFtcyA9IG5ldyBGbG9hdDMyQXJyYXkoW21vcnBoLm1vcnBoVGV4dHVyZVdpZHRoLCBtb3JwaC5tb3JwaFRleHR1cmVIZWlnaHQsXG4gICAgICAgICAgICAgICAgMSAvIG1vcnBoLm1vcnBoVGV4dHVyZVdpZHRoLCAxIC8gbW9ycGgubW9ycGhUZXh0dXJlSGVpZ2h0XSk7XG5cbiAgICAgICAgICAgIC8vIHJlc29sdmUgcG9zc2libGUgdGV4dHVyZSBuYW1lc1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1heFN1Ym1pdENvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzWydtb3JwaEJsZW5kVGV4JyArIGldID0gdGhpcy5kZXZpY2Uuc2NvcGUucmVzb2x2ZSgnbW9ycGhCbGVuZFRleCcgKyBpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5tb3JwaEZhY3RvciA9IHRoaXMuZGV2aWNlLnNjb3BlLnJlc29sdmUoJ21vcnBoRmFjdG9yWzBdJyk7XG5cbiAgICAgICAgICAgIC8vIHRydWUgaW5kaWNhdGVzIHJlbmRlciB0YXJnZXQgdGV4dHVyZXMgYXJlIGZ1bGwgb2YgemVyb3MgdG8gYXZvaWQgcmVuZGVyaW5nIHRvIHRoZW0gd2hlbiBhbGwgd2VpZ2h0cyBhcmUgemVyb1xuICAgICAgICAgICAgdGhpcy56ZXJvVGV4dHVyZXMgPSBmYWxzZTtcblxuICAgICAgICB9IGVsc2UgeyAgICAvLyB2ZXJ0ZXggYXR0cmlidXRlIGJhc2VkIG1vcnBoaW5nXG5cbiAgICAgICAgICAgIC8vIG1heCBudW1iZXIgb2YgbW9ycGggdGFyZ2V0cyByZW5kZXJlZCBhdCBhIHRpbWVcbiAgICAgICAgICAgIHRoaXMubWF4U3VibWl0Q291bnQgPSA4O1xuXG4gICAgICAgICAgICAvLyB3ZWlnaHRzIG9mIGFjdGl2ZSB2ZXJ0ZXggYnVmZmVycyBpbiBmb3JtYXQgdXNlZCBieSByZW5kZXJpbmdcbiAgICAgICAgICAgIHRoaXMuX3NoYWRlck1vcnBoV2VpZ2h0cyA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5tYXhTdWJtaXRDb3VudCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hvbGUgYXJyYXlcbiAgICAgICAgICAgIHRoaXMuX3NoYWRlck1vcnBoV2VpZ2h0c0EgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuX3NoYWRlck1vcnBoV2VpZ2h0cy5idWZmZXIsIDAsIDQpOyAgICAgICAgLy8gZmlyc3QgNCBlbGVtZW50c1xuICAgICAgICAgICAgdGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzQiA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzLmJ1ZmZlciwgNCAqIDQsIDQpOyAgICAvLyBzZWNvbmQgNCBlbGVtZW50c1xuXG4gICAgICAgICAgICAvLyBwcmUtYWxsb2NhdGUgYXJyYXkgb2YgYWN0aXZlIHZlcnRleCBidWZmZXJzIHVzZWQgYnkgcmVuZGVyaW5nXG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVWZXJ0ZXhCdWZmZXJzID0gbmV3IEFycmF5KHRoaXMubWF4U3VibWl0Q291bnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnJlZXMgdmlkZW8gbWVtb3J5IGFsbG9jYXRlZCBieSB0aGlzIG9iamVjdC5cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuXG4gICAgICAgIC8vIGRvbid0IGRlc3Ryb3kgc2hhZGVyIGFzIGl0J3MgaW4gdGhlIGNhY2hlIGFuZCBjYW4gYmUgdXNlZCBieSBvdGhlciBtYXRlcmlhbHNcbiAgICAgICAgdGhpcy5zaGFkZXIgPSBudWxsO1xuXG4gICAgICAgIGNvbnN0IG1vcnBoID0gdGhpcy5tb3JwaDtcbiAgICAgICAgaWYgKG1vcnBoKSB7XG5cbiAgICAgICAgICAgIC8vIGRlY3JlYXNlIHJlZiBjb3VudFxuICAgICAgICAgICAgdGhpcy5tb3JwaCA9IG51bGw7XG4gICAgICAgICAgICBtb3JwaC5kZWNSZWZDb3VudCgpO1xuXG4gICAgICAgICAgICAvLyBkZXN0cm95IG1vcnBoXG4gICAgICAgICAgICBpZiAobW9ycGgucmVmQ291bnQgPCAxKSB7XG4gICAgICAgICAgICAgICAgbW9ycGguZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucnRQb3NpdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMucnRQb3NpdGlvbnMuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5ydFBvc2l0aW9ucyA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy50ZXh0dXJlUG9zaXRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLnRleHR1cmVQb3NpdGlvbnMuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy50ZXh0dXJlUG9zaXRpb25zID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnJ0Tm9ybWFscykge1xuICAgICAgICAgICAgdGhpcy5ydE5vcm1hbHMuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5ydE5vcm1hbHMgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudGV4dHVyZU5vcm1hbHMpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dHVyZU5vcm1hbHMuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy50ZXh0dXJlTm9ybWFscyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbG9uZXMgYSBNb3JwaEluc3RhbmNlLiBUaGUgcmV0dXJuZWQgY2xvbmUgdXNlcyB0aGUgc2FtZSB7QGxpbmsgTW9ycGh9IGFuZCB3ZWlnaHRzIGFyZSBzZXRcbiAgICAgKiB0byBkZWZhdWx0cy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtNb3JwaEluc3RhbmNlfSBBIGNsb25lIG9mIHRoZSBzcGVjaWZpZWQgTW9ycGhJbnN0YW5jZS5cbiAgICAgKi9cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNb3JwaEluc3RhbmNlKHRoaXMubW9ycGgpO1xuICAgIH1cblxuICAgIF9nZXRXZWlnaHRJbmRleChrZXkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3dlaWdodE1hcC5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgRGVidWcuZXJyb3IoYENhbm5vdCBmaW5kIG1vcnBoIHRhcmdldCB3aXRoIG5hbWU6ICR7a2V5fS5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ga2V5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgY3VycmVudCB3ZWlnaHQgb2YgdGhlIHNwZWNpZmllZCBtb3JwaCB0YXJnZXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IGtleSAtIEFuIGlkZW50aWZpZXIgZm9yIHRoZSBtb3JwaCB0YXJnZXQuIEVpdGhlciB0aGUgd2VpZ2h0IGluZGV4IG9yIHRoZSB3ZWlnaHQgbmFtZVxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFdlaWdodC5cbiAgICAgKi9cbiAgICBnZXRXZWlnaHQoa2V5KSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fZ2V0V2VpZ2h0SW5kZXgoa2V5KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dlaWdodHNbaW5kZXhdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgd2VpZ2h0IG9mIHRoZSBzcGVjaWZpZWQgbW9ycGggdGFyZ2V0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBrZXkgLSBBbiBpZGVudGlmaWVyIGZvciB0aGUgbW9ycGggdGFyZ2V0LiBFaXRoZXIgdGhlIHdlaWdodCBpbmRleCBvciB0aGUgd2VpZ2h0IG5hbWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2VpZ2h0IC0gV2VpZ2h0LlxuICAgICAqL1xuICAgIHNldFdlaWdodChrZXksIHdlaWdodCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2dldFdlaWdodEluZGV4KGtleSk7XG4gICAgICAgIERlYnVnLmFzc2VydChpbmRleCA+PSAwICYmIGluZGV4IDwgdGhpcy5tb3JwaC5fdGFyZ2V0cy5sZW5ndGgpO1xuICAgICAgICB0aGlzLl93ZWlnaHRzW2luZGV4XSA9IHdlaWdodDtcbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlIGZyYWdtZW50IHNoYWRlciB0byBibGVuZCBhIG51bWJlciBvZiB0ZXh0dXJlcyB1c2luZyBzcGVjaWZpZWQgd2VpZ2h0cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1UZXh0dXJlcyAtIE51bWJlciBvZiB0ZXh0dXJlcyB0byBibGVuZC5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBGcmFnbWVudCBzaGFkZXIuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0RnJhZ21lbnRTaGFkZXIobnVtVGV4dHVyZXMpIHtcblxuICAgICAgICBsZXQgZnJhZ21lbnRTaGFkZXIgPSAnJztcblxuICAgICAgICBpZiAobnVtVGV4dHVyZXMgPiAwKSB7XG4gICAgICAgICAgICBmcmFnbWVudFNoYWRlciArPSAndmFyeWluZyB2ZWMyIHV2MDtcXG4nICtcbiAgICAgICAgICAgICAgICAndW5pZm9ybSBoaWdocCBmbG9hdCBtb3JwaEZhY3RvclsnICsgbnVtVGV4dHVyZXMgKyAnXTtcXG4nO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1UZXh0dXJlczsgaSsrKSB7XG4gICAgICAgICAgICBmcmFnbWVudFNoYWRlciArPSAndW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgbW9ycGhCbGVuZFRleCcgKyBpICsgJztcXG4nO1xuICAgICAgICB9XG5cbiAgICAgICAgZnJhZ21lbnRTaGFkZXIgKz0gJ3ZvaWQgbWFpbiAodm9pZCkge1xcbicgK1xuICAgICAgICAgICAgJyAgICBoaWdocCB2ZWM0IGNvbG9yID0gdmVjNCgwLCAwLCAwLCAxKTtcXG4nO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVGV4dHVyZXM7IGkrKykge1xuICAgICAgICAgICAgZnJhZ21lbnRTaGFkZXIgKz0gJyAgICBjb2xvci54eXogKz0gbW9ycGhGYWN0b3JbJyArIGkgKyAnXSAqIHRleHR1cmUyRChtb3JwaEJsZW5kVGV4JyArIGkgKyAnLCB1djApLnh5ejtcXG4nO1xuICAgICAgICB9XG5cbiAgICAgICAgZnJhZ21lbnRTaGFkZXIgKz0gJyAgICBnbF9GcmFnQ29sb3IgPSBjb2xvcjtcXG4nICtcbiAgICAgICAgICAgICd9XFxuJztcblxuICAgICAgICByZXR1cm4gZnJhZ21lbnRTaGFkZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGNvbXBsZXRlIHNoYWRlciBmb3IgdGV4dHVyZSBiYXNlZCBtb3JwaGluZy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIE51bWJlciBvZiB0ZXh0dXJlcyB0byBibGVuZC5cbiAgICAgKiBAcmV0dXJucyB7U2hhZGVyfSBTaGFkZXIuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0U2hhZGVyKGNvdW50KSB7XG5cbiAgICAgICAgbGV0IHNoYWRlciA9IHRoaXMuc2hhZGVyQ2FjaGVbY291bnRdO1xuXG4gICAgICAgIC8vIGlmIHNoYWRlciBpcyBub3QgaW4gY2FjaGUsIGdlbmVyYXRlIG9uZVxuICAgICAgICBpZiAoIXNoYWRlcikge1xuICAgICAgICAgICAgY29uc3QgZnMgPSB0aGlzLl9nZXRGcmFnbWVudFNoYWRlcihjb3VudCk7XG4gICAgICAgICAgICBzaGFkZXIgPSBjcmVhdGVTaGFkZXJGcm9tQ29kZSh0aGlzLmRldmljZSwgdGV4dHVyZU1vcnBoVmVydGV4U2hhZGVyLCBmcywgJ3RleHR1cmVNb3JwaCcgKyBjb3VudCk7XG4gICAgICAgICAgICB0aGlzLnNoYWRlckNhY2hlW2NvdW50XSA9IHNoYWRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzaGFkZXI7XG4gICAgfVxuXG4gICAgX3VwZGF0ZVRleHR1cmVSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0LCBzcmNUZXh0dXJlTmFtZSkge1xuXG4gICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXMuZGV2aWNlO1xuXG4gICAgICAgIC8vIGJsZW5kIGN1cnJlbnRseSBzZXQgdXAgdGV4dHVyZXMgdG8gcmVuZGVyIHRhcmdldFxuICAgICAgICBjb25zdCBzdWJtaXRCYXRjaCA9ICh1c2VkQ291bnQsIGJsZW5kaW5nKSA9PiB7XG5cbiAgICAgICAgICAgIC8vIGZhY3RvcnNcbiAgICAgICAgICAgIHRoaXMubW9ycGhGYWN0b3Iuc2V0VmFsdWUodGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzKTtcblxuICAgICAgICAgICAgLy8gYWxwaGEgYmxlbmRpbmcgLSBmaXJzdCBwYXNzIGdldHMgbm9uZSwgZm9sbG93aW5nIHBhc3NlcyBhcmUgYWRkaXRpdmVcbiAgICAgICAgICAgIGRldmljZS5zZXRCbGVuZGluZyhibGVuZGluZyk7XG4gICAgICAgICAgICBpZiAoYmxlbmRpbmcpIHtcbiAgICAgICAgICAgICAgICBkZXZpY2Uuc2V0QmxlbmRGdW5jdGlvbihCTEVORE1PREVfT05FLCBCTEVORE1PREVfT05FKTtcbiAgICAgICAgICAgICAgICBkZXZpY2Uuc2V0QmxlbmRFcXVhdGlvbihCTEVOREVRVUFUSU9OX0FERCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHJlbmRlciBxdWFkIHdpdGggc2hhZGVyIGZvciByZXF1aXJlZCBudW1iZXIgb2YgdGV4dHVyZXNcbiAgICAgICAgICAgIGNvbnN0IHNoYWRlciA9IHRoaXMuX2dldFNoYWRlcih1c2VkQ291bnQpO1xuICAgICAgICAgICAgZHJhd1F1YWRXaXRoU2hhZGVyKGRldmljZSwgcmVuZGVyVGFyZ2V0LCBzaGFkZXIsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBibGVuZGluZyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc2V0IHVwIHBhcmFtZXRlcnMgZm9yIGFjdGl2ZSBibGVuZCB0YXJnZXRzXG4gICAgICAgIGxldCB1c2VkQ291bnQgPSAwO1xuICAgICAgICBsZXQgYmxlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLl9hY3RpdmVUYXJnZXRzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVUYXJnZXQgPSB0aGlzLl9hY3RpdmVUYXJnZXRzW2ldO1xuICAgICAgICAgICAgY29uc3QgdGV4ID0gYWN0aXZlVGFyZ2V0LnRhcmdldFtzcmNUZXh0dXJlTmFtZV07XG4gICAgICAgICAgICBpZiAodGV4KSB7XG5cbiAgICAgICAgICAgICAgICAvLyB0ZXh0dXJlXG4gICAgICAgICAgICAgICAgdGhpc1snbW9ycGhCbGVuZFRleCcgKyB1c2VkQ291bnRdLnNldFZhbHVlKHRleCk7XG5cbiAgICAgICAgICAgICAgICAvLyB3ZWlnaHRcbiAgICAgICAgICAgICAgICB0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHNbdXNlZENvdW50XSA9IGFjdGl2ZVRhcmdldC53ZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICAvLyBzdWJtaXQgaWYgYmF0Y2ggaXMgZnVsbFxuICAgICAgICAgICAgICAgIHVzZWRDb3VudCsrO1xuICAgICAgICAgICAgICAgIGlmICh1c2VkQ291bnQgPj0gdGhpcy5tYXhTdWJtaXRDb3VudCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pdEJhdGNoKHVzZWRDb3VudCwgYmxlbmRpbmcpO1xuICAgICAgICAgICAgICAgICAgICB1c2VkQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICBibGVuZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gbGVmdG92ZXIgYmF0Y2gsIG9yIGp1c3QgdG8gY2xlYXIgdGV4dHVyZVxuICAgICAgICBpZiAodXNlZENvdW50ID4gMCB8fCAoY291bnQgPT09IDAgJiYgIXRoaXMuemVyb1RleHR1cmVzKSkge1xuICAgICAgICAgICAgc3VibWl0QmF0Y2godXNlZENvdW50LCBibGVuZGluZyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdXBkYXRlVGV4dHVyZU1vcnBoKCkge1xuXG4gICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXMuZGV2aWNlO1xuXG4gICAgICAgIERlYnVnR3JhcGhpY3MucHVzaEdwdU1hcmtlcihkZXZpY2UsICdNb3JwaFVwZGF0ZScpO1xuXG4gICAgICAgIC8vIHVwZGF0ZSB0ZXh0dXJlcyBpZiBhY3RpdmUgdGFyZ2V0cywgb3Igbm8gYWN0aXZlIHRhcmdldHMgYW5kIHRleHR1cmVzIG5lZWQgdG8gYmUgY2xlYXJlZFxuICAgICAgICBpZiAodGhpcy5fYWN0aXZlVGFyZ2V0cy5sZW5ndGggPiAwIHx8ICF0aGlzLnplcm9UZXh0dXJlcykge1xuXG4gICAgICAgICAgICAvLyBibGVuZCBtb3JwaCB0YXJnZXRzIGludG8gcmVuZGVyIHRhcmdldHNcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRleHR1cmVSZW5kZXJUYXJnZXQodGhpcy5ydFBvc2l0aW9ucywgJ3RleHR1cmVQb3NpdGlvbnMnKTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRleHR1cmVSZW5kZXJUYXJnZXQodGhpcy5ydE5vcm1hbHMsICd0ZXh0dXJlTm9ybWFscycpO1xuXG4gICAgICAgICAgICAvLyB0ZXh0dXJlcyB3ZXJlIGNsZWFyZWQgaWYgbm8gYWN0aXZlIHRhcmdldHNcbiAgICAgICAgICAgIHRoaXMuemVyb1RleHR1cmVzID0gdGhpcy5fYWN0aXZlVGFyZ2V0cy5sZW5ndGggPT09IDA7XG4gICAgICAgIH1cblxuICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcihkZXZpY2UpO1xuICAgIH1cblxuICAgIF91cGRhdGVWZXJ0ZXhNb3JwaCgpIHtcblxuICAgICAgICAvLyBwcmVwYXJlIDggc2xvdHMgZm9yIHJlbmRlcmluZy4gdGhlc2UgYXJlIHN1cHBvcnRlZCBjb21iaW5hdGlvbnM6IFBQUFBQUFBQLCBOTk5OTk5OTiwgUFBQUE5OTk5cbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLm1heFN1Ym1pdENvdW50O1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuX3NoYWRlck1vcnBoV2VpZ2h0c1tpXSA9IDA7XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVWZXJ0ZXhCdWZmZXJzW2ldID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBwb3NJbmRleCA9IDA7XG4gICAgICAgIGxldCBucm1JbmRleCA9IHRoaXMubW9ycGgubW9ycGhQb3NpdGlvbnMgPyA0IDogMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9hY3RpdmVUYXJnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9hY3RpdmVUYXJnZXRzW2ldLnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5fdmVydGV4QnVmZmVyUG9zaXRpb25zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlVmVydGV4QnVmZmVyc1twb3NJbmRleF0gPSB0YXJnZXQuX3ZlcnRleEJ1ZmZlclBvc2l0aW9ucztcbiAgICAgICAgICAgICAgICB0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHNbcG9zSW5kZXhdID0gdGhpcy5fYWN0aXZlVGFyZ2V0c1tpXS53ZWlnaHQ7XG4gICAgICAgICAgICAgICAgcG9zSW5kZXgrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRhcmdldC5fdmVydGV4QnVmZmVyTm9ybWFscykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVZlcnRleEJ1ZmZlcnNbbnJtSW5kZXhdID0gdGFyZ2V0Ll92ZXJ0ZXhCdWZmZXJOb3JtYWxzO1xuICAgICAgICAgICAgICAgIHRoaXMuX3NoYWRlck1vcnBoV2VpZ2h0c1tucm1JbmRleF0gPSB0aGlzLl9hY3RpdmVUYXJnZXRzW2ldLndlaWdodDtcbiAgICAgICAgICAgICAgICBucm1JbmRleCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0cyBhY3RpdmUgbW9ycGggdGFyZ2V0cyBhbmQgcHJlcGFyZXMgbW9ycGggZm9yIHJlbmRlcmluZy4gQ2FsbGVkIGF1dG9tYXRpY2FsbHkgYnlcbiAgICAgKiByZW5kZXJlci5cbiAgICAgKi9cbiAgICB1cGRhdGUoKSB7XG5cbiAgICAgICAgdGhpcy5fZGlydHkgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IHRoaXMubW9ycGguX3RhcmdldHM7XG5cbiAgICAgICAgLy8gY29sbGVjdCBhY3RpdmUgdGFyZ2V0cywgcmV1c2Ugb2JqZWN0cyBpbiBfYWN0aXZlVGFyZ2V0cyBhcnJheSB0byBhdm9pZCBhbGxvY2F0aW9uc1xuICAgICAgICBsZXQgYWN0aXZlQ291bnQgPSAwO1xuICAgICAgICBjb25zdCBlcHNpbG9uID0gMC4wMDAwMTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBhYnNXZWlnaHQgPSBNYXRoLmFicyh0aGlzLmdldFdlaWdodChpKSk7XG4gICAgICAgICAgICBpZiAoYWJzV2VpZ2h0ID4gZXBzaWxvbikge1xuXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIG5ldyBvYmplY3QgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVRhcmdldHMubGVuZ3RoIDw9IGFjdGl2ZUNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldHNbYWN0aXZlQ291bnRdID0ge307XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlVGFyZ2V0ID0gdGhpcy5fYWN0aXZlVGFyZ2V0c1thY3RpdmVDb3VudCsrXTtcbiAgICAgICAgICAgICAgICBhY3RpdmVUYXJnZXQuYWJzV2VpZ2h0ID0gYWJzV2VpZ2h0O1xuICAgICAgICAgICAgICAgIGFjdGl2ZVRhcmdldC53ZWlnaHQgPSB0aGlzLmdldFdlaWdodChpKTtcbiAgICAgICAgICAgICAgICBhY3RpdmVUYXJnZXQudGFyZ2V0ID0gdGFyZ2V0c1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9hY3RpdmVUYXJnZXRzLmxlbmd0aCA9IGFjdGl2ZUNvdW50O1xuXG4gICAgICAgIC8vIGlmIHRoZXJlJ3MgbW9yZSBhY3RpdmUgdGFyZ2V0cyB0aGVuIHJlbmRlcmluZyBzdXBwb3J0c1xuICAgICAgICBjb25zdCBtYXhBY3RpdmVUYXJnZXRzID0gdGhpcy5tb3JwaC5tYXhBY3RpdmVUYXJnZXRzO1xuICAgICAgICBpZiAodGhpcy5fYWN0aXZlVGFyZ2V0cy5sZW5ndGggPiBtYXhBY3RpdmVUYXJnZXRzKSB7XG5cbiAgICAgICAgICAgIC8vIHNvcnQgdGhlbSBieSBhYnNXZWlnaHRcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldHMuc29ydChmdW5jdGlvbiAobCwgcikge1xuICAgICAgICAgICAgICAgIHJldHVybiAobC5hYnNXZWlnaHQgPCByLmFic1dlaWdodCkgPyAxIDogKHIuYWJzV2VpZ2h0IDwgbC5hYnNXZWlnaHQgPyAtMSA6IDApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBleGNlc3NcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldHMubGVuZ3RoID0gbWF4QWN0aXZlVGFyZ2V0cztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHByZXBhcmUgZm9yIHJlbmRlcmluZ1xuICAgICAgICBpZiAodGhpcy5tb3JwaC51c2VUZXh0dXJlTW9ycGgpIHtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRleHR1cmVNb3JwaCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlVmVydGV4TW9ycGgoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgTW9ycGhJbnN0YW5jZSB9O1xuIl0sIm5hbWVzIjpbInRleHR1cmVNb3JwaFZlcnRleFNoYWRlciIsIk1vcnBoSW5zdGFuY2UiLCJjb25zdHJ1Y3RvciIsIm1vcnBoIiwiaW5jUmVmQ291bnQiLCJkZXZpY2UiLCJfd2VpZ2h0cyIsIl93ZWlnaHRNYXAiLCJNYXAiLCJ2IiwiX3RhcmdldHMiLCJsZW5ndGgiLCJ0YXJnZXQiLCJuYW1lIiwic2V0Iiwic2V0V2VpZ2h0IiwiZGVmYXVsdFdlaWdodCIsIl9hY3RpdmVUYXJnZXRzIiwidXNlVGV4dHVyZU1vcnBoIiwic2hhZGVyQ2FjaGUiLCJtYXhTdWJtaXRDb3VudCIsIm1heFRleHR1cmVzIiwiX3NoYWRlck1vcnBoV2VpZ2h0cyIsIkZsb2F0MzJBcnJheSIsImNyZWF0ZVJUIiwidGV4dHVyZVZhciIsImZvcm1hdCIsIl9yZW5kZXJUZXh0dXJlRm9ybWF0IiwiTW9ycGgiLCJGT1JNQVRfRkxPQVQiLCJQSVhFTEZPUk1BVF9SR0JBMzJGIiwiUElYRUxGT1JNQVRfUkdCQTE2RiIsIl9jcmVhdGVUZXh0dXJlIiwiUmVuZGVyVGFyZ2V0IiwiY29sb3JCdWZmZXIiLCJkZXB0aCIsIm1vcnBoUG9zaXRpb25zIiwicnRQb3NpdGlvbnMiLCJtb3JwaE5vcm1hbHMiLCJydE5vcm1hbHMiLCJfdGV4dHVyZVBhcmFtcyIsIm1vcnBoVGV4dHVyZVdpZHRoIiwibW9ycGhUZXh0dXJlSGVpZ2h0IiwiaSIsInNjb3BlIiwicmVzb2x2ZSIsIm1vcnBoRmFjdG9yIiwiemVyb1RleHR1cmVzIiwiX3NoYWRlck1vcnBoV2VpZ2h0c0EiLCJidWZmZXIiLCJfc2hhZGVyTW9ycGhXZWlnaHRzQiIsIl9hY3RpdmVWZXJ0ZXhCdWZmZXJzIiwiQXJyYXkiLCJkZXN0cm95Iiwic2hhZGVyIiwiZGVjUmVmQ291bnQiLCJyZWZDb3VudCIsInRleHR1cmVQb3NpdGlvbnMiLCJ0ZXh0dXJlTm9ybWFscyIsImNsb25lIiwiX2dldFdlaWdodEluZGV4Iiwia2V5IiwiaW5kZXgiLCJnZXQiLCJ1bmRlZmluZWQiLCJEZWJ1ZyIsImVycm9yIiwiZ2V0V2VpZ2h0Iiwid2VpZ2h0IiwiYXNzZXJ0IiwiX2RpcnR5IiwiX2dldEZyYWdtZW50U2hhZGVyIiwibnVtVGV4dHVyZXMiLCJmcmFnbWVudFNoYWRlciIsIl9nZXRTaGFkZXIiLCJjb3VudCIsImZzIiwiY3JlYXRlU2hhZGVyRnJvbUNvZGUiLCJfdXBkYXRlVGV4dHVyZVJlbmRlclRhcmdldCIsInJlbmRlclRhcmdldCIsInNyY1RleHR1cmVOYW1lIiwic3VibWl0QmF0Y2giLCJ1c2VkQ291bnQiLCJibGVuZGluZyIsInNldFZhbHVlIiwic2V0QmxlbmRpbmciLCJzZXRCbGVuZEZ1bmN0aW9uIiwiQkxFTkRNT0RFX09ORSIsInNldEJsZW5kRXF1YXRpb24iLCJCTEVOREVRVUFUSU9OX0FERCIsImRyYXdRdWFkV2l0aFNoYWRlciIsImFjdGl2ZVRhcmdldCIsInRleCIsIl91cGRhdGVUZXh0dXJlTW9ycGgiLCJEZWJ1Z0dyYXBoaWNzIiwicHVzaEdwdU1hcmtlciIsInBvcEdwdU1hcmtlciIsIl91cGRhdGVWZXJ0ZXhNb3JwaCIsInBvc0luZGV4IiwibnJtSW5kZXgiLCJfdmVydGV4QnVmZmVyUG9zaXRpb25zIiwiX3ZlcnRleEJ1ZmZlck5vcm1hbHMiLCJ1cGRhdGUiLCJ0YXJnZXRzIiwiYWN0aXZlQ291bnQiLCJlcHNpbG9uIiwiYWJzV2VpZ2h0IiwiTWF0aCIsImFicyIsIm1heEFjdGl2ZVRhcmdldHMiLCJzb3J0IiwibCIsInIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFZQSxNQUFNQSx3QkFBd0IsR0FBSSxDQUFBO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBUEEsQ0FBQSxDQUFBOztBQWFBLE1BQU1DLGFBQU4sQ0FBb0I7RUFNaEJDLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRO0lBTWYsSUFBS0EsQ0FBQUEsS0FBTCxHQUFhQSxLQUFiLENBQUE7QUFDQUEsSUFBQUEsS0FBSyxDQUFDQyxXQUFOLEVBQUEsQ0FBQTtBQUNBLElBQUEsSUFBQSxDQUFLQyxNQUFMLEdBQWNGLEtBQUssQ0FBQ0UsTUFBcEIsQ0FBQTtJQUdBLElBQUtDLENBQUFBLFFB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
