/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, BLENDMODE_ONE, BLENDEQUATION_ADD } from '../platform/graphics/constants.js';
import { drawQuadWithShader } from '../platform/graphics/simple-post-effect.js';
import { RenderTarget } from '../platform/graphics/render-target.js';
import { DebugGraphics } from '../platform/graphics/debug-graphics.js';
import { createShaderFromCode } from './shader-lib/utils.js';
import { Morph } from './morph.js';

const textureMorphVertexShader = `
    attribute vec2 vertex_position;
    varying vec2 uv0;
    void main(void) {
        gl_Position = vec4(vertex_position, 0.5, 1.0);
        uv0 = vertex_position.xy * 0.5 + 0.5;
    }
    `;

class MorphInstance {
  constructor(morph) {
    this.morph = morph;
    morph.incRefCount();
    this.device = morph.device;

    this._weights = [];
    this._weightMap = new Map();
    for (let v = 0; v < morph._targets.length; v++) {
      const target = morph._targets[v];
      if (target.name) {
        this._weightMap.set(target.name, v);
      }
      this.setWeight(v, target.defaultWeight);
    }

    this._activeTargets = [];
    if (morph.useTextureMorph) {
      this.shaderCache = {};

      this.maxSubmitCount = this.device.maxTextures;

      this._shaderMorphWeights = new Float32Array(this.maxSubmitCount);

      const createRT = (name, textureVar) => {
        const format = morph._renderTextureFormat === Morph.FORMAT_FLOAT ? PIXELFORMAT_RGBA32F : PIXELFORMAT_RGBA16F;
        this[textureVar] = morph._createTexture(name, format);
        return new RenderTarget({
          colorBuffer: this[textureVar],
          depth: false
        });
      };
      if (morph.morphPositions) {
        this.rtPositions = createRT('MorphRTPos', 'texturePositions');
      }
      if (morph.morphNormals) {
        this.rtNormals = createRT('MorphRTNrm', 'textureNormals');
      }

      this._textureParams = new Float32Array([morph.morphTextureWidth, morph.morphTextureHeight, 1 / morph.morphTextureWidth, 1 / morph.morphTextureHeight]);

      for (let i = 0; i < this.maxSubmitCount; i++) {
        this['morphBlendTex' + i] = this.device.scope.resolve('morphBlendTex' + i);
      }
      this.morphFactor = this.device.scope.resolve('morphFactor[0]');

      this.zeroTextures = false;
    } else {

      this.maxSubmitCount = 8;

      this._shaderMorphWeights = new Float32Array(this.maxSubmitCount);
      this._shaderMorphWeightsA = new Float32Array(this._shaderMorphWeights.buffer, 0, 4);
      this._shaderMorphWeightsB = new Float32Array(this._shaderMorphWeights.buffer, 4 * 4, 4);

      this._activeVertexBuffers = new Array(this.maxSubmitCount);
    }
  }

  destroy() {
    this.shader = null;
    const morph = this.morph;
    if (morph) {
      this.morph = null;
      morph.decRefCount();

      if (morph.refCount < 1) {
        morph.destroy();
      }
    }
    if (this.rtPositions) {
      this.rtPositions.destroy();
      this.rtPositions = null;
    }
    if (this.texturePositions) {
      this.texturePositions.destroy();
      this.texturePositions = null;
    }
    if (this.rtNormals) {
      this.rtNormals.destroy();
      this.rtNormals = null;
    }
    if (this.textureNormals) {
      this.textureNormals.destroy();
      this.textureNormals = null;
    }
  }

  clone() {
    return new MorphInstance(this.morph);
  }
  _getWeightIndex(key) {
    if (typeof key === 'string') {
      const index = this._weightMap.get(key);
      if (index === undefined) {
        Debug.error(`Cannot find morph target with name: ${key}.`);
      }
      return index;
    }
    return key;
  }

  getWeight(key) {
    const index = this._getWeightIndex(key);
    return this._weights[index];
  }

  setWeight(key, weight) {
    const index = this._getWeightIndex(key);
    Debug.assert(index >= 0 && index < this.morph._targets.length);
    this._weights[index] = weight;
    this._dirty = true;
  }

  _getFragmentShader(numTextures) {
    let fragmentShader = '';
    if (numTextures > 0) {
      fragmentShader += 'varying vec2 uv0;\n' + 'uniform highp float morphFactor[' + numTextures + '];\n';
    }
    for (let i = 0; i < numTextures; i++) {
      fragmentShader += 'uniform highp sampler2D morphBlendTex' + i + ';\n';
    }
    fragmentShader += 'void main (void) {\n' + '    highp vec4 color = vec4(0, 0, 0, 1);\n';
    for (let i = 0; i < numTextures; i++) {
      fragmentShader += '    color.xyz += morphFactor[' + i + '] * texture2D(morphBlendTex' + i + ', uv0).xyz;\n';
    }
    fragmentShader += '    gl_FragColor = color;\n' + '}\n';
    return fragmentShader;
  }

  _getShader(count) {
    let shader = this.shaderCache[count];

    if (!shader) {
      const fs = this._getFragmentShader(count);
      shader = createShaderFromCode(this.device, textureMorphVertexShader, fs, 'textureMorph' + count);
      this.shaderCache[count] = shader;
    }
    return shader;
  }
  _updateTextureRenderTarget(renderTarget, srcTextureName) {
    const device = this.device;

    const submitBatch = (usedCount, blending) => {
      this.morphFactor.setValue(this._shaderMorphWeights);

      device.setBlending(blending);
      if (blending) {
        device.setBlendFunction(BLENDMODE_ONE, BLENDMODE_ONE);
        device.setBlendEquation(BLENDEQUATION_ADD);
      }

      const shader = this._getShader(usedCount);
      drawQuadWithShader(device, renderTarget, shader, undefined, undefined, blending);
    };

    let usedCount = 0;
    let blending = false;
    const count = this._activeTargets.length;
    for (let i = 0; i < count; i++) {
      const activeTarget = this._activeTargets[i];
      const tex = activeTarget.target[srcTextureName];
      if (tex) {
        this['morphBlendTex' + usedCount].setValue(tex);

        this._shaderMorphWeights[usedCount] = activeTarget.weight;

        usedCount++;
        if (usedCount >= this.maxSubmitCount) {
          submitBatch(usedCount, blending);
          usedCount = 0;
          blending = true;
        }
      }
    }

    if (usedCount > 0 || count === 0 && !this.zeroTextures) {
      submitBatch(usedCount, blending);
    }
  }
  _updateTextureMorph() {
    const device = this.device;
    DebugGraphics.pushGpuMarker(device, 'MorphUpdate');

    if (this._activeTargets.length > 0 || !this.zeroTextures) {
      this._updateTextureRenderTarget(this.rtPositions, 'texturePositions');
      this._updateTextureRenderTarget(this.rtNormals, 'textureNormals');

      this.zeroTextures = this._activeTargets.length === 0;
    }
    DebugGraphics.popGpuMarker(device);
  }
  _updateVertexMorph() {
    const count = this.maxSubmitCount;
    for (let i = 0; i < count; i++) {
      this._shaderMorphWeights[i] = 0;
      this._activeVertexBuffers[i] = null;
    }
    let posIndex = 0;
    let nrmIndex = this.morph.morphPositions ? 4 : 0;
    for (let i = 0; i < this._activeTargets.length; i++) {
      const target = this._activeTargets[i].target;
      if (target._vertexBufferPositions) {
        this._activeVertexBuffers[posIndex] = target._vertexBufferPositions;
        this._shaderMorphWeights[posIndex] = this._activeTargets[i].weight;
        posIndex++;
      }
      if (target._vertexBufferNormals) {
        this._activeVertexBuffers[nrmIndex] = target._vertexBufferNormals;
        this._shaderMorphWeights[nrmIndex] = this._activeTargets[i].weight;
        nrmIndex++;
      }
    }
  }

  update() {
    this._dirty = false;
    const targets = this.morph._targets;

    let activeCount = 0;
    const epsilon = 0.00001;
    for (let i = 0; i < targets.length; i++) {
      const absWeight = Math.abs(this.getWeight(i));
      if (absWeight > epsilon) {
        if (this._activeTargets.length <= activeCount) {
          this._activeTargets[activeCount] = {};
        }
        const activeTarget = this._activeTargets[activeCount++];
        activeTarget.absWeight = absWeight;
        activeTarget.weight = this.getWeight(i);
        activeTarget.target = targets[i];
      }
    }
    this._activeTargets.length = activeCount;

    const maxActiveTargets = this.morph.maxActiveTargets;
    if (this._activeTargets.length > maxActiveTargets) {
      this._activeTargets.sort(function (l, r) {
        return l.absWeight < r.absWeight ? 1 : r.absWeight < l.absWeight ? -1 : 0;
      });

      this._activeTargets.length = maxActiveTargets;
    }

    if (this.morph.useTextureMorph) {
      this._updateTextureMorph();
    } else {
      this._updateVertexMorph();
    }
  }
}

export { MorphInstance };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ycGgtaW5zdGFuY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zY2VuZS9tb3JwaC1pbnN0YW5jZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuXG5pbXBvcnQgeyBCTEVOREVRVUFUSU9OX0FERCwgQkxFTkRNT0RFX09ORSwgUElYRUxGT1JNQVRfUkdCQTMyRiwgUElYRUxGT1JNQVRfUkdCQTE2RiB9IGZyb20gJy4uL3BsYXRmb3JtL2dyYXBoaWNzL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBkcmF3UXVhZFdpdGhTaGFkZXIgfSBmcm9tICcuLi9wbGF0Zm9ybS9ncmFwaGljcy9zaW1wbGUtcG9zdC1lZmZlY3QuanMnO1xuaW1wb3J0IHsgUmVuZGVyVGFyZ2V0IH0gZnJvbSAnLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qcyc7XG5pbXBvcnQgeyBEZWJ1Z0dyYXBoaWNzIH0gZnJvbSAnLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZGVidWctZ3JhcGhpY3MuanMnO1xuXG5pbXBvcnQgeyBjcmVhdGVTaGFkZXJGcm9tQ29kZSB9IGZyb20gJy4vc2hhZGVyLWxpYi91dGlscy5qcyc7XG5pbXBvcnQgeyBNb3JwaCB9IGZyb20gJy4vbW9ycGguanMnO1xuXG4vLyB2ZXJ0ZXggc2hhZGVyIHVzZWQgdG8gYWRkIG1vcnBoIHRhcmdldHMgZnJvbSB0ZXh0dXJlcyBpbnRvIHJlbmRlciB0YXJnZXRcbmNvbnN0IHRleHR1cmVNb3JwaFZlcnRleFNoYWRlciA9IGBcbiAgICBhdHRyaWJ1dGUgdmVjMiB2ZXJ0ZXhfcG9zaXRpb247XG4gICAgdmFyeWluZyB2ZWMyIHV2MDtcbiAgICB2b2lkIG1haW4odm9pZCkge1xuICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQodmVydGV4X3Bvc2l0aW9uLCAwLjUsIDEuMCk7XG4gICAgICAgIHV2MCA9IHZlcnRleF9wb3NpdGlvbi54eSAqIDAuNSArIDAuNTtcbiAgICB9XG4gICAgYDtcblxuLyoqXG4gKiBBbiBpbnN0YW5jZSBvZiB7QGxpbmsgTW9ycGh9LiBDb250YWlucyB3ZWlnaHRzIHRvIGFzc2lnbiB0byBldmVyeSB7QGxpbmsgTW9ycGhUYXJnZXR9LCBtYW5hZ2VzXG4gKiBzZWxlY3Rpb24gb2YgYWN0aXZlIG1vcnBoIHRhcmdldHMuXG4gKi9cbmNsYXNzIE1vcnBoSW5zdGFuY2Uge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBNb3JwaEluc3RhbmNlIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtNb3JwaH0gbW9ycGggLSBUaGUge0BsaW5rIE1vcnBofSB0byBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihtb3JwaCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG1vcnBoIHdpdGggaXRzIHRhcmdldHMsIHdoaWNoIGlzIGJlaW5nIGluc3RhbmNlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge01vcnBofVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tb3JwaCA9IG1vcnBoO1xuICAgICAgICBtb3JwaC5pbmNSZWZDb3VudCgpO1xuICAgICAgICB0aGlzLmRldmljZSA9IG1vcnBoLmRldmljZTtcblxuICAgICAgICAvLyB3ZWlnaHRzXG4gICAgICAgIHRoaXMuX3dlaWdodHMgPSBbXTtcbiAgICAgICAgdGhpcy5fd2VpZ2h0TWFwID0gbmV3IE1hcCgpO1xuICAgICAgICBmb3IgKGxldCB2ID0gMDsgdiA8IG1vcnBoLl90YXJnZXRzLmxlbmd0aDsgdisrKSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBtb3JwaC5fdGFyZ2V0c1t2XTtcbiAgICAgICAgICAgIGlmICh0YXJnZXQubmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3dlaWdodE1hcC5zZXQodGFyZ2V0Lm5hbWUsIHYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRXZWlnaHQodiwgdGFyZ2V0LmRlZmF1bHRXZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGVtcG9yYXJ5IGFycmF5IG9mIHRhcmdldHMgd2l0aCBub24temVybyB3ZWlnaHRcbiAgICAgICAgdGhpcy5fYWN0aXZlVGFyZ2V0cyA9IFtdO1xuXG4gICAgICAgIGlmIChtb3JwaC51c2VUZXh0dXJlTW9ycGgpIHtcblxuICAgICAgICAgICAgLy8gc2hhZGVyIGNhY2hlXG4gICAgICAgICAgICB0aGlzLnNoYWRlckNhY2hlID0ge307XG5cbiAgICAgICAgICAgIC8vIG1heCBudW1iZXIgb2YgbW9ycGggdGFyZ2V0cyByZW5kZXJlZCBhdCBhIHRpbWUgKGVhY2ggdXNlcyBzaW5nbGUgdGV4dHVyZSBzbG90KVxuICAgICAgICAgICAgdGhpcy5tYXhTdWJtaXRDb3VudCA9IHRoaXMuZGV2aWNlLm1heFRleHR1cmVzO1xuXG4gICAgICAgICAgICAvLyBhcnJheSBmb3IgbWF4IG51bWJlciBvZiB3ZWlnaHRzXG4gICAgICAgICAgICB0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHMgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMubWF4U3VibWl0Q291bnQpO1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgcmVuZGVyIHRhcmdldHMgdG8gbW9ycGggdGFyZ2V0cyBpbnRvXG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSVCA9IChuYW1lLCB0ZXh0dXJlVmFyKSA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyByZW5kZXIgdG8gYXBwcm9wcmlhdGUsIFJHQkEgZm9ybWF0cywgd2UgY2Fubm90IHJlbmRlciB0byBSR0IgZmxvYXQgLyBoYWxmIGZsb2F0IGZvcm1hdCBpbiBXRWJHTFxuICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdCA9IG1vcnBoLl9yZW5kZXJUZXh0dXJlRm9ybWF0ID09PSBNb3JwaC5GT1JNQVRfRkxPQVQgPyBQSVhFTEZPUk1BVF9SR0JBMzJGIDogUElYRUxGT1JNQVRfUkdCQTE2RjtcbiAgICAgICAgICAgICAgICB0aGlzW3RleHR1cmVWYXJdID0gbW9ycGguX2NyZWF0ZVRleHR1cmUobmFtZSwgZm9ybWF0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlbmRlclRhcmdldCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yQnVmZmVyOiB0aGlzW3RleHR1cmVWYXJdLFxuICAgICAgICAgICAgICAgICAgICBkZXB0aDogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChtb3JwaC5tb3JwaFBvc2l0aW9ucykge1xuICAgICAgICAgICAgICAgIHRoaXMucnRQb3NpdGlvbnMgPSBjcmVhdGVSVCgnTW9ycGhSVFBvcycsICd0ZXh0dXJlUG9zaXRpb25zJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtb3JwaC5tb3JwaE5vcm1hbHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJ0Tm9ybWFscyA9IGNyZWF0ZVJUKCdNb3JwaFJUTnJtJywgJ3RleHR1cmVOb3JtYWxzJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHRleHR1cmUgcGFyYW1zXG4gICAgICAgICAgICB0aGlzLl90ZXh0dXJlUGFyYW1zID0gbmV3IEZsb2F0MzJBcnJheShbbW9ycGgubW9ycGhUZXh0dXJlV2lkdGgsIG1vcnBoLm1vcnBoVGV4dHVyZUhlaWdodCxcbiAgICAgICAgICAgICAgICAxIC8gbW9ycGgubW9ycGhUZXh0dXJlV2lkdGgsIDEgLyBtb3JwaC5tb3JwaFRleHR1cmVIZWlnaHRdKTtcblxuICAgICAgICAgICAgLy8gcmVzb2x2ZSBwb3NzaWJsZSB0ZXh0dXJlIG5hbWVzXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWF4U3VibWl0Q291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXNbJ21vcnBoQmxlbmRUZXgnICsgaV0gPSB0aGlzLmRldmljZS5zY29wZS5yZXNvbHZlKCdtb3JwaEJsZW5kVGV4JyArIGkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm1vcnBoRmFjdG9yID0gdGhpcy5kZXZpY2Uuc2NvcGUucmVzb2x2ZSgnbW9ycGhGYWN0b3JbMF0nKTtcblxuICAgICAgICAgICAgLy8gdHJ1ZSBpbmRpY2F0ZXMgcmVuZGVyIHRhcmdldCB0ZXh0dXJlcyBhcmUgZnVsbCBvZiB6ZXJvcyB0byBhdm9pZCByZW5kZXJpbmcgdG8gdGhlbSB3aGVuIGFsbCB3ZWlnaHRzIGFyZSB6ZXJvXG4gICAgICAgICAgICB0aGlzLnplcm9UZXh0dXJlcyA9IGZhbHNlO1xuXG4gICAgICAgIH0gZWxzZSB7ICAgIC8vIHZlcnRleCBhdHRyaWJ1dGUgYmFzZWQgbW9ycGhpbmdcblxuICAgICAgICAgICAgLy8gbWF4IG51bWJlciBvZiBtb3JwaCB0YXJnZXRzIHJlbmRlcmVkIGF0IGEgdGltZVxuICAgICAgICAgICAgdGhpcy5tYXhTdWJtaXRDb3VudCA9IDg7XG5cbiAgICAgICAgICAgIC8vIHdlaWdodHMgb2YgYWN0aXZlIHZlcnRleCBidWZmZXJzIGluIGZvcm1hdCB1c2VkIGJ5IHJlbmRlcmluZ1xuICAgICAgICAgICAgdGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLm1heFN1Ym1pdENvdW50KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aG9sZSBhcnJheVxuICAgICAgICAgICAgdGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzQSA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzLmJ1ZmZlciwgMCwgNCk7ICAgICAgICAvLyBmaXJzdCA0IGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHNCID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHMuYnVmZmVyLCA0ICogNCwgNCk7ICAgIC8vIHNlY29uZCA0IGVsZW1lbnRzXG5cbiAgICAgICAgICAgIC8vIHByZS1hbGxvY2F0ZSBhcnJheSBvZiBhY3RpdmUgdmVydGV4IGJ1ZmZlcnMgdXNlZCBieSByZW5kZXJpbmdcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVZlcnRleEJ1ZmZlcnMgPSBuZXcgQXJyYXkodGhpcy5tYXhTdWJtaXRDb3VudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGcmVlcyB2aWRlbyBtZW1vcnkgYWxsb2NhdGVkIGJ5IHRoaXMgb2JqZWN0LlxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG5cbiAgICAgICAgLy8gZG9uJ3QgZGVzdHJveSBzaGFkZXIgYXMgaXQncyBpbiB0aGUgY2FjaGUgYW5kIGNhbiBiZSB1c2VkIGJ5IG90aGVyIG1hdGVyaWFsc1xuICAgICAgICB0aGlzLnNoYWRlciA9IG51bGw7XG5cbiAgICAgICAgY29uc3QgbW9ycGggPSB0aGlzLm1vcnBoO1xuICAgICAgICBpZiAobW9ycGgpIHtcblxuICAgICAgICAgICAgLy8gZGVjcmVhc2UgcmVmIGNvdW50XG4gICAgICAgICAgICB0aGlzLm1vcnBoID0gbnVsbDtcbiAgICAgICAgICAgIG1vcnBoLmRlY1JlZkNvdW50KCk7XG5cbiAgICAgICAgICAgIC8vIGRlc3Ryb3kgbW9ycGhcbiAgICAgICAgICAgIGlmIChtb3JwaC5yZWZDb3VudCA8IDEpIHtcbiAgICAgICAgICAgICAgICBtb3JwaC5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5ydFBvc2l0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5ydFBvc2l0aW9ucy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLnJ0UG9zaXRpb25zID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnRleHR1cmVQb3NpdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dHVyZVBvc2l0aW9ucy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLnRleHR1cmVQb3NpdGlvbnMgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucnROb3JtYWxzKSB7XG4gICAgICAgICAgICB0aGlzLnJ0Tm9ybWFscy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLnJ0Tm9ybWFscyA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy50ZXh0dXJlTm9ybWFscykge1xuICAgICAgICAgICAgdGhpcy50ZXh0dXJlTm9ybWFscy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLnRleHR1cmVOb3JtYWxzID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb25lcyBhIE1vcnBoSW5zdGFuY2UuIFRoZSByZXR1cm5lZCBjbG9uZSB1c2VzIHRoZSBzYW1lIHtAbGluayBNb3JwaH0gYW5kIHdlaWdodHMgYXJlIHNldFxuICAgICAqIHRvIGRlZmF1bHRzLlxuICAgICAqXG4gICAgICogQHJldHVybnMge01vcnBoSW5zdGFuY2V9IEEgY2xvbmUgb2YgdGhlIHNwZWNpZmllZCBNb3JwaEluc3RhbmNlLlxuICAgICAqL1xuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IE1vcnBoSW5zdGFuY2UodGhpcy5tb3JwaCk7XG4gICAgfVxuXG4gICAgX2dldFdlaWdodEluZGV4KGtleSkge1xuICAgICAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fd2VpZ2h0TWFwLmdldChrZXkpO1xuICAgICAgICAgICAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBEZWJ1Zy5lcnJvcihgQ2Fubm90IGZpbmQgbW9ycGggdGFyZ2V0IHdpdGggbmFtZTogJHtrZXl9LmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBrZXk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBjdXJyZW50IHdlaWdodCBvZiB0aGUgc3BlY2lmaWVkIG1vcnBoIHRhcmdldC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0ga2V5IC0gQW4gaWRlbnRpZmllciBmb3IgdGhlIG1vcnBoIHRhcmdldC4gRWl0aGVyIHRoZSB3ZWlnaHQgaW5kZXggb3JcbiAgICAgKiB0aGUgd2VpZ2h0IG5hbWUuXG4gICAgICogQHJldHVybnMge251bWJlcn0gV2VpZ2h0LlxuICAgICAqL1xuICAgIGdldFdlaWdodChrZXkpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9nZXRXZWlnaHRJbmRleChrZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fd2VpZ2h0c1tpbmRleF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB3ZWlnaHQgb2YgdGhlIHNwZWNpZmllZCBtb3JwaCB0YXJnZXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IGtleSAtIEFuIGlkZW50aWZpZXIgZm9yIHRoZSBtb3JwaCB0YXJnZXQuIEVpdGhlciB0aGUgd2VpZ2h0IGluZGV4IG9yXG4gICAgICogdGhlIHdlaWdodCBuYW1lLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3ZWlnaHQgLSBXZWlnaHQuXG4gICAgICovXG4gICAgc2V0V2VpZ2h0KGtleSwgd2VpZ2h0KSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fZ2V0V2VpZ2h0SW5kZXgoa2V5KTtcbiAgICAgICAgRGVidWcuYXNzZXJ0KGluZGV4ID49IDAgJiYgaW5kZXggPCB0aGlzLm1vcnBoLl90YXJnZXRzLmxlbmd0aCk7XG4gICAgICAgIHRoaXMuX3dlaWdodHNbaW5kZXhdID0gd2VpZ2h0O1xuICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgZnJhZ21lbnQgc2hhZGVyIHRvIGJsZW5kIGEgbnVtYmVyIG9mIHRleHR1cmVzIHVzaW5nIHNwZWNpZmllZCB3ZWlnaHRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG51bVRleHR1cmVzIC0gTnVtYmVyIG9mIHRleHR1cmVzIHRvIGJsZW5kLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IEZyYWdtZW50IHNoYWRlci5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9nZXRGcmFnbWVudFNoYWRlcihudW1UZXh0dXJlcykge1xuXG4gICAgICAgIGxldCBmcmFnbWVudFNoYWRlciA9ICcnO1xuXG4gICAgICAgIGlmIChudW1UZXh0dXJlcyA+IDApIHtcbiAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyICs9ICd2YXJ5aW5nIHZlYzIgdXYwO1xcbicgK1xuICAgICAgICAgICAgICAgICd1bmlmb3JtIGhpZ2hwIGZsb2F0IG1vcnBoRmFjdG9yWycgKyBudW1UZXh0dXJlcyArICddO1xcbic7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVRleHR1cmVzOyBpKyspIHtcbiAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyICs9ICd1bmlmb3JtIGhpZ2hwIHNhbXBsZXIyRCBtb3JwaEJsZW5kVGV4JyArIGkgKyAnO1xcbic7XG4gICAgICAgIH1cblxuICAgICAgICBmcmFnbWVudFNoYWRlciArPSAndm9pZCBtYWluICh2b2lkKSB7XFxuJyArXG4gICAgICAgICAgICAnICAgIGhpZ2hwIHZlYzQgY29sb3IgPSB2ZWM0KDAsIDAsIDAsIDEpO1xcbic7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1UZXh0dXJlczsgaSsrKSB7XG4gICAgICAgICAgICBmcmFnbWVudFNoYWRlciArPSAnICAgIGNvbG9yLnh5eiArPSBtb3JwaEZhY3RvclsnICsgaSArICddICogdGV4dHVyZTJEKG1vcnBoQmxlbmRUZXgnICsgaSArICcsIHV2MCkueHl6O1xcbic7XG4gICAgICAgIH1cblxuICAgICAgICBmcmFnbWVudFNoYWRlciArPSAnICAgIGdsX0ZyYWdDb2xvciA9IGNvbG9yO1xcbicgK1xuICAgICAgICAgICAgJ31cXG4nO1xuXG4gICAgICAgIHJldHVybiBmcmFnbWVudFNoYWRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgY29tcGxldGUgc2hhZGVyIGZvciB0ZXh0dXJlIGJhc2VkIG1vcnBoaW5nLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IC0gTnVtYmVyIG9mIHRleHR1cmVzIHRvIGJsZW5kLlxuICAgICAqIEByZXR1cm5zIHtpbXBvcnQoJy4uL3BsYXRmb3JtL2dyYXBoaWNzL3NoYWRlci5qcycpLlNoYWRlcn0gU2hhZGVyLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2dldFNoYWRlcihjb3VudCkge1xuXG4gICAgICAgIGxldCBzaGFkZXIgPSB0aGlzLnNoYWRlckNhY2hlW2NvdW50XTtcblxuICAgICAgICAvLyBpZiBzaGFkZXIgaXMgbm90IGluIGNhY2hlLCBnZW5lcmF0ZSBvbmVcbiAgICAgICAgaWYgKCFzaGFkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZzID0gdGhpcy5fZ2V0RnJhZ21lbnRTaGFkZXIoY291bnQpO1xuICAgICAgICAgICAgc2hhZGVyID0gY3JlYXRlU2hhZGVyRnJvbUNvZGUodGhpcy5kZXZpY2UsIHRleHR1cmVNb3JwaFZlcnRleFNoYWRlciwgZnMsICd0ZXh0dXJlTW9ycGgnICsgY291bnQpO1xuICAgICAgICAgICAgdGhpcy5zaGFkZXJDYWNoZVtjb3VudF0gPSBzaGFkZXI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2hhZGVyO1xuICAgIH1cblxuICAgIF91cGRhdGVUZXh0dXJlUmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwgc3JjVGV4dHVyZU5hbWUpIHtcblxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcblxuICAgICAgICAvLyBibGVuZCBjdXJyZW50bHkgc2V0IHVwIHRleHR1cmVzIHRvIHJlbmRlciB0YXJnZXRcbiAgICAgICAgY29uc3Qgc3VibWl0QmF0Y2ggPSAodXNlZENvdW50LCBibGVuZGluZykgPT4ge1xuXG4gICAgICAgICAgICAvLyBmYWN0b3JzXG4gICAgICAgICAgICB0aGlzLm1vcnBoRmFjdG9yLnNldFZhbHVlKHRoaXMuX3NoYWRlck1vcnBoV2VpZ2h0cyk7XG5cbiAgICAgICAgICAgIC8vIGFscGhhIGJsZW5kaW5nIC0gZmlyc3QgcGFzcyBnZXRzIG5vbmUsIGZvbGxvd2luZyBwYXNzZXMgYXJlIGFkZGl0aXZlXG4gICAgICAgICAgICBkZXZpY2Uuc2V0QmxlbmRpbmcoYmxlbmRpbmcpO1xuICAgICAgICAgICAgaWYgKGJsZW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgZGV2aWNlLnNldEJsZW5kRnVuY3Rpb24oQkxFTkRNT0RFX09ORSwgQkxFTkRNT0RFX09ORSk7XG4gICAgICAgICAgICAgICAgZGV2aWNlLnNldEJsZW5kRXF1YXRpb24oQkxFTkRFUVVBVElPTl9BREQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyByZW5kZXIgcXVhZCB3aXRoIHNoYWRlciBmb3IgcmVxdWlyZWQgbnVtYmVyIG9mIHRleHR1cmVzXG4gICAgICAgICAgICBjb25zdCBzaGFkZXIgPSB0aGlzLl9nZXRTaGFkZXIodXNlZENvdW50KTtcbiAgICAgICAgICAgIGRyYXdRdWFkV2l0aFNoYWRlcihkZXZpY2UsIHJlbmRlclRhcmdldCwgc2hhZGVyLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgYmxlbmRpbmcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHNldCB1cCBwYXJhbWV0ZXJzIGZvciBhY3RpdmUgYmxlbmQgdGFyZ2V0c1xuICAgICAgICBsZXQgdXNlZENvdW50ID0gMDtcbiAgICAgICAgbGV0IGJsZW5kaW5nID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5fYWN0aXZlVGFyZ2V0cy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgYWN0aXZlVGFyZ2V0ID0gdGhpcy5fYWN0aXZlVGFyZ2V0c1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHRleCA9IGFjdGl2ZVRhcmdldC50YXJnZXRbc3JjVGV4dHVyZU5hbWVdO1xuICAgICAgICAgICAgaWYgKHRleCkge1xuXG4gICAgICAgICAgICAgICAgLy8gdGV4dHVyZVxuICAgICAgICAgICAgICAgIHRoaXNbJ21vcnBoQmxlbmRUZXgnICsgdXNlZENvdW50XS5zZXRWYWx1ZSh0ZXgpO1xuXG4gICAgICAgICAgICAgICAgLy8gd2VpZ2h0XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzW3VzZWRDb3VudF0gPSBhY3RpdmVUYXJnZXQud2VpZ2h0O1xuXG4gICAgICAgICAgICAgICAgLy8gc3VibWl0IGlmIGJhdGNoIGlzIGZ1bGxcbiAgICAgICAgICAgICAgICB1c2VkQ291bnQrKztcbiAgICAgICAgICAgICAgICBpZiAodXNlZENvdW50ID49IHRoaXMubWF4U3VibWl0Q291bnQpIHtcblxuICAgICAgICAgICAgICAgICAgICBzdWJtaXRCYXRjaCh1c2VkQ291bnQsIGJsZW5kaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgdXNlZENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgYmxlbmRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGxlZnRvdmVyIGJhdGNoLCBvciBqdXN0IHRvIGNsZWFyIHRleHR1cmVcbiAgICAgICAgaWYgKHVzZWRDb3VudCA+IDAgfHwgKGNvdW50ID09PSAwICYmICF0aGlzLnplcm9UZXh0dXJlcykpIHtcbiAgICAgICAgICAgIHN1Ym1pdEJhdGNoKHVzZWRDb3VudCwgYmxlbmRpbmcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3VwZGF0ZVRleHR1cmVNb3JwaCgpIHtcblxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcblxuICAgICAgICBEZWJ1Z0dyYXBoaWNzLnB1c2hHcHVNYXJrZXIoZGV2aWNlLCAnTW9ycGhVcGRhdGUnKTtcblxuICAgICAgICAvLyB1cGRhdGUgdGV4dHVyZXMgaWYgYWN0aXZlIHRhcmdldHMsIG9yIG5vIGFjdGl2ZSB0YXJnZXRzIGFuZCB0ZXh0dXJlcyBuZWVkIHRvIGJlIGNsZWFyZWRcbiAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVRhcmdldHMubGVuZ3RoID4gMCB8fCAhdGhpcy56ZXJvVGV4dHVyZXMpIHtcblxuICAgICAgICAgICAgLy8gYmxlbmQgbW9ycGggdGFyZ2V0cyBpbnRvIHJlbmRlciB0YXJnZXRzXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVUZXh0dXJlUmVuZGVyVGFyZ2V0KHRoaXMucnRQb3NpdGlvbnMsICd0ZXh0dXJlUG9zaXRpb25zJyk7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVUZXh0dXJlUmVuZGVyVGFyZ2V0KHRoaXMucnROb3JtYWxzLCAndGV4dHVyZU5vcm1hbHMnKTtcblxuICAgICAgICAgICAgLy8gdGV4dHVyZXMgd2VyZSBjbGVhcmVkIGlmIG5vIGFjdGl2ZSB0YXJnZXRzXG4gICAgICAgICAgICB0aGlzLnplcm9UZXh0dXJlcyA9IHRoaXMuX2FjdGl2ZVRhcmdldHMubGVuZ3RoID09PSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgRGVidWdHcmFwaGljcy5wb3BHcHVNYXJrZXIoZGV2aWNlKTtcbiAgICB9XG5cbiAgICBfdXBkYXRlVmVydGV4TW9ycGgoKSB7XG5cbiAgICAgICAgLy8gcHJlcGFyZSA4IHNsb3RzIGZvciByZW5kZXJpbmcuIHRoZXNlIGFyZSBzdXBwb3J0ZWQgY29tYmluYXRpb25zOiBQUFBQUFBQUCwgTk5OTk5OTk4sIFBQUFBOTk5OXG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5tYXhTdWJtaXRDb3VudDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHNbaV0gPSAwO1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZlVmVydGV4QnVmZmVyc1tpXSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcG9zSW5kZXggPSAwO1xuICAgICAgICBsZXQgbnJtSW5kZXggPSB0aGlzLm1vcnBoLm1vcnBoUG9zaXRpb25zID8gNCA6IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fYWN0aXZlVGFyZ2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fYWN0aXZlVGFyZ2V0c1tpXS50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuX3ZlcnRleEJ1ZmZlclBvc2l0aW9ucykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVZlcnRleEJ1ZmZlcnNbcG9zSW5kZXhdID0gdGFyZ2V0Ll92ZXJ0ZXhCdWZmZXJQb3NpdGlvbnM7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hhZGVyTW9ycGhXZWlnaHRzW3Bvc0luZGV4XSA9IHRoaXMuX2FjdGl2ZVRhcmdldHNbaV0ud2VpZ2h0O1xuICAgICAgICAgICAgICAgIHBvc0luZGV4Kys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuX3ZlcnRleEJ1ZmZlck5vcm1hbHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVWZXJ0ZXhCdWZmZXJzW25ybUluZGV4XSA9IHRhcmdldC5fdmVydGV4QnVmZmVyTm9ybWFscztcbiAgICAgICAgICAgICAgICB0aGlzLl9zaGFkZXJNb3JwaFdlaWdodHNbbnJtSW5kZXhdID0gdGhpcy5fYWN0aXZlVGFyZ2V0c1tpXS53ZWlnaHQ7XG4gICAgICAgICAgICAgICAgbnJtSW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbGVjdHMgYWN0aXZlIG1vcnBoIHRhcmdldHMgYW5kIHByZXBhcmVzIG1vcnBoIGZvciByZW5kZXJpbmcuIENhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5XG4gICAgICogcmVuZGVyZXIuXG4gICAgICovXG4gICAgdXBkYXRlKCkge1xuXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSB0aGlzLm1vcnBoLl90YXJnZXRzO1xuXG4gICAgICAgIC8vIGNvbGxlY3QgYWN0aXZlIHRhcmdldHMsIHJldXNlIG9iamVjdHMgaW4gX2FjdGl2ZVRhcmdldHMgYXJyYXkgdG8gYXZvaWQgYWxsb2NhdGlvbnNcbiAgICAgICAgbGV0IGFjdGl2ZUNvdW50ID0gMDtcbiAgICAgICAgY29uc3QgZXBzaWxvbiA9IDAuMDAwMDE7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgYWJzV2VpZ2h0ID0gTWF0aC5hYnModGhpcy5nZXRXZWlnaHQoaSkpO1xuICAgICAgICAgICAgaWYgKGFic1dlaWdodCA+IGVwc2lsb24pIHtcblxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgb2JqZWN0IGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3RpdmVUYXJnZXRzLmxlbmd0aCA8PSBhY3RpdmVDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVUYXJnZXRzW2FjdGl2ZUNvdW50XSA9IHt9O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRhcmdldCA9IHRoaXMuX2FjdGl2ZVRhcmdldHNbYWN0aXZlQ291bnQrK107XG4gICAgICAgICAgICAgICAgYWN0aXZlVGFyZ2V0LmFic1dlaWdodCA9IGFic1dlaWdodDtcbiAgICAgICAgICAgICAgICBhY3RpdmVUYXJnZXQud2VpZ2h0ID0gdGhpcy5nZXRXZWlnaHQoaSk7XG4gICAgICAgICAgICAgICAgYWN0aXZlVGFyZ2V0LnRhcmdldCA9IHRhcmdldHNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYWN0aXZlVGFyZ2V0cy5sZW5ndGggPSBhY3RpdmVDb3VudDtcblxuICAgICAgICAvLyBpZiB0aGVyZSdzIG1vcmUgYWN0aXZlIHRhcmdldHMgdGhlbiByZW5kZXJpbmcgc3VwcG9ydHNcbiAgICAgICAgY29uc3QgbWF4QWN0aXZlVGFyZ2V0cyA9IHRoaXMubW9ycGgubWF4QWN0aXZlVGFyZ2V0cztcbiAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVRhcmdldHMubGVuZ3RoID4gbWF4QWN0aXZlVGFyZ2V0cykge1xuXG4gICAgICAgICAgICAvLyBzb3J0IHRoZW0gYnkgYWJzV2VpZ2h0XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVUYXJnZXRzLnNvcnQoZnVuY3Rpb24gKGwsIHIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGwuYWJzV2VpZ2h0IDwgci5hYnNXZWlnaHQpID8gMSA6IChyLmFic1dlaWdodCA8IGwuYWJzV2VpZ2h0ID8gLTEgOiAwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgZXhjZXNzXG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVUYXJnZXRzLmxlbmd0aCA9IG1heEFjdGl2ZVRhcmdldHM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwcmVwYXJlIGZvciByZW5kZXJpbmdcbiAgICAgICAgaWYgKHRoaXMubW9ycGgudXNlVGV4dHVyZU1vcnBoKSB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVUZXh0dXJlTW9ycGgoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRleE1vcnBoKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IE1vcnBoSW5zdGFuY2UgfTtcbiJdLCJuYW1lcyI6WyJ0ZXh0dXJlTW9ycGhWZXJ0ZXhTaGFkZXIiLCJNb3JwaEluc3RhbmNlIiwiY29uc3RydWN0b3IiLCJtb3JwaCIsImluY1JlZkNvdW50IiwiZGV2aWNlIiwiX3dlaWdodHMiLCJfd2VpZ2h0TWFwIiwiTWFwIiwidiIsIl90YXJnZXRzIiwibGVuZ3RoIiwidGFyZ2V0IiwibmFtZSIsInNldCIsInNldFdlaWdodCIsImRlZmF1bHRXZWlnaHQiLCJfYWN0aXZlVGFyZ2V0cyIsInVzZVRleHR1cmVNb3JwaCIsInNoYWRlckNhY2hlIiwibWF4U3VibWl0Q291bnQiLCJtYXhUZXh0dXJlcyIsIl9zaGFkZXJNb3JwaFdlaWdodHMiLCJGbG9hdDMyQXJyYXkiLCJjcmVhdGVSVCIsInRleHR1cmVWYXIiLCJmb3JtYXQiLCJfcmVuZGVyVGV4dHVyZUZvcm1hdCIsIk1vcnBoIiwiRk9STUFUX0ZMT0FUIiwiUElYRUxGT1JNQVRfUkdCQTMyRiIsIlBJWEVMRk9STUFUX1JHQkExNkYiLCJfY3JlYXRlVGV4dHVyZSIsIlJlbmRlclRhcmdldCIsImNvbG9yQnVmZmVyIiwiZGVwdGgiLCJtb3JwaFBvc2l0aW9ucyIsInJ0UG9zaXRpb25zIiwibW9ycGhOb3JtYWxzIiwicnROb3JtYWxzIiwiX3RleHR1cmVQYXJhbXMiLCJtb3JwaFRleHR1cmVXaWR0aCIsIm1vcnBoVGV4dHVyZUhlaWdodCIsImkiLCJzY29wZSIsInJlc29sdmUiLCJtb3JwaEZhY3RvciIsInplcm9UZXh0dXJlcyIsIl9zaGFkZXJNb3JwaFdlaWdodHNBIiwiYnVmZmVyIiwiX3NoYWRlck1vcnBoV2VpZ2h0c0IiLCJfYWN0aXZlVmVydGV4QnVmZmVycyIsIkFycmF5IiwiZGVzdHJveSIsInNoYWRlciIsImRlY1JlZkNvdW50IiwicmVmQ291bnQiLCJ0ZXh0dXJlUG9zaXRpb25zIiwidGV4dHVyZU5vcm1hbHMiLCJjbG9uZSIsIl9nZXRXZWlnaHRJbmRleCIsImtleSIsImluZGV4IiwiZ2V0IiwidW5kZWZpbmVkIiwiRGVidWciLCJlcnJvciIsImdldFdlaWdodCIsIndlaWdodCIsImFzc2VydCIsIl9kaXJ0eSIsIl9nZXRGcmFnbWVudFNoYWRlciIsIm51bVRleHR1cmVzIiwiZnJhZ21lbnRTaGFkZXIiLCJfZ2V0U2hhZGVyIiwiY291bnQiLCJmcyIsImNyZWF0ZVNoYWRlckZyb21Db2RlIiwiX3VwZGF0ZVRleHR1cmVSZW5kZXJUYXJnZXQiLCJyZW5kZXJUYXJnZXQiLCJzcmNUZXh0dXJlTmFtZSIsInN1Ym1pdEJhdGNoIiwidXNlZENvdW50IiwiYmxlbmRpbmciLCJzZXRWYWx1ZSIsInNldEJsZW5kaW5nIiwic2V0QmxlbmRGdW5jdGlvbiIsIkJMRU5ETU9ERV9PTkUiLCJzZXRCbGVuZEVxdWF0aW9uIiwiQkxFTkRFUVVBVElPTl9BREQiLCJkcmF3UXVhZFdpdGhTaGFkZXIiLCJhY3RpdmVUYXJnZXQiLCJ0ZXgiLCJfdXBkYXRlVGV4dHVyZU1vcnBoIiwiRGVidWdHcmFwaGljcyIsInB1c2hHcHVNYXJrZXIiLCJwb3BHcHVNYXJrZXIiLCJfdXBkYXRlVmVydGV4TW9ycGgiLCJwb3NJbmRleCIsIm5ybUluZGV4IiwiX3ZlcnRleEJ1ZmZlclBvc2l0aW9ucyIsIl92ZXJ0ZXhCdWZmZXJOb3JtYWxzIiwidXBkYXRlIiwidGFyZ2V0cyIsImFjdGl2ZUNvdW50IiwiZXBzaWxvbiIsImFic1dlaWdodCIsIk1hdGgiLCJhYnMiLCJtYXhBY3RpdmVUYXJnZXRzIiwic29ydCIsImwiLCJyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBV0EsTUFBTUEsd0JBQXdCLEdBQUksQ0FBQTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFLLENBQUEsQ0FBQTs7QUFNTCxNQUFNQyxhQUFhLENBQUM7RUFNaEJDLFdBQVcsQ0FBQ0MsS0FBSyxFQUFFO0lBTWYsSUFBSSxDQUFDQSxLQUFLLEdBQUdBLEtBQUssQ0FBQTtJQUNsQkEsS0FBSyxDQUFDQyxXQUFXLEVBQUUsQ0FBQTtBQUNuQixJQUFBLElBQUksQ0FBQ0MsTUFBTSxHQUFHRixLQUFLLENBQUNFLE1BQU0sQ0FBQTs7SUFHMUIsSUFBSSxDQUFDQyxRQUFRLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLElBQUEsSUFBSSxDQUFDQyxVQUFVLEdBQUcsSUFBSUMsR0FBRyxFQUFFLENBQUE7QUFDM0IsSUFBQSxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR04sS0FBSyxDQUFDTyxRQUFRLENBQUNDLE1BQU0sRUFBRUYsQ0FBQyxFQUFFLEVBQUU7QUFDNUMsTUFBQSxNQUFNRyxNQUFNLEdBQUdULEtBQUssQ0FBQ08sUUFBUSxDQUFDRCxDQUFDLENBQUMsQ0FBQTtNQUNoQyxJQUFJRyxNQUFNLENBQUNDLElBQUksRUFBRTtRQUNiLElBQUksQ0FBQ04sVUFBVSxDQUFDTyxHQUFHLENBQUNGLE1BQU0sQ0FBQ0MsSUFBSSxFQUFFSixDQUFDLENBQUMsQ0FBQTtBQUN2QyxPQUFBO01BQ0EsSUFBSSxDQUFDTSxTQUFTLENBQUNOLENBQUMsRUFBRUcsTUFBTSxDQUFDSSxhQUFhLENBQUMsQ0FBQTtBQUMzQyxLQUFBOztJQUdBLElBQUksQ0FBQ0MsY0FBYyxHQUFHLEVBQUUsQ0FBQTtJQUV4QixJQUFJZCxLQUFLLENBQUNlLGVBQWUsRUFBRTtBQUd2QixNQUFBLElBQUksQ0FBQ0MsV0FBVyxHQUFHLEVBQUUsQ0FBQTs7QUFHckIsTUFBQSxJQUFJLENBQUNDLGNBQWMsR0FBRyxJQUFJLENBQUNmLE1BQU0sQ0FBQ2dCLFdBQVcsQ0FBQTs7TUFHN0MsSUFBSSxDQUFDQyxtQkFBbUIsR0FBRyxJQUFJQyxZQUFZLENBQUMsSUFBSSxDQUFDSCxjQUFjLENBQUMsQ0FBQTs7QUFHaEUsTUFBQSxNQUFNSSxRQUFRLEdBQUcsQ0FBQ1gsSUFBSSxFQUFFWSxVQUFVLEtBQUs7QUFHbkMsUUFBQSxNQUFNQyxNQUFNLEdBQUd2QixLQUFLLENBQUN3QixvQkFBb0IsS0FBS0MsS0FBSyxDQUFDQyxZQUFZLEdBQUdDLG1CQUFtQixHQUFHQyxtQkFBbUIsQ0FBQTtRQUM1RyxJQUFJLENBQUNOLFVBQVUsQ0FBQyxHQUFHdEIsS0FBSyxDQUFDNkIsY0FBYyxDQUFDbkIsSUFBSSxFQUFFYSxNQUFNLENBQUMsQ0FBQTtRQUNyRCxPQUFPLElBQUlPLFlBQVksQ0FBQztBQUNwQkMsVUFBQUEsV0FBVyxFQUFFLElBQUksQ0FBQ1QsVUFBVSxDQUFDO0FBQzdCVSxVQUFBQSxLQUFLLEVBQUUsS0FBQTtBQUNYLFNBQUMsQ0FBQyxDQUFBO09BQ0wsQ0FBQTtNQUVELElBQUloQyxLQUFLLENBQUNpQyxjQUFjLEVBQUU7UUFDdEIsSUFBSSxDQUFDQyxXQUFXLEdBQUdiLFFBQVEsQ0FBQyxZQUFZLEVBQUUsa0JBQWtCLENBQUMsQ0FBQTtBQUNqRSxPQUFBO01BRUEsSUFBSXJCLEtBQUssQ0FBQ21DLFlBQVksRUFBRTtRQUNwQixJQUFJLENBQUNDLFNBQVMsR0FBR2YsUUFBUSxDQUFDLFlBQVksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO0FBQzdELE9BQUE7O01BR0EsSUFBSSxDQUFDZ0IsY0FBYyxHQUFHLElBQUlqQixZQUFZLENBQUMsQ0FBQ3BCLEtBQUssQ0FBQ3NDLGlCQUFpQixFQUFFdEMsS0FBSyxDQUFDdUMsa0JBQWtCLEVBQ3JGLENBQUMsR0FBR3ZDLEtBQUssQ0FBQ3NDLGlCQUFpQixFQUFFLENBQUMsR0FBR3RDLEtBQUssQ0FBQ3VDLGtCQUFrQixDQUFDLENBQUMsQ0FBQTs7QUFHL0QsTUFBQSxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBRyxJQUFJLENBQUN2QixjQUFjLEVBQUV1QixDQUFDLEVBQUUsRUFBRTtBQUMxQyxRQUFBLElBQUksQ0FBQyxlQUFlLEdBQUdBLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQ3RDLE1BQU0sQ0FBQ3VDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDLGVBQWUsR0FBR0YsQ0FBQyxDQUFDLENBQUE7QUFDOUUsT0FBQTtBQUVBLE1BQUEsSUFBSSxDQUFDRyxXQUFXLEdBQUcsSUFBSSxDQUFDekMsTUFBTSxDQUFDdUMsS0FBSyxDQUFDQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTs7TUFHOUQsSUFBSSxDQUFDRSxZQUFZLEdBQUcsS0FBSyxDQUFBO0FBRTdCLEtBQUMsTUFBTTs7TUFHSCxJQUFJLENBQUMzQixjQUFjLEdBQUcsQ0FBQyxDQUFBOztNQUd2QixJQUFJLENBQUNFLG1CQUFtQixHQUFHLElBQUlDLFlBQVksQ0FBQyxJQUFJLENBQUNILGNBQWMsQ0FBQyxDQUFBO0FBQ2hFLE1BQUEsSUFBSSxDQUFDNEIsb0JBQW9CLEdBQUcsSUFBSXpCLFlBQVksQ0FBQyxJQUFJLENBQUNELG1CQUFtQixDQUFDMkIsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNuRixNQUFBLElBQUksQ0FBQ0Msb0JBQW9CLEdBQUcsSUFBSTNCLFlBQVksQ0FBQyxJQUFJLENBQUNELG1CQUFtQixDQUFDMkIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7O01BR3ZGLElBQUksQ0FBQ0Usb0JBQW9CLEdBQUcsSUFBSUMsS0FBSyxDQUFDLElBQUksQ0FBQ2hDLGNBQWMsQ0FBQyxDQUFBO0FBQzlELEtBQUE7QUFDSixHQUFBOztBQUtBaUMsRUFBQUEsT0FBTyxHQUFHO0lBR04sSUFBSSxDQUFDQyxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBRWxCLElBQUEsTUFBTW5ELEtBQUssR0FBRyxJQUFJLENBQUNBLEtBQUssQ0FBQTtBQUN4QixJQUFBLElBQUlBLEtBQUssRUFBRTtNQUdQLElBQUksQ0FBQ0EsS0FBSyxHQUFHLElBQUksQ0FBQTtNQUNqQkEsS0FBSyxDQUFDb0QsV0FBVyxFQUFFLENBQUE7O0FBR25CLE1BQUEsSUFBSXBELEtBQUssQ0FBQ3FELFFBQVEsR0FBRyxDQUFDLEVBQUU7UUFDcEJyRCxLQUFLLENBQUNrRCxPQUFPLEVBQUUsQ0FBQTtBQUNuQixPQUFBO0FBQ0osS0FBQTtJQUVBLElBQUksSUFBSSxDQUFDaEIsV0FBVyxFQUFFO0FBQ2xCLE1BQUEsSUFBSSxDQUFDQSxXQUFXLENBQUNnQixPQUFPLEVBQUUsQ0FBQTtNQUMxQixJQUFJLENBQUNoQixXQUFXLEdBQUcsSUFBSSxDQUFBO0FBQzNCLEtBQUE7SUFFQSxJQUFJLElBQUksQ0FBQ29CLGdCQUFnQixFQUFFO0FBQ3ZCLE1BQUEsSUFBSSxDQUFDQSxnQkFBZ0IsQ0FBQ0osT0FBTyxFQUFFLENBQUE7TUFDL0IsSUFBSSxDQUFDSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUE7QUFDaEMsS0FBQTtJQUVBLElBQUksSUFBSSxDQUFDbEIsU0FBUyxFQUFFO0FBQ2hCLE1BQUEsSUFBSSxDQUFDQSxTQUFTLENBQUNjLE9BQU8sRUFBRSxDQUFBO01BQ3hCLElBQUksQ0FBQ2QsU0FBUyxHQUFHLElBQUksQ0FBQTtBQUN6QixLQUFBO0lBRUEsSUFBSSxJQUFJLENBQUNtQixjQUFjLEVBQUU7QUFDckIsTUFBQSxJQUFJLENBQUNBLGNBQWMsQ0FBQ0wsT0FBTyxFQUFFLENBQUE7TUFDN0IsSUFBSSxDQUFDSyxjQUFjLEdBQUcsSUFBSSxDQUFBO0FBQzlCLEtBQUE7QUFDSixHQUFBOztBQVFBQyxFQUFBQSxLQUFLLEdBQUc7QUFDSixJQUFBLE9BQU8sSUFBSTFELGFBQWEsQ0FBQyxJQUFJLENBQUNFLEtBQUssQ0FBQyxDQUFBO0FBQ3hDLEdBQUE7RUFFQXlELGVBQWUsQ0FBQ0MsR0FBRyxFQUFFO0FBQ2pCLElBQUEsSUFBSSxPQUFPQSxHQUFHLEtBQUssUUFBUSxFQUFFO01BQ3pCLE1BQU1DLEtBQUssR0FBRyxJQUFJLENBQUN2RCxVQUFVLENBQUN3RCxHQUFHLENBQUNGLEdBQUcsQ0FBQyxDQUFBO01BQ3RDLElBQUlDLEtBQUssS0FBS0UsU0FBUyxFQUFFO0FBQ3JCQyxRQUFBQSxLQUFLLENBQUNDLEtBQUssQ0FBRSxDQUFzQ0wsb0NBQUFBLEVBQUFBLEdBQUksR0FBRSxDQUFDLENBQUE7QUFDOUQsT0FBQTtBQUNBLE1BQUEsT0FBT0MsS0FBSyxDQUFBO0FBQ2hCLEtBQUE7QUFDQSxJQUFBLE9BQU9ELEdBQUcsQ0FBQTtBQUNkLEdBQUE7O0VBU0FNLFNBQVMsQ0FBQ04sR0FBRyxFQUFFO0FBQ1gsSUFBQSxNQUFNQyxLQUFLLEdBQUcsSUFBSSxDQUFDRixlQUFlLENBQUNDLEdBQUcsQ0FBQyxDQUFBO0FBQ3ZDLElBQUEsT0FBTyxJQUFJLENBQUN2RCxRQUFRLENBQUN3RCxLQUFLLENBQUMsQ0FBQTtBQUMvQixHQUFBOztBQVNBL0MsRUFBQUEsU0FBUyxDQUFDOEMsR0FBRyxFQUFFTyxNQUFNLEVBQUU7QUFDbkIsSUFBQSxNQUFNTixLQUFLLEdBQUcsSUFBSSxDQUFDRixlQUFlLENBQUNDLEdBQUcsQ0FBQyxDQUFBO0FBQ3ZDSSxJQUFBQSxLQUFLLENBQUNJLE1BQU0sQ0FBQ1AsS0FBSyxJQUFJLENBQUMsSUFBSUEsS0FBSyxHQUFHLElBQUksQ0FBQzNELEtBQUssQ0FBQ08sUUFBUSxDQUFDQyxNQUFNLENBQUMsQ0FBQTtBQUM5RCxJQUFBLElBQUksQ0FBQ0wsUUFBUSxDQUFDd0QsS0FBSyxDQUFDLEdBQUdNLE1BQU0sQ0FBQTtJQUM3QixJQUFJLENBQUNFLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDdEIsR0FBQTs7RUFTQUMsa0JBQWtCLENBQUNDLFdBQVcsRUFBRTtJQUU1QixJQUFJQyxjQUFjLEdBQUcsRUFBRSxDQUFBO0lBRXZCLElBQUlELFdBQVcsR0FBRyxDQUFDLEVBQUU7QUFDakJDLE1BQUFBLGNBQWMsSUFBSSxxQkFBcUIsR0FDbkMsa0NBQWtDLEdBQUdELFdBQVcsR0FBRyxNQUFNLENBQUE7QUFDakUsS0FBQTtJQUVBLEtBQUssSUFBSTdCLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBRzZCLFdBQVcsRUFBRTdCLENBQUMsRUFBRSxFQUFFO0FBQ2xDOEIsTUFBQUEsY0FBYyxJQUFJLHVDQUF1QyxHQUFHOUIsQ0FBQyxHQUFHLEtBQUssQ0FBQTtBQUN6RSxLQUFBO0lBRUE4QixjQUFjLElBQUksc0JBQXNCLEdBQ3BDLDRDQUE0QyxDQUFBO0lBRWhELEtBQUssSUFBSTlCLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBRzZCLFdBQVcsRUFBRTdCLENBQUMsRUFBRSxFQUFFO01BQ2xDOEIsY0FBYyxJQUFJLCtCQUErQixHQUFHOUIsQ0FBQyxHQUFHLDZCQUE2QixHQUFHQSxDQUFDLEdBQUcsZUFBZSxDQUFBO0FBQy9HLEtBQUE7SUFFQThCLGNBQWMsSUFBSSw2QkFBNkIsR0FDM0MsS0FBSyxDQUFBO0FBRVQsSUFBQSxPQUFPQSxjQUFjLENBQUE7QUFDekIsR0FBQTs7RUFTQUMsVUFBVSxDQUFDQyxLQUFLLEVBQUU7QUFFZCxJQUFBLElBQUlyQixNQUFNLEdBQUcsSUFBSSxDQUFDbkMsV0FBVyxDQUFDd0QsS0FBSyxDQUFDLENBQUE7O0lBR3BDLElBQUksQ0FBQ3JCLE1BQU0sRUFBRTtBQUNULE1BQUEsTUFBTXNCLEVBQUUsR0FBRyxJQUFJLENBQUNMLGtCQUFrQixDQUFDSSxLQUFLLENBQUMsQ0FBQTtBQUN6Q3JCLE1BQUFBLE1BQU0sR0FBR3VCLG9CQUFvQixDQUFDLElBQUksQ0FBQ3hFLE1BQU0sRUFBRUwsd0JBQXdCLEVBQUU0RSxFQUFFLEVBQUUsY0FBYyxHQUFHRCxLQUFLLENBQUMsQ0FBQTtBQUNoRyxNQUFBLElBQUksQ0FBQ3hELFdBQVcsQ0FBQ3dELEtBQUssQ0FBQyxHQUFHckIsTUFBTSxDQUFBO0FBQ3BDLEtBQUE7QUFFQSxJQUFBLE9BQU9BLE1BQU0sQ0FBQTtBQUNqQixHQUFBO0FBRUF3QixFQUFBQSwwQkFBMEIsQ0FBQ0MsWUFBWSxFQUFFQyxjQUFjLEVBQUU7QUFFckQsSUFBQSxNQUFNM0UsTUFBTSxHQUFHLElBQUksQ0FBQ0EsTUFBTSxDQUFBOztBQUcxQixJQUFBLE1BQU00RSxXQUFXLEdBQUcsQ0FBQ0MsU0FBUyxFQUFFQyxRQUFRLEtBQUs7TUFHekMsSUFBSSxDQUFDckMsV0FBVyxDQUFDc0MsUUFBUSxDQUFDLElBQUksQ0FBQzlELG1CQUFtQixDQUFDLENBQUE7O0FBR25EakIsTUFBQUEsTUFBTSxDQUFDZ0YsV0FBVyxDQUFDRixRQUFRLENBQUMsQ0FBQTtBQUM1QixNQUFBLElBQUlBLFFBQVEsRUFBRTtBQUNWOUUsUUFBQUEsTUFBTSxDQUFDaUYsZ0JBQWdCLENBQUNDLGFBQWEsRUFBRUEsYUFBYSxDQUFDLENBQUE7QUFDckRsRixRQUFBQSxNQUFNLENBQUNtRixnQkFBZ0IsQ0FBQ0MsaUJBQWlCLENBQUMsQ0FBQTtBQUM5QyxPQUFBOztBQUdBLE1BQUEsTUFBTW5DLE1BQU0sR0FBRyxJQUFJLENBQUNvQixVQUFVLENBQUNRLFNBQVMsQ0FBQyxDQUFBO0FBQ3pDUSxNQUFBQSxrQkFBa0IsQ0FBQ3JGLE1BQU0sRUFBRTBFLFlBQVksRUFBRXpCLE1BQU0sRUFBRVUsU0FBUyxFQUFFQSxTQUFTLEVBQUVtQixRQUFRLENBQUMsQ0FBQTtLQUNuRixDQUFBOztJQUdELElBQUlELFNBQVMsR0FBRyxDQUFDLENBQUE7SUFDakIsSUFBSUMsUUFBUSxHQUFHLEtBQUssQ0FBQTtBQUNwQixJQUFBLE1BQU1SLEtBQUssR0FBRyxJQUFJLENBQUMxRCxjQUFjLENBQUNOLE1BQU0sQ0FBQTtJQUN4QyxLQUFLLElBQUlnQyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdnQyxLQUFLLEVBQUVoQyxDQUFDLEVBQUUsRUFBRTtBQUM1QixNQUFBLE1BQU1nRCxZQUFZLEdBQUcsSUFBSSxDQUFDMUUsY0FBYyxDQUFDMEIsQ0FBQyxDQUFDLENBQUE7QUFDM0MsTUFBQSxNQUFNaUQsR0FBRyxHQUFHRCxZQUFZLENBQUMvRSxNQUFNLENBQUNvRSxjQUFjLENBQUMsQ0FBQTtBQUMvQyxNQUFBLElBQUlZLEdBQUcsRUFBRTtRQUdMLElBQUksQ0FBQyxlQUFlLEdBQUdWLFNBQVMsQ0FBQyxDQUFDRSxRQUFRLENBQUNRLEdBQUcsQ0FBQyxDQUFBOztRQUcvQyxJQUFJLENBQUN0RSxtQkFBbUIsQ0FBQzRELFNBQVMsQ0FBQyxHQUFHUyxZQUFZLENBQUN2QixNQUFNLENBQUE7O0FBR3pEYyxRQUFBQSxTQUFTLEVBQUUsQ0FBQTtBQUNYLFFBQUEsSUFBSUEsU0FBUyxJQUFJLElBQUksQ0FBQzlELGNBQWMsRUFBRTtBQUVsQzZELFVBQUFBLFdBQVcsQ0FBQ0MsU0FBUyxFQUFFQyxRQUFRLENBQUMsQ0FBQTtBQUNoQ0QsVUFBQUEsU0FBUyxHQUFHLENBQUMsQ0FBQTtBQUNiQyxVQUFBQSxRQUFRLEdBQUcsSUFBSSxDQUFBO0FBQ25CLFNBQUE7QUFDSixPQUFBO0FBQ0osS0FBQTs7QUFHQSxJQUFBLElBQUlELFNBQVMsR0FBRyxDQUFDLElBQUtQLEtBQUssS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM1QixZQUFhLEVBQUU7QUFDdERrQyxNQUFBQSxXQUFXLENBQUNDLFNBQVMsRUFBRUMsUUFBUSxDQUFDLENBQUE7QUFDcEMsS0FBQTtBQUNKLEdBQUE7QUFFQVUsRUFBQUEsbUJBQW1CLEdBQUc7QUFFbEIsSUFBQSxNQUFNeEYsTUFBTSxHQUFHLElBQUksQ0FBQ0EsTUFBTSxDQUFBO0FBRTFCeUYsSUFBQUEsYUFBYSxDQUFDQyxhQUFhLENBQUMxRixNQUFNLEVBQUUsYUFBYSxDQUFDLENBQUE7O0FBR2xELElBQUEsSUFBSSxJQUFJLENBQUNZLGNBQWMsQ0FBQ04sTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQ29DLFlBQVksRUFBRTtNQUd0RCxJQUFJLENBQUMrQiwwQkFBMEIsQ0FBQyxJQUFJLENBQUN6QyxXQUFXLEVBQUUsa0JBQWtCLENBQUMsQ0FBQTtNQUNyRSxJQUFJLENBQUN5QywwQkFBMEIsQ0FBQyxJQUFJLENBQUN2QyxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQTs7TUFHakUsSUFBSSxDQUFDUSxZQUFZLEdBQUcsSUFBSSxDQUFDOUIsY0FBYyxDQUFDTixNQUFNLEtBQUssQ0FBQyxDQUFBO0FBQ3hELEtBQUE7QUFFQW1GLElBQUFBLGFBQWEsQ0FBQ0UsWUFBWSxDQUFDM0YsTUFBTSxDQUFDLENBQUE7QUFDdEMsR0FBQTtBQUVBNEYsRUFBQUEsa0JBQWtCLEdBQUc7QUFHakIsSUFBQSxNQUFNdEIsS0FBSyxHQUFHLElBQUksQ0FBQ3ZELGNBQWMsQ0FBQTtJQUNqQyxLQUFLLElBQUl1QixDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdnQyxLQUFLLEVBQUVoQyxDQUFDLEVBQUUsRUFBRTtBQUM1QixNQUFBLElBQUksQ0FBQ3JCLG1CQUFtQixDQUFDcUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBQy9CLE1BQUEsSUFBSSxDQUFDUSxvQkFBb0IsQ0FBQ1IsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO0FBQ3ZDLEtBQUE7SUFFQSxJQUFJdUQsUUFBUSxHQUFHLENBQUMsQ0FBQTtJQUNoQixJQUFJQyxRQUFRLEdBQUcsSUFBSSxDQUFDaEcsS0FBSyxDQUFDaUMsY0FBYyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDaEQsSUFBQSxLQUFLLElBQUlPLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBRyxJQUFJLENBQUMxQixjQUFjLENBQUNOLE1BQU0sRUFBRWdDLENBQUMsRUFBRSxFQUFFO01BQ2pELE1BQU0vQixNQUFNLEdBQUcsSUFBSSxDQUFDSyxjQUFjLENBQUMwQixDQUFDLENBQUMsQ0FBQy9CLE1BQU0sQ0FBQTtNQUU1QyxJQUFJQSxNQUFNLENBQUN3RixzQkFBc0IsRUFBRTtRQUMvQixJQUFJLENBQUNqRCxvQkFBb0IsQ0FBQytDLFFBQVEsQ0FBQyxHQUFHdEYsTUFBTSxDQUFDd0Ysc0JBQXNCLENBQUE7QUFDbkUsUUFBQSxJQUFJLENBQUM5RSxtQkFBbUIsQ0FBQzRFLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQ2pGLGNBQWMsQ0FBQzBCLENBQUMsQ0FBQyxDQUFDeUIsTUFBTSxDQUFBO0FBQ2xFOEIsUUFBQUEsUUFBUSxFQUFFLENBQUE7QUFDZCxPQUFBO01BRUEsSUFBSXRGLE1BQU0sQ0FBQ3lGLG9CQUFvQixFQUFFO1FBQzdCLElBQUksQ0FBQ2xELG9CQUFvQixDQUFDZ0QsUUFBUSxDQUFDLEdBQUd2RixNQUFNLENBQUN5RixvQkFBb0IsQ0FBQTtBQUNqRSxRQUFBLElBQUksQ0FBQy9FLG1CQUFtQixDQUFDNkUsUUFBUSxDQUFDLEdBQUcsSUFBSSxDQUFDbEYsY0FBYyxDQUFDMEIsQ0FBQyxDQUFDLENBQUN5QixNQUFNLENBQUE7QUFDbEUrQixRQUFBQSxRQUFRLEVBQUUsQ0FBQTtBQUNkLE9BQUE7QUFDSixLQUFBO0FBQ0osR0FBQTs7QUFNQUcsRUFBQUEsTUFBTSxHQUFHO0lBRUwsSUFBSSxDQUFDaEMsTUFBTSxHQUFHLEtBQUssQ0FBQTtBQUNuQixJQUFBLE1BQU1pQyxPQUFPLEdBQUcsSUFBSSxDQUFDcEcsS0FBSyxDQUFDTyxRQUFRLENBQUE7O0lBR25DLElBQUk4RixXQUFXLEdBQUcsQ0FBQyxDQUFBO0lBQ25CLE1BQU1DLE9BQU8sR0FBRyxPQUFPLENBQUE7QUFDdkIsSUFBQSxLQUFLLElBQUk5RCxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUc0RCxPQUFPLENBQUM1RixNQUFNLEVBQUVnQyxDQUFDLEVBQUUsRUFBRTtBQUNyQyxNQUFBLE1BQU0rRCxTQUFTLEdBQUdDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLElBQUksQ0FBQ3pDLFNBQVMsQ0FBQ3hCLENBQUMsQ0FBQyxDQUFDLENBQUE7TUFDN0MsSUFBSStELFNBQVMsR0FBR0QsT0FBTyxFQUFFO0FBR3JCLFFBQUEsSUFBSSxJQUFJLENBQUN4RixjQUFjLENBQUNOLE1BQU0sSUFBSTZGLFdBQVcsRUFBRTtBQUMzQyxVQUFBLElBQUksQ0FBQ3ZGLGNBQWMsQ0FBQ3VGLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUN6QyxTQUFBO1FBRUEsTUFBTWIsWUFBWSxHQUFHLElBQUksQ0FBQzFFLGNBQWMsQ0FBQ3VGLFdBQVcsRUFBRSxDQUFDLENBQUE7UUFDdkRiLFlBQVksQ0FBQ2UsU0FBUyxHQUFHQSxTQUFTLENBQUE7UUFDbENmLFlBQVksQ0FBQ3ZCLE1BQU0sR0FBRyxJQUFJLENBQUNELFNBQVMsQ0FBQ3hCLENBQUMsQ0FBQyxDQUFBO0FBQ3ZDZ0QsUUFBQUEsWUFBWSxDQUFDL0UsTUFBTSxHQUFHMkYsT0FBTyxDQUFDNUQsQ0FBQyxDQUFDLENBQUE7QUFDcEMsT0FBQTtBQUNKLEtBQUE7QUFDQSxJQUFBLElBQUksQ0FBQzFCLGNBQWMsQ0FBQ04sTUFBTSxHQUFHNkYsV0FBVyxDQUFBOztBQUd4QyxJQUFBLE1BQU1LLGdCQUFnQixHQUFHLElBQUksQ0FBQzFHLEtBQUssQ0FBQzBHLGdCQUFnQixDQUFBO0FBQ3BELElBQUEsSUFBSSxJQUFJLENBQUM1RixjQUFjLENBQUNOLE1BQU0sR0FBR2tHLGdCQUFnQixFQUFFO01BRy9DLElBQUksQ0FBQzVGLGNBQWMsQ0FBQzZGLElBQUksQ0FBQyxVQUFVQyxDQUFDLEVBQUVDLENBQUMsRUFBRTtRQUNyQyxPQUFRRCxDQUFDLENBQUNMLFNBQVMsR0FBR00sQ0FBQyxDQUFDTixTQUFTLEdBQUksQ0FBQyxHQUFJTSxDQUFDLENBQUNOLFNBQVMsR0FBR0ssQ0FBQyxDQUFDTCxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBRSxDQUFBO0FBQ2pGLE9BQUMsQ0FBQyxDQUFBOztBQUdGLE1BQUEsSUFBSSxDQUFDekYsY0FBYyxDQUFDTixNQUFNLEdBQUdrRyxnQkFBZ0IsQ0FBQTtBQUNqRCxLQUFBOztBQUdBLElBQUEsSUFBSSxJQUFJLENBQUMxRyxLQUFLLENBQUNlLGVBQWUsRUFBRTtNQUM1QixJQUFJLENBQUMyRSxtQkFBbUIsRUFBRSxDQUFBO0FBQzlCLEtBQUMsTUFBTTtNQUNILElBQUksQ0FBQ0ksa0JBQWtCLEVBQUUsQ0FBQTtBQUM3QixLQUFBO0FBQ0osR0FBQTtBQUNKOzs7OyJ9
