/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { TRACEID_RENDER_PASS, TRACEID_RENDER_PASS_DETAIL } from '../core/constants.js';
import { Debug } from '../core/debug.js';
import { Tracing } from '../core/tracing.js';

class FrameGraph {
  constructor() {
    this.renderPasses = [];
    this.renderTargetMap = new Map();
  }
  addRenderPass(renderPass) {
    this.renderPasses.push(renderPass);
  }
  reset() {
    this.renderPasses.length = 0;
  }
  compile() {
    const renderTargetMap = this.renderTargetMap;
    const renderPasses = this.renderPasses;
    for (let i = 0; i < renderPasses.length; i++) {
      const renderPass = renderPasses[i];
      const renderTarget = renderPass.renderTarget;

      if (renderTarget !== undefined) {
        const prevPass = renderTargetMap.get(renderTarget);
        if (prevPass) {
          if (!renderPass.colorOps.clear) {
            prevPass.colorOps.store = true;
          }
          if (!renderPass.depthStencilOps.clearDepth) {
            prevPass.depthStencilOps.storeDepth = true;
          }
          if (!renderPass.depthStencilOps.clearStencil) {
            prevPass.depthStencilOps.storeStencil = true;
          }
        }

        renderTargetMap.set(renderTarget, renderPass);
      }
    }

    let lastCubeTexture = null;
    let lastCubeRenderPass = null;
    for (let i = 0; i < renderPasses.length; i++) {
      const renderPass = renderPasses[i];
      const renderTarget = renderPass.renderTarget;
      const thisTexture = renderTarget == null ? void 0 : renderTarget.colorBuffer;
      if (thisTexture != null && thisTexture.cubemap) {
        if (lastCubeTexture === thisTexture) {
          lastCubeRenderPass.colorOps.mipmaps = false;
        }
        lastCubeTexture = renderTarget.colorBuffer;
        lastCubeRenderPass = renderPass;
      } else if (renderPass.requiresCubemaps) {
        lastCubeTexture = null;
        lastCubeRenderPass = null;
      }
    }

    renderTargetMap.forEach((renderPass, renderTarget) => {
      if (renderTarget === null) {
        renderPass.colorOps.store = true;

        renderPass.colorOps.resolve = false;
        renderPass.colorOps.mipmaps = false;
      }
    });
    renderTargetMap.clear();
    this.log();
  }
  render() {
    this.compile();
    const renderPasses = this.renderPasses;
    for (let i = 0; i < renderPasses.length; i++) {
      renderPasses[i].render();
    }
  }
  log() {
    if (Tracing.get(TRACEID_RENDER_PASS) || Tracing.get(TRACEID_RENDER_PASS_DETAIL)) {
      this.renderPasses.forEach((renderPass, index) => {
        var _renderPass$renderTar, _renderPass$renderTar2, _renderPass$renderTar3;
        const hasColor = (_renderPass$renderTar = renderPass.renderTarget) == null ? void 0 : _renderPass$renderTar.colorBuffer;
        const hasDepth = (_renderPass$renderTar2 = renderPass.renderTarget) == null ? void 0 : _renderPass$renderTar2.depth;
        const hasStencil = (_renderPass$renderTar3 = renderPass.renderTarget) == null ? void 0 : _renderPass$renderTar3.stencil;
        const rt = renderPass.renderTarget === undefined ? '' : ` RT: ${renderPass.renderTarget ? renderPass.renderTarget.name : 'NULL'} ` + `${hasColor ? '[Color]' : ''}` + `${hasDepth ? '[Depth]' : ''}` + `${hasStencil ? '[Stencil]' : ''}` + `${renderPass.samples > 0 ? ' samples: ' + renderPass.samples : ''}`;
        Debug.trace(TRACEID_RENDER_PASS, `${index.toString().padEnd(2, ' ')}: ${renderPass.name.padEnd(20, ' ')}` + rt.padEnd(30));
        if (renderPass.colorOps && hasColor) {
          Debug.trace(TRACEID_RENDER_PASS_DETAIL, `    colorOps: ` + `${renderPass.colorOps.clear ? 'clear' : 'load'}->` + `${renderPass.colorOps.store ? 'store' : 'discard'} ` + `${renderPass.colorOps.resolve ? 'resolve ' : ''}` + `${renderPass.colorOps.mipmaps ? 'mipmaps ' : ''}`);
        }
        if (renderPass.depthStencilOps) {
          if (hasDepth) {
            Debug.trace(TRACEID_RENDER_PASS_DETAIL, `    depthOps: ` + `${renderPass.depthStencilOps.clearDepth ? 'clear' : 'load'}->` + `${renderPass.depthStencilOps.storeDepth ? 'store' : 'discard'}`);
          }
          if (hasStencil) {
            Debug.trace(TRACEID_RENDER_PASS_DETAIL, `    stencOps: ` + `${renderPass.depthStencilOps.clearStencil ? 'clear' : 'load'}->` + `${renderPass.depthStencilOps.storeStencil ? 'store' : 'discard'}`);
          }
        }
      });
    }
  }
}

export { FrameGraph };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWUtZ3JhcGguanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zY2VuZS9mcmFtZS1ncmFwaC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUUkFDRUlEX1JFTkRFUl9QQVNTLCBUUkFDRUlEX1JFTkRFUl9QQVNTX0RFVEFJTCB9IGZyb20gJy4uL2NvcmUvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBUcmFjaW5nIH0gZnJvbSAnLi4vY29yZS90cmFjaW5nLmpzJztcblxuLyoqXG4gKiBBIGZyYW1lIGdyYXBoIHJlcHJlc2VudHMgYSBzaW5nbGUgcmVuZGVyaW5nIGZyYW1lIGFzIGEgc2VxdWVuY2Ugb2YgcmVuZGVyIHBhc3Nlcy5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIEZyYW1lR3JhcGgge1xuICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuLi9wbGF0Zm9ybS9ncmFwaGljcy9yZW5kZXItcGFzcy5qcycpLlJlbmRlclBhc3NbXX0gKi9cbiAgICByZW5kZXJQYXNzZXMgPSBbXTtcblxuICAgIC8qKlxuICAgICAqIE1hcCB1c2VkIGR1cmluZyBmcmFtZSBncmFwaCBjb21waWxhdGlvbi4gSXQgbWFwcyBhIHJlbmRlciB0YXJnZXQgdG8gaXRzIHByZXZpb3VzIG9jY3VycmVuY2UuXG4gICAgICpcbiAgICAgKiAgQHR5cGUge01hcDxpbXBvcnQoJy4uL3BsYXRmb3JtL2dyYXBoaWNzL3JlbmRlci10YXJnZXQuanMnKS5SZW5kZXJUYXJnZXQsIGltcG9ydCgnLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXBhc3MuanMnKS5SZW5kZXJQYXNzPn1cbiAgICAgKi9cbiAgICByZW5kZXJUYXJnZXRNYXAgPSBuZXcgTWFwKCk7XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSByZW5kZXIgcGFzcyB0byB0aGUgZnJhbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXBhc3MuanMnKS5SZW5kZXJQYXNzfSByZW5kZXJQYXNzIC0gVGhlIHJlbmRlclxuICAgICAqIHBhc3MgdG8gYWRkLlxuICAgICAqL1xuICAgIGFkZFJlbmRlclBhc3MocmVuZGVyUGFzcykge1xuICAgICAgICB0aGlzLnJlbmRlclBhc3Nlcy5wdXNoKHJlbmRlclBhc3MpO1xuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnJlbmRlclBhc3Nlcy5sZW5ndGggPSAwO1xuICAgIH1cblxuICAgIGNvbXBpbGUoKSB7XG5cbiAgICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0TWFwID0gdGhpcy5yZW5kZXJUYXJnZXRNYXA7XG4gICAgICAgIGNvbnN0IHJlbmRlclBhc3NlcyA9IHRoaXMucmVuZGVyUGFzc2VzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbmRlclBhc3Nlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcmVuZGVyUGFzcyA9IHJlbmRlclBhc3Nlc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHJlbmRlclRhcmdldCA9IHJlbmRlclBhc3MucmVuZGVyVGFyZ2V0O1xuXG4gICAgICAgICAgICAvLyBpZiB1c2luZyBhIHRhcmdldCwgb3IgbnVsbCB3aGljaCByZXByZXNlbnRzIHRoZSBkZWZhdWx0IGZyYW1lYnVmZmVyXG4gICAgICAgICAgICBpZiAocmVuZGVyVGFyZ2V0ICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgIC8vIHByZXZpb3VzIHBhc3MgdXNpbmcgdGhlIHNhbWUgcmVuZGVyIHRhcmdldFxuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZQYXNzID0gcmVuZGVyVGFyZ2V0TWFwLmdldChyZW5kZXJUYXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmIChwcmV2UGFzcykge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIHVzZSB0aGUgUlQgd2l0aG91dCBjbGVhcmluZywgbWFrZSBzdXJlIHRoZSBwcmV2aW91cyBwYXNzIHN0b3JlcyBkYXRhXG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVuZGVyUGFzcy5jb2xvck9wcy5jbGVhcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldlBhc3MuY29sb3JPcHMuc3RvcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVuZGVyUGFzcy5kZXB0aFN0ZW5jaWxPcHMuY2xlYXJEZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldlBhc3MuZGVwdGhTdGVuY2lsT3BzLnN0b3JlRGVwdGggPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVuZGVyUGFzcy5kZXB0aFN0ZW5jaWxPcHMuY2xlYXJTdGVuY2lsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2UGFzcy5kZXB0aFN0ZW5jaWxPcHMuc3RvcmVTdGVuY2lsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUgcGFzcyB0byB0aGUgbWFwXG4gICAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0TWFwLnNldChyZW5kZXJUYXJnZXQsIHJlbmRlclBhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2FsayBvdmVyIHJlbmRlciBwYXNzZXMgdG8gZmluZCBwYXNzZXMgcmVuZGVyaW5nIHRvIHRoZSBzYW1lIGN1YmVtYXAgdGV4dHVyZS5cbiAgICAgICAgLy8gSWYgdGhvc2UgcGFzc2VzIGFyZSBzZXBhcmF0ZWQgb25seSBieSBwYXNzZXMgbm90IHJlcXVpcmluZyBjdWJlbWFwIChzaGFkb3dzIC4uKSxcbiAgICAgICAgLy8gd2Ugc2tpcCB0aGUgbWlwbWFwIGdlbmVyYXRpb24gdGlsbCB0aGUgbGFzdCByZW5kZXJpbmcgdG8gdGhlIGN1YmVtYXAsIHRvIGF2b2lkXG4gICAgICAgIC8vIG1pcG1hcHMgYmVpbmcgZ2VuZXJhdGVkIGFmdGVyIGVhY2ggZmFjZS5cbiAgICAgICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnKS5UZXh0dXJlfSAqL1xuICAgICAgICBsZXQgbGFzdEN1YmVUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4uL3BsYXRmb3JtL2dyYXBoaWNzL3JlbmRlci1wYXNzLmpzJykuUmVuZGVyUGFzc30gKi9cbiAgICAgICAgbGV0IGxhc3RDdWJlUmVuZGVyUGFzcyA9IG51bGw7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVuZGVyUGFzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCByZW5kZXJQYXNzID0gcmVuZGVyUGFzc2VzW2ldO1xuICAgICAgICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gcmVuZGVyUGFzcy5yZW5kZXJUYXJnZXQ7XG4gICAgICAgICAgICBjb25zdCB0aGlzVGV4dHVyZSA9IHJlbmRlclRhcmdldD8uY29sb3JCdWZmZXI7XG5cbiAgICAgICAgICAgIGlmICh0aGlzVGV4dHVyZT8uY3ViZW1hcCkge1xuXG4gICAgICAgICAgICAgICAgLy8gaWYgcHJldmlvdXMgcGFzcyB1c2VkIHRoZSBzYW1lIGN1YmVtYXAgdGV4dHVyZSwgaXQgZG9lcyBub3QgbmVlZCBtaXBtYXBzIGdlbmVyYXRlZFxuICAgICAgICAgICAgICAgIGlmIChsYXN0Q3ViZVRleHR1cmUgPT09IHRoaXNUZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RDdWJlUmVuZGVyUGFzcy5jb2xvck9wcy5taXBtYXBzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGFzdEN1YmVUZXh0dXJlID0gcmVuZGVyVGFyZ2V0LmNvbG9yQnVmZmVyO1xuICAgICAgICAgICAgICAgIGxhc3RDdWJlUmVuZGVyUGFzcyA9IHJlbmRlclBhc3M7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVuZGVyUGFzcy5yZXF1aXJlc0N1YmVtYXBzKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgY3ViZW1hcCBpcyByZXF1aXJlZCwgYnJlYWsgdGhlIGN1YmVtYXAgcmVuZGVyaW5nIGNoYWluXG4gICAgICAgICAgICAgICAgbGFzdEN1YmVUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBsYXN0Q3ViZVJlbmRlclBhc3MgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gaGFuZGxlIHdoYXQncyBsZWZ0IGluIHRoZSBtYXAgLSBsYXN0IHBhc3NlcyByZW5kZXJpbmcgdG8gZWFjaCByZW5kZXIgdGFyZ2V0XG4gICAgICAgIHJlbmRlclRhcmdldE1hcC5mb3JFYWNoKChyZW5kZXJQYXNzLCByZW5kZXJUYXJnZXQpID0+IHtcblxuICAgICAgICAgICAgLy8gZGVmYXVsdCBmcmFtZWJ1ZmZlclxuICAgICAgICAgICAgaWYgKHJlbmRlclRhcmdldCA9PT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgLy8gc3RvcmUgdGhlIG11bHRpc2FtcGxlZCBidWZmZXJcbiAgICAgICAgICAgICAgICByZW5kZXJQYXNzLmNvbG9yT3BzLnN0b3JlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIC8vIG5vIHJlc29sdmUsIG5vIG1pcG1hcHNcbiAgICAgICAgICAgICAgICByZW5kZXJQYXNzLmNvbG9yT3BzLnJlc29sdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZW5kZXJQYXNzLmNvbG9yT3BzLm1pcG1hcHMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVuZGVyVGFyZ2V0TWFwLmNsZWFyKCk7XG5cbiAgICAgICAgdGhpcy5sb2coKTtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG5cbiAgICAgICAgdGhpcy5jb21waWxlKCk7XG5cbiAgICAgICAgY29uc3QgcmVuZGVyUGFzc2VzID0gdGhpcy5yZW5kZXJQYXNzZXM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVuZGVyUGFzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICByZW5kZXJQYXNzZXNbaV0ucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2coKSB7XG4gICAgICAgIC8vICNpZiBfREVCVUdcbiAgICAgICAgaWYgKFRyYWNpbmcuZ2V0KFRSQUNFSURfUkVOREVSX1BBU1MpIHx8IFRyYWNpbmcuZ2V0KFRSQUNFSURfUkVOREVSX1BBU1NfREVUQUlMKSkge1xuXG4gICAgICAgICAgICB0aGlzLnJlbmRlclBhc3Nlcy5mb3JFYWNoKChyZW5kZXJQYXNzLCBpbmRleCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzQ29sb3IgPSByZW5kZXJQYXNzLnJlbmRlclRhcmdldD8uY29sb3JCdWZmZXI7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzRGVwdGggPSByZW5kZXJQYXNzLnJlbmRlclRhcmdldD8uZGVwdGg7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzU3RlbmNpbCA9IHJlbmRlclBhc3MucmVuZGVyVGFyZ2V0Py5zdGVuY2lsO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJ0ID0gcmVuZGVyUGFzcy5yZW5kZXJUYXJnZXQgPT09IHVuZGVmaW5lZCA/ICcnIDogYCBSVDogJHsocmVuZGVyUGFzcy5yZW5kZXJUYXJnZXQgPyByZW5kZXJQYXNzLnJlbmRlclRhcmdldC5uYW1lIDogJ05VTEwnKX0gYCArXG4gICAgICAgICAgICAgICAgICAgIGAke2hhc0NvbG9yID8gJ1tDb2xvcl0nIDogJyd9YCArXG4gICAgICAgICAgICAgICAgICAgIGAke2hhc0RlcHRoID8gJ1tEZXB0aF0nIDogJyd9YCArXG4gICAgICAgICAgICAgICAgICAgIGAke2hhc1N0ZW5jaWwgPyAnW1N0ZW5jaWxdJyA6ICcnfWAgK1xuICAgICAgICAgICAgICAgICAgICBgJHsocmVuZGVyUGFzcy5zYW1wbGVzID4gMCA/ICcgc2FtcGxlczogJyArIHJlbmRlclBhc3Muc2FtcGxlcyA6ICcnKX1gO1xuXG4gICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRF9SRU5ERVJfUEFTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHtpbmRleC50b1N0cmluZygpLnBhZEVuZCgyLCAnICcpfTogJHtyZW5kZXJQYXNzLm5hbWUucGFkRW5kKDIwLCAnICcpfWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ0LnBhZEVuZCgzMCkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlbmRlclBhc3MuY29sb3JPcHMgJiYgaGFzQ29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRF9SRU5ERVJfUEFTU19ERVRBSUwsIGAgICAgY29sb3JPcHM6IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHtyZW5kZXJQYXNzLmNvbG9yT3BzLmNsZWFyID8gJ2NsZWFyJyA6ICdsb2FkJ30tPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHtyZW5kZXJQYXNzLmNvbG9yT3BzLnN0b3JlID8gJ3N0b3JlJyA6ICdkaXNjYXJkJ30gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3JlbmRlclBhc3MuY29sb3JPcHMucmVzb2x2ZSA/ICdyZXNvbHZlICcgOiAnJ31gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7cmVuZGVyUGFzcy5jb2xvck9wcy5taXBtYXBzID8gJ21pcG1hcHMgJyA6ICcnfWApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyZW5kZXJQYXNzLmRlcHRoU3RlbmNpbE9wcykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNEZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRF9SRU5ERVJfUEFTU19ERVRBSUwsIGAgICAgZGVwdGhPcHM6IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7cmVuZGVyUGFzcy5kZXB0aFN0ZW5jaWxPcHMuY2xlYXJEZXB0aCA/ICdjbGVhcicgOiAnbG9hZCd9LT5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3JlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLnN0b3JlRGVwdGggPyAnc3RvcmUnIDogJ2Rpc2NhcmQnfWApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1N0ZW5jaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSURfUkVOREVSX1BBU1NfREVUQUlMLCBgICAgIHN0ZW5jT3BzOiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3JlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLmNsZWFyU3RlbmNpbCA/ICdjbGVhcicgOiAnbG9hZCd9LT5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAke3JlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLnN0b3JlU3RlbmNpbCA/ICdzdG9yZScgOiAnZGlzY2FyZCd9YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyAjZW5kaWZcbiAgICB9XG59XG5cbmV4cG9ydCB7IEZyYW1lR3JhcGggfTtcbiJdLCJuYW1lcyI6WyJGcmFtZUdyYXBoIiwicmVuZGVyUGFzc2VzIiwicmVuZGVyVGFyZ2V0TWFwIiwiTWFwIiwiYWRkUmVuZGVyUGFzcyIsInJlbmRlclBhc3MiLCJwdXNoIiwicmVzZXQiLCJsZW5ndGgiLCJjb21waWxlIiwiaSIsInJlbmRlclRhcmdldCIsInVuZGVmaW5lZCIsInByZXZQYXNzIiwiZ2V0IiwiY29sb3JPcHMiLCJjbGVhciIsInN0b3JlIiwiZGVwdGhTdGVuY2lsT3BzIiwiY2xlYXJEZXB0aCIsInN0b3JlRGVwdGgiLCJjbGVhclN0ZW5jaWwiLCJzdG9yZVN0ZW5jaWwiLCJzZXQiLCJsYXN0Q3ViZVRleHR1cmUiLCJsYXN0Q3ViZVJlbmRlclBhc3MiLCJ0aGlzVGV4dHVyZSIsImNvbG9yQnVmZmVyIiwiY3ViZW1hcCIsIm1pcG1hcHMiLCJyZXF1aXJlc0N1YmVtYXBzIiwiZm9yRWFjaCIsInJlc29sdmUiLCJsb2ciLCJyZW5kZXIiLCJUcmFjaW5nIiwiVFJBQ0VJRF9SRU5ERVJfUEFTUyIsIlRSQUNFSURfUkVOREVSX1BBU1NfREVUQUlMIiwiaW5kZXgiLCJoYXNDb2xvciIsImhhc0RlcHRoIiwiZGVwdGgiLCJoYXNTdGVuY2lsIiwic3RlbmNpbCIsInJ0IiwibmFtZSIsInNhbXBsZXMiLCJEZWJ1ZyIsInRyYWNlIiwidG9TdHJpbmciLCJwYWRFbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVNBLE1BQU1BLFVBQVUsQ0FBQztBQUFBLEVBQUEsV0FBQSxHQUFBO0lBQUEsSUFFYkMsQ0FBQUEsWUFBWSxHQUFHLEVBQUUsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQU9qQkMsZUFBZSxHQUFHLElBQUlDLEdBQUcsRUFBRSxDQUFBO0FBQUEsR0FBQTtFQVEzQkMsYUFBYSxDQUFDQyxVQUFVLEVBQUU7QUFDdEIsSUFBQSxJQUFJLENBQUNKLFlBQVksQ0FBQ0ssSUFBSSxDQUFDRCxVQUFVLENBQUMsQ0FBQTtBQUN0QyxHQUFBO0FBRUFFLEVBQUFBLEtBQUssR0FBRztBQUNKLElBQUEsSUFBSSxDQUFDTixZQUFZLENBQUNPLE1BQU0sR0FBRyxDQUFDLENBQUE7QUFDaEMsR0FBQTtBQUVBQyxFQUFBQSxPQUFPLEdBQUc7QUFFTixJQUFBLE1BQU1QLGVBQWUsR0FBRyxJQUFJLENBQUNBLGVBQWUs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
