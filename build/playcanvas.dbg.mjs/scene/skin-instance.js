/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { math } from '../math/math.js';
import { Mat4 } from '../math/mat4.js';
import { PIXELFORMAT_RGBA32F, FILTER_NEAREST } from '../graphics/constants.js';
import { Texture } from '../graphics/texture.js';

const _invMatrix = new Mat4();

class SkinInstance {
  constructor(skin) {
    this.bones = void 0;
    this._dirty = true;
    this._rootBone = null;
    this._skinUpdateIndex = -1;
    this._updateBeforeCull = true;

    if (skin) {
      this.initSkin(skin);
    }
  }

  set rootBone(rootBone) {
    this._rootBone = rootBone;
  }

  get rootBone() {
    return this._rootBone;
  }

  init(device, numBones) {
    if (device.supportsBoneTextures) {
      const numPixels = numBones * 3;
      let width = Math.ceil(Math.sqrt(numPixels));
      width = math.roundUp(width, 3);
      const height = Math.ceil(numPixels / width);
      this.boneTexture = new Texture(device, {
        width: width,
        height: height,
        format: PIXELFORMAT_RGBA32F,
        mipmaps: false,
        minFilter: FILTER_NEAREST,
        magFilter: FILTER_NEAREST,
        name: 'skin'
      });
      this.matrixPalette = this.boneTexture.lock();
    } else {
      this.matrixPalette = new Float32Array(numBones * 12);
    }
  }

  destroy() {
    if (this.boneTexture) {
      this.boneTexture.destroy();
      this.boneTexture = null;
    }
  }

  resolve(rootBone, entity) {
    this.rootBone = rootBone;
    const skin = this.skin;
    const bones = [];

    for (let j = 0; j < skin.boneNames.length; j++) {
      const boneName = skin.boneNames[j];
      let bone = rootBone.findByName(boneName);

      if (!bone) {
        Debug.error(`Failed to find bone [${boneName}] in the entity hierarchy, RenderComponent on ${entity.name}, rootBone: ${rootBone.name}`);
        bone = entity;
      }

      bones.push(bone);
    }

    this.bones = bones;
  }

  initSkin(skin) {
    this.skin = skin;
    this.bones = [];
    const numBones = skin.inverseBindPose.length;
    this.init(skin.device, numBones);
    this.matrices = [];

    for (let i = 0; i < numBones; i++) {
      this.matrices[i] = new Mat4();
    }
  }

  uploadBones(device) {
    if (device.supportsBoneTextures) {
      this.boneTexture.lock();
      this.boneTexture.unlock();
    }
  }

  _updateMatrices(rootNode, skinUpdateIndex) {
    if (this._skinUpdateIndex !== skinUpdateIndex) {
      this._skinUpdateIndex = skinUpdateIndex;

      _invMatrix.copy(rootNode.getWorldTransform()).invert();

      for (let i = this.bones.length - 1; i >= 0; i--) {
        this.matrices[i].mulAffine2(_invMatrix, this.bones[i].getWorldTransform());
        this.matrices[i].mulAffine2(this.matrices[i], this.skin.inverseBindPose[i]);
      }
    }
  }

  updateMatrices(rootNode, skinUpdateIndex) {
    if (this._updateBeforeCull) {
      this._updateMatrices(rootNode, skinUpdateIndex);
    }
  }

  updateMatrixPalette(rootNode, skinUpdateIndex) {
    this._updateMatrices(rootNode, skinUpdateIndex);

    const mp = this.matrixPalette;
    const count = this.bones.length;

    for (let i = 0; i < count; i++) {
      const pe = this.matrices[i].data;
      const base = i * 12;
      mp[base] = pe[0];
      mp[base + 1] = pe[4];
      mp[base + 2] = pe[8];
      mp[base + 3] = pe[12];
      mp[base + 4] = pe[1];
      mp[base + 5] = pe[5];
      mp[base + 6] = pe[9];
      mp[base + 7] = pe[13];
      mp[base + 8] = pe[2];
      mp[base + 9] = pe[6];
      mp[base + 10] = pe[10];
      mp[base + 11] = pe[14];
    }

    this.uploadBones(this.skin.device);
  }

}

export { SkinInstance };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tpbi1pbnN0YW5jZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3NjZW5lL3NraW4taW5zdGFuY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IG1hdGggfSBmcm9tICcuLi9tYXRoL21hdGguanMnO1xuaW1wb3J0IHsgTWF0NCB9IGZyb20gJy4uL21hdGgvbWF0NC5qcyc7XG5cbmltcG9ydCB7IEZJTFRFUl9ORUFSRVNULCBQSVhFTEZPUk1BVF9SR0JBMzJGIH0gZnJvbSAnLi4vZ3JhcGhpY3MvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi9ncmFwaGljcy90ZXh0dXJlLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vZ3JhcGgtbm9kZS5qcycpLkdyYXBoTm9kZX0gR3JhcGhOb2RlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9za2luLmpzJykuU2tpbn0gU2tpbiAqL1xuXG5jb25zdCBfaW52TWF0cml4ID0gbmV3IE1hdDQoKTtcblxuLyoqXG4gKiBBIHNraW4gaW5zdGFuY2UgaXMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgdGhlIG1hdHJpeCBwYWxldHRlIHRoYXQgaXMgdXNlZCB0byBza2luIHZlcnRpY2VzXG4gKiBmcm9tIG9iamVjdCBzcGFjZSB0byB3b3JsZCBzcGFjZS5cbiAqL1xuY2xhc3MgU2tpbkluc3RhbmNlIHtcbiAgICAvKipcbiAgICAgKiBBbiBhcnJheSBvZiBub2RlcyByZXByZXNlbnRpbmcgZWFjaCBib25lIGluIHRoaXMgc2tpbiBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtHcmFwaE5vZGVbXX1cbiAgICAgKi9cbiAgICBib25lcztcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBTa2luSW5zdGFuY2UgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NraW59IHNraW4gLSBUaGUgc2tpbiB0aGF0IHdpbGwgcHJvdmlkZSB0aGUgaW52ZXJzZSBiaW5kIHBvc2UgbWF0cmljZXMgdG8gZ2VuZXJhdGVcbiAgICAgKiB0aGUgZmluYWwgbWF0cml4IHBhbGV0dGUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc2tpbikge1xuICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG5cbiAgICAgICAgLy8gb3B0aW9uYWwgcm9vdCBib25lIC0gdXNlZCBmb3IgY2FjaGUgbG9va3VwLCBub3QgdXNlZCBmb3Igc2tpbm5pbmdcbiAgICAgICAgdGhpcy5fcm9vdEJvbmUgPSBudWxsO1xuXG4gICAgICAgIC8vIHNlcXVlbnRpYWwgaW5kZXggb2Ygd2hlbiB0aGUgYm9uZSB1cGRhdGUgd2FzIHBlcmZvcm1lZCB0aGUgbGFzdCB0aW1lXG4gICAgICAgIHRoaXMuX3NraW5VcGRhdGVJbmRleCA9IC0xO1xuXG4gICAgICAgIC8vIHRydWUgaWYgYm9uZXMgbmVlZCB0byBiZSB1cGRhdGVkIGJlZm9yZSB0aGUgZnJ1c3R1bSBjdWxsaW5nIChib25lcyBhcmUgbmVlZGVkIHRvIHVwZGF0ZSBib3VuZHMgb2YgdGhlIE1lc2hJbnN0YW5jZSlcbiAgICAgICAgdGhpcy5fdXBkYXRlQmVmb3JlQ3VsbCA9IHRydWU7XG5cbiAgICAgICAgaWYgKHNraW4pIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdFNraW4oc2tpbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXQgcm9vdEJvbmUocm9vdEJvbmUpIHtcbiAgICAgICAgdGhpcy5fcm9vdEJvbmUgPSByb290Qm9uZTtcbiAgICB9XG5cbiAgICBnZXQgcm9vdEJvbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yb290Qm9uZTtcbiAgICB9XG5cbiAgICBpbml0KGRldmljZSwgbnVtQm9uZXMpIHtcblxuICAgICAgICBpZiAoZGV2aWNlLnN1cHBvcnRzQm9uZVRleHR1cmVzKSB7XG5cbiAgICAgICAgICAgIC8vIHRleHR1cmUgc2l6ZSAtIHJvdWdobHkgc3F1YXJlIHRoYXQgZml0cyBhbGwgYm9uZXMsIHdpZHRoIGlzIG11bHRpcGx5IG9mIDMgdG8gc2ltcGxpZnkgc2hhZGVyIG1hdGhcbiAgICAgICAgICAgIGNvbnN0IG51bVBpeGVscyA9IG51bUJvbmVzICogMztcbiAgICAgICAgICAgIGxldCB3aWR0aCA9IE1hdGguY2VpbChNYXRoLnNxcnQobnVtUGl4ZWxzKSk7XG4gICAgICAgICAgICB3aWR0aCA9IG1hdGgucm91bmRVcCh3aWR0aCwgMyk7XG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLmNlaWwobnVtUGl4ZWxzIC8gd2lkdGgpO1xuXG4gICAgICAgICAgICB0aGlzLmJvbmVUZXh0dXJlID0gbmV3IFRleHR1cmUoZGV2aWNlLCB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgICAgIGZvcm1hdDogUElYRUxGT1JNQVRfUkdCQTMyRixcbiAgICAgICAgICAgICAgICBtaXBtYXBzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtaW5GaWx0ZXI6IEZJTFRFUl9ORUFSRVNULFxuICAgICAgICAgICAgICAgIG1hZ0ZpbHRlcjogRklMVEVSX05FQVJFU1QsXG4gICAgICAgICAgICAgICAgbmFtZTogJ3NraW4nXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5tYXRyaXhQYWxldHRlID0gdGhpcy5ib25lVGV4dHVyZS5sb2NrKCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWF0cml4UGFsZXR0ZSA9IG5ldyBGbG9hdDMyQXJyYXkobnVtQm9uZXMgKiAxMik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkZXN0cm95KCkge1xuXG4gICAgICAgIGlmICh0aGlzLmJvbmVUZXh0dXJlKSB7XG4gICAgICAgICAgICB0aGlzLmJvbmVUZXh0dXJlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuYm9uZVRleHR1cmUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gcmVzb2x2ZWQgc2tpbiBib25lcyB0byBhIGhpZXJhcmNoeSB3aXRoIHRoZSByb290Qm9uZSBhdCBpdHMgcm9vdC5cbiAgICAvLyBlbnRpdHkgcGFyYW1ldGVyIHNwZWNpZmllcyB0aGUgZW50aXR5IHVzZWQgaWYgdGhlIGJvbmUgbWF0Y2ggaXMgbm90IGZvdW5kIGluIHRoZSBoaWVyYXJjaHkgLSB1c3VhbGx5IHRoZSBlbnRpdHkgdGhlIHJlbmRlciBjb21wb25lbnQgaXMgYXR0YWNoZWQgdG9cbiAgICByZXNvbHZlKHJvb3RCb25lLCBlbnRpdHkpIHtcblxuICAgICAgICB0aGlzLnJvb3RCb25lID0gcm9vdEJvbmU7XG5cbiAgICAgICAgLy8gUmVzb2x2ZSBib25lIElEcyB0byBhY3R1YWwgZ3JhcGggbm9kZXMgb2YgdGhlIGhpZXJhcmNoeVxuICAgICAgICBjb25zdCBza2luID0gdGhpcy5za2luO1xuICAgICAgICBjb25zdCBib25lcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNraW4uYm9uZU5hbWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCBib25lTmFtZSA9IHNraW4uYm9uZU5hbWVzW2pdO1xuICAgICAgICAgICAgbGV0IGJvbmUgPSByb290Qm9uZS5maW5kQnlOYW1lKGJvbmVOYW1lKTtcblxuICAgICAgICAgICAgaWYgKCFib25lKSB7XG4gICAgICAgICAgICAgICAgRGVidWcuZXJyb3IoYEZhaWxlZCB0byBmaW5kIGJvbmUgWyR7Ym9uZU5hbWV9XSBpbiB0aGUgZW50aXR5IGhpZXJhcmNoeSwgUmVuZGVyQ29tcG9uZW50IG9uICR7ZW50aXR5Lm5hbWV9LCByb290Qm9uZTogJHtyb290Qm9uZS5uYW1lfWApO1xuICAgICAgICAgICAgICAgIGJvbmUgPSBlbnRpdHk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJvbmVzLnB1c2goYm9uZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib25lcyA9IGJvbmVzO1xuICAgIH1cblxuICAgIGluaXRTa2luKHNraW4pIHtcblxuICAgICAgICB0aGlzLnNraW4gPSBza2luO1xuXG4gICAgICAgIC8vIFVuaXF1ZSBwZXIgY2xvbmVcbiAgICAgICAgdGhpcy5ib25lcyA9IFtdO1xuXG4gICAgICAgIGNvbnN0IG51bUJvbmVzID0gc2tpbi5pbnZlcnNlQmluZFBvc2UubGVuZ3RoO1xuICAgICAgICB0aGlzLmluaXQoc2tpbi5kZXZpY2UsIG51bUJvbmVzKTtcblxuICAgICAgICB0aGlzLm1hdHJpY2VzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtQm9uZXM7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5tYXRyaWNlc1tpXSA9IG5ldyBNYXQ0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGxvYWRCb25lcyhkZXZpY2UpIHtcblxuICAgICAgICAvLyBUT0RPOiB0aGlzIGlzIGEgYml0IHN0cmFuZ2UgbG9va2luZy4gQ2hhbmdlIHRoZSBUZXh0dXJlIEFQSSB0byBkbyBhIHJldXBsb2FkXG4gICAgICAgIGlmIChkZXZpY2Uuc3VwcG9ydHNCb25lVGV4dHVyZXMpIHtcbiAgICAgICAgICAgIHRoaXMuYm9uZVRleHR1cmUubG9jaygpO1xuICAgICAgICAgICAgdGhpcy5ib25lVGV4dHVyZS51bmxvY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF91cGRhdGVNYXRyaWNlcyhyb290Tm9kZSwgc2tpblVwZGF0ZUluZGV4KSB7XG5cbiAgICAgICAgLy8gaWYgbm90IGFscmVhZHkgdXAgdG8gZGF0ZVxuICAgICAgICBpZiAodGhpcy5fc2tpblVwZGF0ZUluZGV4ICE9PSBza2luVXBkYXRlSW5kZXgpIHtcbiAgICAgICAgICAgIHRoaXMuX3NraW5VcGRhdGVJbmRleCA9IHNraW5VcGRhdGVJbmRleDtcblxuICAgICAgICAgICAgX2ludk1hdHJpeC5jb3B5KHJvb3ROb2RlLmdldFdvcmxkVHJhbnNmb3JtKCkpLmludmVydCgpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuYm9uZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hdHJpY2VzW2ldLm11bEFmZmluZTIoX2ludk1hdHJpeCwgdGhpcy5ib25lc1tpXS5nZXRXb3JsZFRyYW5zZm9ybSgpKTsgLy8gd29ybGQgc3BhY2UgLT4gcm9vdE5vZGUgc3BhY2VcbiAgICAgICAgICAgICAgICB0aGlzLm1hdHJpY2VzW2ldLm11bEFmZmluZTIodGhpcy5tYXRyaWNlc1tpXSwgdGhpcy5za2luLmludmVyc2VCaW5kUG9zZVtpXSk7IC8vIHJvb3ROb2RlIHNwYWNlIC0+IGJpbmQgc3BhY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZU1hdHJpY2VzKHJvb3ROb2RlLCBza2luVXBkYXRlSW5kZXgpIHtcblxuICAgICAgICBpZiAodGhpcy5fdXBkYXRlQmVmb3JlQ3VsbCkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlTWF0cmljZXMocm9vdE5vZGUsIHNraW5VcGRhdGVJbmRleCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGVNYXRyaXhQYWxldHRlKHJvb3ROb2RlLCBza2luVXBkYXRlSW5kZXgpIHtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgbWF0cmljZXMgYXJlIHVwIHRvIGRhdGVcbiAgICAgICAgdGhpcy5fdXBkYXRlTWF0cmljZXMocm9vdE5vZGUsIHNraW5VcGRhdGVJbmRleCk7XG5cbiAgICAgICAgLy8gY29weSBtYXRyaWNlcyB0byBwYWxldHRlXG4gICAgICAgIGNvbnN0IG1wID0gdGhpcy5tYXRyaXhQYWxldHRlO1xuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuYm9uZXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHBlID0gdGhpcy5tYXRyaWNlc1tpXS5kYXRhO1xuXG4gICAgICAgICAgICAvLyBDb3B5IHRoZSBtYXRyaXggaW50byB0aGUgcGFsZXR0ZSwgcmVhZHkgdG8gYmUgc2VudCB0byB0aGUgdmVydGV4IHNoYWRlciwgdHJhbnNwb3NlIG1hdHJpeCBmcm9tIDR4NCB0byA0eDMgZm9ybWF0IGFzIHdlbGxcbiAgICAgICAgICAgIGNvbnN0IGJhc2UgPSBpICogMTI7XG4gICAgICAgICAgICBtcFtiYXNlXSA9IHBlWzBdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDFdID0gcGVbNF07XG4gICAgICAgICAgICBtcFtiYXNlICsgMl0gPSBwZVs4XTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyAzXSA9IHBlWzEyXTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyA0XSA9IHBlWzFdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDVdID0gcGVbNV07XG4gICAgICAgICAgICBtcFtiYXNlICsgNl0gPSBwZVs5XTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyA3XSA9IHBlWzEzXTtcbiAgICAgICAgICAgIG1wW2Jhc2UgKyA4XSA9IHBlWzJdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDldID0gcGVbNl07XG4gICAgICAgICAgICBtcFtiYXNlICsgMTBdID0gcGVbMTBdO1xuICAgICAgICAgICAgbXBbYmFzZSArIDExXSA9IHBlWzE0XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBsb2FkQm9uZXModGhpcy5za2luLmRldmljZSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTa2luSW5zdGFuY2UgfTtcbiJdLCJuYW1lcyI6WyJfaW52TWF0cml4IiwiTWF0NCIsIlNraW5JbnN0YW5jZSIsImNvbnN0cnVjdG9yIiwic2tpbiIsImJvbmVzIiwiX2RpcnR5IiwiX3Jvb3RCb25lIiwiX3NraW5VcGRhdGVJbmRleCIsIl91cGRhdGVCZWZvcmVDdWxsIiwiaW5pdFNraW4iLCJyb290Qm9uZSIsImluaXQiLCJkZXZpY2UiLCJudW1Cb25lcyIsInN1cHBvcnRzQm9uZVRleHR1cmVzIiwibnVtUGl4ZWxzIiwid2lkdGgiLCJNYXRoIiwiY2VpbCIsInNxcnQiLCJtYXRoIiwicm91bmRVcCIsImhlaWdodCIsImJvbmVUZXh0dXJlIiwiVGV4dHVyZSIsImZvcm1hdCIsIlBJWEVMRk9STUFUX1JHQkEzMkYiLCJtaXBtYXBzIiwibWluRmlsdGVyIiwiRklMVEVSX05FQVJFU1QiLCJtYWdGaWx0ZXIiLCJuYW1lIiwibWF0cml4UGFsZXR0ZSIsImxvY2siLCJGbG9hdDMyQXJyYXkiLCJkZXN0cm95IiwicmVzb2x2ZSIsImVudGl0eSIsImoiLCJib25lTmFtZXMiLCJsZW5ndGgiLCJib25lTmFtZSIsImJvbmUiLCJmaW5kQnlOYW1lIiwiRGVidWciLCJlcnJvciIsInB1c2giLCJpbnZlcnNlQmluZFBvc2UiLCJtYXRyaWNlcyIsImkiLCJ1cGxvYWRCb25lcyIsInVubG9jayIsIl91cGRhdGVNYXRyaWNlcyIsInJvb3ROb2RlIiwic2tpblVwZGF0ZUluZGV4IiwiY29weSIsImdldFdvcmxkVHJhbnNmb3JtIiwiaW52ZXJ0IiwibXVsQWZmaW5lMiIsInVwZGF0ZU1hdHJpY2VzIiwidXBkYXRlTWF0cml4UGFsZXR0ZSIsIm1wIiwiY291bnQiLCJwZSIsImRhdGEiLCJiYXNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQVVBLE1BQU1BLFVBQVUsR0FBRyxJQUFJQyxJQUFKLEVBQW5CLENBQUE7O0FBTUEsTUFBTUMsWUFBTixDQUFtQjtFQWNmQyxXQUFXLENBQUNDLElBQUQsRUFBTztBQUFBLElBQUEsSUFBQSxDQVJsQkMsS0FRa0IsR0FBQSxLQUFBLENBQUEsQ0FBQTtJQUNkLElBQUtDLENBQUFBLE1BQUwsR0FBYyxJQUFkLENBQUE7SUFHQSxJQUFLQyxDQUFBQSxTQUFMLEdBQWlCLElBQWpCLENBQUE7SUFHQSxJQUFLQyxDQUFBQSxnQkFBTCxHQUF3QixDQUFDLENBQXpCLENBQUE7SUFHQSxJQUFLQyxDQUFBQSxpQkFBTCxHQUF5QixJQUF6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
