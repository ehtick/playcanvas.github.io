/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../../core/event-handler.js';
import { Color } from '../../math/color.js';
import { Vec2 } from '../../math/vec2.js';
import { Vec3 } from '../../math/vec3.js';
import { Vec4 } from '../../math/vec4.js';

class ComponentSystem extends EventHandler {
  constructor(app) {
    super();
    this.app = app;
    this.store = {};
    this.schema = [];
  }

  addComponent(entity, data = {}) {
    const component = new this.ComponentType(this, entity);
    const componentData = new this.DataType();
    this.store[entity.getGuid()] = {
      entity: entity,
      data: componentData
    };
    entity[this.id] = component;
    entity.c[this.id] = component;
    this.initializeComponentData(component, data, []);
    this.fire('add', entity, component);
    return component;
  }

  removeComponent(entity) {
    const record = this.store[entity.getGuid()];
    const component = entity.c[this.id];
    this.fire('beforeremove', entity, component);
    delete this.store[entity.getGuid()];
    entity[this.id] = undefined;
    delete entity.c[this.id];
    this.fire('remove', entity, record.data);
  }

  cloneComponent(entity, clone) {
    const src = this.store[entity.getGuid()];
    return this.addComponent(clone, src.data);
  }

  initializeComponentData(component, data = {}, properties) {
    for (let i = 0, len = properties.length; i < len; i++) {
      const descriptor = properties[i];
      let name, type;

      if (typeof descriptor === 'object') {
        name = descriptor.name;
        type = descriptor.type;
      } else {
        name = descriptor;
        type = undefined;
      }

      let value = data[name];

      if (value !== undefined) {
        if (type !== undefined) {
          value = convertValue(value, type);
        }

        component[name] = value;
      } else {
        component[name] = component.data[name];
      }
    }

    if (component.enabled && component.entity.enabled) {
      component.onEnable();
    }
  }

  getPropertiesOfType(type) {
    const matchingProperties = [];
    const schema = this.schema || [];
    schema.forEach(function (descriptor) {
      if (descriptor && typeof descriptor === 'object' && descriptor.type === type) {
        matchingProperties.push(descriptor);
      }
    });
    return matchingProperties;
  }

  destroy() {
    this.off();
  }

}

function convertValue(value, type) {
  if (!value) {
    return value;
  }

  switch (type) {
    case 'rgb':
      if (value instanceof Color) {
        return value.clone();
      }

      return new Color(value[0], value[1], value[2]);

    case 'rgba':
      if (value instanceof Color) {
        return value.clone();
      }

      return new Color(value[0], value[1], value[2], value[3]);

    case 'vec2':
      if (value instanceof Vec2) {
        return value.clone();
      }

      return new Vec2(value[0], value[1]);

    case 'vec3':
      if (value instanceof Vec3) {
        return value.clone();
      }

      return new Vec3(value[0], value[1], value[2]);

    case 'vec4':
      if (value instanceof Vec4) {
        return value.clone();
      }

      return new Vec4(value[0], value[1], value[2], value[3]);

    case 'boolean':
    case 'number':
    case 'string':
      return value;

    case 'entity':
      return value;

    default:
      throw new Error('Could not convert unhandled type: ' + type);
  }
}

export { ComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc3lzdGVtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uLy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5cbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vLi4vbWF0aC9jb2xvci5qcyc7XG5pbXBvcnQgeyBWZWMyIH0gZnJvbSAnLi4vLi4vbWF0aC92ZWMyLmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi9tYXRoL3ZlYzMuanMnO1xuaW1wb3J0IHsgVmVjNCB9IGZyb20gJy4uLy4uL21hdGgvdmVjNC5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IEFwcEJhc2UgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudC5qcycpLkNvbXBvbmVudH0gQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vZW50aXR5LmpzJykuRW50aXR5fSBFbnRpdHkgKi9cblxuLyoqXG4gKiBDb21wb25lbnQgU3lzdGVtcyBjb250YWluIHRoZSBsb2dpYyBhbmQgZnVuY3Rpb25hbGl0eSB0byB1cGRhdGUgYWxsIENvbXBvbmVudHMgb2YgYSBwYXJ0aWN1bGFyXG4gKiB0eXBlLlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ29tcG9uZW50U3lzdGVtIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcHBCYXNlfSBhcHAgLSBUaGUgYXBwbGljYXRpb24gbWFuYWdpbmcgdGhpcyBzeXN0ZW0uXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG5cbiAgICAgICAgLy8gVGhlIHN0b3JlIHdoZXJlIGFsbCBDb21wb25lbnREYXRhIG9iamVjdHMgYXJlIGtlcHRcbiAgICAgICAgdGhpcy5zdG9yZSA9IHt9O1xuICAgICAgICB0aGlzLnNjaGVtYSA9IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBuZXcge0BsaW5rIENvbXBvbmVudH0gYW5kIGNvbXBvbmVudCBkYXRhIGluc3RhbmNlcyBhbmQgYXR0YWNoIHRoZW0gdG8gdGhlIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RW50aXR5fSBlbnRpdHkgLSBUaGUgRW50aXR5IHRvIGF0dGFjaCB0aGlzIGNvbXBvbmVudCB0by5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIC0gVGhlIHNvdXJjZSBkYXRhIHdpdGggd2hpY2ggdG8gY3JlYXRlIHRoZSBjb21wb25lbnQuXG4gICAgICogQHJldHVybnMge0NvbXBvbmVudH0gUmV0dXJucyBhIENvbXBvbmVudCBvZiB0eXBlIGRlZmluZWQgYnkgdGhlIGNvbXBvbmVudCBzeXN0ZW0uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgZW50aXR5ID0gbmV3IHBjLkVudGl0eShhcHApO1xuICAgICAqIGFwcC5zeXN0ZW1zLm1vZGVsLmFkZENvbXBvbmVudChlbnRpdHksIHsgdHlwZTogJ2JveCcgfSk7XG4gICAgICogLy8gZW50aXR5Lm1vZGVsIGlzIG5vdyBzZXQgdG8gYSBwYy5Nb2RlbENvbXBvbmVudFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBhZGRDb21wb25lbnQoZW50aXR5LCBkYXRhID0ge30pIHtcbiAgICAgICAgY29uc3QgY29tcG9uZW50ID0gbmV3IHRoaXMuQ29tcG9uZW50VHlwZSh0aGlzLCBlbnRpdHkpO1xuICAgICAgICBjb25zdCBjb21wb25lbnREYXRhID0gbmV3IHRoaXMuRGF0YVR5cGUoKTtcblxuICAgICAgICB0aGlzLnN0b3JlW2VudGl0eS5nZXRHdWlkKCldID0ge1xuICAgICAgICAgICAgZW50aXR5OiBlbnRpdHksXG4gICAgICAgICAgICBkYXRhOiBjb21wb25lbnREYXRhXG4gICAgICAgIH07XG5cbiAgICAgICAgZW50aXR5W3RoaXMuaWRdID0gY29tcG9uZW50O1xuICAgICAgICBlbnRpdHkuY1t0aGlzLmlkXSA9IGNvbXBvbmVudDtcblxuICAgICAgICB0aGlzLmluaXRpYWxpemVDb21wb25lbnREYXRhKGNvbXBvbmVudCwgZGF0YSwgW10pO1xuXG4gICAgICAgIHRoaXMuZmlyZSgnYWRkJywgZW50aXR5LCBjb21wb25lbnQpO1xuXG4gICAgICAgIHJldHVybiBjb21wb25lbnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHRoZSB7QGxpbmsgQ29tcG9uZW50fSBmcm9tIHRoZSBlbnRpdHkgYW5kIGRlbGV0ZSB0aGUgYXNzb2NpYXRlZCBjb21wb25lbnQgZGF0YS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RW50aXR5fSBlbnRpdHkgLSBUaGUgZW50aXR5IHRvIHJlbW92ZSB0aGUgY29tcG9uZW50IGZyb20uXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBhcHAuc3lzdGVtcy5tb2RlbC5yZW1vdmVDb21wb25lbnQoZW50aXR5KTtcbiAgICAgKiAvLyBlbnRpdHkubW9kZWwgPT09IHVuZGVmaW5lZFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICByZW1vdmVDb21wb25lbnQoZW50aXR5KSB7XG4gICAgICAgIGNvbnN0IHJlY29yZCA9IHRoaXMuc3RvcmVbZW50aXR5LmdldEd1aWQoKV07XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGVudGl0eS5jW3RoaXMuaWRdO1xuXG4gICAgICAgIHRoaXMuZmlyZSgnYmVmb3JlcmVtb3ZlJywgZW50aXR5LCBjb21wb25lbnQpO1xuXG4gICAgICAgIGRlbGV0ZSB0aGlzLnN0b3JlW2VudGl0eS5nZXRHdWlkKCldO1xuXG4gICAgICAgIGVudGl0eVt0aGlzLmlkXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgZGVsZXRlIGVudGl0eS5jW3RoaXMuaWRdO1xuXG4gICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlJywgZW50aXR5LCByZWNvcmQuZGF0YSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgY2xvbmUgb2YgY29tcG9uZW50LiBUaGlzIGNyZWF0ZXMgYSBjb3B5IG9mIGFsbCBjb21wb25lbnQgZGF0YSB2YXJpYWJsZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VudGl0eX0gZW50aXR5IC0gVGhlIGVudGl0eSB0byBjbG9uZSB0aGUgY29tcG9uZW50IGZyb20uXG4gICAgICogQHBhcmFtIHtFbnRpdHl9IGNsb25lIC0gVGhlIGVudGl0eSB0byBjbG9uZSB0aGUgY29tcG9uZW50IGludG8uXG4gICAgICogQHJldHVybnMge0NvbXBvbmVudH0gVGhlIG5ld2x5IGNsb25lZCBjb21wb25lbnQuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNsb25lQ29tcG9uZW50KGVudGl0eSwgY2xvbmUpIHtcbiAgICAgICAgLy8gZGVmYXVsdCBjbG9uZSBpcyBqdXN0IHRvIGFkZCBhIG5ldyBjb21wb25lbnQgd2l0aCBleGlzdGluZyBkYXRhXG4gICAgICAgIGNvbnN0IHNyYyA9IHRoaXMuc3RvcmVbZW50aXR5LmdldEd1aWQoKV07XG4gICAgICAgIHJldHVybiB0aGlzLmFkZENvbXBvbmVudChjbG9uZSwgc3JjLmRhdGEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxlZCBkdXJpbmcge0BsaW5rIENvbXBvbmVudFN5c3RlbSNhZGRDb21wb25lbnR9IHRvIGluaXRpYWxpemUgdGhlIGNvbXBvbmVudCBkYXRhIGluIHRoZVxuICAgICAqIHN0b3JlLiBUaGlzIGNhbiBiZSBvdmVycmlkZGVuIGJ5IGRlcml2ZWQgQ29tcG9uZW50IFN5c3RlbXMgYW5kIGVpdGhlciBjYWxsZWQgYnkgdGhlIGRlcml2ZWRcbiAgICAgKiBTeXN0ZW0gb3IgcmVwbGFjZWQgZW50aXJlbHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0NvbXBvbmVudH0gY29tcG9uZW50IC0gVGhlIGNvbXBvbmVudCBiZWluZyBpbml0aWFsaXplZC5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIFRoZSBkYXRhIGJsb2NrIHVzZWQgdG8gaW5pdGlhbGl6ZSB0aGUgY29tcG9uZW50LlxuICAgICAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nIHwge25hbWU6IHN0cmluZywgdHlwZTogc3RyaW5nfT59IHByb3BlcnRpZXMgLSBUaGUgYXJyYXkgb2YgcHJvcGVydHkgZGVzY3JpcHRvcnMgZm9yIHRoZSBjb21wb25lbnQuXG4gICAgICogQSBkZXNjcmlwdG9yIGNhbiBiZSBlaXRoZXIgYSBwbGFpbiBwcm9wZXJ0eSBuYW1lLCBvciBhbiBvYmplY3Qgc3BlY2lmeWluZyB0aGUgbmFtZSBhbmQgdHlwZS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhID0ge30sIHByb3BlcnRpZXMpIHtcbiAgICAgICAgLy8gaW5pdGlhbGl6ZVxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRvciA9IHByb3BlcnRpZXNbaV07XG4gICAgICAgICAgICBsZXQgbmFtZSwgdHlwZTtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIGRlc2NyaXB0b3IgaXMgYW4gb2JqZWN0LCBpdCB3aWxsIGhhdmUgYG5hbWVgIGFuZCBgdHlwZWAgbWVtYmVyc1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdG9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIG5hbWUgPSBkZXNjcmlwdG9yLm5hbWU7XG4gICAgICAgICAgICAgICAgdHlwZSA9IGRlc2NyaXB0b3IudHlwZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aGUgZGVzY3JpcHRvciBpcyBqdXN0IHRoZSBwcm9wZXJ0eSBuYW1lXG4gICAgICAgICAgICAgICAgbmFtZSA9IGRlc2NyaXB0b3I7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHZhbHVlID0gZGF0YVtuYW1lXTtcblxuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBrbm93IHRoZSBpbnRlbmRlZCB0eXBlIG9mIHRoZSB2YWx1ZSwgY29udmVydCB0aGUgcmF3IGRhdGFcbiAgICAgICAgICAgICAgICAvLyBpbnRvIGFuIGluc3RhbmNlIG9mIHRoZSBzcGVjaWZpZWQgdHlwZS5cbiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY29udmVydFZhbHVlKHZhbHVlLCB0eXBlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb21wb25lbnRbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50W25hbWVdID0gY29tcG9uZW50LmRhdGFbbmFtZV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhZnRlciBjb21wb25lbnQgaXMgaW5pdGlhbGl6ZWQgY2FsbCBvbkVuYWJsZVxuICAgICAgICBpZiAoY29tcG9uZW50LmVuYWJsZWQgJiYgY29tcG9uZW50LmVudGl0eS5lbmFibGVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQub25FbmFibGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaGVzIHRoZSBjb21wb25lbnQgc2NoZW1hIGZvciBwcm9wZXJ0aWVzIHRoYXQgbWF0Y2ggdGhlIHNwZWNpZmllZCB0eXBlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSB0byBzZWFyY2ggZm9yLlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmdbXXxvYmplY3RbXX0gQW4gYXJyYXkgb2YgcHJvcGVydHkgZGVzY3JpcHRvcnMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCB0eXBlLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBnZXRQcm9wZXJ0aWVzT2ZUeXBlKHR5cGUpIHtcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdQcm9wZXJ0aWVzID0gW107XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuc2NoZW1hIHx8IFtdO1xuXG4gICAgICAgIHNjaGVtYS5mb3JFYWNoKGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7XG4gICAgICAgICAgICBpZiAoZGVzY3JpcHRvciAmJiB0eXBlb2YgZGVzY3JpcHRvciA9PT0gJ29iamVjdCcgJiYgZGVzY3JpcHRvci50eXBlID09PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hpbmdQcm9wZXJ0aWVzLnB1c2goZGVzY3JpcHRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBtYXRjaGluZ1Byb3BlcnRpZXM7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vZmYoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRWYWx1ZSh2YWx1ZSwgdHlwZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdyZ2InOlxuICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQ29sb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IodmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVsyXSk7XG4gICAgICAgIGNhc2UgJ3JnYmEnOlxuICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQ29sb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IodmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVsyXSwgdmFsdWVbM10pO1xuICAgICAgICBjYXNlICd2ZWMyJzpcbiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFZlYzIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih2YWx1ZVswXSwgdmFsdWVbMV0pO1xuICAgICAgICBjYXNlICd2ZWMzJzpcbiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFZlYzMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMyh2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdKTtcbiAgICAgICAgY2FzZSAndmVjNCc6XG4gICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBWZWM0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmNsb25lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlYzQodmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVsyXSwgdmFsdWVbM10pO1xuICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgY2FzZSAnZW50aXR5JzpcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsgLy8gRW50aXR5IGZpZWxkcyBzaG91bGQganVzdCBiZSBhIHN0cmluZyBndWlkXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjb252ZXJ0IHVuaGFuZGxlZCB0eXBlOiAnICsgdHlwZSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBDb21wb25lbnRTeXN0ZW0gfTtcbiJdLCJuYW1lcyI6WyJDb21wb25lbnRTeXN0ZW0iLCJFdmVudEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsInN0b3JlIiwic2NoZW1hIiwiYWRkQ29tcG9uZW50IiwiZW50aXR5IiwiZGF0YSIsImNvbXBvbmVudCIsIkNvbXBvbmVudFR5cGUiLCJjb21wb25lbnREYXRhIiwiRGF0YVR5cGUiLCJnZXRHdWlkIiwiaWQiLCJjIiwiaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEiLCJmaXJlIiwicmVtb3ZlQ29tcG9uZW50IiwicmVjb3JkIiwidW5kZWZpbmVkIiwiY2xvbmVDb21wb25lbnQiLCJjbG9uZSIsInNyYyIsInByb3BlcnRpZXMiLCJpIiwibGVuIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsIm5hbWUiLCJ0eXBlIiwidmFsdWUiLCJjb252ZXJ0VmFsdWUiLCJlbmFibGVkIiwib25FbmFibGUiLCJnZXRQcm9wZXJ0aWVzT2ZUeXBlIiwibWF0Y2hpbmdQcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInB1c2giLCJkZXN0cm95Iiwib2ZmIiwiQ29sb3IiLCJWZWMyIiwiVmVjMyIsIlZlYzQiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkEsTUFBTUEsZUFBTixTQUE4QkMsWUFBOUIsQ0FBMkM7RUFNdkNDLFdBQVcsQ0FBQ0MsR0FBRCxFQUFNO0FBQ2IsSUFBQSxLQUFBLEVBQUEsQ0FBQTtJQUVBLElBQUtBLENBQUFBLEdBQUwsR0FBV0EsR0FBWCxDQUFBO0lBR0EsSUFBS0MsQ0FBQUEsS0FBTCxHQUFhLEVBQWIs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
