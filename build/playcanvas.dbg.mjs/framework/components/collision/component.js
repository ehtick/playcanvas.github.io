/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Asset } from '../../../asset/asset.js';
import { Component } from '../component.js';

class CollisionComponent extends Component {
  constructor(system, entity) {
    super(system, entity);
    this._compoundParent = null;
    this.entity.on('insert', this._onInsert, this);
    this.on('set_type', this.onSetType, this);
    this.on('set_halfExtents', this.onSetHalfExtents, this);
    this.on('set_radius', this.onSetRadius, this);
    this.on('set_height', this.onSetHeight, this);
    this.on('set_axis', this.onSetAxis, this);
    this.on('set_asset', this.onSetAsset, this);
    this.on('set_renderAsset', this.onSetRenderAsset, this);
    this.on('set_model', this.onSetModel, this);
    this.on('set_render', this.onSetRender, this);
  }

  onSetType(name, oldValue, newValue) {
    if (oldValue !== newValue) {
      this.system.changeType(this, oldValue, newValue);
    }
  }

  onSetHalfExtents(name, oldValue, newValue) {
    const t = this.data.type;

    if (this.data.initialized && t === 'box') {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetRadius(name, oldValue, newValue) {
    const t = this.data.type;

    if (this.data.initialized && (t === 'sphere' || t === 'capsule' || t === 'cylinder' || t === 'cone')) {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetHeight(name, oldValue, newValue) {
    const t = this.data.type;

    if (this.data.initialized && (t === 'capsule' || t === 'cylinder' || t === 'cone')) {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetAxis(name, oldValue, newValue) {
    const t = this.data.type;

    if (this.data.initialized && (t === 'capsule' || t === 'cylinder' || t === 'cone')) {
      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetAsset(name, oldValue, newValue) {
    const assets = this.system.app.assets;

    if (oldValue) {
      const asset = assets.get(oldValue);

      if (asset) {
        asset.off('remove', this.onAssetRemoved, this);
      }
    }

    if (newValue) {
      if (newValue instanceof Asset) {
        this.data.asset = newValue.id;
      }

      const asset = assets.get(this.data.asset);

      if (asset) {
        asset.off('remove', this.onAssetRemoved, this);
        asset.on('remove', this.onAssetRemoved, this);
      }
    }

    if (this.data.initialized && this.data.type === 'mesh') {
      if (!newValue) {
        this.data.model = null;
      }

      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetRenderAsset(name, oldValue, newValue) {
    const assets = this.system.app.assets;

    if (oldValue) {
      const asset = assets.get(oldValue);

      if (asset) {
        asset.off('remove', this.onRenderAssetRemoved, this);
      }
    }

    if (newValue) {
      if (newValue instanceof Asset) {
        this.data.renderAsset = newValue.id;
      }

      const asset = assets.get(this.data.renderAsset);

      if (asset) {
        asset.off('remove', this.onRenderAssetRemoved, this);
        asset.on('remove', this.onRenderAssetRemoved, this);
      }
    }

    if (this.data.initialized && this.data.type === 'mesh') {
      if (!newValue) {
        this.data.render = null;
      }

      this.system.recreatePhysicalShapes(this);
    }
  }

  onSetModel(name, oldValue, newValue) {
    if (this.data.initialized && this.data.type === 'mesh') {
      this.system.implementations.mesh.doRecreatePhysicalShape(this);
    }
  }

  onSetRender(name, oldValue, newValue) {
    this.onSetModel(name, oldValue, newValue);
  }

  onAssetRemoved(asset) {
    asset.off('remove', this.onAssetRemoved, this);

    if (this.data.asset === asset.id) {
      this.asset = null;
    }
  }

  onRenderAssetRemoved(asset) {
    asset.off('remove', this.onRenderAssetRemoved, this);

    if (this.data.renderAsset === asset.id) {
      this.renderAsset = null;
    }
  }

  _getCompoundChildShapeIndex(shape) {
    const compound = this.data.shape;
    const shapes = compound.getNumChildShapes();

    for (let i = 0; i < shapes; i++) {
      const childShape = compound.getChildShape(i);

      if (childShape.ptr === shape.ptr) {
        return i;
      }
    }

    return null;
  }

  _onInsert(parent) {
    if (typeof Ammo === 'undefined') return;

    if (this._compoundParent) {
      this.system.recreatePhysicalShapes(this);
    } else if (!this.entity.rigidbody) {
      let ancestor = this.entity.parent;

      while (ancestor) {
        if (ancestor.collision && ancestor.collision.type === 'compound') {
          if (ancestor.collision.shape.getNumChildShapes() === 0) {
            this.system.recreatePhysicalShapes(ancestor.collision);
          } else {
            this.system.recreatePhysicalShapes(this);
          }

          break;
        }

        ancestor = ancestor.parent;
      }
    }
  }

  _updateCompound() {
    const entity = this.entity;

    if (entity._dirtyWorld) {
      let dirty = entity._dirtyLocal;
      let parent = entity;

      while (parent && !dirty) {
        if (parent.collision && parent.collision === this._compoundParent) break;
        if (parent._dirtyLocal) dirty = true;
        parent = parent.parent;
      }

      if (dirty) {
        entity.forEach(this.system.implementations.compound._updateEachDescendantTransform, entity);
        const bodyComponent = this._compoundParent.entity.rigidbody;
        if (bodyComponent) bodyComponent.activate();
      }
    }
  }

  onEnable() {
    if (this.data.type === 'mesh' && (this.data.asset || this.data.renderAsset) && this.data.initialized) {
      const asset = this.system.app.assets.get(this.data.asset || this.data.renderAsset);

      if (asset && (!asset.resource || !this.data.shape)) {
        this.system.recreatePhysicalShapes(this);
        return;
      }
    }

    if (this.entity.rigidbody) {
      if (this.entity.rigidbody.enabled) {
        this.entity.rigidbody.enableSimulation();
      }
    } else if (this._compoundParent && this !== this._compoundParent) {
      if (this._compoundParent.shape.getNumChildShapes() === 0) {
        this.system.recreatePhysicalShapes(this._compoundParent);
      } else {
        const transform = this.system._getNodeTransform(this.entity, this._compoundParent.entity);

        this._compoundParent.shape.addChildShape(transform, this.data.shape);

        Ammo.destroy(transform);
        if (this._compoundParent.entity.rigidbody) this._compoundParent.entity.rigidbody.activate();
      }
    } else if (this.entity.trigger) {
      this.entity.trigger.enable();
    }
  }

  onDisable() {
    if (this.entity.rigidbody) {
      this.entity.rigidbody.disableSimulation();
    } else if (this._compoundParent && this !== this._compoundParent) {
      if (!this._compoundParent.entity._destroying) {
        this.system._removeCompoundChild(this._compoundParent, this.data.shape);

        if (this._compoundParent.entity.rigidbody) this._compoundParent.entity.rigidbody.activate();
      }
    } else if (this.entity.trigger) {
      this.entity.trigger.disable();
    }
  }

  onBeforeRemove() {
    if (this.asset) {
      this.asset = null;
    }

    if (this.renderAsset) {
      this.renderAsset = null;
    }

    this.entity.off('insert', this._onInsert, this);
    this.off();
  }

}

export { CollisionComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvY29sbGlzaW9uL2NvbXBvbmVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3NldCB9IGZyb20gJy4uLy4uLy4uL2Fzc2V0L2Fzc2V0LmpzJztcblxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uLy4uL21hdGgvdmVjMy5qcycpLlZlYzN9IFZlYzMgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi8uLi8uLi9zY2VuZS9tb2RlbC5qcycpLk1vZGVsfSBNb2RlbCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL2VudGl0eS5qcycpLkVudGl0eX0gRW50aXR5ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9zeXN0ZW0uanMnKS5Db2xsaXNpb25Db21wb25lbnRTeXN0ZW19IENvbGxpc2lvbkNvbXBvbmVudFN5c3RlbSAqL1xuXG4vKipcbiAqIEEgY29sbGlzaW9uIHZvbHVtZS4gVXNlIHRoaXMgaW4gY29uanVuY3Rpb24gd2l0aCBhIHtAbGluayBSaWdpZEJvZHlDb21wb25lbnR9IHRvIG1ha2UgYVxuICogY29sbGlzaW9uIHZvbHVtZSB0aGF0IGNhbiBiZSBzaW11bGF0ZWQgdXNpbmcgdGhlIHBoeXNpY3MgZW5naW5lLlxuICpcbiAqIElmIHRoZSB7QGxpbmsgRW50aXR5fSBkb2VzIG5vdCBoYXZlIGEge0BsaW5rIFJpZ2lkQm9keUNvbXBvbmVudH0gdGhlbiB0aGlzIGNvbGxpc2lvbiB2b2x1bWUgd2lsbFxuICogYWN0IGFzIGEgdHJpZ2dlciB2b2x1bWUuIFdoZW4gYW4gZW50aXR5IHdpdGggYSBkeW5hbWljIG9yIGtpbmVtYXRpYyBib2R5IGVudGVycyBvciBsZWF2ZXMgYW5cbiAqIGVudGl0eSB3aXRoIGEgdHJpZ2dlciB2b2x1bWUsIGJvdGggZW50aXRpZXMgd2lsbCByZWNlaXZlIHRyaWdnZXIgZXZlbnRzLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgdGFibGUgc2hvd3MgYWxsIHRoZSBldmVudHMgdGhhdCBjYW4gYmUgZmlyZWQgYmV0d2VlbiB0d28gRW50aXRpZXM6XG4gKlxuICogfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgUmlnaWQgQm9keSAoU3RhdGljKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgUmlnaWQgQm9keSAoRHluYW1pYyBvciBLaW5lbWF0aWMpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgVHJpZ2dlciBWb2x1bWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB8XG4gKiB8ICoqUmlnaWQgQm9keSAoU3RhdGljKSoqICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCA8dWw+PGxpPmNvbnRhY3Q8L2xpPjxsaT5jb2xsaXNpb25zdGFydDwvbGk+PGxpPmNvbGxpc2lvbmVuZDwvbGk+PC91bD4gfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogfCAqKlJpZ2lkIEJvZHkgKER5bmFtaWMgb3IgS2luZW1hdGljKSoqIHwgPHVsPjxsaT5jb250YWN0PC9saT48bGk+Y29sbGlzaW9uc3RhcnQ8L2xpPjxsaT5jb2xsaXNpb25lbmQ8L2xpPjwvdWw+IHwgPHVsPjxsaT5jb250YWN0PC9saT48bGk+Y29sbGlzaW9uc3RhcnQ8L2xpPjxsaT5jb2xsaXNpb25lbmQ8L2xpPjwvdWw+IHwgPHVsPjxsaT50cmlnZ2VyZW50ZXI8L2xpPjxsaT50cmlnZ2VybGVhdmU8L2xpPjwvdWw+IHxcbiAqIHwgKipUcmlnZ2VyIFZvbHVtZSoqICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDx1bD48bGk+dHJpZ2dlcmVudGVyPC9saT48bGk+dHJpZ2dlcmxlYXZlPC9saT48L3VsPiAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHR5cGUgVGhlIHR5cGUgb2YgdGhlIGNvbGxpc2lvbiB2b2x1bWUuIENhbiBiZTpcbiAqXG4gKiAtIFwiYm94XCI6IEEgYm94LXNoYXBlZCBjb2xsaXNpb24gdm9sdW1lLlxuICogLSBcImNhcHN1bGVcIjogQSBjYXBzdWxlLXNoYXBlZCBjb2xsaXNpb24gdm9sdW1lLlxuICogLSBcImNvbXBvdW5kXCI6IEEgY29tcG91bmQgc2hhcGUuIEFueSBkZXNjZW5kYW50IGVudGl0aWVzIHdpdGggYSBjb2xsaXNpb24gY29tcG9uZW50XG4gKiBvZiB0eXBlIGJveCwgY2Fwc3VsZSwgY29uZSwgY3lsaW5kZXIgb3Igc3BoZXJlIHdpbGwgYmUgY29tYmluZWQgaW50byBhIHNpbmdsZSwgcmlnaWRcbiAqIHNoYXBlLlxuICogLSBcImNvbmVcIjogQSBjb25lLXNoYXBlZCBjb2xsaXNpb24gdm9sdW1lLlxuICogLSBcImN5bGluZGVyXCI6IEEgY3lsaW5kZXItc2hhcGVkIGNvbGxpc2lvbiB2b2x1bWUuXG4gKiAtIFwibWVzaFwiOiBBIGNvbGxpc2lvbiB2b2x1bWUgdGhhdCB1c2VzIGEgbW9kZWwgYXNzZXQgYXMgaXRzIHNoYXBlLlxuICogLSBcInNwaGVyZVwiOiBBIHNwaGVyZS1zaGFwZWQgY29sbGlzaW9uIHZvbHVtZS5cbiAqXG4gKiBEZWZhdWx0cyB0byBcImJveFwiLlxuICogQHByb3BlcnR5IHtWZWMzfSBoYWxmRXh0ZW50cyBUaGUgaGFsZi1leHRlbnRzIG9mIHRoZSBib3gtc2hhcGVkIGNvbGxpc2lvbiB2b2x1bWUgaW4gdGhlIHgsIHkgYW5kXG4gKiB6IGF4ZXMuIERlZmF1bHRzIHRvIFswLjUsIDAuNSwgMC41XS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBjYXBzdWxlLCBjeWxpbmRlciBvciBjb25lLXNoYXBlZCBjb2xsaXNpb25cbiAqIHZvbHVtZXMuIERlZmF1bHRzIHRvIDAuNS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBheGlzIFRoZSBsb2NhbCBzcGFjZSBheGlzIHdpdGggd2hpY2ggdGhlIGNhcHN1bGUsIGN5bGluZGVyIG9yIGNvbmUtc2hhcGVkXG4gKiBjb2xsaXNpb24gdm9sdW1lJ3MgbGVuZ3RoIGlzIGFsaWduZWQuIDAgZm9yIFgsIDEgZm9yIFkgYW5kIDIgZm9yIFouIERlZmF1bHRzIHRvIDEgKFktYXhpcykuXG4gKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IFRoZSB0b3RhbCBoZWlnaHQgb2YgdGhlIGNhcHN1bGUsIGN5bGluZGVyIG9yIGNvbmUtc2hhcGVkIGNvbGxpc2lvblxuICogdm9sdW1lIGZyb20gdGlwIHRvIHRpcC4gRGVmYXVsdHMgdG8gMi5cbiAqIEBwcm9wZXJ0eSB7QXNzZXR8bnVtYmVyfSBhc3NldCBUaGUgYXNzZXQgZm9yIHRoZSBtb2RlbCBvZiB0aGUgbWVzaCBjb2xsaXNpb24gdm9sdW1lIC0gY2FuIGFsc29cbiAqIGJlIGFuIGFzc2V0IGlkLiBEZWZhdWx0cyB0byBudWxsLlxuICogQHByb3BlcnR5IHtBc3NldHxudW1iZXJ9IHJlbmRlckFzc2V0IFRoZSByZW5kZXIgYXNzZXQgb2YgdGhlIG1lc2ggY29sbGlzaW9uIHZvbHVtZSAtIGNhbiBhbHNvIGJlXG4gKiBhbiBhc3NldCBpZC4gRGVmYXVsdHMgdG8gbnVsbC4gSWYgbm90IHNldCB0aGVuIHRoZSBhc3NldCBwcm9wZXJ0eSB3aWxsIGJlIGNoZWNrZWQgaW5zdGVhZC5cbiAqIEBwcm9wZXJ0eSB7TW9kZWx9IG1vZGVsIFRoZSBtb2RlbCB0aGF0IGlzIGFkZGVkIHRvIHRoZSBzY2VuZSBncmFwaCBmb3IgdGhlIG1lc2ggY29sbGlzaW9uXG4gKiB2b2x1bWUuXG4gKiBAYXVnbWVudHMgQ29tcG9uZW50XG4gKi9cbmNsYXNzIENvbGxpc2lvbkNvbXBvbmVudCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IENvbGxpc2lvbkNvbXBvbmVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Q29sbGlzaW9uQ29tcG9uZW50U3lzdGVtfSBzeXN0ZW0gLSBUaGUgQ29tcG9uZW50U3lzdGVtIHRoYXQgY3JlYXRlZCB0aGlzIENvbXBvbmVudC5cbiAgICAgKiBAcGFyYW0ge0VudGl0eX0gZW50aXR5IC0gVGhlIEVudGl0eSB0aGF0IHRoaXMgQ29tcG9uZW50IGlzIGF0dGFjaGVkIHRvLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XG4gICAgICAgIHN1cGVyKHN5c3RlbSwgZW50aXR5KTtcblxuICAgICAgICAvKiogQHByaXZhdGUgKi9cbiAgICAgICAgdGhpcy5fY29tcG91bmRQYXJlbnQgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuZW50aXR5Lm9uKCdpbnNlcnQnLCB0aGlzLl9vbkluc2VydCwgdGhpcyk7XG5cbiAgICAgICAgdGhpcy5vbignc2V0X3R5cGUnLCB0aGlzLm9uU2V0VHlwZSwgdGhpcyk7XG4gICAgICAgIHRoaXMub24oJ3NldF9oYWxmRXh0ZW50cycsIHRoaXMub25TZXRIYWxmRXh0ZW50cywgdGhpcyk7XG4gICAgICAgIHRoaXMub24oJ3NldF9yYWRpdXMnLCB0aGlzLm9uU2V0UmFkaXVzLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X2hlaWdodCcsIHRoaXMub25TZXRIZWlnaHQsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZXRfYXhpcycsIHRoaXMub25TZXRBeGlzLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X2Fzc2V0JywgdGhpcy5vblNldEFzc2V0LCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X3JlbmRlckFzc2V0JywgdGhpcy5vblNldFJlbmRlckFzc2V0LCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X21vZGVsJywgdGhpcy5vblNldE1vZGVsLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbignc2V0X3JlbmRlcicsIHRoaXMub25TZXRSZW5kZXIsIHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSAnY29udGFjdCcgZXZlbnQgaXMgZmlyZWQgd2hlbiBhIGNvbnRhY3Qgb2NjdXJzIGJldHdlZW4gdHdvIHJpZ2lkIGJvZGllcy5cbiAgICAgKlxuICAgICAqIEBldmVudCBDb2xsaXNpb25Db21wb25lbnQjY29udGFjdFxuICAgICAqIEBwYXJhbSB7Q29udGFjdFJlc3VsdH0gcmVzdWx0IC0gRGV0YWlscyBvZiB0aGUgY29udGFjdCBiZXR3ZWVuIHRoZSB0d28gcmlnaWQgYm9kaWVzLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiB0d28gcmlnaWQgYm9kaWVzIHN0YXJ0IHRvdWNoaW5nLlxuICAgICAqXG4gICAgICogQGV2ZW50IENvbGxpc2lvbkNvbXBvbmVudCNjb2xsaXNpb25zdGFydFxuICAgICAqIEBwYXJhbSB7Q29udGFjdFJlc3VsdH0gcmVzdWx0IC0gRGV0YWlscyBvZiB0aGUgY29udGFjdCBiZXR3ZWVuIHRoZSB0d28gRW50aXRpZXMuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB0d28gcmlnaWQtYm9kaWVzIHN0b3AgdG91Y2hpbmcuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQ29sbGlzaW9uQ29tcG9uZW50I2NvbGxpc2lvbmVuZFxuICAgICAqIEBwYXJhbSB7RW50aXR5fSBvdGhlciAtIFRoZSB7QGxpbmsgRW50aXR5fSB0aGF0IHN0b3BwZWQgdG91Y2hpbmcgdGhpcyBjb2xsaXNpb24gdm9sdW1lLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhIHJpZ2lkIGJvZHkgZW50ZXJzIGEgdHJpZ2dlciB2b2x1bWUuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQ29sbGlzaW9uQ29tcG9uZW50I3RyaWdnZXJlbnRlclxuICAgICAqIEBwYXJhbSB7RW50aXR5fSBvdGhlciAtIFRoZSB7QGxpbmsgRW50aXR5fSB0aGF0IGVudGVyZWQgdGhpcyBjb2xsaXNpb24gdm9sdW1lLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhIHJpZ2lkIGJvZHkgZXhpdHMgYSB0cmlnZ2VyIHZvbHVtZS5cbiAgICAgKlxuICAgICAqIEBldmVudCBDb2xsaXNpb25Db21wb25lbnQjdHJpZ2dlcmxlYXZlXG4gICAgICogQHBhcmFtIHtFbnRpdHl9IG90aGVyIC0gVGhlIHtAbGluayBFbnRpdHl9IHRoYXQgZXhpdGVkIHRoaXMgY29sbGlzaW9uIHZvbHVtZS5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRUeXBlKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBpZiAob2xkVmFsdWUgIT09IG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5jaGFuZ2VUeXBlKHRoaXMsIG9sZFZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFByb3BlcnR5IG5hbWUuXG4gICAgICogQHBhcmFtIHsqfSBvbGRWYWx1ZSAtIFByZXZpb3VzIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbHVlIC0gTmV3IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIG9uU2V0SGFsZkV4dGVudHMobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRhdGEudHlwZTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5pbml0aWFsaXplZCAmJiB0ID09PSAnYm94Jykge1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRSYWRpdXMobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRhdGEudHlwZTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5pbml0aWFsaXplZCAmJiAodCA9PT0gJ3NwaGVyZScgfHwgdCA9PT0gJ2NhcHN1bGUnIHx8IHQgPT09ICdjeWxpbmRlcicgfHwgdCA9PT0gJ2NvbmUnKSkge1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRIZWlnaHQobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRhdGEudHlwZTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5pbml0aWFsaXplZCAmJiAodCA9PT0gJ2NhcHN1bGUnIHx8IHQgPT09ICdjeWxpbmRlcicgfHwgdCA9PT0gJ2NvbmUnKSkge1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRBeGlzKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5kYXRhLnR5cGU7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuaW5pdGlhbGl6ZWQgJiYgKHQgPT09ICdjYXBzdWxlJyB8fCB0ID09PSAnY3lsaW5kZXInIHx8IHQgPT09ICdjb25lJykpIHtcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLnJlY3JlYXRlUGh5c2ljYWxTaGFwZXModGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFByb3BlcnR5IG5hbWUuXG4gICAgICogQHBhcmFtIHsqfSBvbGRWYWx1ZSAtIFByZXZpb3VzIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcGFyYW0geyp9IG5ld1ZhbHVlIC0gTmV3IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIG9uU2V0QXNzZXQobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGFzc2V0cyA9IHRoaXMuc3lzdGVtLmFwcC5hc3NldHM7XG5cbiAgICAgICAgaWYgKG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgb2xkIGxpc3RlbmVyc1xuICAgICAgICAgICAgY29uc3QgYXNzZXQgPSBhc3NldHMuZ2V0KG9sZFZhbHVlKTtcbiAgICAgICAgICAgIGlmIChhc3NldCkge1xuICAgICAgICAgICAgICAgIGFzc2V0Lm9mZigncmVtb3ZlJywgdGhpcy5vbkFzc2V0UmVtb3ZlZCwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSBpbnN0YW5jZW9mIEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLmFzc2V0ID0gbmV3VmFsdWUuaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gYXNzZXRzLmdldCh0aGlzLmRhdGEuYXNzZXQpO1xuICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IHN1YnNjcmliZSB0d2ljZVxuICAgICAgICAgICAgICAgIGFzc2V0Lm9mZigncmVtb3ZlJywgdGhpcy5vbkFzc2V0UmVtb3ZlZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgYXNzZXQub24oJ3JlbW92ZScsIHRoaXMub25Bc3NldFJlbW92ZWQsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGF0YS5pbml0aWFsaXplZCAmJiB0aGlzLmRhdGEudHlwZSA9PT0gJ21lc2gnKSB7XG4gICAgICAgICAgICBpZiAoIW5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgYXNzZXQgaXMgbnVsbCBzZXQgbW9kZWwgdG8gbnVsbFxuICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQgaXQncyBnb2luZyB0byBiZSByZW1vdmVkIGZyb20gdGhlIHNpbXVsYXRpb25cbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEubW9kZWwgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gUHJvcGVydHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IG9sZFZhbHVlIC0gUHJldmlvdXMgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSB7Kn0gbmV3VmFsdWUgLSBOZXcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25TZXRSZW5kZXJBc3NldChuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgY29uc3QgYXNzZXRzID0gdGhpcy5zeXN0ZW0uYXBwLmFzc2V0cztcblxuICAgICAgICBpZiAob2xkVmFsdWUpIHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBvbGQgbGlzdGVuZXJzXG4gICAgICAgICAgICBjb25zdCBhc3NldCA9IGFzc2V0cy5nZXQob2xkVmFsdWUpO1xuICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLm9uUmVuZGVyQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlIGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEucmVuZGVyQXNzZXQgPSBuZXdWYWx1ZS5pZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYXNzZXQgPSBhc3NldHMuZ2V0KHRoaXMuZGF0YS5yZW5kZXJBc3NldCk7XG4gICAgICAgICAgICBpZiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3Qgc3Vic2NyaWJlIHR3aWNlXG4gICAgICAgICAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLm9uUmVuZGVyQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBhc3NldC5vbigncmVtb3ZlJywgdGhpcy5vblJlbmRlckFzc2V0UmVtb3ZlZCwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kYXRhLmluaXRpYWxpemVkICYmIHRoaXMuZGF0YS50eXBlID09PSAnbWVzaCcpIHtcbiAgICAgICAgICAgIGlmICghbmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiByZW5kZXIgYXNzZXQgaXMgbnVsbCBzZXQgcmVuZGVyIHRvIG51bGxcbiAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IGl0J3MgZ29pbmcgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBzaW11bGF0aW9uXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLnJlbmRlciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldE1vZGVsKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5kYXRhLmluaXRpYWxpemVkICYmIHRoaXMuZGF0YS50eXBlID09PSAnbWVzaCcpIHtcbiAgICAgICAgICAgIC8vIHJlY3JlYXRlIHBoeXNpY2FsIHNoYXBlcyBza2lwcGluZyBsb2FkaW5nIHRoZSBtb2RlbFxuICAgICAgICAgICAgLy8gZnJvbSB0aGUgJ2Fzc2V0JyBhcyB0aGUgbW9kZWwgcGFzc2VkIGluIG5ld1ZhbHVlIG1pZ2h0XG4gICAgICAgICAgICAvLyBoYXZlIGJlZW4gY3JlYXRlZCBwcm9jZWR1cmFsbHlcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmltcGxlbWVudGF0aW9ucy5tZXNoLmRvUmVjcmVhdGVQaHlzaWNhbFNoYXBlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBQcm9wZXJ0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgLSBQcmV2aW91cyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHsqfSBuZXdWYWx1ZSAtIE5ldyB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBvblNldFJlbmRlcihuYW1lLCBvbGRWYWx1ZSwgbmV3VmFsdWUpIHtcbiAgICAgICAgdGhpcy5vblNldE1vZGVsKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBBc3NldCB0aGF0IHdhcyByZW1vdmVkLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25Bc3NldFJlbW92ZWQoYXNzZXQpIHtcbiAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLm9uQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5hc3NldCA9PT0gYXNzZXQuaWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXNzZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBBc3NldCB0aGF0IHdhcyByZW1vdmVkLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgb25SZW5kZXJBc3NldFJlbW92ZWQoYXNzZXQpIHtcbiAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLm9uUmVuZGVyQXNzZXRSZW1vdmVkLCB0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5yZW5kZXJBc3NldCA9PT0gYXNzZXQuaWQpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQXNzZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHsqfSBzaGFwZSAtIEFtbW8gc2hhcGUuXG4gICAgICogQHJldHVybnMge251bWJlcnxudWxsfSBUaGUgc2hhcGUncyBpbmRleCBpbiB0aGUgY2hpbGQgYXJyYXkgb2YgdGhlIGNvbXBvdW5kIHNoYXBlLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2dldENvbXBvdW5kQ2hpbGRTaGFwZUluZGV4KHNoYXBlKSB7XG4gICAgICAgIGNvbnN0IGNvbXBvdW5kID0gdGhpcy5kYXRhLnNoYXBlO1xuICAgICAgICBjb25zdCBzaGFwZXMgPSBjb21wb3VuZC5nZXROdW1DaGlsZFNoYXBlcygpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hhcGVzOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkU2hhcGUgPSBjb21wb3VuZC5nZXRDaGlsZFNoYXBlKGkpO1xuICAgICAgICAgICAgaWYgKGNoaWxkU2hhcGUucHRyID09PSBzaGFwZS5wdHIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7R3JhcGhOb2RlfSBwYXJlbnQgLSBUaGUgcGFyZW50IG5vZGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfb25JbnNlcnQocGFyZW50KSB7XG4gICAgICAgIC8vIFRPRE9cbiAgICAgICAgLy8gaWYgaXMgY2hpbGQgb2YgY29tcG91bmQgc2hhcGVcbiAgICAgICAgLy8gYW5kIHRoZXJlIGlzIG5vIGNoYW5nZSBvZiBjb21wb3VuZFBhcmVudCwgdGhlbiB1cGRhdGUgY2hpbGQgdHJhbnNmb3JtXG4gICAgICAgIC8vIG9uY2UgdXBkYXRlQ2hpbGRUcmFuc2Zvcm0gaXMgZXhwb3NlZCBpbiBhbW1vLmpzXG5cbiAgICAgICAgaWYgKHR5cGVvZiBBbW1vID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBpZiAodGhpcy5fY29tcG91bmRQYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLnJlY3JlYXRlUGh5c2ljYWxTaGFwZXModGhpcyk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuZW50aXR5LnJpZ2lkYm9keSkge1xuICAgICAgICAgICAgbGV0IGFuY2VzdG9yID0gdGhpcy5lbnRpdHkucGFyZW50O1xuICAgICAgICAgICAgd2hpbGUgKGFuY2VzdG9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuY2VzdG9yLmNvbGxpc2lvbiAmJiBhbmNlc3Rvci5jb2xsaXNpb24udHlwZSA9PT0gJ2NvbXBvdW5kJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYW5jZXN0b3IuY29sbGlzaW9uLnNoYXBlLmdldE51bUNoaWxkU2hhcGVzKCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtLnJlY3JlYXRlUGh5c2ljYWxTaGFwZXMoYW5jZXN0b3IuY29sbGlzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtLnJlY3JlYXRlUGh5c2ljYWxTaGFwZXModGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFuY2VzdG9yID0gYW5jZXN0b3IucGFyZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgX3VwZGF0ZUNvbXBvdW5kKCkge1xuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0eTtcbiAgICAgICAgaWYgKGVudGl0eS5fZGlydHlXb3JsZCkge1xuICAgICAgICAgICAgbGV0IGRpcnR5ID0gZW50aXR5Ll9kaXJ0eUxvY2FsO1xuICAgICAgICAgICAgbGV0IHBhcmVudCA9IGVudGl0eTtcbiAgICAgICAgICAgIHdoaWxlIChwYXJlbnQgJiYgIWRpcnR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudC5jb2xsaXNpb24gJiYgcGFyZW50LmNvbGxpc2lvbiA9PT0gdGhpcy5fY29tcG91bmRQYXJlbnQpXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudC5fZGlydHlMb2NhbClcbiAgICAgICAgICAgICAgICAgICAgZGlydHkgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRpcnR5KSB7XG4gICAgICAgICAgICAgICAgZW50aXR5LmZvckVhY2godGhpcy5zeXN0ZW0uaW1wbGVtZW50YXRpb25zLmNvbXBvdW5kLl91cGRhdGVFYWNoRGVzY2VuZGFudFRyYW5zZm9ybSwgZW50aXR5KTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlDb21wb25lbnQgPSB0aGlzLl9jb21wb3VuZFBhcmVudC5lbnRpdHkucmlnaWRib2R5O1xuICAgICAgICAgICAgICAgIGlmIChib2R5Q29tcG9uZW50KVxuICAgICAgICAgICAgICAgICAgICBib2R5Q29tcG9uZW50LmFjdGl2YXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBvbkVuYWJsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS50eXBlID09PSAnbWVzaCcgJiYgKHRoaXMuZGF0YS5hc3NldCB8fCB0aGlzLmRhdGEucmVuZGVyQXNzZXQpICYmIHRoaXMuZGF0YS5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLnN5c3RlbS5hcHAuYXNzZXRzLmdldCh0aGlzLmRhdGEuYXNzZXQgfHwgdGhpcy5kYXRhLnJlbmRlckFzc2V0KTtcbiAgICAgICAgICAgIC8vIHJlY3JlYXRlIHRoZSBjb2xsaXNpb24gc2hhcGUgaWYgdGhlIG1vZGVsIGFzc2V0IGlzIG5vdCBsb2FkZWRcbiAgICAgICAgICAgIC8vIG9yIHRoZSBzaGFwZSBkb2VzIG5vdCBleGlzdFxuICAgICAgICAgICAgaWYgKGFzc2V0ICYmICghYXNzZXQucmVzb3VyY2UgfHwgIXRoaXMuZGF0YS5zaGFwZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbS5yZWNyZWF0ZVBoeXNpY2FsU2hhcGVzKHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5yaWdpZGJvZHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5yaWdpZGJvZHkuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW50aXR5LnJpZ2lkYm9keS5lbmFibGVTaW11bGF0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29tcG91bmRQYXJlbnQgJiYgdGhpcyAhPT0gdGhpcy5fY29tcG91bmRQYXJlbnQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb21wb3VuZFBhcmVudC5zaGFwZS5nZXROdW1DaGlsZFNoYXBlcygpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW0ucmVjcmVhdGVQaHlzaWNhbFNoYXBlcyh0aGlzLl9jb21wb3VuZFBhcmVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IHRoaXMuc3lzdGVtLl9nZXROb2RlVHJhbnNmb3JtKHRoaXMuZW50aXR5LCB0aGlzLl9jb21wb3VuZFBhcmVudC5lbnRpdHkpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbXBvdW5kUGFyZW50LnNoYXBlLmFkZENoaWxkU2hhcGUodHJhbnNmb3JtLCB0aGlzLmRhdGEuc2hhcGUpO1xuICAgICAgICAgICAgICAgIEFtbW8uZGVzdHJveSh0cmFuc2Zvcm0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eS5yaWdpZGJvZHkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbXBvdW5kUGFyZW50LmVudGl0eS5yaWdpZGJvZHkuYWN0aXZhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVudGl0eS50cmlnZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLmVudGl0eS50cmlnZ2VyLmVuYWJsZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgb25EaXNhYmxlKCkge1xuICAgICAgICBpZiAodGhpcy5lbnRpdHkucmlnaWRib2R5KSB7XG4gICAgICAgICAgICB0aGlzLmVudGl0eS5yaWdpZGJvZHkuZGlzYWJsZVNpbXVsYXRpb24oKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb21wb3VuZFBhcmVudCAmJiB0aGlzICE9PSB0aGlzLl9jb21wb3VuZFBhcmVudCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9jb21wb3VuZFBhcmVudC5lbnRpdHkuX2Rlc3Ryb3lpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbS5fcmVtb3ZlQ29tcG91bmRDaGlsZCh0aGlzLl9jb21wb3VuZFBhcmVudCwgdGhpcy5kYXRhLnNoYXBlKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb21wb3VuZFBhcmVudC5lbnRpdHkucmlnaWRib2R5KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb21wb3VuZFBhcmVudC5lbnRpdHkucmlnaWRib2R5LmFjdGl2YXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbnRpdHkudHJpZ2dlcikge1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkudHJpZ2dlci5kaXNhYmxlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBvbkJlZm9yZVJlbW92ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuYXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMuYXNzZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlbmRlckFzc2V0KSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckFzc2V0ID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZW50aXR5Lm9mZignaW5zZXJ0JywgdGhpcy5fb25JbnNlcnQsIHRoaXMpO1xuXG4gICAgICAgIHRoaXMub2ZmKCk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBDb2xsaXNpb25Db21wb25lbnQgfTtcbiJdLCJuYW1lcyI6WyJDb2xsaXNpb25Db21wb25lbnQiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInN5c3RlbSIsImVudGl0eSIsIl9jb21wb3VuZFBhcmVudCIsIm9uIiwiX29uSW5zZXJ0Iiwib25TZXRUeXBlIiwib25TZXRIYWxmRXh0ZW50cyIsIm9uU2V0UmFkaXVzIiwib25TZXRIZWlnaHQiLCJvblNldEF4aXMiLCJvblNldEFzc2V0Iiwib25TZXRSZW5kZXJBc3NldCIsIm9uU2V0TW9kZWwiLCJvblNldFJlbmRlciIsIm5hbWUiLCJvbGRWYWx1ZSIsIm5ld1ZhbHVlIiwiY2hhbmdlVHlwZSIsInQiLCJkYXRhIiwidHlwZSIsImluaXRpYWxpemVkIiwicmVjcmVhdGVQaHlzaWNhbFNoYXBlcyIsImFzc2V0cyIsImFwcCIsImFzc2V0IiwiZ2V0Iiwib2ZmIiwib25Bc3NldFJlbW92ZWQiLCJBc3NldCIsImlkIiwibW9kZWwiLCJvblJlbmRlckFzc2V0UmVtb3ZlZCIsInJlbmRlckFzc2V0IiwicmVuZGVyIiwiaW1wbGVtZW50YXRpb25zIiwibWVzaCIsImRvUmVjcmVhdGVQaHlzaWNhbFNoYXBlIiwiX2dldENvbXBvdW5kQ2hpbGRTaGFwZUluZGV4Iiwic2hhcGUiLCJjb21wb3VuZCIsInNoYXBlcyIsImdldE51bUNoaWxkU2hhcGVzIiwiaSIsImNoaWxkU2hhcGUiLCJnZXRDaGlsZFNoYXBlIiwicHRyIiwicGFyZW50IiwiQW1tbyIsInJpZ2lkYm9keSIsImFuY2VzdG9yIiwiY29sbGlzaW9uIiwiX3VwZGF0ZUNvbXBvdW5kIiwiX2RpcnR5V29ybGQiLCJkaXJ0eSIsIl9kaXJ0eUxvY2FsIiwiZm9yRWFjaCIsIl91cGRhdGVFYWNoRGVzY2VuZGFudFRyYW5zZm9ybSIsImJvZHlDb21wb25lbnQiLCJhY3RpdmF0ZSIsIm9uRW5hYmxlIiwicmVzb3VyY2UiLCJlbmFibGVkIiwiZW5hYmxlU2ltdWxhdGlvbiIsInRyYW5zZm9ybSIsIl9nZXROb2RlVHJhbnNmb3JtIiwiYWRkQ2hpbGRTaGFwZSIsImRlc3Ryb3kiLCJ0cmlnZ2VyIiwiZW5hYmxlIiwib25EaXNhYmxlIiwiZGlzYWJsZVNpbXVsYXRpb24iLCJfZGVzdHJveWluZyIsIl9yZW1vdmVDb21wb3VuZENoaWxkIiwiZGlzYWJsZSIsIm9uQmVmb3JlUmVtb3ZlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQXNEQSxNQUFNQSxrQkFBTixTQUFpQ0MsU0FBakMsQ0FBMkM7QUFPdkNDLEVBQUFBLFdBQVcsQ0FBQ0MsTUFBRCxFQUFTQyxNQUFULEVBQWlCO0lBQ3hCLEtBQU1ELENBQUFBLE1BQU4sRUFBY0MsTUFBZCxDQUFBLENBQUE7SUFHQSxJQUFLQyxDQUFBQSxlQUFMLEdBQXVCLElBQXZCLENBQUE7SUFFQSxJQUFLRCxDQUFBQSxNQUFMLENBQVlFLEVBQVosQ0FBZSxRQUFmLEVBQXlCLElBQUEsQ0FBS0MsU0FBOUIsRUFBeUMsSUFBekMsQ0FBQSxDQUFBO0FBRUEsSUFBQSxJQUFBLENBQUtELEVBQUwsQ0FBUSxVQUFSLEVBQW9CLElBQUtFLENBQUFBLFNBQXpCLEVBQW9DLElBQXBDLENBQUEsQ0FBQTtBQUNBLElBQUEsSUFBQSxDQUFLRixFQUFMLENBQVEsaUJBQVIsRUFBMkIsSUFBS0csQ0FBQUEsZ0JBQWhDLEVBQWtELElBQWxELENBQUEsQ0FBQTtBQUNBLElBQUEsSUFBQSxDQUFLSCxFQUFMLENBQVEsWUFBUixFQUFzQixJQUFLSSxDQUFBQSxXQUEzQixFQUF3QyxJQUF4QyxDQUFBLENBQUE7QUFDQSxJQUFBLElBQUEsQ0FBS0osRUFBTCxDQUFRLFlBQVIsRUFBc0IsSUFBS0ssQ0FBQUEsV0FBM0IsRUFBd0MsSUFBeEMsQ0FBQSxDQUFBO0FBQ0EsSUFBQSxJQUFBLENBQUtMLEVBQUwsQ0FBUSxVQUFSLEVBQW9CLElBQUtNLENBQUFB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
