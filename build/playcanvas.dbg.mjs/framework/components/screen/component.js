/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../../core/debug.js';
import { Mat4 } from '../../../math/mat4.js';
import { Vec2 } from '../../../math/vec2.js';
import { Entity } from '../../entity.js';
import { SCALEMODE_NONE, SCALEMODE_BLEND } from './constants.js';
import { Component } from '../component.js';

const _transform = new Mat4();

class ScreenComponent extends Component {
  constructor(system, entity) {
    super(system, entity);
    this._resolution = new Vec2(640, 320);
    this._referenceResolution = new Vec2(640, 320);
    this._scaleMode = SCALEMODE_NONE;
    this.scale = 1;
    this._scaleBlend = 0.5;
    this._priority = 0;
    this._screenSpace = false;
    this.cull = this._screenSpace;
    this._screenMatrix = new Mat4();
    this._elements = new Set();
    system.app.graphicsDevice.on('resizecanvas', this._onResize, this);
  }

  syncDrawOrder() {
    this.system.queueDrawOrderSync(this.entity.getGuid(), this._processDrawOrderSync, this);
  }

  _recurseDrawOrderSync(e, i) {
    if (!(e instanceof Entity)) {
      return i;
    }

    if (e.element) {
      const prevDrawOrder = e.element.drawOrder;
      e.element.drawOrder = i++;

      if (e.element._batchGroupId >= 0 && prevDrawOrder !== e.element.drawOrder) {
        var _this$system$app$batc;

        (_this$system$app$batc = this.system.app.batcher) == null ? void 0 : _this$system$app$batc.markGroupDirty(e.element._batchGroupId);
      }
    }

    if (e.particlesystem) {
      e.particlesystem.drawOrder = i++;
    }

    const children = e.children;

    for (let j = 0; j < children.length; j++) {
      i = this._recurseDrawOrderSync(children[j], i);
    }

    return i;
  }

  _processDrawOrderSync() {
    const i = 1;

    this._recurseDrawOrderSync(this.entity, i);

    this.fire('syncdraworder');
  }

  _calcProjectionMatrix() {
    const w = this._resolution.x / this.scale;
    const h = this._resolution.y / this.scale;
    const left = 0;
    const right = w;
    const bottom = -h;
    const top = 0;
    const near = 1;
    const far = -1;

    this._screenMatrix.setOrtho(left, right, bottom, top, near, far);

    if (!this._screenSpace) {
      _transform.setScale(0.5 * w, 0.5 * h, 1);

      this._screenMatrix.mul2(_transform, this._screenMatrix);
    }
  }

  _updateScale() {
    this.scale = this._calcScale(this._resolution, this.referenceResolution);
  }

  _calcScale(resolution, referenceResolution) {
    const lx = Math.log2(resolution.x / referenceResolution.x);
    const ly = Math.log2(resolution.y / referenceResolution.y);
    return Math.pow(2, lx * (1 - this._scaleBlend) + ly * this._scaleBlend);
  }

  _onResize(width, height) {
    if (this._screenSpace) {
      this._resolution.set(width, height);

      this.resolution = this._resolution;
    }
  }

  _bindElement(element) {
    this._elements.add(element);
  }

  _unbindElement(element) {
    this._elements.delete(element);
  }

  onRemove() {
    this.system.app.graphicsDevice.off('resizecanvas', this._onResize, this);
    this.fire('remove');

    this._elements.forEach(element => element._onScreenRemove());

    this._elements.clear();

    this.off();
  }

  set resolution(value) {
    if (!this._screenSpace) {
      this._resolution.set(value.x, value.y);
    } else {
      this._resolution.set(this.system.app.graphicsDevice.width, this.system.app.graphicsDevice.height);
    }

    this._updateScale();

    this._calcProjectionMatrix();

    if (!this.entity._dirtyLocal) this.entity._dirtifyLocal();
    this.fire('set:resolution', this._resolution);

    this._elements.forEach(element => element._onScreenResize(this._resolution));
  }

  get resolution() {
    return this._resolution;
  }

  set referenceResolution(value) {
    this._referenceResolution.set(value.x, value.y);

    this._updateScale();

    this._calcProjectionMatrix();

    if (!this.entity._dirtyLocal) this.entity._dirtifyLocal();
    this.fire('set:referenceresolution', this._resolution);

    this._elements.forEach(element => element._onScreenResize(this._resolution));
  }

  get referenceResolution() {
    if (this._scaleMode === SCALEMODE_NONE) {
      return this._resolution;
    }

    return this._referenceResolution;
  }

  set screenSpace(value) {
    this._screenSpace = value;

    if (this._screenSpace) {
      this._resolution.set(this.system.app.graphicsDevice.width, this.system.app.graphicsDevice.height);
    }

    this.resolution = this._resolution;
    if (!this.entity._dirtyLocal) this.entity._dirtifyLocal();
    this.fire('set:screenspace', this._screenSpace);

    this._elements.forEach(element => element._onScreenSpaceChange());
  }

  get screenSpace() {
    return this._screenSpace;
  }

  set scaleMode(value) {
    if (value !== SCALEMODE_NONE && value !== SCALEMODE_BLEND) {
      value = SCALEMODE_NONE;
    }

    if (!this._screenSpace && value !== SCALEMODE_NONE) {
      value = SCALEMODE_NONE;
    }

    this._scaleMode = value;
    this.resolution = this._resolution;
    this.fire('set:scalemode', this._scaleMode);
  }

  get scaleMode() {
    return this._scaleMode;
  }

  set scaleBlend(value) {
    this._scaleBlend = value;

    this._updateScale();

    this._calcProjectionMatrix();

    if (!this.entity._dirtyLocal) this.entity._dirtifyLocal();
    this.fire('set:scaleblend', this._scaleBlend);

    this._elements.forEach(element => element._onScreenResize(this._resolution));
  }

  get scaleBlend() {
    return this._scaleBlend;
  }

  set priority(value) {
    if (value > 0xFF) {
      Debug.warn(`Clamping screen priority from ${value} to 255`);
      value = 0xFF;
    }

    if (this._priority === value) {
      return;
    }

    this._priority = value;
    this.syncDrawOrder();
  }

  get priority() {
    return this._priority;
  }

}

export { ScreenComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc2NyZWVuL2NvbXBvbmVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZGVidWcuanMnO1xuXG5pbXBvcnQgeyBNYXQ0IH0gZnJvbSAnLi4vLi4vLi4vbWF0aC9tYXQ0LmpzJztcbmltcG9ydCB7IFZlYzIgfSBmcm9tICcuLi8uLi8uLi9tYXRoL3ZlYzIuanMnO1xuXG5pbXBvcnQgeyBFbnRpdHkgfSBmcm9tICcuLi8uLi9lbnRpdHkuanMnO1xuXG5pbXBvcnQgeyBTQ0FMRU1PREVfQkxFTkQsIFNDQUxFTU9ERV9OT05FIH0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vc3lzdGVtLmpzJykuU2NyZWVuQ29tcG9uZW50U3lzdGVtfSBTY3JlZW5Db21wb25lbnRTeXN0ZW0gKi9cblxuY29uc3QgX3RyYW5zZm9ybSA9IG5ldyBNYXQ0KCk7XG5cbi8qKlxuICogQSBTY3JlZW5Db21wb25lbnQgZW5hYmxlcyB0aGUgRW50aXR5IHRvIHJlbmRlciBjaGlsZCB7QGxpbmsgRWxlbWVudENvbXBvbmVudH1zIHVzaW5nIGFuY2hvcnMgYW5kXG4gKiBwb3NpdGlvbnMgaW4gdGhlIFNjcmVlbkNvbXBvbmVudCdzIHNwYWNlLlxuICpcbiAqIEBhdWdtZW50cyBDb21wb25lbnRcbiAqL1xuY2xhc3MgU2NyZWVuQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU2NyZWVuQ29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTY3JlZW5Db21wb25lbnRTeXN0ZW19IHN5c3RlbSAtIFRoZSBDb21wb25lbnRTeXN0ZW0gdGhhdCBjcmVhdGVkIHRoaXMgQ29tcG9uZW50LlxuICAgICAqIEBwYXJhbSB7RW50aXR5fSBlbnRpdHkgLSBUaGUgRW50aXR5IHRoYXQgdGhpcyBDb21wb25lbnQgaXMgYXR0YWNoZWQgdG8uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc3lzdGVtLCBlbnRpdHkpIHtcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xuXG4gICAgICAgIHRoaXMuX3Jlc29sdXRpb24gPSBuZXcgVmVjMig2NDAsIDMyMCk7XG4gICAgICAgIHRoaXMuX3JlZmVyZW5jZVJlc29sdXRpb24gPSBuZXcgVmVjMig2NDAsIDMyMCk7XG4gICAgICAgIHRoaXMuX3NjYWxlTW9kZSA9IFNDQUxFTU9ERV9OT05FO1xuICAgICAgICB0aGlzLnNjYWxlID0gMTtcbiAgICAgICAgdGhpcy5fc2NhbGVCbGVuZCA9IDAuNTtcblxuICAgICAgICB0aGlzLl9wcmlvcml0eSA9IDA7XG5cbiAgICAgICAgdGhpcy5fc2NyZWVuU3BhY2UgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdHJ1ZSB0aGVuIGVsZW1lbnRzIGluc2lkZSB0aGlzIHNjcmVlbiB3aWxsIGJlIG5vdCBiZSByZW5kZXJlZCB3aGVuIG91dHNpZGUgb2YgdGhlXG4gICAgICAgICAqIHNjcmVlbiAob25seSB2YWxpZCB3aGVuIHNjcmVlblNwYWNlIGlzIHRydWUpLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3VsbCA9IHRoaXMuX3NjcmVlblNwYWNlO1xuICAgICAgICB0aGlzLl9zY3JlZW5NYXRyaXggPSBuZXcgTWF0NCgpO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnRzID0gbmV3IFNldCgpO1xuXG4gICAgICAgIHN5c3RlbS5hcHAuZ3JhcGhpY3NEZXZpY2Uub24oJ3Jlc2l6ZWNhbnZhcycsIHRoaXMuX29uUmVzaXplLCB0aGlzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGRyYXdPcmRlciBvZiBlYWNoIGNoaWxkIHtAbGluayBFbGVtZW50Q29tcG9uZW50fSBzbyB0aGF0IEVsZW1lbnRDb21wb25lbnRzIHdoaWNoIGFyZVxuICAgICAqIGxhc3QgaW4gdGhlIGhpZXJhcmNoeSBhcmUgcmVuZGVyZWQgb24gdG9wLiBEcmF3IE9yZGVyIHN5bmMgaXMgcXVldWVkIGFuZCB3aWxsIGJlIHVwZGF0ZWQgYnlcbiAgICAgKiB0aGUgbmV4dCB1cGRhdGUgbG9vcC5cbiAgICAgKi9cbiAgICBzeW5jRHJhd09yZGVyKCkge1xuICAgICAgICB0aGlzLnN5c3RlbS5xdWV1ZURyYXdPcmRlclN5bmModGhpcy5lbnRpdHkuZ2V0R3VpZCgpLCB0aGlzLl9wcm9jZXNzRHJhd09yZGVyU3luYywgdGhpcyk7XG4gICAgfVxuXG4gICAgX3JlY3Vyc2VEcmF3T3JkZXJTeW5jKGUsIGkpIHtcbiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIEVudGl0eSkpIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGUuZWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgcHJldkRyYXdPcmRlciA9IGUuZWxlbWVudC5kcmF3T3JkZXI7XG4gICAgICAgICAgICBlLmVsZW1lbnQuZHJhd09yZGVyID0gaSsrO1xuXG4gICAgICAgICAgICBpZiAoZS5lbGVtZW50Ll9iYXRjaEdyb3VwSWQgPj0gMCAmJiBwcmV2RHJhd09yZGVyICE9PSBlLmVsZW1lbnQuZHJhd09yZGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW0uYXBwLmJhdGNoZXI/Lm1hcmtHcm91cERpcnR5KGUuZWxlbWVudC5fYmF0Y2hHcm91cElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNoaWxkIHBhcnRpY2xlIHN5c3RlbSBpbnNpZGUgMkQgc2NyZWVuIHN1Yi1oaWVyYXJjaHkgZ2V0cyBzb3J0ZWQgYWxvbmcgb3RoZXIgMkQgZWxlbWVudHNcbiAgICAgICAgaWYgKGUucGFydGljbGVzeXN0ZW0pIHtcbiAgICAgICAgICAgIGUucGFydGljbGVzeXN0ZW0uZHJhd09yZGVyID0gaSsrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBlLmNoaWxkcmVuO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNoaWxkcmVuLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpID0gdGhpcy5fcmVjdXJzZURyYXdPcmRlclN5bmMoY2hpbGRyZW5bal0sIGkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGk7XG4gICAgfVxuXG4gICAgX3Byb2Nlc3NEcmF3T3JkZXJTeW5jKCkge1xuICAgICAgICBjb25zdCBpID0gMTtcblxuICAgICAgICB0aGlzLl9yZWN1cnNlRHJhd09yZGVyU3luYyh0aGlzLmVudGl0eSwgaSk7XG5cbiAgICAgICAgLy8gZmlyZSBpbnRlcm5hbCBldmVudCBhZnRlciBhbGwgc2NyZWVuIGhpZXJhcmNoeSBpcyBzeW5jZWRcbiAgICAgICAgdGhpcy5maXJlKCdzeW5jZHJhd29yZGVyJyk7XG4gICAgfVxuXG4gICAgX2NhbGNQcm9qZWN0aW9uTWF0cml4KCkge1xuICAgICAgICBjb25zdCB3ID0gdGhpcy5fcmVzb2x1dGlvbi54IC8gdGhpcy5zY2FsZTtcbiAgICAgICAgY29uc3QgaCA9IHRoaXMuX3Jlc29sdXRpb24ueSAvIHRoaXMuc2NhbGU7XG5cbiAgICAgICAgY29uc3QgbGVmdCA9IDA7XG4gICAgICAgIGNvbnN0IHJpZ2h0ID0gdztcbiAgICAgICAgY29uc3QgYm90dG9tID0gLWg7XG4gICAgICAgIGNvbnN0IHRvcCA9IDA7XG4gICAgICAgIGNvbnN0IG5lYXIgPSAxO1xuICAgICAgICBjb25zdCBmYXIgPSAtMTtcblxuICAgICAgICB0aGlzLl9zY3JlZW5NYXRyaXguc2V0T3J0aG8obGVmdCwgcmlnaHQsIGJvdHRvbSwgdG9wLCBuZWFyLCBmYXIpO1xuXG4gICAgICAgIGlmICghdGhpcy5fc2NyZWVuU3BhY2UpIHtcbiAgICAgICAgICAgIF90cmFuc2Zvcm0uc2V0U2NhbGUoMC41ICogdywgMC41ICogaCwgMSk7XG4gICAgICAgICAgICB0aGlzLl9zY3JlZW5NYXRyaXgubXVsMihfdHJhbnNmb3JtLCB0aGlzLl9zY3JlZW5NYXRyaXgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3VwZGF0ZVNjYWxlKCkge1xuICAgICAgICB0aGlzLnNjYWxlID0gdGhpcy5fY2FsY1NjYWxlKHRoaXMuX3Jlc29sdXRpb24sIHRoaXMucmVmZXJlbmNlUmVzb2x1dGlvbik7XG4gICAgfVxuXG4gICAgX2NhbGNTY2FsZShyZXNvbHV0aW9uLCByZWZlcmVuY2VSZXNvbHV0aW9uKSB7XG4gICAgICAgIC8vIFVzaW5nIGxvZyBvZiBzY2FsZSB2YWx1ZXNcbiAgICAgICAgLy8gVGhpcyBwcm9kdWNlcyBhIG5pY2VyIG91dGNvbWUgd2hlcmUgaWYgeW91IGhhdmUgYSB4c2NhbGUgPSAyIGFuZCB5c2NhbGUgPSAwLjVcbiAgICAgICAgLy8gdGhlIGNvbWJpbmVkIHNjYWxlIGlzIDEgZm9yIGFuIGV2ZW4gYmxlbmRcbiAgICAgICAgY29uc3QgbHggPSBNYXRoLmxvZzIocmVzb2x1dGlvbi54IC8gcmVmZXJlbmNlUmVzb2x1dGlvbi54KTtcbiAgICAgICAgY29uc3QgbHkgPSBNYXRoLmxvZzIocmVzb2x1dGlvbi55IC8gcmVmZXJlbmNlUmVzb2x1dGlvbi55KTtcbiAgICAgICAgcmV0dXJuIE1hdGgucG93KDIsIChseCAqICgxIC0gdGhpcy5fc2NhbGVCbGVuZCkgKyBseSAqIHRoaXMuX3NjYWxlQmxlbmQpKTtcbiAgICB9XG5cbiAgICBfb25SZXNpemUod2lkdGgsIGhlaWdodCkge1xuICAgICAgICBpZiAodGhpcy5fc2NyZWVuU3BhY2UpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdXRpb24uc2V0KHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5yZXNvbHV0aW9uID0gdGhpcy5fcmVzb2x1dGlvbjsgLy8gZm9yY2UgdXBkYXRlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfYmluZEVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9lbGVtZW50cy5hZGQoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgX3VuYmluZEVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9lbGVtZW50cy5kZWxldGUoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgb25SZW1vdmUoKSB7XG4gICAgICAgIHRoaXMuc3lzdGVtLmFwcC5ncmFwaGljc0RldmljZS5vZmYoJ3Jlc2l6ZWNhbnZhcycsIHRoaXMuX29uUmVzaXplLCB0aGlzKTtcbiAgICAgICAgdGhpcy5maXJlKCdyZW1vdmUnKTtcblxuICAgICAgICB0aGlzLl9lbGVtZW50cy5mb3JFYWNoKGVsZW1lbnQgPT4gZWxlbWVudC5fb25TY3JlZW5SZW1vdmUoKSk7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLmNsZWFyKCk7XG5cbiAgICAgICAgLy8gcmVtb3ZlIGFsbCBldmVudHNcbiAgICAgICAgdGhpcy5vZmYoKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBTY3JlZW5Db21wb25lbnQuIFdoZW4gc2NyZWVuU3BhY2UgaXMgdHJ1ZSB0aGUgcmVzb2x1dGlvbiB3aWxsXG4gICAgICogYWx3YXlzIGJlIGVxdWFsIHRvIHtAbGluayBHcmFwaGljc0RldmljZSN3aWR0aH0geCB7QGxpbmsgR3JhcGhpY3NEZXZpY2UjaGVpZ2h0fS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtWZWMyfVxuICAgICAqL1xuICAgIHNldCByZXNvbHV0aW9uKHZhbHVlKSB7XG4gICAgICAgIGlmICghdGhpcy5fc2NyZWVuU3BhY2UpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdXRpb24uc2V0KHZhbHVlLngsIHZhbHVlLnkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gaWdub3JlIGlucHV0IHdoZW4gdXNpbmcgc2NyZWVuIHNwYWNlLlxuICAgICAgICAgICAgdGhpcy5fcmVzb2x1dGlvbi5zZXQodGhpcy5zeXN0ZW0uYXBwLmdyYXBoaWNzRGV2aWNlLndpZHRoLCB0aGlzLnN5c3RlbS5hcHAuZ3JhcGhpY3NEZXZpY2UuaGVpZ2h0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3VwZGF0ZVNjYWxlKCk7XG5cbiAgICAgICAgdGhpcy5fY2FsY1Byb2plY3Rpb25NYXRyaXgoKTtcblxuICAgICAgICBpZiAoIXRoaXMuZW50aXR5Ll9kaXJ0eUxvY2FsKVxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuX2RpcnRpZnlMb2NhbCgpO1xuXG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OnJlc29sdXRpb24nLCB0aGlzLl9yZXNvbHV0aW9uKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudHMuZm9yRWFjaChlbGVtZW50ID0+IGVsZW1lbnQuX29uU2NyZWVuUmVzaXplKHRoaXMuX3Jlc29sdXRpb24pKTtcbiAgICB9XG5cbiAgICBnZXQgcmVzb2x1dGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc29sdXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIHJlc29sdXRpb24gdGhhdCB0aGUgU2NyZWVuQ29tcG9uZW50IGlzIGRlc2lnbmVkIGZvci4gVGhpcyBpcyBvbmx5IHRha2VuIGludG8gYWNjb3VudFxuICAgICAqIHdoZW4gc2NyZWVuU3BhY2UgaXMgdHJ1ZSBhbmQgc2NhbGVNb2RlIGlzIHtAbGluayBTQ0FMRU1PREVfQkxFTkR9LiBJZiB0aGUgYWN0dWFsIHJlc29sdXRpb25cbiAgICAgKiBpcyBkaWZmZXJlbnQgdGhlbiB0aGUgU2NyZWVuQ29tcG9uZW50IHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZyB0byB0aGUgc2NhbGVCbGVuZCB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtWZWMyfVxuICAgICAqL1xuICAgIHNldCByZWZlcmVuY2VSZXNvbHV0aW9uKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3JlZmVyZW5jZVJlc29sdXRpb24uc2V0KHZhbHVlLngsIHZhbHVlLnkpO1xuICAgICAgICB0aGlzLl91cGRhdGVTY2FsZSgpO1xuICAgICAgICB0aGlzLl9jYWxjUHJvamVjdGlvbk1hdHJpeCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5lbnRpdHkuX2RpcnR5TG9jYWwpXG4gICAgICAgICAgICB0aGlzLmVudGl0eS5fZGlydGlmeUxvY2FsKCk7XG5cbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6cmVmZXJlbmNlcmVzb2x1dGlvbicsIHRoaXMuX3Jlc29sdXRpb24pO1xuICAgICAgICB0aGlzLl9lbGVtZW50cy5mb3JFYWNoKGVsZW1lbnQgPT4gZWxlbWVudC5fb25TY3JlZW5SZXNpemUodGhpcy5fcmVzb2x1dGlvbikpO1xuICAgIH1cblxuICAgIGdldCByZWZlcmVuY2VSZXNvbHV0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5fc2NhbGVNb2RlID09PSBTQ0FMRU1PREVfTk9ORSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc29sdXRpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlZmVyZW5jZVJlc29sdXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgdHJ1ZSB0aGVuIHRoZSBTY3JlZW5Db21wb25lbnQgd2lsbCByZW5kZXIgaXRzIGNoaWxkIHtAbGluayBFbGVtZW50Q29tcG9uZW50fXMgaW4gc2NyZWVuXG4gICAgICogc3BhY2UgaW5zdGVhZCBvZiB3b3JsZCBzcGFjZS4gRW5hYmxlIHRoaXMgdG8gY3JlYXRlIDJEIHVzZXIgaW50ZXJmYWNlcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqL1xuICAgIHNldCBzY3JlZW5TcGFjZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9zY3JlZW5TcGFjZSA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy5fc2NyZWVuU3BhY2UpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdXRpb24uc2V0KHRoaXMuc3lzdGVtLmFwcC5ncmFwaGljc0RldmljZS53aWR0aCwgdGhpcy5zeXN0ZW0uYXBwLmdyYXBoaWNzRGV2aWNlLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZXNvbHV0aW9uID0gdGhpcy5fcmVzb2x1dGlvbjsgLy8gZm9yY2UgdXBkYXRlIGVpdGhlciB3YXlcblxuICAgICAgICBpZiAoIXRoaXMuZW50aXR5Ll9kaXJ0eUxvY2FsKVxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuX2RpcnRpZnlMb2NhbCgpO1xuXG4gICAgICAgIHRoaXMuZmlyZSgnc2V0OnNjcmVlbnNwYWNlJywgdGhpcy5fc2NyZWVuU3BhY2UpO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiBlbGVtZW50Ll9vblNjcmVlblNwYWNlQ2hhbmdlKCkpO1xuICAgIH1cblxuICAgIGdldCBzY3JlZW5TcGFjZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmVlblNwYWNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbiBlaXRoZXIgYmUge0BsaW5rIFNDQUxFTU9ERV9OT05FfSBvciB7QGxpbmsgU0NBTEVNT0RFX0JMRU5EfS4gU2VlIHRoZSBkZXNjcmlwdGlvbiBvZlxuICAgICAqIHJlZmVyZW5jZVJlc29sdXRpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNldCBzY2FsZU1vZGUodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSBTQ0FMRU1PREVfTk9ORSAmJiB2YWx1ZSAhPT0gU0NBTEVNT0RFX0JMRU5EKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFNDQUxFTU9ERV9OT05FO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gd29ybGQgc3BhY2Ugc2NyZWVucyBkbyBub3Qgc3VwcG9ydCBzY2FsZSBtb2Rlc1xuICAgICAgICBpZiAoIXRoaXMuX3NjcmVlblNwYWNlICYmIHZhbHVlICE9PSBTQ0FMRU1PREVfTk9ORSkge1xuICAgICAgICAgICAgdmFsdWUgPSBTQ0FMRU1PREVfTk9ORTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3NjYWxlTW9kZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLnJlc29sdXRpb24gPSB0aGlzLl9yZXNvbHV0aW9uOyAvLyBmb3JjZSB1cGRhdGVcbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6c2NhbGVtb2RlJywgdGhpcy5fc2NhbGVNb2RlKTtcbiAgICB9XG5cbiAgICBnZXQgc2NhbGVNb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2NhbGVNb2RlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgdmFsdWUgYmV0d2VlbiAwIGFuZCAxIHRoYXQgaXMgdXNlZCB3aGVuIHNjYWxlTW9kZSBpcyBlcXVhbCB0byB7QGxpbmsgU0NBTEVNT0RFX0JMRU5EfS5cbiAgICAgKiBTY2FsZXMgdGhlIFNjcmVlbkNvbXBvbmVudCB3aXRoIHdpZHRoIGFzIGEgcmVmZXJlbmNlICh3aGVuIHZhbHVlIGlzIDApLCB0aGUgaGVpZ2h0IGFzIGFcbiAgICAgKiByZWZlcmVuY2UgKHdoZW4gdmFsdWUgaXMgMSkgb3IgYW55dGhpbmcgaW4gYmV0d2Vlbi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHNjYWxlQmxlbmQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc2NhbGVCbGVuZCA9IHZhbHVlO1xuICAgICAgICB0aGlzLl91cGRhdGVTY2FsZSgpO1xuICAgICAgICB0aGlzLl9jYWxjUHJvamVjdGlvbk1hdHJpeCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5lbnRpdHkuX2RpcnR5TG9jYWwpXG4gICAgICAgICAgICB0aGlzLmVudGl0eS5fZGlydGlmeUxvY2FsKCk7XG5cbiAgICAgICAgdGhpcy5maXJlKCdzZXQ6c2NhbGVibGVuZCcsIHRoaXMuX3NjYWxlQmxlbmQpO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiBlbGVtZW50Ll9vblNjcmVlblJlc2l6ZSh0aGlzLl9yZXNvbHV0aW9uKSk7XG4gICAgfVxuXG4gICAgZ2V0IHNjYWxlQmxlbmQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zY2FsZUJsZW5kO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByaW9yaXR5IGRldGVybWluZXMgdGhlIG9yZGVyIGluIHdoaWNoIFNjcmVlbiBjb21wb25lbnRzIGluIHRoZSBzYW1lIGxheWVyIGFyZSByZW5kZXJlZC5cbiAgICAgKiBOdW1iZXIgbXVzdCBiZSBhbiBpbnRlZ2VyIGJldHdlZW4gMCBhbmQgMjU1LiBQcmlvcml0eSBpcyBzZXQgaW50byB0aGUgdG9wIDggYml0cyBvZiB0aGVcbiAgICAgKiBkcmF3T3JkZXIgcHJvcGVydHkgaW4gYW4gZWxlbWVudC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHByaW9yaXR5KHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA+IDB4RkYpIHtcbiAgICAgICAgICAgIERlYnVnLndhcm4oYENsYW1waW5nIHNjcmVlbiBwcmlvcml0eSBmcm9tICR7dmFsdWV9IHRvIDI1NWApO1xuICAgICAgICAgICAgdmFsdWUgPSAweEZGO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9wcmlvcml0eSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3ByaW9yaXR5ID0gdmFsdWU7XG4gICAgICAgIHRoaXMuc3luY0RyYXdPcmRlcigpO1xuICAgIH1cblxuICAgIGdldCBwcmlvcml0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByaW9yaXR5O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2NyZWVuQ29tcG9uZW50IH07XG4iXSwibmFtZXMiOlsiX3RyYW5zZm9ybSIsIk1hdDQiLCJTY3JlZW5Db21wb25lbnQiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInN5c3RlbSIsImVudGl0eSIsIl9yZXNvbHV0aW9uIiwiVmVjMiIsIl9yZWZlcmVuY2VSZXNvbHV0aW9uIiwiX3NjYWxlTW9kZSIsIlNDQUxFTU9ERV9OT05FIiwic2NhbGUiLCJfc2NhbGVCbGVuZCIsIl9wcmlvcml0eSIsIl9zY3JlZW5TcGFjZSIsImN1bGwiLCJfc2NyZWVuTWF0cml4IiwiX2VsZW1lbnRzIiwiU2V0IiwiYXBwIiwiZ3JhcGhpY3NEZXZpY2UiLCJvbiIsIl9vblJlc2l6ZSIsInN5bmNEcmF3T3JkZXIiLCJxdWV1ZURyYXdPcmRlclN5bmMiLCJnZXRHdWlkIiwiX3Byb2Nlc3NEcmF3T3JkZXJTeW5jIiwiX3JlY3Vyc2VEcmF3T3JkZXJTeW5jIiwiZSIsImkiLCJFbnRpdHkiLCJlbGVtZW50IiwicHJldkRyYXdPcmRlciIsImRyYXdPcmRlciIsIl9iYXRjaEdyb3VwSWQiLCJiYXRjaGVyIiwibWFya0dyb3VwRGlydHkiLCJwYXJ0aWNsZXN5c3RlbSIsImNoaWxkcmVuIiwiaiIsImxlbmd0aCIsImZpcmUiLCJfY2FsY1Byb2plY3Rpb25NYXRyaXgiLCJ3IiwieCIsImgiLCJ5IiwibGVmdCIsInJpZ2h0IiwiYm90dG9tIiwidG9wIiwibmVhciIsImZhciIsInNldE9ydGhvIiwic2V0U2NhbGUiLCJtdWwyIiwiX3VwZGF0ZVNjYWxlIiwiX2NhbGNTY2FsZSIsInJlZmVyZW5jZVJlc29sdXRpb24iLCJyZXNvbHV0aW9uIiwibHgiLCJNYXRoIiwibG9nMiIsImx5IiwicG93Iiwid2lkdGgiLCJoZWlnaHQiLCJzZXQiLCJfYmluZEVsZW1lbnQiLCJhZGQiLCJfdW5iaW5kRWxlbWVudCIsImRlbGV0ZSIsIm9uUmVtb3ZlIiwib2ZmIiwiZm9yRWFjaCIsIl9vblNjcmVlblJlbW92ZSIsImNsZWFyIiwidmFsdWUiLCJfZGlydHlMb2NhbCIsIl9kaXJ0aWZ5TG9jYWwiLCJfb25TY3JlZW5SZXNpemUiLCJzY3JlZW5TcGFjZSIsIl9vblNjcmVlblNwYWNlQ2hhbmdlIiwic2NhbGVNb2RlIiwiU0NBTEVNT0RFX0JMRU5EIiwic2NhbGVCbGVuZCIsInByaW9yaXR5IiwiRGVidWciLCJ3YXJuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFZQSxNQUFNQSxVQUFVLEdBQUcsSUFBSUMsSUFBSixFQUFuQixDQUFBOztBQVFBLE1BQU1DLGVBQU4sU0FBOEJDLFNBQTlCLENBQXdDO0FBT3BDQyxFQUFBQSxXQUFXLENBQUNDLE1BQUQsRUFBU0MsTUFBVCxFQUFpQjtJQUN4QixLQUFNRCxDQUFBQSxNQUFOLEVBQWNDLE1BQWQsQ0FBQSxDQUFBO0lBRUEsSUFBS0MsQ0FBQUEsV0FBTCxHQUFtQixJQUFJQyxJQUFKLENBQVMsR0FBVCxFQUFjLEdBQWQsQ0FBbkIsQ0FBQTtJQUNBLElBQUtDLENBQUFBLG9CQUFMLEdBQTRCLElBQUlELElBQUosQ0FBUyxHQUFULEVBQWMsR0FBZCxDQUE1QixDQUFBO0lBQ0EsSUFBS0UsQ0FBQUEsVUFBTCxHQUFrQkMsY0FBbEIsQ0FBQTtJQUNBLElBQUtDLENBQUFBLEtBQUwsR0FBYSxDQUFiLENBQUE7SUFDQSxJQUFLQyxDQUFBQSxXQUFMLEdBQW1CLEdBQW5CLENBQUE7SUFFQSxJQUFLQyxDQUFBQSxTQUFMLEdBQWlCLENBQWpCLENBQUE7SUFFQSxJQUFLQyxDQUFBQSxZQUFMLEdBQW9CLEtBQXBCLENBQUE7SUFRQSxJQUFLQyxDQUFBQSxJQUFMLEdBQVksSUFBQSxDQUFLRCxZQUFqQixDQUFBO0FBQ0EsSUFBQSxJQUFBLENBQUtFLGFBQUwsR0FBcUIsSUFBSWhCLElBQUosRUFBckIsQ0FBQTtBQUVBLElBQUEsSUFBQSxDQUFLaUIsU0FBTCxHQUFpQixJQUFJQyxHQUFKLEVBQWpCLENBQUE7QUFFQWQsSUFBQUEsTUFBTSxDQUFDZSxHQUFQLENBQVdDLGNBQVgsQ0FBMEJDLEVBQTFCLENBQTZCLGNBQTdCLEVBQTZDLElBQUEsQ0FBS0MsU0FBbEQsRUFBNkQsSUFBN0QsQ0FBQSxDQUFBO0FBQ0gsR0FBQTs7QUFPREMsRUFBQUEsYUFBYSxHQUFHO0FBQ1osSUFBQSxJQUFBLENBQUtuQixNQUFMLENBQVlvQixrQkFBWixDQUErQixJQUFLbkIsQ0FBQUEsTUFBTCxDQUFZb0IsT0FBWixFQUEvQixFQUFzRCxJQUFLQyxDQUFBQSxxQkFBM0QsRUFBa0YsSUFBbEYsQ0FBQSxDQUFBO0FBQ0gsR0FBQTs7QUFFREMsRUFBQUEscUJBQXFCLENBQUNDLENBQUQsRUFBSUMsQ0FBSixFQUFPO0FBQ3hCLElBQUEsSUFBSSxFQUFFRCxDQUFDLFlBQVlFLE1BQWYsQ0FBSixFQUE0QjtBQUN4QixNQUFBLE9BQU9ELENBQVAsQ0FBQTtBQUNILEtBQUE7O0lBRUQsSUFBSUQsQ0FBQyxDQUFDRyxPQUFOLEVBQWU7QUFDWCxNQUFBLE1BQU1DLGFBQWEsR0FBR0osQ0FBQyxDQUFDRyxPQUFGLENBQVVFLFNBQWhDLENBQUE7QUFDQUwsTUFBQUEsQ0FBQyxDQUFDRyxPQUFGLENBQVVFLFNBQVYsR0FBc0JKLENBQUMsRUFBdkIsQ0FBQTs7QUFFQSxNQUFBLElBQUlELENBQUMsQ0FBQ0csT0FBRixDQUFVRyxhQUFWLElBQTJCLENBQTNCLElBQWdDRixhQUFhLEtBQUtKLENBQUMsQ0FBQ0csT0FBRixDQUFVRSxTQUFoRSxFQUEyRTtBQUFBLFFBQUEsSUFBQSxxQkFBQSxDQUFBOztBQUN2RSxRQUFBLENBQUEscUJBQUEsR0FBQSxJQUFBLENBQUs3QixNQUFMLENBQVllLEdBQVosQ0FBZ0JnQixPQUFoQixLQUFBLElBQUEsR0FBQSxLQUFBLENBQUEsR0FBQSxxQkFBQSxDQUF5QkMsY0FBekIsQ0FBd0NSLENBQUMsQ0FBQ0csT0FBRixDQUFVRyxhQUFsRCxDQUFBLENBQUE7QUFDSCxPQUFBO0FBQ0osS0FBQTs7SUFHRCxJQUFJTixDQUFDLENBQUNTLGNBQU4sRUFBc0I7QUFDbEJULE1BQUFBLENBQUMsQ0FBQ1MsY0FBRixDQUFpQkosU0FBakIsR0FBNkJKLENBQUMsRUFBOUIsQ0FBQTtBQUNILEtBQUE7O0FBRUQsSUFBQSxNQUFNUyxRQUFRLEdBQUdWLENBQUMsQ0FBQ1UsUUFBbkIsQ0FBQTs7QUFDQSxJQUFBLEtBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0QsUUFBUSxDQUFDRSxNQUE3QixFQUFxQ0QsQ0FBQyxFQUF0QyxFQUEwQztNQUN0Q1YsQ0FBQyxHQUFHLElBQUtGLENBQUFBLHFCQUFMLENBQTJCVyxRQUFRLENBQUNDLENBQUQsQ0FBbkMsRUFBd0NWLENBQXhDLENBQUosQ0FBQTtBQUNILEtBQUE7O0FBRUQsSUFBQSxPQUFPQSxDQUFQLENBQUE7QUFDSCxHQUFBOztBQUVESCxFQUFBQSxxQkFBcUIsR0FBRztJQUNwQixNQUFNRyxDQUFDLEdBQUcsQ0FBVixDQUFBOztBQUVBLElBQUEsSUFBQSxDQUFLRixxQkFBTCxDQUEyQixJQUFLdEIsQ0FBQUEsTUFBaEMsRUFBd0N3QixDQUF4QyxDQUFBLENBQUE7O0lBR0EsSUFBS1ksQ0FBQUEsSUFBTCxDQUFVLGVBQVYsQ0FBQSxDQUFBO0FBQ0gsR0FBQTs7QUFFREMsRUFBQUEscUJBQXFCLEdBQUc7SUFDcEIsTUFBTUMsQ0FBQyxHQUFHLElBQUtyQyxDQUFBQSxXQUFMLENBQWlCc0MsQ0FBakIsR0FBcUIsS0FBS2pDLEtBQXBDLENBQUE7SUFDQSxNQUFNa0MsQ0FBQyxHQUFHLElBQUt2QyxDQUFBQSxXQUFMLENBQWlCd0MsQ0FBakIsR0FBcUIsS0FBS25DLEtBQXBDLENBQUE7SUFFQSxNQUFNb0MsSUFBSSxHQUFHLENBQWIsQ0FBQTtJQUNBLE1BQU1DLEtBQUssR0FBR0wsQ0FBZCxDQUFBO0lBQ0EsTUFBTU0sTUFBTSxHQUFHLENBQUNKLENBQWhCLENBQUE7SUFDQSxNQUFNSyxHQUFHLEdBQUcsQ0FBWixDQUFBO0lBQ0EsTUFBTUMsSUFBSSxHQUFHLENBQWIsQ0FBQTtJQUNBLE1BQU1DLEdBQUcsR0FBRyxDQUFDLENBQWIsQ0FBQTs7QUFFQSxJQUFBLElBQUEsQ0FBS3BDLGFBQUwsQ0FBbUJxQyxRQUFuQixDQUE0Qk4sSUFBNUIsRUFBa0NDLEtBQWxDLEVBQXlDQyxNQUF6QyxFQUFpREMsR0FBakQsRUFBc0RDLElBQXRELEVBQTREQyxHQUE1RCxDQUFBLENBQUE7O0lBRUEsSUFBSSxDQUFDLElBQUt0QyxDQUFBQSxZQUFWLEVBQXdCO01BQ3BCZixVQUFVLENBQUN1RCxRQUFYLENBQW9CLEdBQUEsR0FBTVgsQ0FBMUIsRUFBNkIsR0FBQSxHQUFNRSxDQUFuQyxFQUFzQyxDQUF0QyxDQUFBLENBQUE7O0FBQ0EsTUFBQSxJQUFBLENBQUs3QixhQUFMLENBQW1CdUMsSUFBbkIsQ0FBd0J4RCxVQUF4QixFQUFvQyxLQUFLaUIsYUFBekMsQ0FBQSxDQUFBO0FBQ0gsS0FBQTtBQUNKLEdBQUE7O0FBRUR3QyxFQUFBQSxZQUFZLEdBQUc7SUFDWCxJQUFLN0MsQ0FBQUEsS0FBTCxHQUFhLElBQUEsQ0FBSzhDLFVBQUwsQ0FBZ0IsS0FBS25ELFdBQXJCLEVBQWtDLElBQUtvRCxDQUFBQSxtQkFBdkMsQ0FBYixDQUFBO0FBQ0gsR0FBQTs7QUFFREQsRUFBQUEsVUFBVSxDQUFDRSxVQUFELEVBQWFELG1CQUFiLEVBQWtDO0FBSXhDLElBQUEsTUFBTUUsRUFBRSxHQUFHQyxJQUFJLENBQUNDLElBQUwsQ0FBVUgsVUFBVSxDQUFDZixDQUFYLEdBQWVjLG1CQUFtQixDQUFDZCxDQUE3QyxDQUFYLENBQUE7QUFDQSxJQUFBLE1BQU1tQixFQUFFLEdBQUdGLElBQUksQ0FBQ0MsSUFBTCxDQUFVSCxVQUFVLENBQUNiLENBQVgsR0FBZVksbUJBQW1CLENBQUNaLENBQTdDLENBQVgsQ0FBQTtBQUNBLElBQUEsT0FBT2UsSUFBSSxDQUFDRyxHQUFMLENBQVMsQ0FBVCxFQUFhSixFQUFFLElBQUksQ0FBSSxHQUFBLElBQUEsQ0FBS2hELFdBQWIsQ0FBRixHQUE4Qm1ELEVBQUUsR0FBRyxJQUFBLENBQUtuRCxXQUFyRCxDQUFQLENBQUE7QUFDSCxHQUFBOztBQUVEVSxFQUFBQSxTQUFTLENBQUMyQyxLQUFELEVBQVFDLE1BQVIsRUFBZ0I7SUFDckIsSUFBSSxJQUFBLENBQUtwRCxZQUFULEVBQXVCO0FBQ25CLE1BQUEsSUFBQSxDQUFLUixXQUFMLENBQWlCNkQsR0FBakIsQ0FBcUJGLEtBQXJCLEVBQTRCQyxNQUE1QixDQUFBLENBQUE7O01BQ0EsSUFBS1AsQ0FBQUEsVUFBTCxHQUFrQixJQUFBLENBQUtyRCxXQUF2QixDQUFBO0FBQ0gsS0FBQTtBQUNKLEdBQUE7O0VBRUQ4RCxZQUFZLENBQUNyQyxPQUFELEVBQVU7QUFDbEIsSUFBQSxJQUFBLENBQUtkLFNBQUwsQ0FBZW9ELEdBQWYsQ0FBbUJ0QyxPQUFuQixDQUFBLENBQUE7QUFDSCxHQUFBOztFQUVEdUMsY0FBYyxDQUFDdkMsT0FBRCxFQUFVO0FBQ3BCLElBQUEsSUFBQSxDQUFLZCxTQUFMLENBQWVzRCxNQUFmLENBQXNCeEMsT0FBdEIsQ0FBQSxDQUFBO0FBQ0gsR0FBQTs7QUFFRHlDLEVBQUFBLFFBQVEsR0FBRztBQUNQLElBQUEsSUFBQSxDQUFLcEUsTUFBTCxDQUFZZSxHQUFaLENBQWdCQyxjQUFoQixDQUErQnFELEdBQS9CLENBQW1DLGNBQW5DLEVBQW1ELElBQUtuRCxDQUFBQSxTQUF4RCxFQUFtRSxJQUFuRSxDQUFBLENBQUE7SUFDQSxJQUFLbUIsQ0FBQUEsSUFBTCxDQUFVLFFBQVYsQ0FBQSxDQUFBOztJQUVBLElBQUt4QixDQUFBQSxTQUFMLENBQWV5RCxPQUFmLENBQXVCM0MsT0FBTyxJQUFJQSxPQUFPLENBQUM0QyxlQUFSLEVBQWxDLENBQUEsQ0FBQTs7SUFDQSxJQUFLMUQsQ0FBQUEsU0FBTCxDQUFlMkQsS0FBZixFQUFBLENBQUE7O0FBR0EsSUFBQSxJQUFBLENBQUtILEdBQUwsRUFBQSxDQUFBO0FBRUgsR0FBQTs7RUFRYSxJQUFWZCxVQUFVLENBQUNrQixLQUFELEVBQVE7SUFDbEIsSUFBSSxDQUFDLElBQUsvRCxDQUFBQSxZQUFWLEVBQXdCO01BQ3BCLElBQUtSLENBQUFBLFdBQUwsQ0FBaUI2RCxHQUFqQixDQUFxQlUsS0FBSyxDQUFDakMsQ0FBM0IsRUFBOEJpQyxLQUFLLENBQUMvQixDQUFwQyxDQUFBLENBQUE7QUFDSCxLQUZELE1BRU87TUFFSCxJQUFLeEMsQ0FBQUEsV0FBTCxDQUFpQjZELEdBQWpCLENBQXFCLEtBQUsvRCxNQUFMLENBQVllLEdBQVosQ0FBZ0JDLGNBQWhCLENBQStCNkMsS0FBcEQsRUFBMkQsS0FBSzdELE1BQUwsQ0FBWWUsR0FBWixDQUFnQkMsY0FBaEIsQ0FBK0I4QyxNQUExRixDQUFBLENBQUE7QUFDSCxLQUFBOztBQUVELElBQUEsSUFBQSxDQUFLVixZQUFMLEVBQUEsQ0FBQTs7QUFFQSxJQUFBLElBQUEsQ0FBS2QscUJBQUwsRUFBQSxDQUFBOztJQUVBLElBQUksQ0FBQyxLQUFLckMsTUFBTCxDQUFZeUUsV0FBakIsRUFDSSxJQUFBLENBQUt6RSxNQUFMLENBQVkwRSxhQUFaLEVBQUEsQ0FBQTtBQUVKLElBQUEsSUFBQSxDQUFLdEMsSUFBTCxDQUFVLGdCQUFWLEVBQTRCLEtBQUtuQyxXQUFqQyxDQUFBLENBQUE7O0FBQ0EsSUFBQSxJQUFBLENBQUtXLFNBQUwsQ0FBZXlELE9BQWYsQ0FBdUIzQyxPQUFPLElBQUlBLE9BQU8sQ0FBQ2lELGVBQVIsQ0FBd0IsSUFBSzFFLENBQUFBLFdBQTdCLENBQWxDLENBQUEsQ0FBQTtBQUNILEdBQUE7O0FBRWEsRUFBQSxJQUFWcUQsVUFBVSxHQUFHO0FBQ2IsSUFBQSxPQUFPLEtBQUtyRCxXQUFaLENBQUE7QUFDSCxHQUFBOztFQVNzQixJQUFuQm9ELG1CQUFtQixDQUFDbUIsS0FBRCxFQUFRO0lBQzNCLElBQUtyRSxDQUFBQSxvQkFBTCxDQUEwQjJELEdBQTFCLENBQThCVSxLQUFLLENBQUNqQyxDQUFwQyxFQUF1Q2lDLEtBQUssQ0FBQy9CLENBQTdDLENBQUEsQ0FBQTs7QUFDQSxJQUFBLElBQUEsQ0FBS1UsWUFBTCxFQUFBLENBQUE7O0FBQ0EsSUFBQSxJQUFBLENBQUtkLHFCQUFMLEVBQUEsQ0FBQTs7SUFFQSxJQUFJLENBQUMsS0FBS3JDLE1BQUwsQ0FBWXlFLFdBQWpCLEVBQ0ksSUFBQSxDQUFLekUsTUFBTCxDQUFZMEUsYUFBWixFQUFBLENBQUE7QUFFSixJQUFBLElBQUEsQ0FBS3RDLElBQUwsQ0FBVSx5QkFBVixFQUFxQyxLQUFLbkMsV0FBMUMsQ0FBQSxDQUFBOztBQUNBLElBQUEsSUFBQSxDQUFLVyxTQUFMLENBQWV5RCxPQUFmLENBQXVCM0MsT0FBTyxJQUFJQSxPQUFPLENBQUNpRCxlQUFSLENBQXdCLElBQUsxRSxDQUFBQSxXQUE3QixDQUFsQyxDQUFBLENBQUE7QUFDSCxHQUFBOztBQUVzQixFQUFBLElBQW5Cb0QsbUJBQW1CLEdBQUc7QUFDdEIsSUFBQSxJQUFJLElBQUtqRCxDQUFBQSxVQUFMLEtBQW9CQyxjQUF4QixFQUF3QztBQUNwQyxNQUFBLE9BQU8sS0FBS0osV0FBWixDQUFBO0FBQ0gsS0FBQTs7QUFDRCxJQUFBLE9BQU8sS0FBS0Usb0JBQVosQ0FBQTtBQUNILEdBQUE7O0VBUWMsSUFBWHlFLFdBQVcsQ0FBQ0osS0FBRCxFQUFRO0lBQ25CLElBQUsvRCxDQUFBQSxZQUFMLEdBQW9CK0QsS0FBcEIsQ0FBQTs7SUFDQSxJQUFJLElBQUEsQ0FBSy9ELFlBQVQsRUFBdUI7TUFDbkIsSUFBS1IsQ0FBQUEsV0FBTCxDQUFpQjZELEdBQWpCLENBQXFCLEtBQUsvRCxNQUFMLENBQVllLEdBQVosQ0FBZ0JDLGNBQWhCLENBQStCNkMsS0FBcEQsRUFBMkQsS0FBSzdELE1BQUwsQ0FBWWUsR0FBWixDQUFnQkMsY0FBaEIsQ0FBK0I4QyxNQUExRixDQUFBLENBQUE7QUFDSCxLQUFBOztJQUNELElBQUtQLENBQUFBLFVBQUwsR0FBa0IsSUFBQSxDQUFLckQsV0FBdkIsQ0FBQTtJQUVBLElBQUksQ0FBQyxLQUFLRCxNQUFMLENBQVl5RSxXQUFqQixFQUNJLElBQUEsQ0FBS3pFLE1BQUwsQ0FBWTBFLGFBQVosRUFBQSxDQUFBO0FBRUosSUFBQSxJQUFBLENBQUt0QyxJQUFMLENBQVUsaUJBQVYsRUFBNkIsS0FBSzNCLFlBQWxDLENBQUEsQ0FBQTs7SUFFQSxJQUFLRyxDQUFBQSxTQUFMLENBQWV5RCxPQUFmLENBQXVCM0MsT0FBTyxJQUFJQSxPQUFPLENBQUNtRCxvQkFBUixFQUFsQyxDQUFBLENBQUE7QUFDSCxHQUFBOztBQUVjLEVBQUEsSUFBWEQsV0FBVyxHQUFHO0FBQ2QsSUFBQSxPQUFPLEtBQUtuRSxZQUFaLENBQUE7QUFDSCxHQUFBOztFQVFZLElBQVRxRSxTQUFTLENBQUNOLEtBQUQsRUFBUTtBQUNqQixJQUFBLElBQUlBLEtBQUssS0FBS25FLGNBQVYsSUFBNEJtRSxLQUFLLEtBQUtPLGVBQTFDLEVBQTJEO0FBQ3ZEUCxNQUFBQSxLQUFLLEdBQUduRSxjQUFSLENBQUE7QUFDSCxLQUFBOztBQUdELElBQUEsSUFBSSxDQUFDLElBQUtJLENBQUFBLFlBQU4sSUFBc0IrRCxLQUFLLEtBQUtuRSxjQUFwQyxFQUFvRDtBQUNoRG1FLE1BQUFBLEtBQUssR0FBR25FLGNBQVIsQ0FBQTtBQUNILEtBQUE7O0lBRUQsSUFBS0QsQ0FBQUEsVUFBTCxHQUFrQm9FLEtBQWxCLENBQUE7SUFDQSxJQUFLbEIsQ0FBQUEsVUFBTCxHQUFrQixJQUFBLENBQUtyRCxXQUF2QixDQUFBO0FBQ0EsSUFBQSxJQUFBLENBQUttQyxJQUFMLENBQVUsZUFBVixFQUEyQixLQUFLaEMsVUFBaEMsQ0FBQSxDQUFBO0FBQ0gsR0FBQTs7QUFFWSxFQUFBLElBQVQwRSxTQUFTLEdBQUc7QUFDWixJQUFBLE9BQU8sS0FBSzFFLFVBQVosQ0FBQTtBQUNILEdBQUE7O0VBU2EsSUFBVjRFLFVBQVUsQ0FBQ1IsS0FBRCxFQUFRO0lBQ2xCLElBQUtqRSxDQUFBQSxXQUFMLEdBQW1CaUUsS0FBbkIsQ0FBQTs7QUFDQSxJQUFBLElBQUEsQ0FBS3JCLFlBQUwsRUFBQSxDQUFBOztBQUNBLElBQUEsSUFBQSxDQUFLZCxxQkFBTCxFQUFBLENBQUE7O0lBRUEsSUFBSSxDQUFDLEtBQUtyQyxNQUFMLENBQVl5RSxXQUFqQixFQUNJLElBQUEsQ0FBS3pFLE1BQUwsQ0FBWTBFLGFBQVosRUFBQSxDQUFBO0FBRUosSUFBQSxJQUFBLENBQUt0QyxJQUFMLENBQVUsZ0JBQVYsRUFBNEIsS0FBSzdCLFdBQWpDLENBQUEsQ0FBQTs7QUFFQSxJQUFBLElBQUEsQ0FBS0ssU0FBTCxDQUFleUQsT0FBZixDQUF1QjNDLE9BQU8sSUFBSUEsT0FBTyxDQUFDaUQsZUFBUixDQUF3QixJQUFLMUUsQ0FBQUEsV0FBN0IsQ0FBbEMsQ0FBQSxDQUFBO0FBQ0gsR0FBQTs7QUFFYSxFQUFBLElBQVYrRSxVQUFVLEdBQUc7QUFDYixJQUFBLE9BQU8sS0FBS3pFLFdBQVosQ0FBQTtBQUNILEdBQUE7O0VBU1csSUFBUjBFLFFBQVEsQ0FBQ1QsS0FBRCxFQUFRO0lBQ2hCLElBQUlBLEtBQUssR0FBRyxJQUFaLEVBQWtCO0FBQ2RVLE1BQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFZLENBQUEsOEJBQUEsRUFBZ0NYLEtBQU0sQ0FBbEQsT0FBQSxDQUFBLENBQUEsQ0FBQTtBQUNBQSxNQUFBQSxLQUFLLEdBQUcsSUFBUixDQUFBO0FBQ0gsS0FBQTs7QUFDRCxJQUFBLElBQUksSUFBS2hFLENBQUFBLFNBQUwsS0FBbUJnRSxLQUF2QixFQUE4QjtBQUMxQixNQUFBLE9BQUE7QUFDSCxLQUFBOztJQUVELElBQUtoRSxDQUFBQSxTQUFMLEdBQWlCZ0UsS0FBakIsQ0FBQTtBQUNBLElBQUEsSUFBQSxDQUFLdEQsYUFBTCxFQUFBLENBQUE7QUFDSCxHQUFBOztBQUVXLEVBQUEsSUFBUitELFFBQVEsR0FBRztBQUNYLElBQUEsT0FBTyxLQUFLekUsU0FBWixDQUFBO0FBQ0gsR0FBQTs7QUFqU21DOzs7OyJ9
