/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../../core/debug.js';
import { DISTANCE_LINEAR } from '../../../audio/constants.js';
import { Component } from '../component.js';
import { SoundSlot } from './slot.js';

class SoundComponent extends Component {
  constructor(system, entity) {
    super(system, entity);
    this._volume = 1;
    this._pitch = 1;
    this._positional = true;
    this._refDistance = 1;
    this._maxDistance = 10000;
    this._rollOffFactor = 1;
    this._distanceModel = DISTANCE_LINEAR;
    this._slots = {};
    this._playingBeforeDisable = {};
  }

  _updateSoundInstances(property, value, isFactor) {
    const slots = this._slots;

    for (const key in slots) {
      const slot = slots[key];

      if (!slot.overlap) {
        const instances = slot.instances;

        for (let i = 0, len = instances.length; i < len; i++) {
          instances[i][property] = isFactor ? slot[property] * value : value;
        }
      }
    }
  }

  set distanceModel(value) {
    this._distanceModel = value;

    this._updateSoundInstances('distanceModel', value, false);
  }

  get distanceModel() {
    return this._distanceModel;
  }

  set maxDistance(value) {
    this._maxDistance = value;

    this._updateSoundInstances('maxDistance', value, false);
  }

  get maxDistance() {
    return this._maxDistance;
  }

  set refDistance(value) {
    this._refDistance = value;

    this._updateSoundInstances('refDistance', value, false);
  }

  get refDistance() {
    return this._refDistance;
  }

  set rollOffFactor(value) {
    this._rollOffFactor = value;

    this._updateSoundInstances('rollOffFactor', value, false);
  }

  get rollOffFactor() {
    return this._rollOffFactor;
  }

  set pitch(value) {
    this._pitch = value;

    this._updateSoundInstances('pitch', value, true);
  }

  get pitch() {
    return this._pitch;
  }

  set volume(value) {
    this._volume = value;

    this._updateSoundInstances('volume', value, true);
  }

  get volume() {
    return this._volume;
  }

  set positional(newValue) {
    this._positional = newValue;
    const slots = this._slots;

    for (const key in slots) {
      const slot = slots[key];

      if (!slot.overlap) {
        const instances = slot.instances;
        const oldLength = instances.length;

        for (let i = oldLength - 1; i >= 0; i--) {
          const isPlaying = instances[i].isPlaying || instances[i].isSuspended;
          const currentTime = instances[i].currentTime;
          if (isPlaying) instances[i].stop();

          const instance = slot._createInstance();

          if (isPlaying) {
            instance.play();
            instance.currentTime = currentTime;
          }

          instances.push(instance);
        }
      }
    }
  }

  get positional() {
    return this._positional;
  }

  set slots(newValue) {
    const oldValue = this._slots;

    if (oldValue) {
      for (const key in oldValue) {
        oldValue[key].stop();
      }
    }

    const slots = {};

    for (const key in newValue) {
      if (!(newValue[key] instanceof SoundSlot)) {
        if (newValue[key].name) {
          slots[newValue[key].name] = new SoundSlot(this, newValue[key].name, newValue[key]);
        }
      } else {
        slots[newValue[key].name] = newValue[key];
      }
    }

    this._slots = slots;
    if (this.enabled && this.entity.enabled) this.onEnable();
  }

  get slots() {
    return this._slots;
  }

  onEnable() {
    if (this.system._inTools) {
      return;
    }

    const slots = this._slots;
    const playingBeforeDisable = this._playingBeforeDisable;

    for (const key in slots) {
      const slot = slots[key];

      if (slot.autoPlay && slot.isStopped) {
        slot.play();
      } else if (playingBeforeDisable[key]) {
        slot.resume();
      } else if (!slot.isLoaded) {
        slot.load();
      }
    }
  }

  onDisable() {
    const slots = this._slots;
    const playingBeforeDisable = {};

    for (const key in slots) {
      if (!slots[key].overlap) {
        if (slots[key].isPlaying) {
          slots[key].pause();
          playingBeforeDisable[key] = true;
        }
      }
    }

    this._playingBeforeDisable = playingBeforeDisable;
  }

  onRemove() {
    this.off();
  }

  addSlot(name, options) {
    const slots = this._slots;

    if (slots[name]) {
      Debug.warn(`A sound slot with name ${name} already exists on Entity ${this.entity.path}`);
      return null;
    }

    const slot = new SoundSlot(this, name, options);
    slots[name] = slot;

    if (slot.autoPlay && this.enabled && this.entity.enabled) {
      slot.play();
    }

    return slot;
  }

  removeSlot(name) {
    const slots = this._slots;

    if (slots[name]) {
      slots[name].stop();
      delete slots[name];
    }
  }

  slot(name) {
    return this._slots[name];
  }

  play(name) {
    if (!this.enabled || !this.entity.enabled) {
      return null;
    }

    const slot = this._slots[name];

    if (!slot) {
      Debug.warn(`Trying to play sound slot with name ${name} which does not exist`);
      return null;
    }

    return slot.play();
  }

  pause(name) {
    const slots = this._slots;

    if (name) {
      const slot = slots[name];

      if (!slot) {
        Debug.warn(`Trying to pause sound slot with name ${name} which does not exist`);
        return;
      }

      slot.pause();
    } else {
      for (const key in slots) {
        slots[key].pause();
      }
    }
  }

  resume(name) {
    const slots = this._slots;

    if (name) {
      const slot = slots[name];

      if (!slot) {
        Debug.warn(`Trying to resume sound slot with name ${name} which does not exist`);
        return;
      }

      if (slot.isPaused) {
        slot.resume();
      }
    } else {
      for (const key in slots) {
        slots[key].resume();
      }
    }
  }

  stop(name) {
    const slots = this._slots;

    if (name) {
      const slot = slots[name];

      if (!slot) {
        Debug.warn(`Trying to stop sound slot with name ${name} which does not exist`);
        return;
      }

      slot.stop();
    } else {
      for (const key in slots) {
        slots[key].stop();
      }
    }
  }

}

export { SoundComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc291bmQvY29tcG9uZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5cbmltcG9ydCB7IERJU1RBTkNFX0xJTkVBUiB9IGZyb20gJy4uLy4uLy4uL2F1ZGlvL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudC5qcyc7XG5cbmltcG9ydCB7IFNvdW5kU2xvdCB9IGZyb20gJy4vc2xvdC5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi8uLi9lbnRpdHkuanMnKS5FbnRpdHl9IEVudGl0eSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uLy4uL3NvdW5kL2luc3RhbmNlLmpzJykuU291bmRJbnN0YW5jZX0gU291bmRJbnN0YW5jZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vc3lzdGVtLmpzJykuU291bmRDb21wb25lbnRTeXN0ZW19IFNvdW5kQ29tcG9uZW50U3lzdGVtICovXG5cbi8qKlxuICogVGhlIFNvdW5kIENvbXBvbmVudCBjb250cm9scyBwbGF5YmFjayBvZiB7QGxpbmsgU291bmR9cy5cbiAqXG4gKiBAYXVnbWVudHMgQ29tcG9uZW50XG4gKi9cbmNsYXNzIFNvdW5kQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU291bmQgQ29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTb3VuZENvbXBvbmVudFN5c3RlbX0gc3lzdGVtIC0gVGhlIENvbXBvbmVudFN5c3RlbSB0aGF0IGNyZWF0ZWQgdGhpcyBjb21wb25lbnQuXG4gICAgICogQHBhcmFtIHtFbnRpdHl9IGVudGl0eSAtIFRoZSBlbnRpdHkgdGhhdCB0aGUgQ29tcG9uZW50IGlzIGF0dGFjaGVkIHRvLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHN5c3RlbSwgZW50aXR5KSB7XG4gICAgICAgIHN1cGVyKHN5c3RlbSwgZW50aXR5KTtcblxuICAgICAgICAvKiogQHByaXZhdGUgKi9cbiAgICAgICAgdGhpcy5fdm9sdW1lID0gMTtcbiAgICAgICAgLyoqIEBwcml2YXRlICovXG4gICAgICAgIHRoaXMuX3BpdGNoID0gMTtcbiAgICAgICAgLyoqIEBwcml2YXRlICovXG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uYWwgPSB0cnVlO1xuICAgICAgICAvKiogQHByaXZhdGUgKi9cbiAgICAgICAgdGhpcy5fcmVmRGlzdGFuY2UgPSAxO1xuICAgICAgICAvKiogQHByaXZhdGUgKi9cbiAgICAgICAgdGhpcy5fbWF4RGlzdGFuY2UgPSAxMDAwMDtcbiAgICAgICAgLyoqIEBwcml2YXRlICovXG4gICAgICAgIHRoaXMuX3JvbGxPZmZGYWN0b3IgPSAxO1xuICAgICAgICAvKiogQHByaXZhdGUgKi9cbiAgICAgICAgdGhpcy5fZGlzdGFuY2VNb2RlbCA9IERJU1RBTkNFX0xJTkVBUjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUge09iamVjdDxzdHJpbmcsIFNvdW5kU2xvdD59XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9zbG90cyA9IHt9O1xuXG4gICAgICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgICAgICB0aGlzLl9wbGF5aW5nQmVmb3JlRGlzYWJsZSA9IHt9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBzb3VuZCBpbnN0YW5jZSBzdGFydHMgcGxheWluZy5cbiAgICAgKlxuICAgICAqIEBldmVudCBTb3VuZENvbXBvbmVudCNwbGF5XG4gICAgICogQHBhcmFtIHtTb3VuZFNsb3R9IHNsb3QgLSBUaGUgc2xvdCB3aG9zZSBpbnN0YW5jZSBzdGFydGVkIHBsYXlpbmcuXG4gICAgICogQHBhcmFtIHtTb3VuZEluc3RhbmNlfSBpbnN0YW5jZSAtIFRoZSBpbnN0YW5jZSB0aGF0IHN0YXJ0ZWQgcGxheWluZy5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBzb3VuZCBpbnN0YW5jZSBpcyBwYXVzZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgU291bmRDb21wb25lbnQjcGF1c2VcbiAgICAgKiBAcGFyYW0ge1NvdW5kU2xvdH0gc2xvdCAtIFRoZSBzbG90IHdob3NlIGluc3RhbmNlIHdhcyBwYXVzZWQuXG4gICAgICogQHBhcmFtIHtTb3VuZEluc3RhbmNlfSBpbnN0YW5jZSAtIFRoZSBpbnN0YW5jZSB0aGF0IHdhcyBwYXVzZWQgY3JlYXRlZCB0byBwbGF5IHRoZSBzb3VuZC5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBzb3VuZCBpbnN0YW5jZSBpcyByZXN1bWVkLlxuICAgICAqXG4gICAgICogQGV2ZW50IFNvdW5kQ29tcG9uZW50I3Jlc3VtZVxuICAgICAqIEBwYXJhbSB7U291bmRTbG90fSBzbG90IC0gVGhlIHNsb3Qgd2hvc2UgaW5zdGFuY2Ugd2FzIHJlc3VtZWQuXG4gICAgICogQHBhcmFtIHtTb3VuZEluc3RhbmNlfSBpbnN0YW5jZSAtIFRoZSBpbnN0YW5jZSB0aGF0IHdhcyByZXN1bWVkLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhIHNvdW5kIGluc3RhbmNlIGlzIHN0b3BwZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgU291bmRDb21wb25lbnQjc3RvcFxuICAgICAqIEBwYXJhbSB7U291bmRTbG90fSBzbG90IC0gVGhlIHNsb3Qgd2hvc2UgaW5zdGFuY2Ugd2FzIHN0b3BwZWQuXG4gICAgICogQHBhcmFtIHtTb3VuZEluc3RhbmNlfSBpbnN0YW5jZSAtIFRoZSBpbnN0YW5jZSB0aGF0IHdhcyBzdG9wcGVkLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhIHNvdW5kIGluc3RhbmNlIHN0b3BzIHBsYXlpbmcgYmVjYXVzZSBpdCByZWFjaGVkIGl0cyBlbmRpbmcuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgU291bmRDb21wb25lbnQjZW5kXG4gICAgICogQHBhcmFtIHtTb3VuZFNsb3R9IHNsb3QgLSBUaGUgc2xvdCB3aG9zZSBpbnN0YW5jZSBlbmRlZC5cbiAgICAgKiBAcGFyYW0ge1NvdW5kSW5zdGFuY2V9IGluc3RhbmNlIC0gVGhlIGluc3RhbmNlIHRoYXQgZW5kZWQuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIHNwZWNpZmllZCBwcm9wZXJ0eSBvbiBhbGwgc291bmQgaW5zdGFuY2VzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5IC0gVGhlIG5hbWUgb2YgdGhlIFNvdW5kSW5zdGFuY2UgcHJvcGVydHkgdG8gdXBkYXRlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0IHRoZSBwcm9wZXJ0eSB0by5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRmFjdG9yIC0gVHJ1ZSBpZiB0aGUgdmFsdWUgaXMgYSBmYWN0b3Igb2YgdGhlIHNsb3QgcHJvcGVydHkgb3IgZmFsc2VcbiAgICAgKiBpZiBpdCBpcyBhbiBhYnNvbHV0ZSB2YWx1ZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91cGRhdGVTb3VuZEluc3RhbmNlcyhwcm9wZXJ0eSwgdmFsdWUsIGlzRmFjdG9yKSB7XG4gICAgICAgIGNvbnN0IHNsb3RzID0gdGhpcy5fc2xvdHM7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHNsb3RzKSB7XG4gICAgICAgICAgICBjb25zdCBzbG90ID0gc2xvdHNba2V5XTtcbiAgICAgICAgICAgIC8vIG9ubHkgY2hhbmdlIHZhbHVlIG9mIG5vbi1vdmVybGFwcGluZyBpbnN0YW5jZXNcbiAgICAgICAgICAgIGlmICghc2xvdC5vdmVybGFwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gc2xvdC5pbnN0YW5jZXM7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXNbaV1bcHJvcGVydHldID0gaXNGYWN0b3IgPyBzbG90W3Byb3BlcnR5XSAqIHZhbHVlIDogdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyB3aGljaCBhbGdvcml0aG0gdG8gdXNlIHRvIHJlZHVjZSB0aGUgdm9sdW1lIG9mIHRoZSBzb3VuZCBhcyBpdCBtb3ZlcyBhd2F5IGZyb21cbiAgICAgKiB0aGUgbGlzdGVuZXIuIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIERJU1RBTkNFX0xJTkVBUn1cbiAgICAgKiAtIHtAbGluayBESVNUQU5DRV9JTlZFUlNFfVxuICAgICAqIC0ge0BsaW5rIERJU1RBTkNFX0VYUE9ORU5USUFMfVxuICAgICAqXG4gICAgICogRGVmYXVsdHMgdG8ge0BsaW5rIERJU1RBTkNFX0xJTkVBUn0uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHNldCBkaXN0YW5jZU1vZGVsKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2Rpc3RhbmNlTW9kZWwgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlU291bmRJbnN0YW5jZXMoJ2Rpc3RhbmNlTW9kZWwnLCB2YWx1ZSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGdldCBkaXN0YW5jZU1vZGVsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGlzdGFuY2VNb2RlbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbWF4aW11bSBkaXN0YW5jZSBmcm9tIHRoZSBsaXN0ZW5lciBhdCB3aGljaCBhdWRpbyBmYWxsb2ZmIHN0b3BzLiBOb3RlIHRoZSB2b2x1bWUgb2YgdGhlXG4gICAgICogYXVkaW8gaXMgbm90IDAgYWZ0ZXIgdGhpcyBkaXN0YW5jZSwgYnV0IGp1c3QgZG9lc24ndCBmYWxsIG9mZiBhbnltb3JlLiBEZWZhdWx0cyB0byAxMDAwMC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IG1heERpc3RhbmNlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX21heERpc3RhbmNlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVNvdW5kSW5zdGFuY2VzKCdtYXhEaXN0YW5jZScsIHZhbHVlLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgZ2V0IG1heERpc3RhbmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWF4RGlzdGFuY2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIHJlZmVyZW5jZSBkaXN0YW5jZSBmb3IgcmVkdWNpbmcgdm9sdW1lIGFzIHRoZSBzb3VuZCBzb3VyY2UgbW92ZXMgZnVydGhlciBmcm9tIHRoZVxuICAgICAqIGxpc3RlbmVyLiBEZWZhdWx0cyB0byAxLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgcmVmRGlzdGFuY2UodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fcmVmRGlzdGFuY2UgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlU291bmRJbnN0YW5jZXMoJ3JlZkRpc3RhbmNlJywgdmFsdWUsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBnZXQgcmVmRGlzdGFuY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZWZEaXN0YW5jZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZmFjdG9yIHVzZWQgaW4gdGhlIGZhbGxvZmYgZXF1YXRpb24uIERlZmF1bHRzIHRvIDEuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHNldCByb2xsT2ZmRmFjdG9yKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3JvbGxPZmZGYWN0b3IgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlU291bmRJbnN0YW5jZXMoJ3JvbGxPZmZGYWN0b3InLCB2YWx1ZSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGdldCByb2xsT2ZmRmFjdG9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcm9sbE9mZkZhY3RvcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcGl0Y2ggbW9kaWZpZXIgdG8gcGxheSB0aGUgYXVkaW8gd2l0aC4gTXVzdCBiZSBsYXJnZXIgdGhhbiAwLjAxLiBEZWZhdWx0cyB0byAxLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgcGl0Y2godmFsdWUpIHtcbiAgICAgICAgdGhpcy5fcGl0Y2ggPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlU291bmRJbnN0YW5jZXMoJ3BpdGNoJywgdmFsdWUsIHRydWUpO1xuICAgIH1cblxuICAgIGdldCBwaXRjaCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BpdGNoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSB2b2x1bWUgbW9kaWZpZXIgdG8gcGxheSB0aGUgYXVkaW8gd2l0aC4gSW4gcmFuZ2UgMC0xLiBEZWZhdWx0cyB0byAxLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgdm9sdW1lKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3ZvbHVtZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLl91cGRhdGVTb3VuZEluc3RhbmNlcygndm9sdW1lJywgdmFsdWUsIHRydWUpO1xuICAgIH1cblxuICAgIGdldCB2b2x1bWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92b2x1bWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgdHJ1ZSB0aGUgYXVkaW8gd2lsbCBwbGF5IGJhY2sgYXQgdGhlIGxvY2F0aW9uIG9mIHRoZSBFbnRpdHkgaW4gc3BhY2UsIHNvIHRoZSBhdWRpbyB3aWxsXG4gICAgICogYmUgYWZmZWN0ZWQgYnkgdGhlIHBvc2l0aW9uIG9mIHRoZSB7QGxpbmsgQXVkaW9MaXN0ZW5lckNvbXBvbmVudH0uIERlZmF1bHRzIHRvIHRydWUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBzZXQgcG9zaXRpb25hbChuZXdWYWx1ZSkge1xuICAgICAgICB0aGlzLl9wb3NpdGlvbmFsID0gbmV3VmFsdWU7XG5cbiAgICAgICAgY29uc3Qgc2xvdHMgPSB0aGlzLl9zbG90cztcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gc2xvdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHNsb3QgPSBzbG90c1trZXldO1xuICAgICAgICAgICAgLy8gcmVjcmVhdGUgbm9uIG92ZXJsYXBwaW5nIHNvdW5kc1xuICAgICAgICAgICAgaWYgKCFzbG90Lm92ZXJsYXApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBzbG90Lmluc3RhbmNlcztcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRMZW5ndGggPSBpbnN0YW5jZXMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgaW5zdGFuY2UgaXMgc3RvcHBlZCwgaXQgZ2V0cyByZW1vdmVkIGZyb20gdGhlIHNsb3QuaW5zdGFuY2VzIGFycmF5XG4gICAgICAgICAgICAgICAgLy8gc28gd2UgYXJlIGdvaW5nIGJhY2t3YXJkcyB0byBjb21wZW5zYXRlIGZvciB0aGF0XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gb2xkTGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNQbGF5aW5nID0gaW5zdGFuY2VzW2ldLmlzUGxheWluZyB8fCBpbnN0YW5jZXNbaV0uaXNTdXNwZW5kZWQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gaW5zdGFuY2VzW2ldLmN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNQbGF5aW5nKVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VzW2ldLnN0b3AoKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHNsb3QuX2NyZWF0ZUluc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1BsYXlpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmN1cnJlbnRUaW1lID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXMucHVzaChpbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHBvc2l0aW9uYWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbmFsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgZGljdGlvbmFyeSB0aGF0IGNvbnRhaW5zIHRoZSB7QGxpbmsgU291bmRTbG90fXMgbWFuYWdlZCBieSB0aGlzIFNvdW5kQ29tcG9uZW50LlxuICAgICAqXG4gICAgICogQHR5cGUge09iamVjdDxzdHJpbmcsIFNvdW5kU2xvdD59XG4gICAgICovXG4gICAgc2V0IHNsb3RzKG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5fc2xvdHM7XG5cbiAgICAgICAgLy8gc3RvcCBwcmV2aW91cyBzbG90c1xuICAgICAgICBpZiAob2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgb2xkVmFsdWVba2V5XS5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzbG90cyA9IHt9O1xuXG4gICAgICAgIC8vIGNvbnZlcnQgZGF0YSB0byBzbG90c1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKCEobmV3VmFsdWVba2V5XSBpbnN0YW5jZW9mIFNvdW5kU2xvdCkpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWVba2V5XS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsb3RzW25ld1ZhbHVlW2tleV0ubmFtZV0gPSBuZXcgU291bmRTbG90KHRoaXMsIG5ld1ZhbHVlW2tleV0ubmFtZSwgbmV3VmFsdWVba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzbG90c1tuZXdWYWx1ZVtrZXldLm5hbWVdID0gbmV3VmFsdWVba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3Nsb3RzID0gc2xvdHM7XG5cbiAgICAgICAgLy8gY2FsbCBvbkVuYWJsZSBpbiBvcmRlciB0byBzdGFydCBhdXRvUGxheSBzbG90c1xuICAgICAgICBpZiAodGhpcy5lbmFibGVkICYmIHRoaXMuZW50aXR5LmVuYWJsZWQpXG4gICAgICAgICAgICB0aGlzLm9uRW5hYmxlKCk7XG4gICAgfVxuXG4gICAgZ2V0IHNsb3RzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2xvdHM7XG4gICAgfVxuXG4gICAgb25FbmFibGUoKSB7XG4gICAgICAgIC8vIGRvIG5vdCBydW4gaWYgcnVubmluZyBpbiBFZGl0b3JcbiAgICAgICAgaWYgKHRoaXMuc3lzdGVtLl9pblRvb2xzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzbG90cyA9IHRoaXMuX3Nsb3RzO1xuICAgICAgICBjb25zdCBwbGF5aW5nQmVmb3JlRGlzYWJsZSA9IHRoaXMuX3BsYXlpbmdCZWZvcmVEaXNhYmxlO1xuXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHNsb3RzKSB7XG4gICAgICAgICAgICBjb25zdCBzbG90ID0gc2xvdHNba2V5XTtcbiAgICAgICAgICAgIC8vIHBsYXkgaWYgYXV0b1BsYXkgaXMgdHJ1ZSBvclxuICAgICAgICAgICAgLy8gaWYgdGhlIHNsb3Qgd2FzIHBhdXNlZCB3aGVuIHRoZSBjb21wb25lbnRcbiAgICAgICAgICAgIC8vIGdvdCBkaXNhYmxlZFxuICAgICAgICAgICAgaWYgKHNsb3QuYXV0b1BsYXkgJiYgc2xvdC5pc1N0b3BwZWQpIHtcbiAgICAgICAgICAgICAgICBzbG90LnBsYXkoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGxheWluZ0JlZm9yZURpc2FibGVba2V5XSkge1xuICAgICAgICAgICAgICAgIHNsb3QucmVzdW1lKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFzbG90LmlzTG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgLy8gc3RhcnQgbG9hZGluZyBzbG90c1xuICAgICAgICAgICAgICAgIHNsb3QubG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25EaXNhYmxlKCkge1xuICAgICAgICBjb25zdCBzbG90cyA9IHRoaXMuX3Nsb3RzO1xuICAgICAgICBjb25zdCBwbGF5aW5nQmVmb3JlRGlzYWJsZSA9IHt9O1xuXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHNsb3RzKSB7XG4gICAgICAgICAgICAvLyBwYXVzZSBub24tb3ZlcmxhcHBpbmcgc291bmRzXG4gICAgICAgICAgICBpZiAoIXNsb3RzW2tleV0ub3ZlcmxhcCkge1xuICAgICAgICAgICAgICAgIGlmIChzbG90c1trZXldLmlzUGxheWluZykge1xuICAgICAgICAgICAgICAgICAgICBzbG90c1trZXldLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbWVtYmVyIHNvdW5kcyBwbGF5aW5nIHdoZW4gd2UgZGlzYWJsZVxuICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBjYW4gcmVzdW1lIHRoZW0gb24gZW5hYmxlXG4gICAgICAgICAgICAgICAgICAgIHBsYXlpbmdCZWZvcmVEaXNhYmxlW2tleV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3BsYXlpbmdCZWZvcmVEaXNhYmxlID0gcGxheWluZ0JlZm9yZURpc2FibGU7XG4gICAgfVxuXG4gICAgb25SZW1vdmUoKSB7XG4gICAgICAgIHRoaXMub2ZmKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgU291bmRTbG90fSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHNsb3QuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIFNldHRpbmdzIGZvciB0aGUgc2xvdC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMudm9sdW1lPTFdIC0gVGhlIHBsYXliYWNrIHZvbHVtZSwgYmV0d2VlbiAwIGFuZCAxLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5waXRjaD0xXSAtIFRoZSByZWxhdGl2ZSBwaXRjaCwgZGVmYXVsdCBvZiAxLCBwbGF5cyBhdCBub3JtYWwgcGl0Y2guXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sb29wPWZhbHNlXSAtIElmIHRydWUgdGhlIHNvdW5kIHdpbGwgcmVzdGFydCB3aGVuIGl0IHJlYWNoZXMgdGhlIGVuZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuc3RhcnRUaW1lPTBdIC0gVGhlIHN0YXJ0IHRpbWUgZnJvbSB3aGljaCB0aGUgc291bmQgd2lsbCBzdGFydCBwbGF5aW5nLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5kdXJhdGlvbj1udWxsXSAtIFRoZSBkdXJhdGlvbiBvZiB0aGUgc291bmQgdGhhdCB0aGUgc2xvdCB3aWxsIHBsYXlcbiAgICAgKiBzdGFydGluZyBmcm9tIHN0YXJ0VGltZS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLm92ZXJsYXA9ZmFsc2VdIC0gSWYgdHJ1ZSB0aGVuIHNvdW5kcyBwbGF5ZWQgZnJvbSBzbG90IHdpbGwgYmVcbiAgICAgKiBwbGF5ZWQgaW5kZXBlbmRlbnRseSBvZiBlYWNoIG90aGVyLiBPdGhlcndpc2UgdGhlIHNsb3Qgd2lsbCBmaXJzdCBzdG9wIHRoZSBjdXJyZW50IHNvdW5kXG4gICAgICogYmVmb3JlIHN0YXJ0aW5nIHRoZSBuZXcgb25lLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMuYXV0b1BsYXk9ZmFsc2VdIC0gSWYgdHJ1ZSB0aGUgc2xvdCB3aWxsIHN0YXJ0IHBsYXlpbmcgYXMgc29vbiBhc1xuICAgICAqIGl0cyBhdWRpbyBhc3NldCBpcyBsb2FkZWQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmFzc2V0PW51bGxdIC0gVGhlIGFzc2V0IGlkIG9mIHRoZSBhdWRpbyBhc3NldCB0aGF0IGlzIGdvaW5nIHRvIGJlXG4gICAgICogcGxheWVkIGJ5IHRoaXMgc2xvdC5cbiAgICAgKiBAcmV0dXJucyB7U291bmRTbG90fG51bGx9IFRoZSBuZXcgc2xvdCBvciBudWxsIGlmIHRoZSBzbG90IGFscmVhZHkgZXhpc3RzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gZ2V0IGFuIGFzc2V0IGJ5IGlkXG4gICAgICogdmFyIGFzc2V0ID0gYXBwLmFzc2V0cy5nZXQoMTApO1xuICAgICAqIC8vIGFkZCBhIHNsb3RcbiAgICAgKiB0aGlzLmVudGl0eS5zb3VuZC5hZGRTbG90KCdiZWVwJywge1xuICAgICAqICAgICBhc3NldDogYXNzZXRcbiAgICAgKiB9KTtcbiAgICAgKiAvLyBwbGF5XG4gICAgICogdGhpcy5lbnRpdHkuc291bmQucGxheSgnYmVlcCcpO1xuICAgICAqL1xuICAgIGFkZFNsb3QobmFtZSwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBzbG90cyA9IHRoaXMuX3Nsb3RzO1xuICAgICAgICBpZiAoc2xvdHNbbmFtZV0pIHtcbiAgICAgICAgICAgIERlYnVnLndhcm4oYEEgc291bmQgc2xvdCB3aXRoIG5hbWUgJHtuYW1lfSBhbHJlYWR5IGV4aXN0cyBvbiBFbnRpdHkgJHt0aGlzLmVudGl0eS5wYXRofWApO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzbG90ID0gbmV3IFNvdW5kU2xvdCh0aGlzLCBuYW1lLCBvcHRpb25zKTtcbiAgICAgICAgc2xvdHNbbmFtZV0gPSBzbG90O1xuXG4gICAgICAgIGlmIChzbG90LmF1dG9QbGF5ICYmIHRoaXMuZW5hYmxlZCAmJiB0aGlzLmVudGl0eS5lbmFibGVkKSB7XG4gICAgICAgICAgICBzbG90LnBsYXkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzbG90O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHtAbGluayBTb3VuZFNsb3R9IHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc2xvdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIHJlbW92ZSBhIHNsb3QgY2FsbGVkICdiZWVwJ1xuICAgICAqIHRoaXMuZW50aXR5LnNvdW5kLnJlbW92ZVNsb3QoJ2JlZXAnKTtcbiAgICAgKi9cbiAgICByZW1vdmVTbG90KG5hbWUpIHtcbiAgICAgICAgY29uc3Qgc2xvdHMgPSB0aGlzLl9zbG90cztcbiAgICAgICAgaWYgKHNsb3RzW25hbWVdKSB7XG4gICAgICAgICAgICBzbG90c1tuYW1lXS5zdG9wKCk7XG4gICAgICAgICAgICBkZWxldGUgc2xvdHNbbmFtZV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBzbG90IHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc2xvdC5cbiAgICAgKiBAcmV0dXJucyB7U291bmRTbG90fHVuZGVmaW5lZH0gVGhlIHNsb3QuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAvLyBnZXQgYSBzbG90IGFuZCBzZXQgaXRzIHZvbHVtZVxuICAgICAqIHRoaXMuZW50aXR5LnNvdW5kLnNsb3QoJ2JlZXAnKS52b2x1bWUgPSAwLjU7XG4gICAgICpcbiAgICAgKi9cbiAgICBzbG90KG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Nsb3RzW25hbWVdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJlZ2lucyBwbGF5aW5nIHRoZSBzb3VuZCBzbG90IHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLiBUaGUgc2xvdCB3aWxsIHJlc3RhcnQgcGxheWluZyBpZiBpdFxuICAgICAqIGlzIGFscmVhZHkgcGxheWluZyB1bmxlc3MgdGhlIG92ZXJsYXAgZmllbGQgaXMgdHJ1ZSBpbiB3aGljaCBjYXNlIGEgbmV3IHNvdW5kIHdpbGwgYmVcbiAgICAgKiBjcmVhdGVkIGFuZCBwbGF5ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSB7QGxpbmsgU291bmRTbG90fSB0byBwbGF5LlxuICAgICAqIEByZXR1cm5zIHtTb3VuZEluc3RhbmNlfG51bGx9IFRoZSBzb3VuZCBpbnN0YW5jZSB0aGF0IHdpbGwgYmUgcGxheWVkLiBSZXR1cm5zIG51bGwgaWYgdGhlXG4gICAgICogY29tcG9uZW50IG9yIGl0cyBwYXJlbnQgZW50aXR5IGlzIGRpc2FibGVkIG9yIGlmIHRoZSBTb3VuZENvbXBvbmVudCBoYXMgbm8gc2xvdCB3aXRoIHRoZVxuICAgICAqIHNwZWNpZmllZCBuYW1lLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gZ2V0IGFzc2V0IGJ5IGlkXG4gICAgICogdmFyIGFzc2V0ID0gYXBwLmFzc2V0cy5nZXQoMTApO1xuICAgICAqIC8vIGNyZWF0ZSBhIHNsb3QgYW5kIHBsYXkgaXRcbiAgICAgKiB0aGlzLmVudGl0eS5zb3VuZC5hZGRTbG90KCdiZWVwJywge1xuICAgICAqICAgICBhc3NldDogYXNzZXRcbiAgICAgKiB9KTtcbiAgICAgKiB0aGlzLmVudGl0eS5zb3VuZC5wbGF5KCdiZWVwJyk7XG4gICAgICovXG4gICAgcGxheShuYW1lKSB7XG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkIHx8ICF0aGlzLmVudGl0eS5lbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHNsb3QgPSB0aGlzLl9zbG90c1tuYW1lXTtcbiAgICAgICAgaWYgKCFzbG90KSB7XG4gICAgICAgICAgICBEZWJ1Zy53YXJuKGBUcnlpbmcgdG8gcGxheSBzb3VuZCBzbG90IHdpdGggbmFtZSAke25hbWV9IHdoaWNoIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzbG90LnBsYXkoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXVzZXMgcGxheWJhY2sgb2YgdGhlIHNsb3Qgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuIElmIHRoZSBuYW1lIGlzIHVuZGVmaW5lZCB0aGVuIGFsbCBzbG90c1xuICAgICAqIGN1cnJlbnRseSBwbGF5ZWQgd2lsbCBiZSBwYXVzZWQuIFRoZSBzbG90cyBjYW4gYmUgcmVzdW1lZCBieSBjYWxsaW5nIHtAbGluayBTb3VuZENvbXBvbmVudCNyZXN1bWV9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtuYW1lXSAtIFRoZSBuYW1lIG9mIHRoZSBzbG90IHRvIHBhdXNlLiBMZWF2ZSB1bmRlZmluZWQgdG8gcGF1c2UgZXZlcnl0aGluZy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIHBhdXNlIGFsbCBzb3VuZHNcbiAgICAgKiB0aGlzLmVudGl0eS5zb3VuZC5wYXVzZSgpO1xuICAgICAqIC8vIHBhdXNlIGEgc3BlY2lmaWMgc291bmRcbiAgICAgKiB0aGlzLmVudGl0eS5zb3VuZC5wYXVzZSgnYmVlcCcpO1xuICAgICAqL1xuICAgIHBhdXNlKG5hbWUpIHtcbiAgICAgICAgY29uc3Qgc2xvdHMgPSB0aGlzLl9zbG90cztcblxuICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgY29uc3Qgc2xvdCA9IHNsb3RzW25hbWVdO1xuICAgICAgICAgICAgaWYgKCFzbG90KSB7XG4gICAgICAgICAgICAgICAgRGVidWcud2FybihgVHJ5aW5nIHRvIHBhdXNlIHNvdW5kIHNsb3Qgd2l0aCBuYW1lICR7bmFtZX0gd2hpY2ggZG9lcyBub3QgZXhpc3RgKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNsb3QucGF1c2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHNsb3RzKSB7XG4gICAgICAgICAgICAgICAgc2xvdHNba2V5XS5wYXVzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzdW1lcyBwbGF5YmFjayBvZiB0aGUgc291bmQgc2xvdCB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSBpZiBpdCdzIHBhdXNlZC4gSWYgbm8gbmFtZSBpc1xuICAgICAqIHNwZWNpZmllZCBhbGwgc2xvdHMgd2lsbCBiZSByZXN1bWVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtuYW1lXSAtIFRoZSBuYW1lIG9mIHRoZSBzbG90IHRvIHJlc3VtZS4gTGVhdmUgdW5kZWZpbmVkIHRvIHJlc3VtZSBldmVyeXRoaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gcmVzdW1lIGFsbCBzb3VuZHNcbiAgICAgKiB0aGlzLmVudGl0eS5zb3VuZC5yZXN1bWUoKTtcbiAgICAgKiAvLyByZXN1bWUgYSBzcGVjaWZpYyBzb3VuZFxuICAgICAqIHRoaXMuZW50aXR5LnNvdW5kLnJlc3VtZSgnYmVlcCcpO1xuICAgICAqL1xuICAgIHJlc3VtZShuYW1lKSB7XG4gICAgICAgIGNvbnN0IHNsb3RzID0gdGhpcy5fc2xvdHM7XG5cbiAgICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHNsb3QgPSBzbG90c1tuYW1lXTtcbiAgICAgICAgICAgIGlmICghc2xvdCkge1xuICAgICAgICAgICAgICAgIERlYnVnLndhcm4oYFRyeWluZyB0byByZXN1bWUgc291bmQgc2xvdCB3aXRoIG5hbWUgJHtuYW1lfSB3aGljaCBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNsb3QuaXNQYXVzZWQpIHtcbiAgICAgICAgICAgICAgICBzbG90LnJlc3VtZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gc2xvdHMpIHtcbiAgICAgICAgICAgICAgICBzbG90c1trZXldLnJlc3VtZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3RvcHMgcGxheWJhY2sgb2YgdGhlIHNvdW5kIHNsb3Qgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgaWYgaXQncyBwYXVzZWQuIElmIG5vIG5hbWUgaXNcbiAgICAgKiBzcGVjaWZpZWQgYWxsIHNsb3RzIHdpbGwgYmUgc3RvcHBlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbbmFtZV0gLSBUaGUgbmFtZSBvZiB0aGUgc2xvdCB0byBzdG9wLiBMZWF2ZSB1bmRlZmluZWQgdG8gc3RvcCBldmVyeXRoaW5nLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gc3RvcCBhbGwgc291bmRzXG4gICAgICogdGhpcy5lbnRpdHkuc291bmQuc3RvcCgpO1xuICAgICAqIC8vIHN0b3AgYSBzcGVjaWZpYyBzb3VuZFxuICAgICAqIHRoaXMuZW50aXR5LnNvdW5kLnN0b3AoJ2JlZXAnKTtcbiAgICAgKi9cbiAgICBzdG9wKG5hbWUpIHtcbiAgICAgICAgY29uc3Qgc2xvdHMgPSB0aGlzLl9zbG90cztcblxuICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgY29uc3Qgc2xvdCA9IHNsb3RzW25hbWVdO1xuICAgICAgICAgICAgaWYgKCFzbG90KSB7XG4gICAgICAgICAgICAgICAgRGVidWcud2FybihgVHJ5aW5nIHRvIHN0b3Agc291bmQgc2xvdCB3aXRoIG5hbWUgJHtuYW1lfSB3aGljaCBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2xvdC5zdG9wKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBzbG90cykge1xuICAgICAgICAgICAgICAgIHNsb3RzW2tleV0uc3RvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBTb3VuZENvbXBvbmVudCB9O1xuIl0sIm5hbWVzIjpbIlNvdW5kQ29tcG9uZW50IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJzeXN0ZW0iLCJlbnRpdHkiLCJfdm9sdW1lIiwiX3BpdGNoIiwiX3Bvc2l0aW9uYWwiLCJfcmVmRGlzdGFuY2UiLCJfbWF4RGlzdGFuY2UiLCJfcm9sbE9mZkZhY3RvciIsIl9kaXN0YW5jZU1vZGVsIiwiRElTVEFOQ0VfTElORUFSIiwiX3Nsb3RzIiwiX3BsYXlpbmdCZWZvcmVEaXNhYmxlIiwiX3VwZGF0ZVNvdW5kSW5zdGFuY2VzIiwicHJvcGVydHkiLCJ2YWx1ZSIsImlzRmFjdG9yIiwic2xvdHMiLCJrZXkiLCJzbG90Iiwib3ZlcmxhcCIsImluc3RhbmNlcyIsImkiLCJsZW4iLCJsZW5ndGgiLCJkaXN0YW5jZU1vZGVsIiwibWF4RGlzdGFuY2UiLCJyZWZEaXN0YW5jZSIsInJvbGxPZmZGYWN0b3IiLCJwaXRjaCIsInZvbHVtZSIsInBvc2l0aW9uYWwiLCJuZXdWYWx1ZSIsIm9sZExlbmd0aCIsImlzUGxheWluZyIsImlzU3VzcGVuZGVkIiwiY3VycmVudFRpbWUiLCJzdG9wIiwiaW5zdGFuY2UiLCJfY3JlYXRlSW5zdGFuY2UiLCJwbGF5IiwicHVzaCIsIm9sZFZhbHVlIiwiU291bmRTbG90IiwibmFtZSIsImVuYWJsZWQiLCJvbkVuYWJsZSIsIl9pblRvb2xzIiwicGxheWluZ0JlZm9yZURpc2FibGUiLCJhdXRvUGxheSIsImlzU3RvcHBlZCIsInJlc3VtZSIsImlzTG9hZGVkIiwibG9hZCIsIm9uRGlzYWJsZSIsInBhdXNlIiwib25SZW1vdmUiLCJvZmYiLCJhZGRTbG90Iiwib3B0aW9ucyIsIkRlYnVnIiwid2FybiIsInBhdGgiLCJyZW1vdmVTbG90IiwiaXNQYXVzZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFpQkEsTUFBTUEsY0FBTixTQUE2QkMsU0FBN0IsQ0FBdUM7QUFPbkNDLEVBQUFBLFdBQVcsQ0FBQ0MsTUFBRCxFQUFTQyxNQUFULEVBQWlCO0lBQ3hCLEtBQU1ELENBQUFBLE1BQU4sRUFBY0MsTUFBZCxDQUFBLENBQUE7SUFHQSxJQUFLQyxDQUFBQSxPQUFMLEdBQWUsQ0FBZixDQUFBO0lBRUEsSUFBS0MsQ0FBQUEsTUFBTCxHQUFjLENBQWQsQ0FBQTtJQUVBLElBQUtDLENBQUFBLFdBQUwsR0FBbUIsSUFBbkIsQ0FBQTtJQUVBLElBQUtDLENBQUFBLFlBQUwsR0FBb0IsQ0FBcEIsQ0FBQTtJQUVBLElBQUtDLENBQUFBLFlBQUwsR0FBb0IsS0FBcEIsQ0FBQTtJQUVBLElBQUtDLENBQUFBLGNBQUws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
