/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { platform } from '../../../core/platform.js';
import { EventHandler } from '../../../core/event-handler.js';
import { Quat } from '../../../core/math/quat.js';
import { Vec2 } from '../../../core/math/vec2.js';
import { Vec3 } from '../../../core/math/vec3.js';
import { ElementComponent } from './component.js';
import { Ray } from '../../../core/shape/ray.js';
import { Plane } from '../../../core/shape/plane.js';

const _inputScreenPosition = new Vec2();
const _inputWorldPosition = new Vec3();
const _ray = new Ray();
const _plane = new Plane();
const _entityRotation = new Quat();
const OPPOSITE_AXIS = {
  x: 'y',
  y: 'x'
};

class ElementDragHelper extends EventHandler {
  constructor(element, axis) {
    super();
    if (!element || !(element instanceof ElementComponent)) {
      throw new Error('Element was null or not an ElementComponent');
    }
    if (axis && axis !== 'x' && axis !== 'y') {
      throw new Error('Unrecognized axis: ' + axis);
    }
    this._element = element;
    this._app = element.system.app;
    this._axis = axis || null;
    this._enabled = true;
    this._dragScale = new Vec3();
    this._dragStartMousePosition = new Vec3();
    this._dragStartHandlePosition = new Vec3();
    this._deltaMousePosition = new Vec3();
    this._deltaHandlePosition = new Vec3();
    this._isDragging = false;
    this._toggleLifecycleListeners('on');
  }

  _toggleLifecycleListeners(onOrOff) {
    this._element[onOrOff]('mousedown', this._onMouseDownOrTouchStart, this);
    this._element[onOrOff]('touchstart', this._onMouseDownOrTouchStart, this);
  }

  _toggleDragListeners(onOrOff) {
    const isOn = onOrOff === 'on';

    if (this._hasDragListeners && isOn) {
      return;
    }

    if (this._app.mouse) {
      this._element[onOrOff]('mousemove', this._onMove, this);
      this._element[onOrOff]('mouseup', this._onMouseUpOrTouchEnd, this);
    }

    if (platform.touch) {
      this._element[onOrOff]('touchmove', this._onMove, this);
      this._element[onOrOff]('touchend', this._onMouseUpOrTouchEnd, this);
      this._element[onOrOff]('touchcancel', this._onMouseUpOrTouchEnd, this);
    }
    this._hasDragListeners = isOn;
  }
  _onMouseDownOrTouchStart(event) {
    if (this._element && !this._isDragging && this.enabled) {
      this._dragCamera = event.camera;
      this._calculateDragScale();
      const currentMousePosition = this._screenToLocal(event);
      if (currentMousePosition) {
        this._toggleDragListeners('on');
        this._isDragging = true;
        this._dragStartMousePosition.copy(currentMousePosition);
        this._dragStartHandlePosition.copy(this._element.entity.getLocalPosition());
        this.fire('drag:start');
      }
    }
  }
  _onMouseUpOrTouchEnd() {
    if (this._isDragging) {
      this._isDragging = false;
      this._toggleDragListeners('off');
      this.fire('drag:end');
    }
  }

  _screenToLocal(event) {
    this._determineInputPosition(event);
    this._chooseRayOriginAndDirection();
    _plane.point.copy(this._element.entity.getLocalPosition());
    _plane.normal.copy(this._element.entity.forward).mulScalar(-1);
    const denominator = _plane.normal.dot(_ray.direction);

    if (Math.abs(denominator) > 0) {
      const rayOriginToPlaneOrigin = _plane.point.sub(_ray.origin);
      const collisionDistance = rayOriginToPlaneOrigin.dot(_plane.normal) / denominator;
      const position = _ray.origin.add(_ray.direction.mulScalar(collisionDistance));
      _entityRotation.copy(this._element.entity.getRotation()).invert().transformVector(position, position);
      position.mul(this._dragScale);
      return position;
    }
    return null;
  }
  _determineInputPosition(event) {
    const devicePixelRatio = this._app.graphicsDevice.maxPixelRatio;
    if (typeof event.x !== 'undefined' && typeof event.y !== 'undefined') {
      _inputScreenPosition.x = event.x * devicePixelRatio;
      _inputScreenPosition.y = event.y * devicePixelRatio;
    } else if (event.changedTouches) {
      _inputScreenPosition.x = event.changedTouches[0].x * devicePixelRatio;
      _inputScreenPosition.y = event.changedTouches[0].y * devicePixelRatio;
    } else {
      console.warn('Could not determine position from input event');
    }
  }
  _chooseRayOriginAndDirection() {
    if (this._element.screen && this._element.screen.screen.screenSpace) {
      _ray.origin.set(_inputScreenPosition.x, -_inputScreenPosition.y, 0);
      _ray.direction.copy(Vec3.FORWARD);
    } else {
      _inputWorldPosition.copy(this._dragCamera.screenToWorld(_inputScreenPosition.x, _inputScreenPosition.y, 1));
      _ray.origin.copy(this._dragCamera.entity.getPosition());
      _ray.direction.copy(_inputWorldPosition).sub(_ray.origin).normalize();
    }
  }
  _calculateDragScale() {
    let current = this._element.entity.parent;
    const screen = this._element.screen && this._element.screen.screen;
    const isWithin2DScreen = screen && screen.screenSpace;
    const screenScale = isWithin2DScreen ? screen.scale : 1;
    const dragScale = this._dragScale;
    dragScale.set(screenScale, screenScale, screenScale);
    while (current) {
      dragScale.mul(current.getLocalScale());
      current = current.parent;
      if (isWithin2DScreen && current.screen) {
        break;
      }
    }
    dragScale.x = 1 / dragScale.x;
    dragScale.y = 1 / dragScale.y;
    dragScale.z = 1 / dragScale.z;
  }

  _onMove(event) {
    const {
      _element: element,
      _deltaMousePosition: deltaMousePosition,
      _deltaHandlePosition: deltaHandlePosition,
      _axis: axis
    } = this;
    if (element && this._isDragging && this.enabled && element.enabled && element.entity.enabled) {
      const currentMousePosition = this._screenToLocal(event);
      if (currentMousePosition) {
        deltaMousePosition.sub2(currentMousePosition, this._dragStartMousePosition);
        deltaHandlePosition.add2(this._dragStartHandlePosition, deltaMousePosition);
        if (axis) {
          const currentPosition = element.entity.getLocalPosition();
          const constrainedAxis = OPPOSITE_AXIS[axis];
          deltaHandlePosition[constrainedAxis] = currentPosition[constrainedAxis];
        }
        element.entity.setLocalPosition(deltaHandlePosition);
        this.fire('drag:move', deltaHandlePosition);
      }
    }
  }
  destroy() {
    this._toggleLifecycleListeners('off');
    this._toggleDragListeners('off');
  }
  set enabled(value) {
    this._enabled = value;
  }
  get enabled() {
    return this._enabled;
  }
  get isDragging() {
    return this._isDragging;
  }
}

export { ElementDragHelper };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1kcmFnLWhlbHBlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9jb21wb25lbnRzL2VsZW1lbnQvZWxlbWVudC1kcmFnLWhlbHBlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgUXVhdCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9xdWF0LmpzJztcbmltcG9ydCB7IFZlYzIgfSBmcm9tICcuLi8uLi8uLi9jb3JlL21hdGgvdmVjMi5qcyc7XG5pbXBvcnQgeyBWZWMzIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tYXRoL3ZlYzMuanMnO1xuXG5pbXBvcnQgeyBFbGVtZW50Q29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSAnLi4vLi4vLi4vY29yZS9zaGFwZS9yYXkuanMnO1xuaW1wb3J0IHsgUGxhbmUgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3NoYXBlL3BsYW5lLmpzJztcblxuY29uc3QgX2lucHV0U2NyZWVuUG9zaXRpb24gPSBuZXcgVmVjMigpO1xuY29uc3QgX2lucHV0V29ybGRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG5jb25zdCBfcmF5ID0gbmV3IFJheSgpO1xuY29uc3QgX3BsYW5lID0gbmV3IFBsYW5lKCk7XG5jb25zdCBfZW50aXR5Um90YXRpb24gPSBuZXcgUXVhdCgpO1xuXG5jb25zdCBPUFBPU0lURV9BWElTID0ge1xuICAgIHg6ICd5JyxcbiAgICB5OiAneCdcbn07XG5cbi8qKlxuICogSGVscGVyIGNsYXNzIHRoYXQgbWFrZXMgaXQgZWFzeSB0byBjcmVhdGUgRWxlbWVudHMgdGhhdCBjYW4gYmUgZHJhZ2dlZCBieSB0aGUgbW91c2Ugb3IgdG91Y2guXG4gKlxuICogQGF1Z21lbnRzIEV2ZW50SGFuZGxlclxuICovXG5jbGFzcyBFbGVtZW50RHJhZ0hlbHBlciBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEVsZW1lbnREcmFnSGVscGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50Q29tcG9uZW50fSBlbGVtZW50IC0gVGhlIEVsZW1lbnQgdGhhdCBzaG91bGQgYmVjb21lIGRyYWdnYWJsZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2F4aXNdIC0gT3B0aW9uYWwgYXhpcyB0byBjb25zdHJhaW4gdG8sIGVpdGhlciAneCcsICd5JyBvciBudWxsLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIGF4aXMpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICBpZiAoIWVsZW1lbnQgfHwgIShlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudENvbXBvbmVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRWxlbWVudCB3YXMgbnVsbCBvciBub3QgYW4gRWxlbWVudENvbXBvbmVudCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGF4aXMgJiYgYXhpcyAhPT0gJ3gnICYmIGF4aXMgIT09ICd5Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbnJlY29nbml6ZWQgYXhpczogJyArIGF4aXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuX2FwcCA9IGVsZW1lbnQuc3lzdGVtLmFwcDtcbiAgICAgICAgdGhpcy5fYXhpcyA9IGF4aXMgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX2RyYWdTY2FsZSA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RyYWdTdGFydE1vdXNlUG9zaXRpb24gPSBuZXcgVmVjMygpO1xuICAgICAgICB0aGlzLl9kcmFnU3RhcnRIYW5kbGVQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RlbHRhTW91c2VQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RlbHRhSGFuZGxlUG9zaXRpb24gPSBuZXcgVmVjMygpO1xuICAgICAgICB0aGlzLl9pc0RyYWdnaW5nID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5fdG9nZ2xlTGlmZWN5Y2xlTGlzdGVuZXJzKCdvbicpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBuZXcgZHJhZyBvcGVyYXRpb24gc3RhcnRzLlxuICAgICAqXG4gICAgICogQGV2ZW50IEVsZW1lbnREcmFnSGVscGVyI2RyYWc6c3RhcnRcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gdGhlIGN1cnJlbnQgbmV3IGRyYWcgb3BlcmF0aW9uIGVuZHMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgRWxlbWVudERyYWdIZWxwZXIjZHJhZzplbmRcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW5ldmVyIHRoZSBwb3NpdGlvbiBvZiB0aGUgZHJhZ2dlZCBlbGVtZW50IGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgRWxlbWVudERyYWdIZWxwZXIjZHJhZzptb3ZlXG4gICAgICogQHBhcmFtIHtWZWMzfSB2YWx1ZSAtIFRoZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgICAqL1xuXG4gICAgX3RvZ2dsZUxpZmVjeWNsZUxpc3RlbmVycyhvbk9yT2ZmKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duT3JUb3VjaFN0YXJ0LCB0aGlzKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgndG91Y2hzdGFydCcsIHRoaXMuX29uTW91c2VEb3duT3JUb3VjaFN0YXJ0LCB0aGlzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0geydvbid8J29mZid9IG9uT3JPZmYgLSBFaXRoZXIgJ29uJyBvciAnb2ZmJy5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF90b2dnbGVEcmFnTGlzdGVuZXJzKG9uT3JPZmYpIHtcbiAgICAgICAgY29uc3QgaXNPbiA9IG9uT3JPZmYgPT09ICdvbic7XG5cbiAgICAgICAgLy8gUHJldmVudCBtdWx0aXBsZSBsaXN0ZW5lcnNcbiAgICAgICAgaWYgKHRoaXMuX2hhc0RyYWdMaXN0ZW5lcnMgJiYgaXNPbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbW91c2UgZXZlbnRzLCBpZiBtb3VzZSBpcyBhdmFpbGFibGVcbiAgICAgICAgaWYgKHRoaXMuX2FwcC5tb3VzZSkge1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgnbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3ZlLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ21vdXNldXAnLCB0aGlzLl9vbk1vdXNlVXBPclRvdWNoRW5kLCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvdWNoIGV2ZW50cywgaWYgdG91Y2ggaXMgYXZhaWxhYmxlXG4gICAgICAgIGlmIChwbGF0Zm9ybS50b3VjaCkge1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgndG91Y2htb3ZlJywgdGhpcy5fb25Nb3ZlLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ3RvdWNoZW5kJywgdGhpcy5fb25Nb3VzZVVwT3JUb3VjaEVuZCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50W29uT3JPZmZdKCd0b3VjaGNhbmNlbCcsIHRoaXMuX29uTW91c2VVcE9yVG91Y2hFbmQsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faGFzRHJhZ0xpc3RlbmVycyA9IGlzT247XG4gICAgfVxuXG4gICAgX29uTW91c2VEb3duT3JUb3VjaFN0YXJ0KGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9lbGVtZW50ICYmICF0aGlzLl9pc0RyYWdnaW5nICYmIHRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgICAgdGhpcy5fZHJhZ0NhbWVyYSA9IGV2ZW50LmNhbWVyYTtcbiAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZURyYWdTY2FsZSgpO1xuXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50TW91c2VQb3NpdGlvbiA9IHRoaXMuX3NjcmVlblRvTG9jYWwoZXZlbnQpO1xuXG4gICAgICAgICAgICBpZiAoY3VycmVudE1vdXNlUG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVEcmFnTGlzdGVuZXJzKCdvbicpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdTdGFydE1vdXNlUG9zaXRpb24uY29weShjdXJyZW50TW91c2VQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5fZHJhZ1N0YXJ0SGFuZGxlUG9zaXRpb24uY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5nZXRMb2NhbFBvc2l0aW9uKCkpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdkcmFnOnN0YXJ0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25Nb3VzZVVwT3JUb3VjaEVuZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzRHJhZ2dpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3RvZ2dsZURyYWdMaXN0ZW5lcnMoJ29mZicpO1xuXG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2RyYWc6ZW5kJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBjYWxjdWxhdGVzIHRoZSBgVmVjM2AgaW50ZXJzZWN0aW9uIHBvaW50IG9mIHBsYW5lL3JheSBpbnRlcnNlY3Rpb24gYmFzZWQgb25cbiAgICAgKiB0aGUgbW91c2UvdG91Y2ggaW5wdXQgZXZlbnQuIElmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbiwgaXQgcmV0dXJucyBgbnVsbGAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vaW5wdXQvZWxlbWVudC1pbnB1dCcpLkVsZW1lbnRUb3VjaEV2ZW50fSBldmVudCAtIFRoZSBldmVudC5cbiAgICAgKiBAcmV0dXJucyB7VmVjM3xudWxsfSBUaGUgYFZlYzNgIGludGVyc2VjdGlvbiBwb2ludCBvZiBwbGFuZS9yYXkgaW50ZXJzZWN0aW9uLCBpZiB0aGVyZVxuICAgICAqIGlzIGFuIGludGVyc2VjdGlvbiwgb3RoZXJ3aXNlIGBudWxsYFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NjcmVlblRvTG9jYWwoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5fZGV0ZXJtaW5lSW5wdXRQb3NpdGlvbihldmVudCk7XG4gICAgICAgIHRoaXMuX2Nob29zZVJheU9yaWdpbkFuZERpcmVjdGlvbigpO1xuXG4gICAgICAgIF9wbGFuZS5wb2ludC5jb3B5KHRoaXMuX2VsZW1lbnQuZW50aXR5LmdldExvY2FsUG9zaXRpb24oKSk7XG4gICAgICAgIF9wbGFuZS5ub3JtYWwuY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5mb3J3YXJkKS5tdWxTY2FsYXIoLTEpO1xuXG4gICAgICAgIGNvbnN0IGRlbm9taW5hdG9yID0gX3BsYW5lLm5vcm1hbC5kb3QoX3JheS5kaXJlY3Rpb24pO1xuXG4gICAgICAgIC8vIElmIHRoZSByYXkgYW5kIHBsYW5lIGFyZSBub3QgcGFyYWxsZWxcbiAgICAgICAgaWYgKE1hdGguYWJzKGRlbm9taW5hdG9yKSA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJheU9yaWdpblRvUGxhbmVPcmlnaW4gPSBfcGxhbmUucG9pbnQuc3ViKF9yYXkub3JpZ2luKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxpc2lvbkRpc3RhbmNlID0gcmF5T3JpZ2luVG9QbGFuZU9yaWdpbi5kb3QoX3BsYW5lLm5vcm1hbCkgLyBkZW5vbWluYXRvcjtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gX3JheS5vcmlnaW4uYWRkKF9yYXkuZGlyZWN0aW9uLm11bFNjYWxhcihjb2xsaXNpb25EaXN0YW5jZSkpO1xuXG4gICAgICAgICAgICBfZW50aXR5Um90YXRpb24uY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5nZXRSb3RhdGlvbigpKS5pbnZlcnQoKS50cmFuc2Zvcm1WZWN0b3IocG9zaXRpb24sIHBvc2l0aW9uKTtcblxuICAgICAgICAgICAgcG9zaXRpb24ubXVsKHRoaXMuX2RyYWdTY2FsZSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIF9kZXRlcm1pbmVJbnB1dFBvc2l0aW9uKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGRldmljZVBpeGVsUmF0aW8gPSB0aGlzLl9hcHAuZ3JhcGhpY3NEZXZpY2UubWF4UGl4ZWxSYXRpbztcblxuICAgICAgICBpZiAodHlwZW9mIGV2ZW50LnggIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBldmVudC55ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgX2lucHV0U2NyZWVuUG9zaXRpb24ueCA9IGV2ZW50LnggKiBkZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICAgICAgX2lucHV0U2NyZWVuUG9zaXRpb24ueSA9IGV2ZW50LnkgKiBkZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICBfaW5wdXRTY3JlZW5Qb3NpdGlvbi54ID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ueCAqIGRldmljZVBpeGVsUmF0aW87XG4gICAgICAgICAgICBfaW5wdXRTY3JlZW5Qb3NpdGlvbi55ID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ueSAqIGRldmljZVBpeGVsUmF0aW87XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBkZXRlcm1pbmUgcG9zaXRpb24gZnJvbSBpbnB1dCBldmVudCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2Nob29zZVJheU9yaWdpbkFuZERpcmVjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2VsZW1lbnQuc2NyZWVuICYmIHRoaXMuX2VsZW1lbnQuc2NyZWVuLnNjcmVlbi5zY3JlZW5TcGFjZSkge1xuICAgICAgICAgICAgX3JheS5vcmlnaW4uc2V0KF9pbnB1dFNjcmVlblBvc2l0aW9uLngsIC1faW5wdXRTY3JlZW5Qb3NpdGlvbi55LCAwKTtcbiAgICAgICAgICAgIF9yYXkuZGlyZWN0aW9uLmNvcHkoVmVjMy5GT1JXQVJEKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9pbnB1dFdvcmxkUG9zaXRpb24uY29weSh0aGlzLl9kcmFnQ2FtZXJhLnNjcmVlblRvV29ybGQoX2lucHV0U2NyZWVuUG9zaXRpb24ueCwgX2lucHV0U2NyZWVuUG9zaXRpb24ueSwgMSkpO1xuICAgICAgICAgICAgX3JheS5vcmlnaW4uY29weSh0aGlzLl9kcmFnQ2FtZXJhLmVudGl0eS5nZXRQb3NpdGlvbigpKTtcbiAgICAgICAgICAgIF9yYXkuZGlyZWN0aW9uLmNvcHkoX2lucHV0V29ybGRQb3NpdGlvbikuc3ViKF9yYXkub3JpZ2luKS5ub3JtYWxpemUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9jYWxjdWxhdGVEcmFnU2NhbGUoKSB7XG4gICAgICAgIGxldCBjdXJyZW50ID0gdGhpcy5fZWxlbWVudC5lbnRpdHkucGFyZW50O1xuICAgICAgICBjb25zdCBzY3JlZW4gPSB0aGlzLl9lbGVtZW50LnNjcmVlbiAmJiB0aGlzLl9lbGVtZW50LnNjcmVlbi5zY3JlZW47XG4gICAgICAgIGNvbnN0IGlzV2l0aGluMkRTY3JlZW4gPSBzY3JlZW4gJiYgc2NyZWVuLnNjcmVlblNwYWNlO1xuICAgICAgICBjb25zdCBzY3JlZW5TY2FsZSA9IGlzV2l0aGluMkRTY3JlZW4gPyBzY3JlZW4uc2NhbGUgOiAxO1xuICAgICAgICBjb25zdCBkcmFnU2NhbGUgPSB0aGlzLl9kcmFnU2NhbGU7XG5cbiAgICAgICAgZHJhZ1NjYWxlLnNldChzY3JlZW5TY2FsZSwgc2NyZWVuU2NhbGUsIHNjcmVlblNjYWxlKTtcblxuICAgICAgICB3aGlsZSAoY3VycmVudCkge1xuICAgICAgICAgICAgZHJhZ1NjYWxlLm11bChjdXJyZW50LmdldExvY2FsU2NhbGUoKSk7XG4gICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5wYXJlbnQ7XG5cbiAgICAgICAgICAgIGlmIChpc1dpdGhpbjJEU2NyZWVuICYmIGN1cnJlbnQuc2NyZWVuKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBkcmFnU2NhbGUueCA9IDEgLyBkcmFnU2NhbGUueDtcbiAgICAgICAgZHJhZ1NjYWxlLnkgPSAxIC8gZHJhZ1NjYWxlLnk7XG4gICAgICAgIGRyYWdTY2FsZS56ID0gMSAvIGRyYWdTY2FsZS56O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpbmtlZCB0byBgX2VsZW1lbnRgIGV2ZW50czogYG1vdXNlbW92ZWAgYW5kIGB0b3VjaG1vdmVgXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vaW5wdXQvZWxlbWVudC1pbnB1dCcpLkVsZW1lbnRUb3VjaEV2ZW50fSBldmVudCAtIFRoZSBldmVudC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9vbk1vdmUoZXZlbnQpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgX2VsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICBfZGVsdGFNb3VzZVBvc2l0aW9uOiBkZWx0YU1vdXNlUG9zaXRpb24sXG4gICAgICAgICAgICBfZGVsdGFIYW5kbGVQb3NpdGlvbjogZGVsdGFIYW5kbGVQb3NpdGlvbixcbiAgICAgICAgICAgIF9heGlzOiBheGlzXG4gICAgICAgIH0gPSB0aGlzO1xuICAgICAgICBpZiAoZWxlbWVudCAmJiB0aGlzLl9pc0RyYWdnaW5nICYmIHRoaXMuZW5hYmxlZCAmJiBlbGVtZW50LmVuYWJsZWQgJiYgZWxlbWVudC5lbnRpdHkuZW5hYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudE1vdXNlUG9zaXRpb24gPSB0aGlzLl9zY3JlZW5Ub0xvY2FsKGV2ZW50KTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TW91c2VQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIGRlbHRhTW91c2VQb3NpdGlvbi5zdWIyKGN1cnJlbnRNb3VzZVBvc2l0aW9uLCB0aGlzLl9kcmFnU3RhcnRNb3VzZVBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBkZWx0YUhhbmRsZVBvc2l0aW9uLmFkZDIodGhpcy5fZHJhZ1N0YXJ0SGFuZGxlUG9zaXRpb24sIGRlbHRhTW91c2VQb3NpdGlvbik7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXhpcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UG9zaXRpb24gPSBlbGVtZW50LmVudGl0eS5nZXRMb2NhbFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbmVkQXhpcyA9IE9QUE9TSVRFX0FYSVNbYXhpc107XG4gICAgICAgICAgICAgICAgICAgIGRlbHRhSGFuZGxlUG9zaXRpb25bY29uc3RyYWluZWRBeGlzXSA9IGN1cnJlbnRQb3NpdGlvbltjb25zdHJhaW5lZEF4aXNdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZW50aXR5LnNldExvY2FsUG9zaXRpb24oZGVsdGFIYW5kbGVQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdkcmFnOm1vdmUnLCBkZWx0YUhhbmRsZVBvc2l0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUxpZmVjeWNsZUxpc3RlbmVycygnb2ZmJyk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZURyYWdMaXN0ZW5lcnMoJ29mZicpO1xuICAgIH1cblxuICAgIHNldCBlbmFibGVkKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgZW5hYmxlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG4gICAgfVxuXG4gICAgZ2V0IGlzRHJhZ2dpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RyYWdnaW5nO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgRWxlbWVudERyYWdIZWxwZXIgfTtcbiJdLCJuYW1lcyI6WyJfaW5wdXRTY3JlZW5Qb3NpdGlvbiIsIlZlYzIiLCJfaW5wdXRXb3JsZFBvc2l0aW9uIiwiVmVjMyIsIl9yYXkiLCJSYXkiLCJfcGxhbmUiLCJQbGFuZSIsIl9lbnRpdHlSb3RhdGlvbiIsIlF1YXQiLCJPUFBPU0lURV9BWElTIiwieCIsInkiLCJFbGVtZW50RHJhZ0hlbHBlciIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiZWxlbWVudCIsImF4aXMiLCJFbGVtZW50Q29tcG9uZW50IiwiRXJyb3IiLCJfZWxlbWVudCIsIl9hcHAiLCJzeXN0ZW0iLCJhcHAiLCJfYXhpcyIsIl9lbmFibGVkIiwiX2RyYWdTY2FsZSIsIl9kcmFnU3RhcnRNb3VzZVBvc2l0aW9uIiwiX2RyYWdTdGFydEhhbmRsZVBvc2l0aW9uIiwiX2RlbHRhTW91c2VQb3NpdGlvbiIsIl9kZWx0YUhhbmRsZVBvc2l0aW9uIiwiX2lzRHJhZ2dpbmciLCJfdG9nZ2xlTGlmZWN5Y2xlTGlzdGVuZXJzIiwib25Pck9mZiIsIl9vbk1vdXNlRG93bk9yVG91Y2hTdGFydCIsIl90b2dnbGVEcmFnTGlzdGVuZXJzIiwiaXNPbiIsIl9oYXNEcmFnTGlzdGVuZXJzIiwibW91c2UiLCJfb25Nb3ZlIiwiX29uTW91c2VVcE9yVG91Y2hFbmQiLCJwbGF0Zm9ybSIsInRvdWNoIiwiZXZlbnQiLCJlbmFibGVkIiwiX2RyYWdDYW1lcmEiLCJjYW1lcmEiLCJfY2FsY3VsYXRlRHJhZ1NjYWxlIiwiY3VycmVudE1vdXNlUG9zaXRpb24iLCJfc2NyZWVuVG9Mb2NhbCIsImNvcHkiLCJlbnRpdHkiLCJnZXRMb2NhbFBvc2l0aW9uIiwiZmlyZSIsIl9kZXRlcm1pbmVJbnB1dFBvc2l0aW9uIiwiX2Nob29zZVJheU9yaWdpbkFuZERpcmVjdGlvbiIsInBvaW50Iiwibm9ybWFsIiwiZm9yd2FyZCIsIm11bFNjYWxhciIsImRlbm9taW5hdG9yIiwiZG90IiwiZGlyZWN0aW9uIiwiTWF0aCIsImFicyIsInJheU9yaWdpblRvUGxhbmVPcmlnaW4iLCJzdWIiLCJvcmlnaW4iLCJjb2xsaXNpb25EaXN0YW5jZSIsInBvc2l0aW9uIiwiYWRkIiwiZ2V0Um90YXRpb24iLCJpbnZlcnQiLCJ0cmFuc2Zvcm1WZWN0b3IiLCJtdWwiLCJkZXZpY2VQaXhlbFJhdGlvIiwiZ3JhcGhpY3NEZXZpY2UiLCJtYXhQaXhlbFJhdGlvIiwiY2hhbmdlZFRvdWNoZXMiLCJjb25zb2xlIiwid2FybiIsInNjcmVlbiIsInNjcmVlblNwYWNlIiwic2V0IiwiRk9SV0FSRCIsInNjcmVlblRvV29ybGQiLCJnZXRQb3NpdGlvbiIsIm5vcm1hbGl6ZSIsImN1cnJlbnQiLCJwYXJlbnQiLCJpc1dpdGhpbjJEU2NyZWVuIiwic2NyZWVuU2NhbGUiLCJzY2FsZSIsImRyYWdTY2FsZSIsImdldExvY2FsU2NhbGUiLCJ6IiwiZGVsdGFNb3VzZVBvc2l0aW9uIiwiZGVsdGFIYW5kbGVQb3NpdGlvbiIsInN1YjIiLCJhZGQyIiwiY3VycmVudFBvc2l0aW9uIiwiY29uc3RyYWluZWRBeGlzIiwic2V0TG9jYWxQb3NpdGlvbiIsImRlc3Ryb3kiLCJ2YWx1ZSIsImlzRHJhZ2dpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBV0EsTUFBTUEsb0JBQW9CLEdBQUcsSUFBSUMsSUFBSSxFQUFFLENBQUE7QUFDdkMsTUFBTUMsbUJBQW1CLEdBQUcsSUFBSUMsSUFBSSxFQUFFLENBQUE7QUFDdEMsTUFBTUMsSUFBSSxHQUFHLElBQUlDLEdBQUcsRUFBRSxDQUFBO0FBQ3RCLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxLQUFLLEVBQUUsQ0FBQTtBQUMxQixNQUFNQyxlQUFlLEdBQUcsSUFBSUMsSUFBSSxFQUFFLENBQUE7QUFFbEMsTUFBTUMsYUFBYSxHQUFHO0FBQ2xCQyxFQUFBQSxDQUFDLEVBQUUsR0FBRztBQUNOQyxFQUFBQSxDQUFDLEVBQUUsR0FBQTtBQUNQLENBQUMsQ0FBQTs7QUFPRCxNQUFNQyxpQkFBaUIsU0FBU0MsWUFBWSxDQUFDO0FBT3pDQyxFQUFBQSxXQUFXLENBQUNDLE9BQU8sRUFBRUMsSUFBSSxFQUFFO0FBQ3ZCLElBQUEsS0FBSyxFQUFFLENBQUE7SUFFUCxJQUFJLENBQUNELE9BQU8sSUFBSSxFQUFFQSxPQUFPLFlBQVlFLGdCQUFnQixDQUFDLEVBQUU7QUFDcEQsTUFBQSxNQUFNLElBQUlDLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFBO0FBQ2xFLEtBQUE7SUFFQSxJQUFJRixJQUFJLElBQUlBLElBQUksS0FBSyxHQUFHLElBQUlBLElBQUksS0FBSyxHQUFHLEVBQUU7QUFDdEMsTUFBQSxNQUFNLElBQUlFLEtBQUssQ0FBQyxxQkFBcUIsR0FBR0YsSUFBSSxDQUFDLENBQUE7QUFDakQsS0FBQTtJQUVBLElBQUksQ0FBQ0csUUFBUSxHQUFHSixPQUFPLENBQUE7QUFDdkIsSUFBQSxJQUFJLENBQUNLLElBQUksR0FBR0wsT0FBTyxDQUFDTSxNQUFNLENBQUNDLEdBQUcsQ0FB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
