/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { platform } from '../../../core/platform.js';
import { EventHandler } from '../../../core/event-handler.js';
import { Quat } from '../../../math/quat.js';
import { Vec2 } from '../../../math/vec2.js';
import { Vec3 } from '../../../math/vec3.js';
import { ElementComponent } from './component.js';
import { Ray } from '../../../shape/ray.js';
import { Plane } from '../../../shape/plane.js';

const _inputScreenPosition = new Vec2();

const _inputWorldPosition = new Vec3();

const _ray = new Ray();

const _plane = new Plane();

const _entityRotation = new Quat();

const OPPOSITE_AXIS = {
  x: 'y',
  y: 'x'
};

class ElementDragHelper extends EventHandler {
  constructor(element, axis) {
    super();

    if (!element || !(element instanceof ElementComponent)) {
      throw new Error('Element was null or not an ElementComponent');
    }

    if (axis && axis !== 'x' && axis !== 'y') {
      throw new Error('Unrecognized axis: ' + axis);
    }

    this._element = element;
    this._app = element.system.app;
    this._axis = axis || null;
    this._enabled = true;
    this._dragScale = new Vec3();
    this._dragStartMousePosition = new Vec3();
    this._dragStartHandlePosition = new Vec3();
    this._deltaMousePosition = new Vec3();
    this._deltaHandlePosition = new Vec3();
    this._isDragging = false;

    this._toggleLifecycleListeners('on');
  }

  _toggleLifecycleListeners(onOrOff) {
    this._element[onOrOff]('mousedown', this._onMouseDownOrTouchStart, this);

    this._element[onOrOff]('touchstart', this._onMouseDownOrTouchStart, this);
  }

  _toggleDragListeners(onOrOff) {
    const isOn = onOrOff === 'on';

    if (this._hasDragListeners && isOn) {
      return;
    }

    if (!this._handleMouseUpOrTouchEnd) {
      this._handleMouseUpOrTouchEnd = this._onMouseUpOrTouchEnd.bind(this);
    }

    if (this._app.mouse) {
      this._element[onOrOff]('mousemove', this._onMove, this);

      this._element[onOrOff]('mouseup', this._handleMouseUpOrTouchEnd, false);
    }

    if (platform.touch) {
      this._element[onOrOff]('touchmove', this._onMove, this);

      this._element[onOrOff]('touchend', this._handleMouseUpOrTouchEnd, this);

      this._element[onOrOff]('touchcancel', this._handleMouseUpOrTouchEnd, this);
    }

    this._hasDragListeners = isOn;
  }

  _onMouseDownOrTouchStart(event) {
    if (this._element && !this._isDragging && this.enabled) {
      this._dragCamera = event.camera;

      this._calculateDragScale();

      const currentMousePosition = this._screenToLocal(event);

      if (currentMousePosition) {
        this._toggleDragListeners('on');

        this._isDragging = true;

        this._dragStartMousePosition.copy(currentMousePosition);

        this._dragStartHandlePosition.copy(this._element.entity.getLocalPosition());

        this.fire('drag:start');
      }
    }
  }

  _onMouseUpOrTouchEnd() {
    if (this._isDragging) {
      this._isDragging = false;

      this._toggleDragListeners('off');

      this.fire('drag:end');
    }
  }

  _screenToLocal(event) {
    this._determineInputPosition(event);

    this._chooseRayOriginAndDirection();

    _plane.point.copy(this._element.entity.getLocalPosition());

    _plane.normal.copy(this._element.entity.forward).mulScalar(-1);

    const denominator = _plane.normal.dot(_ray.direction);

    if (Math.abs(denominator) > 0) {
      const rayOriginToPlaneOrigin = _plane.point.sub(_ray.origin);

      const collisionDistance = rayOriginToPlaneOrigin.dot(_plane.normal) / denominator;

      const position = _ray.origin.add(_ray.direction.mulScalar(collisionDistance));

      _entityRotation.copy(this._element.entity.getRotation()).invert().transformVector(position, position);

      position.mul(this._dragScale);
      return position;
    }

    return null;
  }

  _determineInputPosition(event) {
    const devicePixelRatio = this._app.graphicsDevice.maxPixelRatio;

    if (typeof event.x !== 'undefined' && typeof event.y !== 'undefined') {
      _inputScreenPosition.x = event.x * devicePixelRatio;
      _inputScreenPosition.y = event.y * devicePixelRatio;
    } else if (event.changedTouches) {
      _inputScreenPosition.x = event.changedTouches[0].x * devicePixelRatio;
      _inputScreenPosition.y = event.changedTouches[0].y * devicePixelRatio;
    } else {
      console.warn('Could not determine position from input event');
    }
  }

  _chooseRayOriginAndDirection() {
    if (this._element.screen && this._element.screen.screen.screenSpace) {
      _ray.origin.set(_inputScreenPosition.x, -_inputScreenPosition.y, 0);

      _ray.direction.copy(Vec3.FORWARD);
    } else {
      _inputWorldPosition.copy(this._dragCamera.screenToWorld(_inputScreenPosition.x, _inputScreenPosition.y, 1));

      _ray.origin.copy(this._dragCamera.entity.getPosition());

      _ray.direction.copy(_inputWorldPosition).sub(_ray.origin).normalize();
    }
  }

  _calculateDragScale() {
    let current = this._element.entity.parent;
    const screen = this._element.screen && this._element.screen.screen;
    const isWithin2DScreen = screen && screen.screenSpace;
    const screenScale = isWithin2DScreen ? screen.scale : 1;
    const dragScale = this._dragScale;
    dragScale.set(screenScale, screenScale, screenScale);

    while (current) {
      dragScale.mul(current.getLocalScale());
      current = current.parent;

      if (isWithin2DScreen && current.screen) {
        break;
      }
    }

    dragScale.x = 1 / dragScale.x;
    dragScale.y = 1 / dragScale.y;
    dragScale.z = 1 / dragScale.z;
  }

  _onMove(event) {
    const {
      _element: element,
      _deltaMousePosition: deltaMousePosition,
      _deltaHandlePosition: deltaHandlePosition,
      _axis: axis
    } = this;

    if (element && this._isDragging && this.enabled && element.enabled && element.entity.enabled) {
      const currentMousePosition = this._screenToLocal(event);

      if (currentMousePosition) {
        deltaMousePosition.sub2(currentMousePosition, this._dragStartMousePosition);
        deltaHandlePosition.add2(this._dragStartHandlePosition, deltaMousePosition);

        if (axis) {
          const currentPosition = element.entity.getLocalPosition();
          const constrainedAxis = OPPOSITE_AXIS[axis];
          deltaHandlePosition[constrainedAxis] = currentPosition[constrainedAxis];
        }

        element.entity.setLocalPosition(deltaHandlePosition);
        this.fire('drag:move', deltaHandlePosition);
      }
    }
  }

  destroy() {
    this._toggleLifecycleListeners('off');

    this._toggleDragListeners('off');
  }

  set enabled(value) {
    this._enabled = value;
  }

  get enabled() {
    return this._enabled;
  }

  get isDragging() {
    return this._isDragging;
  }

}

export { ElementDragHelper };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC1kcmFnLWhlbHBlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9jb21wb25lbnRzL2VsZW1lbnQvZWxlbWVudC1kcmFnLWhlbHBlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgUXVhdCB9IGZyb20gJy4uLy4uLy4uL21hdGgvcXVhdC5qcyc7XG5pbXBvcnQgeyBWZWMyIH0gZnJvbSAnLi4vLi4vLi4vbWF0aC92ZWMyLmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi8uLi9tYXRoL3ZlYzMuanMnO1xuXG5pbXBvcnQgeyBFbGVtZW50Q29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgUmF5IH0gZnJvbSAnLi4vLi4vLi4vc2hhcGUvcmF5LmpzJztcbmltcG9ydCB7IFBsYW5lIH0gZnJvbSAnLi4vLi4vLi4vc2hhcGUvcGxhbmUuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vLi4vaW5wdXQvZWxlbWVudC1pbnB1dCcpLkVsZW1lbnRUb3VjaEV2ZW50fSBFbGVtZW50VG91Y2hFdmVudCAqL1xuXG5jb25zdCBfaW5wdXRTY3JlZW5Qb3NpdGlvbiA9IG5ldyBWZWMyKCk7XG5jb25zdCBfaW5wdXRXb3JsZFBvc2l0aW9uID0gbmV3IFZlYzMoKTtcbmNvbnN0IF9yYXkgPSBuZXcgUmF5KCk7XG5jb25zdCBfcGxhbmUgPSBuZXcgUGxhbmUoKTtcbmNvbnN0IF9lbnRpdHlSb3RhdGlvbiA9IG5ldyBRdWF0KCk7XG5cbmNvbnN0IE9QUE9TSVRFX0FYSVMgPSB7XG4gICAgeDogJ3knLFxuICAgIHk6ICd4J1xufTtcblxuLyoqXG4gKiBIZWxwZXIgY2xhc3MgdGhhdCBtYWtlcyBpdCBlYXN5IHRvIGNyZWF0ZSBFbGVtZW50cyB0aGF0IGNhbiBiZSBkcmFnZ2VkIGJ5IHRoZSBtb3VzZSBvciB0b3VjaC5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIEVsZW1lbnREcmFnSGVscGVyIGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgRWxlbWVudERyYWdIZWxwZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnRDb21wb25lbnR9IGVsZW1lbnQgLSBUaGUgRWxlbWVudCB0aGF0IHNob3VsZCBiZWNvbWUgZHJhZ2dhYmxlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbYXhpc10gLSBPcHRpb25hbCBheGlzIHRvIGNvbnN0cmFpbiB0bywgZWl0aGVyICd4JywgJ3knIG9yIG51bGwuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZWxlbWVudCwgYXhpcykge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIGlmICghZWxlbWVudCB8fCAhKGVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50Q29tcG9uZW50KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbGVtZW50IHdhcyBudWxsIG9yIG5vdCBhbiBFbGVtZW50Q29tcG9uZW50Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXhpcyAmJiBheGlzICE9PSAneCcgJiYgYXhpcyAhPT0gJ3knKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VucmVjb2duaXplZCBheGlzOiAnICsgYXhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgdGhpcy5fYXBwID0gZWxlbWVudC5zeXN0ZW0uYXBwO1xuICAgICAgICB0aGlzLl9heGlzID0gYXhpcyB8fCBudWxsO1xuICAgICAgICB0aGlzLl9lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZHJhZ1NjYWxlID0gbmV3IFZlYzMoKTtcbiAgICAgICAgdGhpcy5fZHJhZ1N0YXJ0TW91c2VQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2RyYWdTdGFydEhhbmRsZVBvc2l0aW9uID0gbmV3IFZlYzMoKTtcbiAgICAgICAgdGhpcy5fZGVsdGFNb3VzZVBvc2l0aW9uID0gbmV3IFZlYzMoKTtcbiAgICAgICAgdGhpcy5fZGVsdGFIYW5kbGVQb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLl90b2dnbGVMaWZlY3ljbGVMaXN0ZW5lcnMoJ29uJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhIG5ldyBkcmFnIG9wZXJhdGlvbiBzdGFydHMuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgRWxlbWVudERyYWdIZWxwZXIjZHJhZzpzdGFydFxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiB0aGUgY3VycmVudCBuZXcgZHJhZyBvcGVyYXRpb24gZW5kcy5cbiAgICAgKlxuICAgICAqIEBldmVudCBFbGVtZW50RHJhZ0hlbHBlciNkcmFnOmVuZFxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbmV2ZXIgdGhlIHBvc2l0aW9uIG9mIHRoZSBkcmFnZ2VkIGVsZW1lbnQgY2hhbmdlcy5cbiAgICAgKlxuICAgICAqIEBldmVudCBFbGVtZW50RHJhZ0hlbHBlciNkcmFnOm1vdmVcbiAgICAgKiBAcGFyYW0ge1ZlYzN9IHZhbHVlIC0gVGhlIGN1cnJlbnQgcG9zaXRpb24uXG4gICAgICovXG5cbiAgICBfdG9nZ2xlTGlmZWN5Y2xlTGlzdGVuZXJzKG9uT3JPZmYpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgnbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd25PclRvdWNoU3RhcnQsIHRoaXMpO1xuICAgICAgICB0aGlzLl9lbGVtZW50W29uT3JPZmZdKCd0b3VjaHN0YXJ0JywgdGhpcy5fb25Nb3VzZURvd25PclRvdWNoU3RhcnQsIHRoaXMpO1xuICAgIH1cblxuICAgIF90b2dnbGVEcmFnTGlzdGVuZXJzKG9uT3JPZmYpIHtcbiAgICAgICAgY29uc3QgaXNPbiA9IG9uT3JPZmYgPT09ICdvbic7XG5cbiAgICAgICAgLy8gUHJldmVudCBtdWx0aXBsZSBsaXN0ZW5lcnNcbiAgICAgICAgaWYgKHRoaXMuX2hhc0RyYWdMaXN0ZW5lcnMgJiYgaXNPbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLl9oYW5kbGVNb3VzZVVwT3JUb3VjaEVuZCkge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlTW91c2VVcE9yVG91Y2hFbmQgPSB0aGlzLl9vbk1vdXNlVXBPclRvdWNoRW5kLmJpbmQodGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBtb3VzZSBldmVudHMsIGlmIG1vdXNlIGlzIGF2YWlsYWJsZVxuICAgICAgICBpZiAodGhpcy5fYXBwLm1vdXNlKSB7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50W29uT3JPZmZdKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdmUsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFtvbk9yT2ZmXSgnbW91c2V1cCcsIHRoaXMuX2hhbmRsZU1vdXNlVXBPclRvdWNoRW5kLCBmYWxzZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0b3VjaCBldmVudHMsIGlmIHRvdWNoIGlzIGF2YWlsYWJsZVxuICAgICAgICBpZiAocGxhdGZvcm0udG91Y2gpIHtcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ3RvdWNobW92ZScsIHRoaXMuX29uTW92ZSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50W29uT3JPZmZdKCd0b3VjaGVuZCcsIHRoaXMuX2hhbmRsZU1vdXNlVXBPclRvdWNoRW5kLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRbb25Pck9mZl0oJ3RvdWNoY2FuY2VsJywgdGhpcy5faGFuZGxlTW91c2VVcE9yVG91Y2hFbmQsIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faGFzRHJhZ0xpc3RlbmVycyA9IGlzT247XG4gICAgfVxuXG4gICAgX29uTW91c2VEb3duT3JUb3VjaFN0YXJ0KGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9lbGVtZW50ICYmICF0aGlzLl9pc0RyYWdnaW5nICYmIHRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgICAgdGhpcy5fZHJhZ0NhbWVyYSA9IGV2ZW50LmNhbWVyYTtcbiAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZURyYWdTY2FsZSgpO1xuXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50TW91c2VQb3NpdGlvbiA9IHRoaXMuX3NjcmVlblRvTG9jYWwoZXZlbnQpO1xuXG4gICAgICAgICAgICBpZiAoY3VycmVudE1vdXNlUG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVEcmFnTGlzdGVuZXJzKCdvbicpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdTdGFydE1vdXNlUG9zaXRpb24uY29weShjdXJyZW50TW91c2VQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5fZHJhZ1N0YXJ0SGFuZGxlUG9zaXRpb24uY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5nZXRMb2NhbFBvc2l0aW9uKCkpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdkcmFnOnN0YXJ0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25Nb3VzZVVwT3JUb3VjaEVuZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzRHJhZ2dpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3RvZ2dsZURyYWdMaXN0ZW5lcnMoJ29mZicpO1xuXG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2RyYWc6ZW5kJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBjYWxjdWxhdGVzIHRoZSBgVmVjM2AgaW50ZXJzZWN0aW9uIHBvaW50IG9mIHBsYW5lL3JheSBpbnRlcnNlY3Rpb24gYmFzZWQgb25cbiAgICAgKiB0aGUgbW91c2UvdG91Y2ggaW5wdXQgZXZlbnQuIElmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbiwgaXQgcmV0dXJucyBgbnVsbGAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnRUb3VjaEV2ZW50fSBldmVudCAtIFRoZSBldmVudC5cbiAgICAgKiBAcmV0dXJucyB7VmVjM3xudWxsfSBUaGUgYFZlYzNgIGludGVyc2VjdGlvbiBwb2ludCBvZiBwbGFuZS9yYXkgaW50ZXJzZWN0aW9uLCBpZiB0aGVyZVxuICAgICAqIGlzIGFuIGludGVyc2VjdGlvbiwgb3RoZXJ3aXNlIGBudWxsYFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NjcmVlblRvTG9jYWwoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5fZGV0ZXJtaW5lSW5wdXRQb3NpdGlvbihldmVudCk7XG4gICAgICAgIHRoaXMuX2Nob29zZVJheU9yaWdpbkFuZERpcmVjdGlvbigpO1xuXG4gICAgICAgIF9wbGFuZS5wb2ludC5jb3B5KHRoaXMuX2VsZW1lbnQuZW50aXR5LmdldExvY2FsUG9zaXRpb24oKSk7XG4gICAgICAgIF9wbGFuZS5ub3JtYWwuY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5mb3J3YXJkKS5tdWxTY2FsYXIoLTEpO1xuXG4gICAgICAgIGNvbnN0IGRlbm9taW5hdG9yID0gX3BsYW5lLm5vcm1hbC5kb3QoX3JheS5kaXJlY3Rpb24pO1xuXG4gICAgICAgIC8vIElmIHRoZSByYXkgYW5kIHBsYW5lIGFyZSBub3QgcGFyYWxsZWxcbiAgICAgICAgaWYgKE1hdGguYWJzKGRlbm9taW5hdG9yKSA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJheU9yaWdpblRvUGxhbmVPcmlnaW4gPSBfcGxhbmUucG9pbnQuc3ViKF9yYXkub3JpZ2luKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxpc2lvbkRpc3RhbmNlID0gcmF5T3JpZ2luVG9QbGFuZU9yaWdpbi5kb3QoX3BsYW5lLm5vcm1hbCkgLyBkZW5vbWluYXRvcjtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gX3JheS5vcmlnaW4uYWRkKF9yYXkuZGlyZWN0aW9uLm11bFNjYWxhcihjb2xsaXNpb25EaXN0YW5jZSkpO1xuXG4gICAgICAgICAgICBfZW50aXR5Um90YXRpb24uY29weSh0aGlzLl9lbGVtZW50LmVudGl0eS5nZXRSb3RhdGlvbigpKS5pbnZlcnQoKS50cmFuc2Zvcm1WZWN0b3IocG9zaXRpb24sIHBvc2l0aW9uKTtcblxuICAgICAgICAgICAgcG9zaXRpb24ubXVsKHRoaXMuX2RyYWdTY2FsZSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIF9kZXRlcm1pbmVJbnB1dFBvc2l0aW9uKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGRldmljZVBpeGVsUmF0aW8gPSB0aGlzLl9hcHAuZ3JhcGhpY3NEZXZpY2UubWF4UGl4ZWxSYXRpbztcblxuICAgICAgICBpZiAodHlwZW9mIGV2ZW50LnggIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBldmVudC55ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgX2lucHV0U2NyZWVuUG9zaXRpb24ueCA9IGV2ZW50LnggKiBkZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICAgICAgX2lucHV0U2NyZWVuUG9zaXRpb24ueSA9IGV2ZW50LnkgKiBkZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICBfaW5wdXRTY3JlZW5Qb3NpdGlvbi54ID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ueCAqIGRldmljZVBpeGVsUmF0aW87XG4gICAgICAgICAgICBfaW5wdXRTY3JlZW5Qb3NpdGlvbi55ID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ueSAqIGRldmljZVBpeGVsUmF0aW87XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBkZXRlcm1pbmUgcG9zaXRpb24gZnJvbSBpbnB1dCBldmVudCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2Nob29zZVJheU9yaWdpbkFuZERpcmVjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2VsZW1lbnQuc2NyZWVuICYmIHRoaXMuX2VsZW1lbnQuc2NyZWVuLnNjcmVlbi5zY3JlZW5TcGFjZSkge1xuICAgICAgICAgICAgX3JheS5vcmlnaW4uc2V0KF9pbnB1dFNjcmVlblBvc2l0aW9uLngsIC1faW5wdXRTY3JlZW5Qb3NpdGlvbi55LCAwKTtcbiAgICAgICAgICAgIF9yYXkuZGlyZWN0aW9uLmNvcHkoVmVjMy5GT1JXQVJEKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9pbnB1dFdvcmxkUG9zaXRpb24uY29weSh0aGlzLl9kcmFnQ2FtZXJhLnNjcmVlblRvV29ybGQoX2lucHV0U2NyZWVuUG9zaXRpb24ueCwgX2lucHV0U2NyZWVuUG9zaXRpb24ueSwgMSkpO1xuICAgICAgICAgICAgX3JheS5vcmlnaW4uY29weSh0aGlzLl9kcmFnQ2FtZXJhLmVudGl0eS5nZXRQb3NpdGlvbigpKTtcbiAgICAgICAgICAgIF9yYXkuZGlyZWN0aW9uLmNvcHkoX2lucHV0V29ybGRQb3NpdGlvbikuc3ViKF9yYXkub3JpZ2luKS5ub3JtYWxpemUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9jYWxjdWxhdGVEcmFnU2NhbGUoKSB7XG4gICAgICAgIGxldCBjdXJyZW50ID0gdGhpcy5fZWxlbWVudC5lbnRpdHkucGFyZW50O1xuICAgICAgICBjb25zdCBzY3JlZW4gPSB0aGlzLl9lbGVtZW50LnNjcmVlbiAmJiB0aGlzLl9lbGVtZW50LnNjcmVlbi5zY3JlZW47XG4gICAgICAgIGNvbnN0IGlzV2l0aGluMkRTY3JlZW4gPSBzY3JlZW4gJiYgc2NyZWVuLnNjcmVlblNwYWNlO1xuICAgICAgICBjb25zdCBzY3JlZW5TY2FsZSA9IGlzV2l0aGluMkRTY3JlZW4gPyBzY3JlZW4uc2NhbGUgOiAxO1xuICAgICAgICBjb25zdCBkcmFnU2NhbGUgPSB0aGlzLl9kcmFnU2NhbGU7XG5cbiAgICAgICAgZHJhZ1NjYWxlLnNldChzY3JlZW5TY2FsZSwgc2NyZWVuU2NhbGUsIHNjcmVlblNjYWxlKTtcblxuICAgICAgICB3aGlsZSAoY3VycmVudCkge1xuICAgICAgICAgICAgZHJhZ1NjYWxlLm11bChjdXJyZW50LmdldExvY2FsU2NhbGUoKSk7XG4gICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5wYXJlbnQ7XG5cbiAgICAgICAgICAgIGlmIChpc1dpdGhpbjJEU2NyZWVuICYmIGN1cnJlbnQuc2NyZWVuKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBkcmFnU2NhbGUueCA9IDEgLyBkcmFnU2NhbGUueDtcbiAgICAgICAgZHJhZ1NjYWxlLnkgPSAxIC8gZHJhZ1NjYWxlLnk7XG4gICAgICAgIGRyYWdTY2FsZS56ID0gMSAvIGRyYWdTY2FsZS56O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGxpbmtlZCB0byBgX2VsZW1lbnRgIGV2ZW50czogYG1vdXNlbW92ZWAgYW5kIGB0b3VjaG1vdmVgXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnRUb3VjaEV2ZW50fSBldmVudCAtIFRoZSBldmVudC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9vbk1vdmUoZXZlbnQpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgX2VsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICBfZGVsdGFNb3VzZVBvc2l0aW9uOiBkZWx0YU1vdXNlUG9zaXRpb24sXG4gICAgICAgICAgICBfZGVsdGFIYW5kbGVQb3NpdGlvbjogZGVsdGFIYW5kbGVQb3NpdGlvbixcbiAgICAgICAgICAgIF9heGlzOiBheGlzXG4gICAgICAgIH0gPSB0aGlzO1xuICAgICAgICBpZiAoZWxlbWVudCAmJiB0aGlzLl9pc0RyYWdnaW5nICYmIHRoaXMuZW5hYmxlZCAmJiBlbGVtZW50LmVuYWJsZWQgJiYgZWxlbWVudC5lbnRpdHkuZW5hYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudE1vdXNlUG9zaXRpb24gPSB0aGlzLl9zY3JlZW5Ub0xvY2FsKGV2ZW50KTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TW91c2VQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIGRlbHRhTW91c2VQb3NpdGlvbi5zdWIyKGN1cnJlbnRNb3VzZVBvc2l0aW9uLCB0aGlzLl9kcmFnU3RhcnRNb3VzZVBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBkZWx0YUhhbmRsZVBvc2l0aW9uLmFkZDIodGhpcy5fZHJhZ1N0YXJ0SGFuZGxlUG9zaXRpb24sIGRlbHRhTW91c2VQb3NpdGlvbik7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXhpcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UG9zaXRpb24gPSBlbGVtZW50LmVudGl0eS5nZXRMb2NhbFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbmVkQXhpcyA9IE9QUE9TSVRFX0FYSVNbYXhpc107XG4gICAgICAgICAgICAgICAgICAgIGRlbHRhSGFuZGxlUG9zaXRpb25bY29uc3RyYWluZWRBeGlzXSA9IGN1cnJlbnRQb3NpdGlvbltjb25zdHJhaW5lZEF4aXNdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZW50aXR5LnNldExvY2FsUG9zaXRpb24oZGVsdGFIYW5kbGVQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdkcmFnOm1vdmUnLCBkZWx0YUhhbmRsZVBvc2l0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUxpZmVjeWNsZUxpc3RlbmVycygnb2ZmJyk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZURyYWdMaXN0ZW5lcnMoJ29mZicpO1xuICAgIH1cblxuICAgIHNldCBlbmFibGVkKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgZW5hYmxlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG4gICAgfVxuXG4gICAgZ2V0IGlzRHJhZ2dpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RyYWdnaW5nO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgRWxlbWVudERyYWdIZWxwZXIgfTtcbiJdLCJuYW1lcyI6WyJfaW5wdXRTY3JlZW5Qb3NpdGlvbiIsIlZlYzIiLCJfaW5wdXRXb3JsZFBvc2l0aW9uIiwiVmVjMyIsIl9yYXkiLCJSYXkiLCJfcGxhbmUiLCJQbGFuZSIsIl9lbnRpdHlSb3RhdGlvbiIsIlF1YXQiLCJPUFBPU0lURV9BWElTIiwieCIsInkiLCJFbGVtZW50RHJhZ0hlbHBlciIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiZWxlbWVudCIsImF4aXMiLCJFbGVtZW50Q29tcG9uZW50IiwiRXJyb3IiLCJfZWxlbWVudCIsIl9hcHAiLCJzeXN0ZW0iLCJhcHAiLCJfYXhpcyIsIl9lbmFibGVkIiwiX2RyYWdTY2FsZSIsIl9kcmFnU3RhcnRNb3VzZVBvc2l0aW9uIiwiX2RyYWdTdGFydEhhbmRsZVBvc2l0aW9uIiwiX2RlbHRhTW91c2VQb3NpdGlvbiIsIl9kZWx0YUhhbmRsZVBvc2l0aW9uIiwiX2lzRHJhZ2dpbmciLCJfdG9nZ2xlTGlmZWN5Y2xlTGlzdGVuZXJzIiwib25Pck9mZiIsIl9vbk1vdXNlRG93bk9yVG91Y2hTdGFydCIsIl90b2dnbGVEcmFnTGlzdGVuZXJzIiwiaXNPbiIsIl9oYXNEcmFnTGlzdGVuZXJzIiwiX2hhbmRsZU1vdXNlVXBPclRvdWNoRW5kIiwiX29uTW91c2VVcE9yVG91Y2hFbmQiLCJiaW5kIiwibW91c2UiLCJfb25Nb3ZlIiwicGxhdGZvcm0iLCJ0b3VjaCIsImV2ZW50IiwiZW5hYmxlZCIsIl9kcmFnQ2FtZXJhIiwiY2FtZXJhIiwiX2NhbGN1bGF0ZURyYWdTY2FsZSIsImN1cnJlbnRNb3VzZVBvc2l0aW9uIiwiX3NjcmVlblRvTG9jYWwiLCJjb3B5IiwiZW50aXR5IiwiZ2V0TG9jYWxQb3NpdGlvbiIsImZpcmUiLCJfZGV0ZXJtaW5lSW5wdXRQb3NpdGlvbiIsIl9jaG9vc2VSYXlPcmlnaW5BbmREaXJlY3Rpb24iLCJwb2ludCIsIm5vcm1hbCIsImZvcndhcmQiLCJtdWxTY2FsYXIiLCJkZW5vbWluYXRvciIsImRvdCIsImRpcmVjdGlvbiIsIk1hdGgiLCJhYnMiLCJyYXlPcmlnaW5Ub1BsYW5lT3JpZ2luIiwic3ViIiwib3JpZ2luIiwiY29sbGlzaW9uRGlzdGFuY2UiLCJwb3NpdGlvbiIsImFkZCIsImdldFJvdGF0aW9uIiwiaW52ZXJ0IiwidHJhbnNmb3JtVmVjdG9yIiwibXVsIiwiZGV2aWNlUGl4ZWxSYXRpbyIsImdyYXBoaWNzRGV2aWNlIiwibWF4UGl4ZWxSYXRpbyIsImNoYW5nZWRUb3VjaGVzIiwiY29uc29sZSIsIndhcm4iLCJzY3JlZW4iLCJzY3JlZW5TcGFjZSIsInNldCIsIkZPUldBUkQiLCJzY3JlZW5Ub1dvcmxkIiwiZ2V0UG9zaXRpb24iLCJub3JtYWxpemUiLCJjdXJyZW50IiwicGFyZW50IiwiaXNXaXRoaW4yRFNjcmVlbiIsInNjcmVlblNjYWxlIiwic2NhbGUiLCJkcmFnU2NhbGUiLCJnZXRMb2NhbFNjYWxlIiwieiIsImRlbHRhTW91c2VQb3NpdGlvbiIsImRlbHRhSGFuZGxlUG9zaXRpb24iLCJzdWIyIiwiYWRkMiIsImN1cnJlbnRQb3NpdGlvbiIsImNvbnN0cmFpbmVkQXhpcyIsInNldExvY2FsUG9zaXRpb24iLCJkZXN0cm95IiwidmFsdWUiLCJpc0RyYWdnaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQWFBLE1BQU1BLG9CQUFvQixHQUFHLElBQUlDLElBQUosRUFBN0IsQ0FBQTs7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRyxJQUFJQyxJQUFKLEVBQTVCLENBQUE7O0FBQ0EsTUFBTUMsSUFBSSxHQUFHLElBQUlDLEdBQUosRUFBYixDQUFBOztBQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxLQUFKLEVBQWYsQ0FBQTs7QUFDQSxNQUFNQyxlQUFlLEdBQUcsSUFBSUMsSUFBSixFQUF4QixDQUFBOztBQUVBLE1BQU1DLGFBQWEsR0FBRztBQUNsQkMsRUFBQUEsQ0FBQyxFQUFFLEdBRGU7QUFFbEJDLEVBQUFBLENBQUMsRUFBRSxHQUFBO0FBRmUsQ0FBdEIsQ0FBQTs7QUFVQSxNQUFNQyxpQkFBTixTQUFnQ0MsWUFBaEMsQ0FBNkM7QUFPekNDLEVBQUFBLFdBQVcsQ0FBQ0MsT0FBRCxFQUFVQyxJQUFWLEVBQWdCO0FBQ3ZCLElBQUEsS0FBQSxFQUFBLENBQUE7O0lBRUEsSUFBSSxDQUFDRCxPQUFELElBQVksRUFBRUEsT0FBTyxZQUFZRSxnQkFBckIsQ0FBaEIsRUFBd0Q7QUFDcEQsTUFBQSxNQUFNLElBQUlDLEtBQUosQ0FBVSw2Q0FBVixDQUFOLENBQUE7QUFDSCxLQUFBOztJQUVELElBQUlGLElBQUksSUFBSUEsSUFBSSxLQUFLLEdBQWpCLElBQXdCQSxJQUFJLEtBQUssR0FBckMsRUFBMEM7QUFDdEMsTUFBQSxNQUFNLElBQUlFLEtBQUosQ0FBVSxxQkFBQSxHQUF3QkYsSUFBbEMsQ0FBTixDQUFBO0FB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
