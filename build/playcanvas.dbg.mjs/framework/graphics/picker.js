/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Color } from '../../core/math/color.js';
import { PIXELFORMAT_RGBA8, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE, CLEARFLAG_DEPTH } from '../../platform/graphics/constants.js';
import { GraphicsDevice } from '../../platform/graphics/graphics-device.js';
import { RenderTarget } from '../../platform/graphics/render-target.js';
import { Texture } from '../../platform/graphics/texture.js';
import { DebugGraphics } from '../../platform/graphics/debug-graphics.js';
import { SHADER_PICK, SORTMODE_NONE } from '../../scene/constants.js';
import { Camera } from '../../scene/camera.js';
import { Command } from '../../scene/mesh-instance.js';
import { Layer } from '../../scene/layer.js';
import { LayerComposition } from '../../scene/composition/layer-composition.js';
import { getApplication } from '../globals.js';
import { Entity } from '../entity.js';
import { Debug } from '../../core/debug.js';

const tempSet = new Set();
const clearDepthOptions = {
  depth: 1.0,
  flags: CLEARFLAG_DEPTH
};

/**
 * Picker object used to select mesh instances from screen coordinates.
 *
 * @property {number} width Width of the pick buffer in pixels (read-only).
 * @property {number} height Height of the pick buffer in pixels (read-only).
 * @property {RenderTarget} renderTarget The render target used by the picker internally
 * (read-only).
 */
class Picker {
  /**
   * Create a new Picker instance.
   *
   * @param {import('../app-base.js').AppBase} app - The application managing this picker
   * instance.
   * @param {number} width - The width of the pick buffer in pixels.
   * @param {number} height - The height of the pick buffer in pixels.
   */
  constructor(app, width, height) {
    if (app instanceof GraphicsDevice) {
      app = getApplication();
      Debug.deprecated('pc.Picker now takes pc.AppBase as first argument. Passing pc.GraphicsDevice is deprecated.');
    }
    this.app = app;
    this.device = app.graphicsDevice;

    // uniform for the mesh index encoded into rgba
    this.pickColor = new Float32Array(4);
    this.pickColor[3] = 1;

    // mapping table from ids to meshInstances
    this.mapping = [];

    // create layer composition with the layer and camera
    this.cameraEntity = null;
    this.layer = null;
    this.layerComp = null;
    this.initLayerComposition();

    // internal render target
    this._renderTarget = null;

    // clear command user to simulate layer clearing, required due to storing meshes from multiple layers on a singe layer
    const device = this.device;
    this.clearDepthCommand = new Command(0, 0, function () {
      device.clear(clearDepthOptions);
    });
    this.width = 0;
    this.height = 0;
    this.resize(width, height);
  }

  /**
   * Return the list of mesh instances selected by the specified rectangle in the previously
   * prepared pick buffer.The rectangle using top-left coordinate system.
   *
   * @param {number} x - The left edge of the rectangle.
   * @param {number} y - The top edge of the rectangle.
   * @param {number} [width] - The width of the rectangle.
   * @param {number} [height] - The height of the rectangle.
   * @returns {import('../../scene/mesh-instance.js').MeshInstance[]} An array of mesh instances
   * that are in the selection.
   * @example
   * // Get the selection at the point (10,20)
   * var selection = picker.getSelection(10, 20);
   * @example
   * // Get all models in rectangle with corners at (10,20) and (20,40)
   * var selection = picker.getSelection(10, 20, 10, 20);
   */
  getSelection(x, y, width, height) {
    const device = this.device;
    if (typeof x === 'object') {
      Debug.deprecated('Picker.getSelection:param \'rect\' is deprecated, use \'x, y, width, height\' instead.');
      const rect = x;
      x = rect.x;
      y = rect.y;
      width = rect.width;
      height = rect.height;
    } else {
      y = this.renderTarget.height - (y + (height || 1));
    }

    // make sure we have nice numbers to work with
    x = Math.floor(x);
    y = Math.floor(y);
    width = Math.floor(Math.max(width || 1, 1));
    height = Math.floor(Math.max(height || 1, 1));

    // backup active render target
    const origRenderTarget = device.renderTarget;
    DebugGraphics.pushGpuMarker(device, 'PICKER');

    // Ready the device for rendering to the pick buffer
    device.setRenderTarget(this.renderTarget);
    device.updateBegin();
    const pixels = new Uint8Array(4 * width * height);
    device.readPixels(x, y, width, height, pixels);
    device.updateEnd();

    // Restore render target
    device.setRenderTarget(origRenderTarget);
    DebugGraphics.popGpuMarker(device);
    const mapping = this.mapping;
    for (let i = 0; i < width * height; i++) {
      const r = pixels[4 * i + 0];
      const g = pixels[4 * i + 1];
      const b = pixels[4 * i + 2];
      const index = r << 16 | g << 8 | b;

      // White is 'no selection'
      if (index !== 0xffffff) {
        tempSet.add(mapping[index]);
      }
    }

    // return the content of the set as an array
    const selection = [];
    tempSet.forEach(meshInstance => selection.push(meshInstance));
    tempSet.clear();
    return selection;
  }
  allocateRenderTarget() {
    const colorBuffer = new Texture(this.device, {
      format: PIXELFORMAT_RGBA8,
      width: this.width,
      height: this.height,
      mipmaps: false,
      minFilter: FILTER_NEAREST,
      magFilter: FILTER_NEAREST,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      name: 'pick'
    });
    this.renderTarget = new RenderTarget({
      colorBuffer: colorBuffer,
      depth: true
    });
  }
  releaseRenderTarget() {
    // unset it from the camera
    this.cameraEntity.camera.renderTarget = null;
    if (this._renderTarget) {
      this._renderTarget.destroyTextureBuffers();
      this._renderTarget.destroy();
      this._renderTarget = null;
    }
  }
  initLayerComposition() {
    const device = this.device;
    const self = this;
    const pickColorId = device.scope.resolve('uColor');

    // camera
    this.cameraEntity = new Entity();
    this.cameraEntity.addComponent('camera');

    // layer all meshes rendered for picking at added to
    this.layer = new Layer({
      name: 'Picker',
      shaderPass: SHADER_PICK,
      opaqueSortMode: SORTMODE_NONE,
      // executes just before the mesh is rendered. And index encoded in rgb is assigned to it
      onDrawCall: function (meshInstance, index) {
        self.pickColor[0] = (index >> 16 & 0xff) / 255;
        self.pickColor[1] = (index >> 8 & 0xff) / 255;
        self.pickColor[2] = (index & 0xff) / 255;
        pickColorId.setValue(self.pickColor);
        device.setBlending(false);

        // keep the index -> meshInstance index mapping
        self.mapping[index] = meshInstance;
      }
    });
    this.layer.addCamera(this.cameraEntity.camera);

    // composition
    this.layerComp = new LayerComposition('picker');
    this.layerComp.pushOpaque(this.layer);
  }

  /**
   * Primes the pick buffer with a rendering of the specified models from the point of view of
   * the supplied camera. Once the pick buffer has been prepared, {@link Picker#getSelection} can
   * be called multiple times on the same picker object. Therefore, if the models or camera do
   * not change in any way, {@link Picker#prepare} does not need to be called again.
   *
   * @param {import('../components/camera/component.js').CameraComponent} camera - The camera
   * component used to render the scene.
   * @param {import('../../scene/scene.js').Scene} scene - The scene containing the pickable mesh
   * instances.
   * @param {Layer[]} [layers] - Layers from which objects will be picked. If not supplied, all layers of the specified camera will be used.
   */
  prepare(camera, scene, layers) {
    // handle deprecated arguments
    if (camera instanceof Camera) {
      Debug.deprecated('pc.Picker#prepare now takes pc.CameraComponent as first argument. Passing pc.Camera is deprecated.');

      // Get the camera component
      camera = camera.node.camera;
    }
    if (layers instanceof Layer) {
      layers = [layers];
    }

    // populate the layer with meshes and depth clear commands
    this.layer.clearMeshInstances();
    const destMeshInstances = this.layer.opaqueMeshInstances;

    // source mesh instances
    const srcLayers = scene.layers.layerList;
    const subLayerEnabled = scene.layers.subLayerEnabled;
    const isTransparent = scene.layers.subLayerList;
    for (let i = 0; i < srcLayers.length; i++) {
      const srcLayer = srcLayers[i];

      // skip the layer if it does not match the provided ones
      if (layers && layers.indexOf(srcLayer) < 0) {
        continue;
      }
      if (srcLayer.enabled && subLayerEnabled[i]) {
        // if the layer is rendered by the camera
        const layerCamId = srcLayer.cameras.indexOf(camera);
        if (layerCamId >= 0) {
          // if the layer clears the depth, add command to clear it
          if (srcLayer._clearDepthBuffer) {
            destMeshInstances.push(this.clearDepthCommand);
          }

          // copy all pickable mesh instances
          const meshInstances = isTransparent[i] ? srcLayer.instances.transparentMeshInstances : srcLayer.instances.opaqueMeshInstances;
          for (let j = 0; j < meshInstances.length; j++) {
            const meshInstance = meshInstances[j];
            if (meshInstance.pick) {
              destMeshInstances.push(meshInstance);
            }
          }
        }
      }
    }

    // make the render target the right size
    if (!this.renderTarget || this.width !== this.renderTarget.width || this.height !== this.renderTarget.height) {
      this.releaseRenderTarget();
      this.allocateRenderTarget();
    }

    // prepare the rendering camera
    this.updateCamera(camera);

    // clear registered meshes mapping
    this.mapping.length = 0;

    // render
    this.app.renderComposition(this.layerComp);
  }
  updateCamera(srcCamera) {
    // copy transform
    this.cameraEntity.copy(srcCamera.entity);
    this.cameraEntity.name = 'PickerCamera';

    // copy camera component properties - which overwrites few properties we change to what is needed later
    const destCamera = this.cameraEntity.camera;
    destCamera.copy(srcCamera);

    // set up clears
    destCamera.clearColorBuffer = true;
    destCamera.clearDepthBuffer = true;
    destCamera.clearStencilBuffer = true;
    destCamera.clearColor = Color.WHITE;

    // render target
    destCamera.renderTarget = this.renderTarget;

    // layers
    this.layer.clearCameras();
    this.layer.addCamera(destCamera);
    destCamera.layers = [this.layer.id];
  }

  /**
   * Sets the resolution of the pick buffer. The pick buffer resolution does not need to match
   * the resolution of the corresponding frame buffer use for general rendering of the 3D scene.
   * However, the lower the resolution of the pick buffer, the less accurate the selection
   * results returned by {@link Picker#getSelection}. On the other hand, smaller pick buffers
   * will yield greater performance, so there is a trade off.
   *
   * @param {number} width - The width of the pick buffer in pixels.
   * @param {number} height - The height of the pick buffer in pixels.
   */
  resize(width, height) {
    this.width = Math.floor(width);
    this.height = Math.floor(height);
  }
}

export { Picker };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja2VyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2dyYXBoaWNzL3BpY2tlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9jb2xvci5qcyc7XG5cbmltcG9ydCB7IEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgQ0xFQVJGTEFHX0RFUFRILCBGSUxURVJfTkVBUkVTVCwgUElYRUxGT1JNQVRfUkdCQTggfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgR3JhcGhpY3NEZXZpY2UgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9ncmFwaGljcy1kZXZpY2UuanMnO1xuaW1wb3J0IHsgUmVuZGVyVGFyZ2V0IH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qcyc7XG5pbXBvcnQgeyBUZXh0dXJlIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvdGV4dHVyZS5qcyc7XG5pbXBvcnQgeyBEZWJ1Z0dyYXBoaWNzIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZGVidWctZ3JhcGhpY3MuanMnO1xuXG5pbXBvcnQgeyBTSEFERVJfUElDSywgU09SVE1PREVfTk9ORSB9IGZyb20gJy4uLy4uL3NjZW5lL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBDYW1lcmEgfSBmcm9tICcuLi8uLi9zY2VuZS9jYW1lcmEuanMnO1xuaW1wb3J0IHsgQ29tbWFuZCB9IGZyb20gJy4uLy4uL3NjZW5lL21lc2gtaW5zdGFuY2UuanMnO1xuaW1wb3J0IHsgTGF5ZXIgfSBmcm9tICcuLi8uLi9zY2VuZS9sYXllci5qcyc7XG5pbXBvcnQgeyBMYXllckNvbXBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vc2NlbmUvY29tcG9zaXRpb24vbGF5ZXItY29tcG9zaXRpb24uanMnO1xuXG5pbXBvcnQgeyBnZXRBcHBsaWNhdGlvbiB9IGZyb20gJy4uL2dsb2JhbHMuanMnO1xuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi4vZW50aXR5LmpzJztcbmltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5cbmNvbnN0IHRlbXBTZXQgPSBuZXcgU2V0KCk7XG5cbmNvbnN0IGNsZWFyRGVwdGhPcHRpb25zID0ge1xuICAgIGRlcHRoOiAxLjAsXG4gICAgZmxhZ3M6IENMRUFSRkxBR19ERVBUSFxufTtcblxuLyoqXG4gKiBQaWNrZXIgb2JqZWN0IHVzZWQgdG8gc2VsZWN0IG1lc2ggaW5zdGFuY2VzIGZyb20gc2NyZWVuIGNvb3JkaW5hdGVzLlxuICpcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCBXaWR0aCBvZiB0aGUgcGljayBidWZmZXIgaW4gcGl4ZWxzIChyZWFkLW9ubHkpLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCBIZWlnaHQgb2YgdGhlIHBpY2sgYnVmZmVyIGluIHBpeGVscyAocmVhZC1vbmx5KS5cbiAqIEBwcm9wZXJ0eSB7UmVuZGVyVGFyZ2V0fSByZW5kZXJUYXJnZXQgVGhlIHJlbmRlciB0YXJnZXQgdXNlZCBieSB0aGUgcGlja2VyIGludGVybmFsbHlcbiAqIChyZWFkLW9ubHkpLlxuICovXG5jbGFzcyBQaWNrZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBQaWNrZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgYXBwbGljYXRpb24gbWFuYWdpbmcgdGhpcyBwaWNrZXJcbiAgICAgKiBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHBpY2sgYnVmZmVyIGluIHBpeGVscy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgcGljayBidWZmZXIgaW4gcGl4ZWxzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICBpZiAoYXBwIGluc3RhbmNlb2YgR3JhcGhpY3NEZXZpY2UpIHtcbiAgICAgICAgICAgIGFwcCA9IGdldEFwcGxpY2F0aW9uKCk7XG4gICAgICAgICAgICBEZWJ1Zy5kZXByZWNhdGVkKCdwYy5QaWNrZXIgbm93IHRha2VzIHBjLkFwcEJhc2UgYXMgZmlyc3QgYXJndW1lbnQuIFBhc3NpbmcgcGMuR3JhcGhpY3NEZXZpY2UgaXMgZGVwcmVjYXRlZC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLmRldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcblxuICAgICAgICAvLyB1bmlmb3JtIGZvciB0aGUgbWVzaCBpbmRleCBlbmNvZGVkIGludG8gcmdiYVxuICAgICAgICB0aGlzLnBpY2tDb2xvciA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7XG4gICAgICAgIHRoaXMucGlja0NvbG9yWzNdID0gMTtcblxuICAgICAgICAvLyBtYXBwaW5nIHRhYmxlIGZyb20gaWRzIHRvIG1lc2hJbnN0YW5jZXNcbiAgICAgICAgdGhpcy5tYXBwaW5nID0gW107XG5cbiAgICAgICAgLy8gY3JlYXRlIGxheWVyIGNvbXBvc2l0aW9uIHdpdGggdGhlIGxheWVyIGFuZCBjYW1lcmFcbiAgICAgICAgdGhpcy5jYW1lcmFFbnRpdHkgPSBudWxsO1xuICAgICAgICB0aGlzLmxheWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXllckNvbXAgPSBudWxsO1xuICAgICAgICB0aGlzLmluaXRMYXllckNvbXBvc2l0aW9uKCk7XG5cbiAgICAgICAgLy8gaW50ZXJuYWwgcmVuZGVyIHRhcmdldFxuICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXQgPSBudWxsO1xuXG4gICAgICAgIC8vIGNsZWFyIGNvbW1hbmQgdXNlciB0byBzaW11bGF0ZSBsYXllciBjbGVhcmluZywgcmVxdWlyZWQgZHVlIHRvIHN0b3JpbmcgbWVzaGVzIGZyb20gbXVsdGlwbGUgbGF5ZXJzIG9uIGEgc2luZ2UgbGF5ZXJcbiAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpcy5kZXZpY2U7XG4gICAgICAgIHRoaXMuY2xlYXJEZXB0aENvbW1hbmQgPSBuZXcgQ29tbWFuZCgwLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkZXZpY2UuY2xlYXIoY2xlYXJEZXB0aE9wdGlvbnMpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLndpZHRoID0gMDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2YgbWVzaCBpbnN0YW5jZXMgc2VsZWN0ZWQgYnkgdGhlIHNwZWNpZmllZCByZWN0YW5nbGUgaW4gdGhlIHByZXZpb3VzbHlcbiAgICAgKiBwcmVwYXJlZCBwaWNrIGJ1ZmZlci5UaGUgcmVjdGFuZ2xlIHVzaW5nIHRvcC1sZWZ0IGNvb3JkaW5hdGUgc3lzdGVtLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgbGVmdCBlZGdlIG9mIHRoZSByZWN0YW5nbGUuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdG9wIGVkZ2Ugb2YgdGhlIHJlY3RhbmdsZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoXSAtIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0XSAtIFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZS5cbiAgICAgKiBAcmV0dXJucyB7aW1wb3J0KCcuLi8uLi9zY2VuZS9tZXNoLWluc3RhbmNlLmpzJykuTWVzaEluc3RhbmNlW119IEFuIGFycmF5IG9mIG1lc2ggaW5zdGFuY2VzXG4gICAgICogdGhhdCBhcmUgaW4gdGhlIHNlbGVjdGlvbi5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIEdldCB0aGUgc2VsZWN0aW9uIGF0IHRoZSBwb2ludCAoMTAsMjApXG4gICAgICogdmFyIHNlbGVjdGlvbiA9IHBpY2tlci5nZXRTZWxlY3Rpb24oMTAsIDIwKTtcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIEdldCBhbGwgbW9kZWxzIGluIHJlY3RhbmdsZSB3aXRoIGNvcm5lcnMgYXQgKDEwLDIwKSBhbmQgKDIwLDQwKVxuICAgICAqIHZhciBzZWxlY3Rpb24gPSBwaWNrZXIuZ2V0U2VsZWN0aW9uKDEwLCAyMCwgMTAsIDIwKTtcbiAgICAgKi9cbiAgICBnZXRTZWxlY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcblxuICAgICAgICBpZiAodHlwZW9mIHggPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBEZWJ1Zy5kZXByZWNhdGVkKCdQaWNrZXIuZ2V0U2VsZWN0aW9uOnBhcmFtIFxcJ3JlY3RcXCcgaXMgZGVwcmVjYXRlZCwgdXNlIFxcJ3gsIHksIHdpZHRoLCBoZWlnaHRcXCcgaW5zdGVhZC4nKTtcblxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IHg7XG4gICAgICAgICAgICB4ID0gcmVjdC54O1xuICAgICAgICAgICAgeSA9IHJlY3QueTtcbiAgICAgICAgICAgIHdpZHRoID0gcmVjdC53aWR0aDtcbiAgICAgICAgICAgIGhlaWdodCA9IHJlY3QuaGVpZ2h0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeSA9IHRoaXMucmVuZGVyVGFyZ2V0LmhlaWdodCAtICh5ICsgKGhlaWdodCB8fCAxKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSBuaWNlIG51bWJlcnMgdG8gd29yayB3aXRoXG4gICAgICAgIHggPSBNYXRoLmZsb29yKHgpO1xuICAgICAgICB5ID0gTWF0aC5mbG9vcih5KTtcbiAgICAgICAgd2lkdGggPSBNYXRoLmZsb29yKE1hdGgubWF4KHdpZHRoIHx8IDEsIDEpKTtcbiAgICAgICAgaGVpZ2h0ID0gTWF0aC5mbG9vcihNYXRoLm1heChoZWlnaHQgfHwgMSwgMSkpO1xuXG4gICAgICAgIC8vIGJhY2t1cCBhY3RpdmUgcmVuZGVyIHRhcmdldFxuICAgICAgICBjb25zdCBvcmlnUmVuZGVyVGFyZ2V0ID0gZGV2aWNlLnJlbmRlclRhcmdldDtcblxuICAgICAgICBEZWJ1Z0dyYXBoaWNzLnB1c2hHcHVNYXJrZXIoZGV2aWNlLCAnUElDS0VSJyk7XG5cbiAgICAgICAgLy8gUmVhZHkgdGhlIGRldmljZSBmb3IgcmVuZGVyaW5nIHRvIHRoZSBwaWNrIGJ1ZmZlclxuICAgICAgICBkZXZpY2Uuc2V0UmVuZGVyVGFyZ2V0KHRoaXMucmVuZGVyVGFyZ2V0KTtcbiAgICAgICAgZGV2aWNlLnVwZGF0ZUJlZ2luKCk7XG5cbiAgICAgICAgY29uc3QgcGl4ZWxzID0gbmV3IFVpbnQ4QXJyYXkoNCAqIHdpZHRoICogaGVpZ2h0KTtcbiAgICAgICAgZGV2aWNlLnJlYWRQaXhlbHMoeCwgeSwgd2lkdGgsIGhlaWdodCwgcGl4ZWxzKTtcblxuICAgICAgICBkZXZpY2UudXBkYXRlRW5kKCk7XG5cbiAgICAgICAgLy8gUmVzdG9yZSByZW5kZXIgdGFyZ2V0XG4gICAgICAgIGRldmljZS5zZXRSZW5kZXJUYXJnZXQob3JpZ1JlbmRlclRhcmdldCk7XG5cbiAgICAgICAgRGVidWdHcmFwaGljcy5wb3BHcHVNYXJrZXIoZGV2aWNlKTtcblxuICAgICAgICBjb25zdCBtYXBwaW5nID0gdGhpcy5tYXBwaW5nO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdpZHRoICogaGVpZ2h0OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBwaXhlbHNbNCAqIGkgKyAwXTtcbiAgICAgICAgICAgIGNvbnN0IGcgPSBwaXhlbHNbNCAqIGkgKyAxXTtcbiAgICAgICAgICAgIGNvbnN0IGIgPSBwaXhlbHNbNCAqIGkgKyAyXTtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gciA8PCAxNiB8IGcgPDwgOCB8IGI7XG5cbiAgICAgICAgICAgIC8vIFdoaXRlIGlzICdubyBzZWxlY3Rpb24nXG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IDB4ZmZmZmZmKSB7XG4gICAgICAgICAgICAgICAgdGVtcFNldC5hZGQobWFwcGluZ1tpbmRleF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmV0dXJuIHRoZSBjb250ZW50IG9mIHRoZSBzZXQgYXMgYW4gYXJyYXlcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gW107XG4gICAgICAgIHRlbXBTZXQuZm9yRWFjaChtZXNoSW5zdGFuY2UgPT4gc2VsZWN0aW9uLnB1c2gobWVzaEluc3RhbmNlKSk7XG4gICAgICAgIHRlbXBTZXQuY2xlYXIoKTtcblxuICAgICAgICByZXR1cm4gc2VsZWN0aW9uO1xuICAgIH1cblxuICAgIGFsbG9jYXRlUmVuZGVyVGFyZ2V0KCkge1xuXG4gICAgICAgIGNvbnN0IGNvbG9yQnVmZmVyID0gbmV3IFRleHR1cmUodGhpcy5kZXZpY2UsIHtcbiAgICAgICAgICAgIGZvcm1hdDogUElYRUxGT1JNQVRfUkdCQTgsXG4gICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICAgICAgICBtaXBtYXBzOiBmYWxzZSxcbiAgICAgICAgICAgIG1pbkZpbHRlcjogRklMVEVSX05FQVJFU1QsXG4gICAgICAgICAgICBtYWdGaWx0ZXI6IEZJTFRFUl9ORUFSRVNULFxuICAgICAgICAgICAgYWRkcmVzc1U6IEFERFJFU1NfQ0xBTVBfVE9fRURHRSxcbiAgICAgICAgICAgIGFkZHJlc3NWOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBuYW1lOiAncGljaydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yZW5kZXJUYXJnZXQgPSBuZXcgUmVuZGVyVGFyZ2V0KHtcbiAgICAgICAgICAgIGNvbG9yQnVmZmVyOiBjb2xvckJ1ZmZlcixcbiAgICAgICAgICAgIGRlcHRoOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlbGVhc2VSZW5kZXJUYXJnZXQoKSB7XG5cbiAgICAgICAgLy8gdW5zZXQgaXQgZnJvbSB0aGUgY2FtZXJhXG4gICAgICAgIHRoaXMuY2FtZXJhRW50aXR5LmNhbWVyYS5yZW5kZXJUYXJnZXQgPSBudWxsO1xuXG4gICAgICAgIGlmICh0aGlzLl9yZW5kZXJUYXJnZXQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRhcmdldC5kZXN0cm95VGV4dHVyZUJ1ZmZlcnMoKTtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRhcmdldC5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdExheWVyQ29tcG9zaXRpb24oKSB7XG5cbiAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpcy5kZXZpY2U7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBjb25zdCBwaWNrQ29sb3JJZCA9IGRldmljZS5zY29wZS5yZXNvbHZlKCd1Q29sb3InKTtcblxuICAgICAgICAvLyBjYW1lcmFcbiAgICAgICAgdGhpcy5jYW1lcmFFbnRpdHkgPSBuZXcgRW50aXR5KCk7XG4gICAgICAgIHRoaXMuY2FtZXJhRW50aXR5LmFkZENvbXBvbmVudCgnY2FtZXJhJyk7XG5cbiAgICAgICAgLy8gbGF5ZXIgYWxsIG1lc2hlcyByZW5kZXJlZCBmb3IgcGlja2luZyBhdCBhZGRlZCB0b1xuICAgICAgICB0aGlzLmxheWVyID0gbmV3IExheWVyKHtcbiAgICAgICAgICAgIG5hbWU6ICdQaWNrZXInLFxuICAgICAgICAgICAgc2hhZGVyUGFzczogU0hBREVSX1BJQ0ssXG4gICAgICAgICAgICBvcGFxdWVTb3J0TW9kZTogU09SVE1PREVfTk9ORSxcblxuICAgICAgICAgICAgLy8gZXhlY3V0ZXMganVzdCBiZWZvcmUgdGhlIG1lc2ggaXMgcmVuZGVyZWQuIEFuZCBpbmRleCBlbmNvZGVkIGluIHJnYiBpcyBhc3NpZ25lZCB0byBpdFxuICAgICAgICAgICAgb25EcmF3Q2FsbDogZnVuY3Rpb24gKG1lc2hJbnN0YW5jZSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnBpY2tDb2xvclswXSA9ICgoaW5kZXggPj4gMTYpICYgMHhmZikgLyAyNTU7XG4gICAgICAgICAgICAgICAgc2VsZi5waWNrQ29sb3JbMV0gPSAoKGluZGV4ID4+IDgpICYgMHhmZikgLyAyNTU7XG4gICAgICAgICAgICAgICAgc2VsZi5waWNrQ29sb3JbMl0gPSAoaW5kZXggJiAweGZmKSAvIDI1NTtcbiAgICAgICAgICAgICAgICBwaWNrQ29sb3JJZC5zZXRWYWx1ZShzZWxmLnBpY2tDb2xvcik7XG4gICAgICAgICAgICAgICAgZGV2aWNlLnNldEJsZW5kaW5nKGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIC8vIGtlZXAgdGhlIGluZGV4IC0+IG1lc2hJbnN0YW5jZSBpbmRleCBtYXBwaW5nXG4gICAgICAgICAgICAgICAgc2VsZi5tYXBwaW5nW2luZGV4XSA9IG1lc2hJbnN0YW5jZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGF5ZXIuYWRkQ2FtZXJhKHRoaXMuY2FtZXJhRW50aXR5LmNhbWVyYSk7XG5cbiAgICAgICAgLy8gY29tcG9zaXRpb25cbiAgICAgICAgdGhpcy5sYXllckNvbXAgPSBuZXcgTGF5ZXJDb21wb3NpdGlvbigncGlja2VyJyk7XG4gICAgICAgIHRoaXMubGF5ZXJDb21wLnB1c2hPcGFxdWUodGhpcy5sYXllcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJpbWVzIHRoZSBwaWNrIGJ1ZmZlciB3aXRoIGEgcmVuZGVyaW5nIG9mIHRoZSBzcGVjaWZpZWQgbW9kZWxzIGZyb20gdGhlIHBvaW50IG9mIHZpZXcgb2ZcbiAgICAgKiB0aGUgc3VwcGxpZWQgY2FtZXJhLiBPbmNlIHRoZSBwaWNrIGJ1ZmZlciBoYXMgYmVlbiBwcmVwYXJlZCwge0BsaW5rIFBpY2tlciNnZXRTZWxlY3Rpb259IGNhblxuICAgICAqIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBvbiB0aGUgc2FtZSBwaWNrZXIgb2JqZWN0LiBUaGVyZWZvcmUsIGlmIHRoZSBtb2RlbHMgb3IgY2FtZXJhIGRvXG4gICAgICogbm90IGNoYW5nZSBpbiBhbnkgd2F5LCB7QGxpbmsgUGlja2VyI3ByZXBhcmV9IGRvZXMgbm90IG5lZWQgdG8gYmUgY2FsbGVkIGFnYWluLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2NvbXBvbmVudHMvY2FtZXJhL2NvbXBvbmVudC5qcycpLkNhbWVyYUNvbXBvbmVudH0gY2FtZXJhIC0gVGhlIGNhbWVyYVxuICAgICAqIGNvbXBvbmVudCB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uLy4uL3NjZW5lL3NjZW5lLmpzJykuU2NlbmV9IHNjZW5lIC0gVGhlIHNjZW5lIGNvbnRhaW5pbmcgdGhlIHBpY2thYmxlIG1lc2hcbiAgICAgKiBpbnN0YW5jZXMuXG4gICAgICogQHBhcmFtIHtMYXllcltdfSBbbGF5ZXJzXSAtIExheWVycyBmcm9tIHdoaWNoIG9iamVjdHMgd2lsbCBiZSBwaWNrZWQuIElmIG5vdCBzdXBwbGllZCwgYWxsIGxheWVycyBvZiB0aGUgc3BlY2lmaWVkIGNhbWVyYSB3aWxsIGJlIHVzZWQuXG4gICAgICovXG4gICAgcHJlcGFyZShjYW1lcmEsIHNjZW5lLCBsYXllcnMpIHtcblxuICAgICAgICAvLyBoYW5kbGUgZGVwcmVjYXRlZCBhcmd1bWVudHNcbiAgICAgICAgaWYgKGNhbWVyYSBpbnN0YW5jZW9mIENhbWVyYSkge1xuICAgICAgICAgICAgRGVidWcuZGVwcmVjYXRlZCgncGMuUGlja2VyI3ByZXBhcmUgbm93IHRha2VzIHBjLkNhbWVyYUNvbXBvbmVudCBhcyBmaXJzdCBhcmd1bWVudC4gUGFzc2luZyBwYy5DYW1lcmEgaXMgZGVwcmVjYXRlZC4nKTtcblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBjYW1lcmEgY29tcG9uZW50XG4gICAgICAgICAgICBjYW1lcmEgPSBjYW1lcmEubm9kZS5jYW1lcmE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGF5ZXJzIGluc3RhbmNlb2YgTGF5ZXIpIHtcbiAgICAgICAgICAgIGxheWVycyA9IFtsYXllcnNdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcG9wdWxhdGUgdGhlIGxheWVyIHdpdGggbWVzaGVzIGFuZCBkZXB0aCBjbGVhciBjb21tYW5kc1xuICAgICAgICB0aGlzLmxheWVyLmNsZWFyTWVzaEluc3RhbmNlcygpO1xuICAgICAgICBjb25zdCBkZXN0TWVzaEluc3RhbmNlcyA9IHRoaXMubGF5ZXIub3BhcXVlTWVzaEluc3RhbmNlcztcblxuICAgICAgICAvLyBzb3VyY2UgbWVzaCBpbnN0YW5jZXNcbiAgICAgICAgY29uc3Qgc3JjTGF5ZXJzID0gc2NlbmUubGF5ZXJzLmxheWVyTGlzdDtcbiAgICAgICAgY29uc3Qgc3ViTGF5ZXJFbmFibGVkID0gc2NlbmUubGF5ZXJzLnN1YkxheWVyRW5hYmxlZDtcbiAgICAgICAgY29uc3QgaXNUcmFuc3BhcmVudCA9IHNjZW5lLmxheWVycy5zdWJMYXllckxpc3Q7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcmNMYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHNyY0xheWVyID0gc3JjTGF5ZXJzW2ldO1xuXG4gICAgICAgICAgICAvLyBza2lwIHRoZSBsYXllciBpZiBpdCBkb2VzIG5vdCBtYXRjaCB0aGUgcHJvdmlkZWQgb25lc1xuICAgICAgICAgICAgaWYgKGxheWVycyAmJiBsYXllcnMuaW5kZXhPZihzcmNMYXllcikgPCAwKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzcmNMYXllci5lbmFibGVkICYmIHN1YkxheWVyRW5hYmxlZFtpXSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIGxheWVyIGlzIHJlbmRlcmVkIGJ5IHRoZSBjYW1lcmFcbiAgICAgICAgICAgICAgICBjb25zdCBsYXllckNhbUlkID0gc3JjTGF5ZXIuY2FtZXJhcy5pbmRleE9mKGNhbWVyYSk7XG4gICAgICAgICAgICAgICAgaWYgKGxheWVyQ2FtSWQgPj0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBsYXllciBjbGVhcnMgdGhlIGRlcHRoLCBhZGQgY29tbWFuZCB0byBjbGVhciBpdFxuICAgICAgICAgICAgICAgICAgICBpZiAoc3JjTGF5ZXIuX2NsZWFyRGVwdGhCdWZmZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RNZXNoSW5zdGFuY2VzLnB1c2godGhpcy5jbGVhckRlcHRoQ29tbWFuZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjb3B5IGFsbCBwaWNrYWJsZSBtZXNoIGluc3RhbmNlc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2VzID0gaXNUcmFuc3BhcmVudFtpXSA/IHNyY0xheWVyLmluc3RhbmNlcy50cmFuc3BhcmVudE1lc2hJbnN0YW5jZXMgOiBzcmNMYXllci5pbnN0YW5jZXMub3BhcXVlTWVzaEluc3RhbmNlcztcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtZXNoSW5zdGFuY2VzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2UgPSBtZXNoSW5zdGFuY2VzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc2hJbnN0YW5jZS5waWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdE1lc2hJbnN0YW5jZXMucHVzaChtZXNoSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gbWFrZSB0aGUgcmVuZGVyIHRhcmdldCB0aGUgcmlnaHQgc2l6ZVxuICAgICAgICBpZiAoIXRoaXMucmVuZGVyVGFyZ2V0IHx8ICh0aGlzLndpZHRoICE9PSB0aGlzLnJlbmRlclRhcmdldC53aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gdGhpcy5yZW5kZXJUYXJnZXQuaGVpZ2h0KSkge1xuICAgICAgICAgICAgdGhpcy5yZWxlYXNlUmVuZGVyVGFyZ2V0KCk7XG4gICAgICAgICAgICB0aGlzLmFsbG9jYXRlUmVuZGVyVGFyZ2V0KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwcmVwYXJlIHRoZSByZW5kZXJpbmcgY2FtZXJhXG4gICAgICAgIHRoaXMudXBkYXRlQ2FtZXJhKGNhbWVyYSk7XG5cbiAgICAgICAgLy8gY2xlYXIgcmVnaXN0ZXJlZCBtZXNoZXMgbWFwcGluZ1xuICAgICAgICB0aGlzLm1hcHBpbmcubGVuZ3RoID0gMDtcblxuICAgICAgICAvLyByZW5kZXJcbiAgICAgICAgdGhpcy5hcHAucmVuZGVyQ29tcG9zaXRpb24odGhpcy5sYXllckNvbXApO1xuICAgIH1cblxuICAgIHVwZGF0ZUNhbWVyYShzcmNDYW1lcmEpIHtcblxuICAgICAgICAvLyBjb3B5IHRyYW5zZm9ybVxuICAgICAgICB0aGlzLmNhbWVyYUVudGl0eS5jb3B5KHNyY0NhbWVyYS5lbnRpdHkpO1xuICAgICAgICB0aGlzLmNhbWVyYUVudGl0eS5uYW1lID0gJ1BpY2tlckNhbWVyYSc7XG5cbiAgICAgICAgLy8gY29weSBjYW1lcmEgY29tcG9uZW50IHByb3BlcnRpZXMgLSB3aGljaCBvdmVyd3JpdGVzIGZldyBwcm9wZXJ0aWVzIHdlIGNoYW5nZSB0byB3aGF0IGlzIG5lZWRlZCBsYXRlclxuICAgICAgICBjb25zdCBkZXN0Q2FtZXJhID0gdGhpcy5jYW1lcmFFbnRpdHkuY2FtZXJhO1xuICAgICAgICBkZXN0Q2FtZXJhLmNvcHkoc3JjQ2FtZXJhKTtcblxuICAgICAgICAvLyBzZXQgdXAgY2xlYXJzXG4gICAgICAgIGRlc3RDYW1lcmEuY2xlYXJDb2xvckJ1ZmZlciA9IHRydWU7XG4gICAgICAgIGRlc3RDYW1lcmEuY2xlYXJEZXB0aEJ1ZmZlciA9IHRydWU7XG4gICAgICAgIGRlc3RDYW1lcmEuY2xlYXJTdGVuY2lsQnVmZmVyID0gdHJ1ZTtcbiAgICAgICAgZGVzdENhbWVyYS5jbGVhckNvbG9yID0gQ29sb3IuV0hJVEU7XG5cbiAgICAgICAgLy8gcmVuZGVyIHRhcmdldFxuICAgICAgICBkZXN0Q2FtZXJhLnJlbmRlclRhcmdldCA9IHRoaXMucmVuZGVyVGFyZ2V0O1xuXG4gICAgICAgIC8vIGxheWVyc1xuICAgICAgICB0aGlzLmxheWVyLmNsZWFyQ2FtZXJhcygpO1xuICAgICAgICB0aGlzLmxheWVyLmFkZENhbWVyYShkZXN0Q2FtZXJhKTtcbiAgICAgICAgZGVzdENhbWVyYS5sYXllcnMgPSBbdGhpcy5sYXllci5pZF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgcmVzb2x1dGlvbiBvZiB0aGUgcGljayBidWZmZXIuIFRoZSBwaWNrIGJ1ZmZlciByZXNvbHV0aW9uIGRvZXMgbm90IG5lZWQgdG8gbWF0Y2hcbiAgICAgKiB0aGUgcmVzb2x1dGlvbiBvZiB0aGUgY29ycmVzcG9uZGluZyBmcmFtZSBidWZmZXIgdXNlIGZvciBnZW5lcmFsIHJlbmRlcmluZyBvZiB0aGUgM0Qgc2NlbmUuXG4gICAgICogSG93ZXZlciwgdGhlIGxvd2VyIHRoZSByZXNvbHV0aW9uIG9mIHRoZSBwaWNrIGJ1ZmZlciwgdGhlIGxlc3MgYWNjdXJhdGUgdGhlIHNlbGVjdGlvblxuICAgICAqIHJlc3VsdHMgcmV0dXJuZWQgYnkge0BsaW5rIFBpY2tlciNnZXRTZWxlY3Rpb259LiBPbiB0aGUgb3RoZXIgaGFuZCwgc21hbGxlciBwaWNrIGJ1ZmZlcnNcbiAgICAgKiB3aWxsIHlpZWxkIGdyZWF0ZXIgcGVyZm9ybWFuY2UsIHNvIHRoZXJlIGlzIGEgdHJhZGUgb2ZmLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBwaWNrIGJ1ZmZlciBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHBpY2sgYnVmZmVyIGluIHBpeGVscy5cbiAgICAgKi9cbiAgICByZXNpemUod2lkdGgsIGhlaWdodCkge1xuICAgICAgICB0aGlzLndpZHRoID0gTWF0aC5mbG9vcih3aWR0aCk7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gTWF0aC5mbG9vcihoZWlnaHQpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgUGlja2VyIH07XG4iXSwibmFtZXMiOlsidGVtcFNldCIsIlNldCIsImNsZWFyRGVwdGhPcHRpb25zIiwiZGVwdGgiLCJmbGFncyIsIkNMRUFSRkxBR19ERVBUSCIsIlBpY2tlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwid2lkdGgiLCJoZWlnaHQiLCJHcmFwaGljc0RldmljZSIsImdldEFwcGxpY2F0aW9uIiwiRGVidWciLCJkZXByZWNhdGVkIiwiZGV2aWNlIiwiZ3JhcGhpY3NEZXZpY2UiLCJwaWNrQ29sb3IiLCJGbG9hdDMyQXJyYXkiLCJtYXBwaW5nIiwiY2FtZXJhRW50aXR5IiwibGF5ZXIiLCJsYXllckNvbXAiLCJpbml0TGF5ZXJDb21wb3NpdGlvbiIsIl9yZW5kZXJUYXJnZXQiLCJjbGVhckRlcHRoQ29tbWFuZCIsIkNvbW1hbmQiLCJjbGVhciIsInJlc2l6ZSIsImdldFNlbGVjdGlvbiIsIngiLCJ5IiwicmVjdCIsInJlbmRlclRhcmdldCIsIk1hdGgiLCJmbG9vciIsIm1heCIsIm9yaWdSZW5kZXJUYXJnZXQiLCJEZWJ1Z0dyYXBoaWNzIiwicHVzaEdwdU1hcmtlciIsInNldFJlbmRlclRhcmdldCIsInVwZGF0ZUJlZ2luIiwicGl4ZWxzIiwiVWludDhBcnJheSIsInJlYWRQaXhlbHMiLCJ1cGRhdGVFbmQiLCJwb3BHcHVNYXJrZXIiLCJpIiwiciIsImciLCJiIiwiaW5kZXgiLCJhZGQiLCJzZWxlY3Rpb24iLCJmb3JFYWNoIiwibWVzaEluc3RhbmNlIiwicHVzaCIsImFsbG9jYXRlUmVuZGVyVGFyZ2V0IiwiY29sb3JCdWZmZXIiLCJUZXh0dXJlIiwiZm9ybWF0IiwiUElYRUxGT1JNQVRfUkdCQTgiLCJtaXBtYXBzIiwibWluRmlsdGVyIiwiRklMVEVSX05FQVJFU1QiLCJtYWdGaWx0ZXIiLCJhZGRyZXNzVSIsIkFERFJFU1NfQ0xBTVBfVE9fRURHRSIsImFkZHJlc3NWIiwibmFtZSIsIlJlbmRlclRhcmdldCIsInJlbGVhc2VSZW5kZXJUYXJnZXQiLCJjYW1lcmEiLCJkZXN0cm95VGV4dHVyZUJ1ZmZlcnMiLCJkZXN0cm95Iiwic2VsZiIsInBpY2tDb2xvcklkIiwic2NvcGUiLCJyZXNvbHZlIiwiRW50aXR5IiwiYWRkQ29tcG9uZW50IiwiTGF5ZXIiLCJzaGFkZXJQYXNzIiwiU0hBREVSX1BJQ0siLCJvcGFxdWVTb3J0TW9kZSIsIlNPUlRNT0RFX05PTkUiLCJvbkRyYXdDYWxsIiwic2V0VmFsdWUiLCJzZXRCbGVuZGluZyIsImFkZENhbWVyYSIsIkxheWVyQ29tcG9zaXRpb24iLCJwdXNoT3BhcXVlIiwicHJlcGFyZSIsInNjZW5lIiwibGF5ZXJzIiwiQ2FtZXJhIiwibm9kZSIsImNsZWFyTWVzaEluc3RhbmNlcyIsImRlc3RNZXNoSW5zdGFuY2VzIiwib3BhcXVlTWVzaEluc3RhbmNlcyIsInNyY0xheWVycyIsImxheWVyTGlzdCIsInN1YkxheWVyRW5hYmxlZCIsImlzVHJhbnNwYXJlbnQiLCJzdWJMYXllckxpc3QiLCJsZW5ndGgiLCJzcmNMYXllciIsImluZGV4T2YiLCJlbmFibGVkIiwibGF5ZXJDYW1JZCIsImNhbWVyYXMiLCJfY2xlYXJEZXB0aEJ1ZmZlciIsIm1lc2hJbnN0YW5jZXMiLCJpbnN0YW5jZXMiLCJ0cmFuc3BhcmVudE1lc2hJbnN0YW5jZXMiLCJqIiwicGljayIsInVwZGF0ZUNhbWVyYSIsInJlbmRlckNvbXBvc2l0aW9uIiwic3JjQ2FtZXJhIiwiY29weSIsImVudGl0eSIsImRlc3RDYW1lcmEiLCJjbGVhckNvbG9yQnVmZmVyIiwiY2xlYXJEZXB0aEJ1ZmZlciIsImNsZWFyU3RlbmNpbEJ1ZmZlciIsImNsZWFyQ29sb3IiLCJDb2xvciIsIldISVRFIiwiY2xlYXJDYW1lcmFzIiwiaWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0JBLE1BQU1BLE9BQU8sR0FBRyxJQUFJQyxHQUFHLEVBQUUsQ0FBQTtBQUV6QixNQUFNQyxpQkFBaUIsR0FBRztBQUN0QkMsRUFBQUEsS0FBSyxFQUFFLEdBQUc7QUFDVkMsRUFBQUEsS0FBSyxFQUFFQyxlQUFBQTtBQUNYLENBQUMsQ0FBQTs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsTUFBTSxDQUFDO0FBQ1Q7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxXQUFXLENBQUNDLEdBQUcsRUFBRUMsS0FBSyxFQUFFQyxNQUFNLEVBQUU7SUFDNUIsSUFBSUYsR0FBRyxZQUFZRyxjQUFjLEVBQUU7TUFDL0JILEdBQUcsR0FBR0ksY0FBYyxFQUFFLENBQUE7QUFDdEJDLE1BQUFBLEtBQUssQ0FBQ0MsVUFBVSxDQUFDLDRGQUE0RixDQUFDLENBQUE7QUFDbEgsS0FBQTtJQUVBLElBQUksQ0FBQ04sR0FBRyxHQUFHQSxHQUFHLENBQUE7QUFDZCxJQUFBLElBQUksQ0FBQ08sTUFBTSxHQUFHUCxHQUFHLENBQUNRLGNBQWMsQ0FBQTs7QUFFaEM7QUFDQSxJQUFBLElBQUksQ0FBQ0MsU0FBUyxHQUFHLElBQUlDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNwQyxJQUFBLElBQUksQ0FB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
