/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { path } from '../core/path.js';
import { Debug } from '../core/debug.js';
import { ABSOLUTE_URL } from '../asset/constants.js';
import { SceneRegistryItem } from './scene-registry-item.js';

class SceneRegistry {
  constructor(app) {
    this._app = app;
    this._list = [];
    this._index = {};
    this._urlIndex = {};
  }

  destroy() {
    this._app = null;
  }

  list() {
    return this._list;
  }

  add(name, url) {
    if (this._index.hasOwnProperty(name)) {
      Debug.warn('pc.SceneRegistry: trying to add more than one scene called: ' + name);
      return false;
    }

    const item = new SceneRegistryItem(name, url);

    const i = this._list.push(item);

    this._index[item.name] = i - 1;
    this._urlIndex[item.url] = i - 1;
    return true;
  }

  find(name) {
    if (this._index.hasOwnProperty(name)) {
      return this._list[this._index[name]];
    }

    return null;
  }

  findByUrl(url) {
    if (this._urlIndex.hasOwnProperty(url)) {
      return this._list[this._urlIndex[url]];
    }

    return null;
  }

  remove(name) {
    if (this._index.hasOwnProperty(name)) {
      const idx = this._index[name];
      let item = this._list[idx];
      delete this._urlIndex[item.url];
      delete this._index[name];

      this._list.splice(idx, 1);

      for (let i = 0; i < this._list.length; i++) {
        item = this._list[i];
        this._index[item.name] = i;
        this._urlIndex[item.url] = i;
      }
    }
  }

  _loadSceneData(sceneItem, storeInCache, callback) {
    const app = this._app;
    let url = sceneItem;

    if (typeof sceneItem === 'string') {
      sceneItem = this.findByUrl(url) || this.find(url) || new SceneRegistryItem('Untitled', url);
    }

    url = sceneItem.url;

    if (!url) {
      callback("Cannot find scene to load");
      return;
    }

    if (sceneItem.loaded) {
      callback(null, sceneItem);
      return;
    }

    if (app.assets && app.assets.prefix && !ABSOLUTE_URL.test(url)) {
      url = path.join(app.assets.prefix, url);
    }

    sceneItem._onLoadedCallbacks.push(callback);

    if (!sceneItem._loading) {
      const handler = app.loader.getHandler("hierarchy");
      handler.load(url, (err, data) => {
        sceneItem.data = data;
        sceneItem._loading = false;

        for (let i = 0; i < sceneItem._onLoadedCallbacks.length; i++) {
          sceneItem._onLoadedCallbacks[i](err, sceneItem);
        }

        if (!storeInCache) {
          sceneItem.data = null;
        }

        sceneItem._onLoadedCallbacks.length = 0;
      });
    }

    sceneItem._loading = true;
  }

  loadSceneData(sceneItem, callback) {
    this._loadSceneData(sceneItem, true, callback);
  }

  unloadSceneData(sceneItem) {
    if (typeof sceneItem === 'string') {
      sceneItem = this.findByUrl(sceneItem);
    }

    if (sceneItem) {
      sceneItem.data = null;
    }
  }

  _loadSceneHierarchy(sceneItem, onBeforeAddHierarchy, callback) {
    this._loadSceneData(sceneItem, false, (err, sceneItem) => {
      if (err) {
        if (callback) {
          callback(err);
        }

        return;
      }

      if (onBeforeAddHierarchy) {
        onBeforeAddHierarchy(sceneItem);
      }

      const app = this._app;

      const _loaded = () => {
        const handler = app.loader.getHandler("hierarchy");
        app.systems.script.preloading = true;
        const entity = handler.open(sceneItem.url, sceneItem.data);
        app.systems.script.preloading = false;
        app.loader.clearCache(sceneItem.url, "hierarchy");
        app.root.addChild(entity);
        app.systems.fire('initialize', entity);
        app.systems.fire('postInitialize', entity);
        app.systems.fire('postPostInitialize', entity);
        if (callback) callback(null, entity);
      };

      app._preloadScripts(sceneItem.data, _loaded);
    });
  }

  loadSceneHierarchy(sceneItem, callback) {
    this._loadSceneHierarchy(sceneItem, null, callback);
  }

  loadSceneSettings(sceneItem, callback) {
    this._loadSceneData(sceneItem, false, (err, sceneItem) => {
      if (!err) {
        this._app.applySceneSettings(sceneItem.data.settings);

        if (callback) {
          callback(null);
        }
      } else {
        if (callback) {
          callback(err);
        }
      }
    });
  }

  changeScene(sceneItem, callback) {
    const app = this._app;

    const onBeforeAddHierarchy = sceneItem => {
      const rootChildren = app.root.children;

      while (rootChildren.length > 0) {
        const child = rootChildren[0];
        child.reparent(null);
        child.destroy == null ? void 0 : child.destroy();
      }

      app.applySceneSettings(sceneItem.data.settings);
    };

    this._loadSceneHierarchy(sceneItem, onBeforeAddHierarchy, callback);
  }

  loadScene(url, callback) {
    const app = this._app;
    const handler = app.loader.getHandler("scene");

    if (app.assets && app.assets.prefix && !ABSOLUTE_URL.test(url)) {
      url = path.join(app.assets.prefix, url);
    }

    handler.load(url, (err, data) => {
      if (!err) {
        const _loaded = () => {
          app.systems.script.preloading = true;
          const scene = handler.open(url, data);
          const sceneItem = this.findByUrl(url);

          if (sceneItem && !sceneItem.loaded) {
            sceneItem.data = data;
          }

          app.systems.script.preloading = false;
          app.loader.clearCache(url, "scene");
          app.loader.patch({
            resource: scene,
            type: "scene"
          }, app.assets);
          app.root.addChild(scene.root);

          if (app.systems.rigidbody && typeof Ammo !== 'undefined') {
            app.systems.rigidbody.gravity.set(scene._gravity.x, scene._gravity.y, scene._gravity.z);
          }

          if (callback) {
            callback(null, scene);
          }
        };

        app._preloadScripts(data, _loaded);
      } else {
        if (callback) {
          callback(err);
        }
      }
    });
  }

}

export { SceneRegistry };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtcmVnaXN0cnkuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvc2NlbmUtcmVnaXN0cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGF0aCB9IGZyb20gJy4uL2NvcmUvcGF0aC5qcyc7XG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuXG5pbXBvcnQgeyBBQlNPTFVURV9VUkwgfSBmcm9tICcuLi9hc3NldC9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQgeyBTY2VuZVJlZ2lzdHJ5SXRlbSB9IGZyb20gJy4vc2NlbmUtcmVnaXN0cnktaXRlbS5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gQXBwQmFzZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vZW50aXR5LmpzJykuRW50aXR5fSBFbnRpdHkgKi9cblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBTY2VuZVJlZ2lzdHJ5I2xvYWRTY2VuZUhpZXJhcmNoeX0uXG4gKlxuICogQGNhbGxiYWNrIExvYWRIaWVyYXJjaHlDYWxsYmFja1xuICogQHBhcmFtIHtzdHJpbmd8bnVsbH0gZXJyIC0gVGhlIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGNhc2Ugd2hlcmUgdGhlIGxvYWRpbmcgb3IgcGFyc2luZyBmYWlscy5cbiAqIEBwYXJhbSB7RW50aXR5fSBbZW50aXR5XSAtIFRoZSBsb2FkZWQgcm9vdCBlbnRpdHkgaWYgbm8gZXJyb3JzIHdlcmUgZW5jb3VudGVyZWQuXG4gKi9cblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBTY2VuZVJlZ2lzdHJ5I2xvYWRTY2VuZVNldHRpbmdzfS5cbiAqXG4gKiBAY2FsbGJhY2sgTG9hZFNldHRpbmdzQ2FsbGJhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IGVyciAtIFRoZSBlcnJvciBtZXNzYWdlIGluIHRoZSBjYXNlIHdoZXJlIHRoZSBsb2FkaW5nIG9yIHBhcnNpbmcgZmFpbHMuXG4gKi9cblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBTY2VuZVJlZ2lzdHJ5I2NoYW5nZVNjZW5lfS5cbiAqXG4gKiBAY2FsbGJhY2sgQ2hhbmdlU2NlbmVDYWxsYmFja1xuICogQHBhcmFtIHtzdHJpbmd8bnVsbH0gZXJyIC0gVGhlIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGNhc2Ugd2hlcmUgdGhlIGxvYWRpbmcgb3IgcGFyc2luZyBmYWlscy5cbiAqIEBwYXJhbSB7RW50aXR5fSBbZW50aXR5XSAtIFRoZSBsb2FkZWQgcm9vdCBlbnRpdHkgaWYgbm8gZXJyb3JzIHdlcmUgZW5jb3VudGVyZWQuXG4gKi9cblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBTY2VuZVJlZ2lzdHJ5I2xvYWRTY2VuZX0uXG4gKlxuICogQGNhbGxiYWNrIExvYWRTY2VuZUNhbGxiYWNrXG4gKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBlcnIgLSBUaGUgZXJyb3IgbWVzc2FnZSBpbiB0aGUgY2FzZSB3aGVyZSB0aGUgbG9hZGluZyBvciBwYXJzaW5nIGZhaWxzLlxuICogQHBhcmFtIHtFbnRpdHl9IFtlbnRpdHldIC0gVGhlIGxvYWRlZCByb290IGVudGl0eSBpZiBubyBlcnJvcnMgd2VyZSBlbmNvdW50ZXJlZC5cbiAqL1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lRGF0YX0uXG4gKlxuICogQGNhbGxiYWNrIExvYWRTY2VuZURhdGFDYWxsYmFja1xuICogQHBhcmFtIHtzdHJpbmd8bnVsbH0gZXJyIC0gVGhlIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGNhc2Ugd2hlcmUgdGhlIGxvYWRpbmcgb3IgcGFyc2luZyBmYWlscy5cbiAqIEBwYXJhbSB7U2NlbmVSZWdpc3RyeUl0ZW19IFtzY2VuZUl0ZW1dIC0gVGhlIHNjZW5lIHJlZ2lzdHJ5IGl0ZW0gaWYgbm8gZXJyb3JzIHdlcmUgZW5jb3VudGVyZWQuXG4gKi9cblxuLyoqXG4gKiBDb250YWluZXIgZm9yIHN0b3JpbmcgYW5kIGxvYWRpbmcgb2Ygc2NlbmVzLiBBbiBpbnN0YW5jZSBvZiB0aGUgcmVnaXN0cnkgaXMgY3JlYXRlZCBvbiB0aGVcbiAqIHtAbGluayBBcHBCYXNlfSBvYmplY3QgYXMge0BsaW5rIEFwcEJhc2Ujc2NlbmVzfS5cbiAqL1xuY2xhc3MgU2NlbmVSZWdpc3RyeSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNjZW5lUmVnaXN0cnkgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FwcEJhc2V9IGFwcCAtIFRoZSBhcHBsaWNhdGlvbi5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgdGhpcy5fYXBwID0gYXBwO1xuICAgICAgICB0aGlzLl9saXN0ID0gW107XG4gICAgICAgIHRoaXMuX2luZGV4ID0ge307XG4gICAgICAgIHRoaXMuX3VybEluZGV4ID0ge307XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fYXBwID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2Ygc2NlbmUuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7U2NlbmVSZWdpc3RyeUl0ZW1bXX0gQWxsIGl0ZW1zIGluIHRoZSByZWdpc3RyeS5cbiAgICAgKi9cbiAgICBsaXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGlzdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBuZXcgaXRlbSB0byB0aGUgc2NlbmUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBzY2VuZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gIFRoZSB1cmwgb2YgdGhlIHNjZW5lIGZpbGUuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2NlbmUgd2FzIHN1Y2Nlc3NmdWxseSBhZGRlZCB0byB0aGUgcmVnaXN0cnksIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBhZGQobmFtZSwgdXJsKSB7XG4gICAgICAgIGlmICh0aGlzLl9pbmRleC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgICAgRGVidWcud2FybigncGMuU2NlbmVSZWdpc3RyeTogdHJ5aW5nIHRvIGFkZCBtb3JlIHRoYW4gb25lIHNjZW5lIGNhbGxlZDogJyArIG5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXRlbSA9IG5ldyBTY2VuZVJlZ2lzdHJ5SXRlbShuYW1lLCB1cmwpO1xuXG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLl9saXN0LnB1c2goaXRlbSk7XG4gICAgICAgIHRoaXMuX2luZGV4W2l0ZW0ubmFtZV0gPSBpIC0gMTtcbiAgICAgICAgdGhpcy5fdXJsSW5kZXhbaXRlbS51cmxdID0gaSAtIDE7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhIFNjZW5lIGJ5IG5hbWUgYW5kIHJldHVybiB0aGUge0BsaW5rIFNjZW5lUmVnaXN0cnlJdGVtfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHNjZW5lLlxuICAgICAqIEByZXR1cm5zIHtTY2VuZVJlZ2lzdHJ5SXRlbXxudWxsfSBUaGUgc3RvcmVkIGRhdGEgYWJvdXQgYSBzY2VuZSBvciBudWxsIGlmIG5vIHNjZW5lIHdpdGhcbiAgICAgKiB0aGF0IG5hbWUgZXhpc3RzLlxuICAgICAqL1xuICAgIGZpbmQobmFtZSkge1xuICAgICAgICBpZiAodGhpcy5faW5kZXguaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9saXN0W3RoaXMuX2luZGV4W25hbWVdXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYSBzY2VuZSBieSB0aGUgVVJMIGFuZCByZXR1cm4gdGhlIHtAbGluayBTY2VuZVJlZ2lzdHJ5SXRlbX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBzZWFyY2ggYnkuXG4gICAgICogQHJldHVybnMge1NjZW5lUmVnaXN0cnlJdGVtfG51bGx9IFRoZSBzdG9yZWQgZGF0YSBhYm91dCBhIHNjZW5lIG9yIG51bGwgaWYgbm8gc2NlbmUgd2l0aFxuICAgICAqIHRoYXQgVVJMIGV4aXN0cy5cbiAgICAgKi9cbiAgICBmaW5kQnlVcmwodXJsKSB7XG4gICAgICAgIGlmICh0aGlzLl91cmxJbmRleC5oYXNPd25Qcm9wZXJ0eSh1cmwpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGlzdFt0aGlzLl91cmxJbmRleFt1cmxdXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhbiBpdGVtIGZyb20gdGhlIHNjZW5lIHJlZ2lzdHJ5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc2NlbmUuXG4gICAgICovXG4gICAgcmVtb3ZlKG5hbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2luZGV4Lmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9pbmRleFtuYW1lXTtcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5fbGlzdFtpZHhdO1xuXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fdXJsSW5kZXhbaXRlbS51cmxdO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gaW5kZXhcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9pbmRleFtuYW1lXTtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gbGlzdFxuICAgICAgICAgICAgdGhpcy5fbGlzdC5zcGxpY2UoaWR4LCAxKTtcblxuICAgICAgICAgICAgLy8gcmVmcmVzaCBpbmRleFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9saXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuX2xpc3RbaV07XG4gICAgICAgICAgICAgICAgdGhpcy5faW5kZXhbaXRlbS5uYW1lXSA9IGk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXJsSW5kZXhbaXRlbS51cmxdID0gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFByaXZhdGUgZnVuY3Rpb24gdG8gbG9hZCBzY2VuZSBkYXRhIHdpdGggdGhlIG9wdGlvbiB0byBjYWNoZVxuICAgIC8vIFRoaXMgYWxsb3dzIHVzIHRvIHJldGFpbiBleHBlY3RlZCBiZWhhdmlvciBvZiBsb2FkU2NlbmVTZXR0aW5ncyBhbmQgbG9hZFNjZW5lSGllcmFyY2h5IHdoZXJlIHRoZXlcbiAgICAvLyBkb24ndCBzdG9yZSBsb2FkZWQgZGF0YSB3aGljaCBtYXkgYmUgdW5kZXNpcmVkIGJlaGF2aW9yIHdpdGggcHJvamVjdHMgdGhhdCBoYXZlIG1hbnkgc2NlbmVzLlxuICAgIF9sb2FkU2NlbmVEYXRhKHNjZW5lSXRlbSwgc3RvcmVJbkNhY2hlLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBhcHAgPSB0aGlzLl9hcHA7XG4gICAgICAgIC8vIElmIGl0J3MgYSBzY2VuZUl0ZW0sIHdlIHdhbnQgdG8gYmUgYWJsZSB0byBjYWNoZSB0aGUgZGF0YVxuICAgICAgICAvLyB0aGF0IGlzIGxvYWRlZCBzbyB3ZSBkb24ndCBkbyBhIHN1YnNlcXVlbnQgaHR0cCByZXF1ZXN0c1xuICAgICAgICAvLyBvbiB0aGUgc2FtZSBzY2VuZSBsYXRlclxuXG4gICAgICAgIC8vIElmIGl0J3MganVzdCBhIFVSTCBvciBzY2VuZSBuYW1lIHRoZW4gYXR0ZW1wdCB0byBmaW5kXG4gICAgICAgIC8vIHRoZSBzY2VuZSBpdGVtIGluIHRoZSByZWdpc3RyeSBlbHNlIGNyZWF0ZSBhIHRlbXBcbiAgICAgICAgLy8gU2NlbmVSZWdpc3RyeUl0ZW0gdG8gdXNlIGZvciB0aGlzIGZ1bmN0aW9uIGFzIHRoZSBzY2VuZVxuICAgICAgICAvLyBtYXkgbm90IGhhdmUgYmVlbiBhZGRlZCB0byB0aGUgcmVnaXN0cnlcbiAgICAgICAgbGV0IHVybCA9IHNjZW5lSXRlbTtcbiAgICAgICAgaWYgKHR5cGVvZiBzY2VuZUl0ZW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzY2VuZUl0ZW0gPSB0aGlzLmZpbmRCeVVybCh1cmwpIHx8IHRoaXMuZmluZCh1cmwpIHx8IG5ldyBTY2VuZVJlZ2lzdHJ5SXRlbSgnVW50aXRsZWQnLCB1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgdXJsID0gc2NlbmVJdGVtLnVybDtcblxuICAgICAgICBpZiAoIXVybCkge1xuICAgICAgICAgICAgY2FsbGJhY2soXCJDYW5ub3QgZmluZCBzY2VuZSB0byBsb2FkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgd2UgaGF2ZSB0aGUgZGF0YSBhbHJlYWR5IGxvYWRlZCwgbm8gbmVlZCB0byBkbyBhbm90aGVyIEhUVFAgcmVxdWVzdFxuICAgICAgICBpZiAoc2NlbmVJdGVtLmxvYWRlZCkge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgc2NlbmVJdGVtKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGluY2x1ZGUgYXNzZXQgcHJlZml4IGlmIHByZXNlbnRcbiAgICAgICAgaWYgKGFwcC5hc3NldHMgJiYgYXBwLmFzc2V0cy5wcmVmaXggJiYgIUFCU09MVVRFX1VSTC50ZXN0KHVybCkpIHtcbiAgICAgICAgICAgIHVybCA9IHBhdGguam9pbihhcHAuYXNzZXRzLnByZWZpeCwgdXJsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNjZW5lSXRlbS5fb25Mb2FkZWRDYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG5cbiAgICAgICAgaWYgKCFzY2VuZUl0ZW0uX2xvYWRpbmcpIHtcbiAgICAgICAgICAgIC8vIEJlY2F1c2Ugd2UgbmVlZCB0byBsb2FkIHNjcmlwdHMgYmVmb3JlIHdlIGluc3RhbmNlIHRoZSBoaWVyYXJjaHkgKGkuZS4gYmVmb3JlIHdlIGNyZWF0ZSBzY3JpcHQgY29tcG9uZW50cylcbiAgICAgICAgICAgIC8vIFNwbGl0IGxvYWRpbmcgaW50byBsb2FkIGFuZCBvcGVuXG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gYXBwLmxvYWRlci5nZXRIYW5kbGVyKFwiaGllcmFyY2h5XCIpO1xuXG4gICAgICAgICAgICBoYW5kbGVyLmxvYWQodXJsLCAoZXJyLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgc2NlbmVJdGVtLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHNjZW5lSXRlbS5fbG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY2VuZUl0ZW0uX29uTG9hZGVkQ2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjZW5lSXRlbS5fb25Mb2FkZWRDYWxsYmFja3NbaV0oZXJyLCBzY2VuZUl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgZGF0YSBpZiBpdCdzIG5vdCBiZWVuIHJlcXVlc3RlZCB0byBzdG9yZSBpbiBjYWNoZVxuICAgICAgICAgICAgICAgIGlmICghc3RvcmVJbkNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjZW5lSXRlbS5kYXRhID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY2VuZUl0ZW0uX29uTG9hZGVkQ2FsbGJhY2tzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNjZW5lSXRlbS5fbG9hZGluZyA9IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZHMgYW5kIHN0b3JlcyB0aGUgc2NlbmUgZGF0YSB0byByZWR1Y2UgdGhlIG51bWJlciBvZiB0aGUgbmV0d29yayByZXF1ZXN0cyB3aGVuIHRoZSBzYW1lXG4gICAgICogc2NlbmVzIGFyZSBsb2FkZWQgbXVsdGlwbGUgdGltZXMuIENhbiBhbHNvIGJlIHVzZWQgdG8gbG9hZCBkYXRhIGJlZm9yZSBjYWxsaW5nXG4gICAgICoge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lSGllcmFyY2h5fSBhbmQge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lU2V0dGluZ3N9IHRvIG1ha2VcbiAgICAgKiBzY2VuZSBsb2FkaW5nIHF1aWNrZXIgZm9yIHRoZSB1c2VyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTY2VuZVJlZ2lzdHJ5SXRlbSB8IHN0cmluZ30gc2NlbmVJdGVtIC0gVGhlIHNjZW5lIGl0ZW0gKHdoaWNoIGNhbiBiZSBmb3VuZCB3aXRoXG4gICAgICoge0BsaW5rIFNjZW5lUmVnaXN0cnkjZmluZH0sIFVSTCBvZiB0aGUgc2NlbmUgZmlsZSAoZS5nLlwic2NlbmVfaWQuanNvblwiKSBvciBuYW1lIG9mIHRoZSBzY2VuZS5cbiAgICAgKiBAcGFyYW0ge0xvYWRTY2VuZURhdGFDYWxsYmFja30gY2FsbGJhY2sgLSBUaGUgZnVuY3Rpb24gdG8gY2FsbCBhZnRlciBsb2FkaW5nLFxuICAgICAqIHBhc3NlZCAoZXJyLCBzY2VuZUl0ZW0pIHdoZXJlIGVyciBpcyBudWxsIGlmIG5vIGVycm9ycyBvY2N1cnJlZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBzY2VuZUl0ZW0gPSBhcHAuc2NlbmVzLmZpbmQoXCJTY2VuZSBOYW1lXCIpO1xuICAgICAqIGFwcC5zY2VuZXMubG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0sIGZ1bmN0aW9uIChlcnIsIHNjZW5lSXRlbSkge1xuICAgICAqICAgICBpZiAoZXJyKSB7XG4gICAgICogICAgICAgICAvLyBlcnJvclxuICAgICAqICAgICB9XG4gICAgICogfSk7XG4gICAgICovXG4gICAgbG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0sIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2xvYWRTY2VuZURhdGEoc2NlbmVJdGVtLCB0cnVlLCBjYWxsYmFjayk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVW5sb2FkcyBzY2VuZSBkYXRhIHRoYXQgaGFzIGJlZW4gbG9hZGVkIHByZXZpb3VzbHkgdXNpbmcge0BsaW5rIFNjZW5lUmVnaXN0cnkjbG9hZFNjZW5lRGF0YX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NjZW5lUmVnaXN0cnlJdGVtIHwgc3RyaW5nfSBzY2VuZUl0ZW0gLSBUaGUgc2NlbmUgaXRlbSAod2hpY2ggY2FuIGJlIGZvdW5kIHdpdGhcbiAgICAgKiB7QGxpbmsgU2NlbmVSZWdpc3RyeSNmaW5kfSBvciBVUkwgb2YgdGhlIHNjZW5lIGZpbGUuIFVzdWFsbHkgdGhpcyB3aWxsIGJlIFwic2NlbmVfaWQuanNvblwiLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIHNjZW5lSXRlbSA9IGFwcC5zY2VuZXMuZmluZChcIlNjZW5lIE5hbWVcIik7XG4gICAgICogYXBwLnNjZW5lcy51bmxvYWRTY2VuZURhdGEoc2NlbmVJdGVtKTtcbiAgICAgKi9cbiAgICB1bmxvYWRTY2VuZURhdGEoc2NlbmVJdGVtKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc2NlbmVJdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgc2NlbmVJdGVtID0gdGhpcy5maW5kQnlVcmwoc2NlbmVJdGVtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzY2VuZUl0ZW0pIHtcbiAgICAgICAgICAgIHNjZW5lSXRlbS5kYXRhID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9sb2FkU2NlbmVIaWVyYXJjaHkoc2NlbmVJdGVtLCBvbkJlZm9yZUFkZEhpZXJhcmNoeSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbG9hZFNjZW5lRGF0YShzY2VuZUl0ZW0sIGZhbHNlLCAoZXJyLCBzY2VuZUl0ZW0pID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob25CZWZvcmVBZGRIaWVyYXJjaHkpIHtcbiAgICAgICAgICAgICAgICBvbkJlZm9yZUFkZEhpZXJhcmNoeShzY2VuZUl0ZW0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBhcHAgPSB0aGlzLl9hcHA7XG5cbiAgICAgICAgICAgIC8vIGNhbGxlZCBhZnRlciBzY3JpcHRzIGFyZSBwcmVsb2FkZWRcbiAgICAgICAgICAgIGNvbnN0IF9sb2FkZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gQmVjYXVzZSB3ZSBuZWVkIHRvIGxvYWQgc2NyaXB0cyBiZWZvcmUgd2UgaW5zdGFuY2UgdGhlIGhpZXJhcmNoeSAoaS5lLiBiZWZvcmUgd2UgY3JlYXRlIHNjcmlwdCBjb21wb25lbnRzKVxuICAgICAgICAgICAgICAgIC8vIFNwbGl0IGxvYWRpbmcgaW50byBsb2FkIGFuZCBvcGVuXG4gICAgICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9IGFwcC5sb2FkZXIuZ2V0SGFuZGxlcihcImhpZXJhcmNoeVwiKTtcblxuICAgICAgICAgICAgICAgIGFwcC5zeXN0ZW1zLnNjcmlwdC5wcmVsb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBoYW5kbGVyLm9wZW4oc2NlbmVJdGVtLnVybCwgc2NlbmVJdGVtLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMuc2NyaXB0LnByZWxvYWRpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIC8vIGNsZWFyIGZyb20gY2FjaGUgYmVjYXVzZSB0aGlzIGRhdGEgaXMgbW9kaWZpZWQgYnkgZW50aXR5IG9wZXJhdGlvbnMgKGUuZy4gZGVzdHJveSlcbiAgICAgICAgICAgICAgICBhcHAubG9hZGVyLmNsZWFyQ2FjaGUoc2NlbmVJdGVtLnVybCwgXCJoaWVyYXJjaHlcIik7XG5cbiAgICAgICAgICAgICAgICAvLyBhZGQgdG8gaGllcmFyY2h5XG4gICAgICAgICAgICAgICAgYXBwLnJvb3QuYWRkQ2hpbGQoZW50aXR5KTtcblxuICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemUgY29tcG9uZW50c1xuICAgICAgICAgICAgICAgIGFwcC5zeXN0ZW1zLmZpcmUoJ2luaXRpYWxpemUnLCBlbnRpdHkpO1xuICAgICAgICAgICAgICAgIGFwcC5zeXN0ZW1zLmZpcmUoJ3Bvc3RJbml0aWFsaXplJywgZW50aXR5KTtcbiAgICAgICAgICAgICAgICBhcHAuc3lzdGVtcy5maXJlKCdwb3N0UG9zdEluaXRpYWxpemUnLCBlbnRpdHkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhudWxsLCBlbnRpdHkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gbG9hZCBwcmlvcml0eSBhbmQgcmVmZXJlbmNlZCBzY3JpcHRzIGJlZm9yZSBvcGVuaW5nIHNjZW5lXG4gICAgICAgICAgICBhcHAuX3ByZWxvYWRTY3JpcHRzKHNjZW5lSXRlbS5kYXRhLCBfbG9hZGVkKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCBhIHNjZW5lIGZpbGUsIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgRW50aXR5IGhpZXJhcmNoeSBhbmQgYWRkIHRoZSBoaWVyYXJjaHkgdG8gdGhlXG4gICAgICogYXBwbGljYXRpb24gcm9vdCBFbnRpdHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NjZW5lUmVnaXN0cnlJdGVtIHwgc3RyaW5nfSBzY2VuZUl0ZW0gLSBUaGUgc2NlbmUgaXRlbSAod2hpY2ggY2FuIGJlIGZvdW5kIHdpdGhcbiAgICAgKiB7QGxpbmsgU2NlbmVSZWdpc3RyeSNmaW5kfSwgVVJMIG9mIHRoZSBzY2VuZSBmaWxlIChlLmcuXCJzY2VuZV9pZC5qc29uXCIpIG9yIG5hbWUgb2YgdGhlIHNjZW5lLlxuICAgICAqIEBwYXJhbSB7TG9hZEhpZXJhcmNoeUNhbGxiYWNrfSBjYWxsYmFjayAtIFRoZSBmdW5jdGlvbiB0byBjYWxsIGFmdGVyIGxvYWRpbmcsXG4gICAgICogcGFzc2VkIChlcnIsIGVudGl0eSkgd2hlcmUgZXJyIGlzIG51bGwgaWYgbm8gZXJyb3JzIG9jY3VycmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIHNjZW5lSXRlbSA9IGFwcC5zY2VuZXMuZmluZChcIlNjZW5lIE5hbWVcIik7XG4gICAgICogYXBwLnNjZW5lcy5sb2FkU2NlbmVIaWVyYXJjaHkoc2NlbmVJdGVtLCBmdW5jdGlvbiAoZXJyLCBlbnRpdHkpIHtcbiAgICAgKiAgICAgaWYgKCFlcnIpIHtcbiAgICAgKiAgICAgICAgIHZhciBlID0gYXBwLnJvb3QuZmluZChcIk15IE5ldyBFbnRpdHlcIik7XG4gICAgICogICAgIH0gZWxzZSB7XG4gICAgICogICAgICAgICAvLyBlcnJvclxuICAgICAqICAgICB9XG4gICAgICogfSk7XG4gICAgICovXG4gICAgbG9hZFNjZW5lSGllcmFyY2h5KHNjZW5lSXRlbSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbG9hZFNjZW5lSGllcmFyY2h5KHNjZW5lSXRlbSwgbnVsbCwgY2FsbGJhY2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWQgYSBzY2VuZSBmaWxlIGFuZCBhcHBseSB0aGUgc2NlbmUgc2V0dGluZ3MgdG8gdGhlIGN1cnJlbnQgc2NlbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NjZW5lUmVnaXN0cnlJdGVtIHwgc3RyaW5nfSBzY2VuZUl0ZW0gLSBUaGUgc2NlbmUgaXRlbSAod2hpY2ggY2FuIGJlIGZvdW5kIHdpdGhcbiAgICAgKiB7QGxpbmsgU2NlbmVSZWdpc3RyeSNmaW5kfSwgVVJMIG9mIHRoZSBzY2VuZSBmaWxlIChlLmcuXCJzY2VuZV9pZC5qc29uXCIpIG9yIG5hbWUgb2YgdGhlIHNjZW5lLlxuICAgICAqIEBwYXJhbSB7TG9hZFNldHRpbmdzQ2FsbGJhY2t9IGNhbGxiYWNrIC0gVGhlIGZ1bmN0aW9uIGNhbGxlZCBhZnRlciB0aGUgc2V0dGluZ3NcbiAgICAgKiBhcmUgYXBwbGllZC4gUGFzc2VkIChlcnIpIHdoZXJlIGVyciBpcyBudWxsIGlmIG5vIGVycm9yIG9jY3VycmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIHNjZW5lSXRlbSA9IGFwcC5zY2VuZXMuZmluZChcIlNjZW5lIE5hbWVcIik7XG4gICAgICogYXBwLnNjZW5lcy5sb2FkU2NlbmVTZXR0aW5ncyhzY2VuZUl0ZW0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgKiAgICAgaWYgKCFlcnIpIHtcbiAgICAgKiAgICAgICAgIC8vIHN1Y2Nlc3NcbiAgICAgKiAgICAgfSBlbHNlIHtcbiAgICAgKiAgICAgICAgIC8vIGVycm9yXG4gICAgICogICAgIH1cbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBsb2FkU2NlbmVTZXR0aW5ncyhzY2VuZUl0ZW0sIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2xvYWRTY2VuZURhdGEoc2NlbmVJdGVtLCBmYWxzZSwgKGVyciwgc2NlbmVJdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWVycikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2FwcC5hcHBseVNjZW5lU2V0dGluZ3Moc2NlbmVJdGVtLmRhdGEuc2V0dGluZ3MpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlIHRvIGEgbmV3IHNjZW5lLiBDYWxsaW5nIHRoaXMgZnVuY3Rpb24gd2lsbCBsb2FkIHRoZSBzY2VuZSBkYXRhLCBkZWxldGUgYWxsXG4gICAgICogZW50aXRpZXMgYW5kIGdyYXBoIG5vZGVzIHVuZGVyIGBhcHAucm9vdGAgYW5kIGxvYWQgdGhlIHNjZW5lIHNldHRpbmdzIGFuZCBoaWVyYXJjaHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NjZW5lUmVnaXN0cnlJdGVtIHwgc3RyaW5nfSBzY2VuZUl0ZW0gLSBUaGUgc2NlbmUgaXRlbSAod2hpY2ggY2FuIGJlIGZvdW5kIHdpdGhcbiAgICAgKiB7QGxpbmsgU2NlbmVSZWdpc3RyeSNmaW5kfSwgVVJMIG9mIHRoZSBzY2VuZSBmaWxlIChlLmcuXCJzY2VuZV9pZC5qc29uXCIpIG9yIG5hbWUgb2YgdGhlIHNjZW5lLlxuICAgICAqIEBwYXJhbSB7Q2hhbmdlU2NlbmVDYWxsYmFja30gW2NhbGxiYWNrXSAtIFRoZSBmdW5jdGlvbiB0byBjYWxsIGFmdGVyIGxvYWRpbmcsXG4gICAgICogcGFzc2VkIChlcnIsIGVudGl0eSkgd2hlcmUgZXJyIGlzIG51bGwgaWYgbm8gZXJyb3JzIG9jY3VycmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLnNjZW5lcy5jaGFuZ2VTY2VuZShcIlNjZW5lIE5hbWVcIiwgZnVuY3Rpb24gKGVyciwgZW50aXR5KSB7XG4gICAgICogICAgIGlmICghZXJyKSB7XG4gICAgICogICAgICAgICAvLyBzdWNjZXNzXG4gICAgICogICAgIH0gZWxzZSB7XG4gICAgICogICAgICAgICAvLyBlcnJvclxuICAgICAqICAgICB9XG4gICAgICogfSk7XG4gICAgICovXG4gICAgY2hhbmdlU2NlbmUoc2NlbmVJdGVtLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBhcHAgPSB0aGlzLl9hcHA7XG5cbiAgICAgICAgY29uc3Qgb25CZWZvcmVBZGRIaWVyYXJjaHkgPSAoc2NlbmVJdGVtKSA9PiB7XG4gICAgICAgICAgICAvLyBEZXN0cm95L1JlbW92ZSBhbGwgbm9kZXMgb24gdGhlIGFwcC5yb290XG4gICAgICAgICAgICBjb25zdCByb290Q2hpbGRyZW4gPSBhcHAucm9vdC5jaGlsZHJlbjtcbiAgICAgICAgICAgIHdoaWxlIChyb290Q2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gcm9vdENoaWxkcmVuWzBdO1xuICAgICAgICAgICAgICAgIGNoaWxkLnJlcGFyZW50KG51bGwpO1xuICAgICAgICAgICAgICAgIGNoaWxkLmRlc3Ryb3k/LigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhcHAuYXBwbHlTY2VuZVNldHRpbmdzKHNjZW5lSXRlbS5kYXRhLnNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl9sb2FkU2NlbmVIaWVyYXJjaHkoc2NlbmVJdGVtLCBvbkJlZm9yZUFkZEhpZXJhcmNoeSwgY2FsbGJhY2spO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIHNjZW5lIGhpZXJhcmNoeSBhbmQgc2NlbmUgc2V0dGluZ3MuIFRoaXMgaXMgYW4gaW50ZXJuYWwgbWV0aG9kIHVzZWQgYnkgdGhlXG4gICAgICoge0BsaW5rIEFwcEJhc2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIHNjZW5lIGZpbGUuXG4gICAgICogQHBhcmFtIHtMb2FkU2NlbmVDYWxsYmFja30gY2FsbGJhY2sgLSBUaGUgZnVuY3Rpb24gY2FsbGVkIGFmdGVyIHRoZSBzZXR0aW5ncyBhcmVcbiAgICAgKiBhcHBsaWVkLiBQYXNzZWQgKGVyciwgc2NlbmUpIHdoZXJlIGVyciBpcyBudWxsIGlmIG5vIGVycm9yIG9jY3VycmVkIGFuZCBzY2VuZSBpcyB0aGVcbiAgICAgKiB7QGxpbmsgU2NlbmV9LlxuICAgICAqL1xuICAgIGxvYWRTY2VuZSh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuX2FwcDtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gYXBwLmxvYWRlci5nZXRIYW5kbGVyKFwic2NlbmVcIik7XG5cbiAgICAgICAgLy8gaW5jbHVkZSBhc3NldCBwcmVmaXggaWYgcHJlc2VudFxuICAgICAgICBpZiAoYXBwLmFzc2V0cyAmJiBhcHAuYXNzZXRzLnByZWZpeCAmJiAhQUJTT0xVVEVfVVJMLnRlc3QodXJsKSkge1xuICAgICAgICAgICAgdXJsID0gcGF0aC5qb2luKGFwcC5hc3NldHMucHJlZml4LCB1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgaGFuZGxlci5sb2FkKHVybCwgKGVyciwgZGF0YSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBfbG9hZGVkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBwYXJzZSBhbmQgY3JlYXRlIHNjZW5lXG4gICAgICAgICAgICAgICAgICAgIGFwcC5zeXN0ZW1zLnNjcmlwdC5wcmVsb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NlbmUgPSBoYW5kbGVyLm9wZW4odXJsLCBkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDYWNoZSB0aGUgZGF0YSBhcyB3ZSBhcmUgbG9hZGluZyB2aWEgVVJMIG9ubHlcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NlbmVJdGVtID0gdGhpcy5maW5kQnlVcmwodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjZW5lSXRlbSAmJiAhc2NlbmVJdGVtLmxvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmVJdGVtLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXBwLnN5c3RlbXMuc2NyaXB0LnByZWxvYWRpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciBzY2VuZSBmcm9tIGNhY2hlIGJlY2F1c2Ugd2UnbGwgZGVzdHJveSBpdCB3aGVuIHdlIGxvYWQgYW5vdGhlciBvbmVcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gZGF0YSB3aWxsIGJlIGludmFsaWRcbiAgICAgICAgICAgICAgICAgICAgYXBwLmxvYWRlci5jbGVhckNhY2hlKHVybCwgXCJzY2VuZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICBhcHAubG9hZGVyLnBhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlOiBzY2VuZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic2NlbmVcIlxuICAgICAgICAgICAgICAgICAgICB9LCBhcHAuYXNzZXRzKTtcblxuICAgICAgICAgICAgICAgICAgICBhcHAucm9vdC5hZGRDaGlsZChzY2VuZS5yb290KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplIHBhY2sgc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcC5zeXN0ZW1zLnJpZ2lkYm9keSAmJiB0eXBlb2YgQW1tbyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5zeXN0ZW1zLnJpZ2lkYm9keS5ncmF2aXR5LnNldChzY2VuZS5fZ3Jhdml0eS54LCBzY2VuZS5fZ3Jhdml0eS55LCBzY2VuZS5fZ3Jhdml0eS56KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgc2NlbmUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIHByZWxvYWQgc2NyaXB0cyBiZWZvcmUgb3BlbmluZyBzY2VuZVxuICAgICAgICAgICAgICAgIGFwcC5fcHJlbG9hZFNjcmlwdHMoZGF0YSwgX2xvYWRlZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTY2VuZVJlZ2lzdHJ5IH07XG4iXSwibmFtZXMiOlsiU2NlbmVSZWdpc3RyeSIsImNvbnN0cnVjdG9yIiwiYXBwIiwiX2FwcCIsIl9saXN0IiwiX2luZGV4IiwiX3VybEluZGV4IiwiZGVzdHJveSIsImxpc3QiLCJhZGQiLCJuYW1lIiwidXJsIiwiaGFzT3duUHJvcGVydHkiLCJEZWJ1ZyIsIndhcm4iLCJpdGVtIiwiU2NlbmVSZWdpc3RyeUl0ZW0iLCJpIiwicHVzaCIsImZpbmQiLCJmaW5kQnlVcmwiLCJyZW1vdmUiLCJpZHgiLCJzcGxpY2UiLCJsZW5ndGgiLCJfbG9hZFNjZW5lRGF0YSIsInNjZW5lSXRlbSIsInN0b3JlSW5DYWNoZSIsImNhbGxiYWNrIiwibG9hZGVkIiwiYXNzZXRzIiwicHJlZml4IiwiQUJTT0xVVEVfVVJMIiwidGVzdCIsInBhdGgiLCJqb2luIiwiX29uTG9hZGVkQ2FsbGJhY2tzIiwiX2xvYWRpbmciLCJoYW5kbGVyIiwibG9hZGVyIiwiZ2V0SGFuZGxlciIsImxvYWQiLCJlcnIiLCJkYXRhIiwibG9hZFNjZW5lRGF0YSIsInVubG9hZFNjZW5lRGF0YSIsIl9sb2FkU2NlbmVIaWVyYXJjaHkiLCJvbkJlZm9yZUFkZEhpZXJhcmNoeSIsIl9sb2FkZWQiLCJzeXN0ZW1zIiwic2NyaXB0IiwicHJlbG9hZGluZyIsImVudGl0eSIsIm9wZW4iLCJjbGVhckNhY2hlIiwicm9vdCIsImFkZENoaWxkIiwiZmlyZSIsIl9wcmVsb2FkU2NyaXB0cyIsImxvYWRTY2VuZUhpZXJhcmNoeSIsImxvYWRTY2VuZVNldHRpbmdzIiwiYXBwbHlTY2VuZVNldHRpbmdzIiwic2V0dGluZ3MiLCJjaGFuZ2VTY2VuZSIsInJvb3RDaGlsZHJlbiIsImNoaWxkcmVuIiwiY2hpbGQiLCJyZXBhcmVudCIsImxvYWRTY2VuZSIsInNjZW5lIiwicGF0Y2giLCJyZXNvdXJjZSIsInR5cGUiLCJyaWdpZGJvZHkiLCJBbW1vIiwiZ3Jhdml0eSIsInNldCIsIl9ncmF2aXR5IiwieCIsInkiLCJ6Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBcURBLE1BQU1BLGFBQU4sQ0FBb0I7RUFNaEJDLFdBQVcsQ0FBQ0MsR0FBRCxFQUFNO0lBQ2IsSUFBS0MsQ0FBQUEsSUFBTCxHQUFZRCxHQUFaLENBQUE7SUFDQSxJQUFLRSxDQUFBQSxLQUFMLEdBQWEsRUFBYixDQUFBO0lBQ0EsSUFBS0MsQ0FBQUEsTUFBTCxHQUFjLEVBQWQsQ0FBQTtJQUNBLElBQUtDLENBQUFBLFNBQUwsR0FBaUIsRUFBakIsQ0FBQTtBQUNILEdBQUE7O0FBRURDLEVBQUFBLE9BQU8sR0FBRztJQUNOLElBQUtKLENBQUFBLElBQUwsR0FBWSxJQUFaLENBQUE7QUFDSCxHQUFBOztBQU9ESyxFQUFBQSxJQUFJLEdBQUc7QUFDSCxJQUFBLE9BQU8sS0FBS0osS0FBWixDQUFBO0FBQ0gsR0FBQTs7QUFTREssRUFBQUEsR0FBRyxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNYLElBQUEsSUFBSSxLQUFLTixNQUFMLENBQVlPLGNBQVosQ0FBMkJGLElBQTNCLENBQUosRUFBc0M7QUFDbENHLE1BQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLDhEQUFBLEdBQWlFSixJQUE1RSxDQUFB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
