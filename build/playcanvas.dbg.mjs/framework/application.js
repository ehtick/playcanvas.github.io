/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { platform } from '../core/platform.js';
import { WebglGraphicsDevice } from '../graphics/webgl/webgl-graphics-device.js';
import { SoundManager } from '../sound/manager.js';
import { Lightmapper } from '../scene/lightmapper/lightmapper.js';
import { BatchManager } from '../scene/batching/batch-manager.js';
import { AppBase } from './app-base.js';
import { AppOptions } from './app-options.js';
import { script } from './script.js';
import { AnimationComponentSystem } from './components/animation/system.js';
import { AnimComponentSystem } from './components/anim/system.js';
import { AudioListenerComponentSystem } from './components/audio-listener/system.js';
import { AudioSourceComponentSystem } from './components/audio-source/system.js';
import { ButtonComponentSystem } from './components/button/system.js';
import { CollisionComponentSystem } from './components/collision/system.js';
import { ElementComponentSystem } from './components/element/system.js';
import { JointComponentSystem } from './components/joint/system.js';
import { LayoutChildComponentSystem } from './components/layout-child/system.js';
import { LayoutGroupComponentSystem } from './components/layout-group/system.js';
import { ModelComponentSystem } from './components/model/system.js';
import { ParticleSystemComponentSystem } from './components/particle-system/system.js';
import { RenderComponentSystem } from './components/render/system.js';
import { RigidBodyComponentSystem } from './components/rigid-body/system.js';
import { ScreenComponentSystem } from './components/screen/system.js';
import { ScriptLegacyComponentSystem } from './components/script-legacy/system.js';
import { ScrollViewComponentSystem } from './components/scroll-view/system.js';
import { ScrollbarComponentSystem } from './components/scrollbar/system.js';
import { SoundComponentSystem } from './components/sound/system.js';
import { SpriteComponentSystem } from './components/sprite/system.js';
import { ZoneComponentSystem } from './components/zone/system.js';
import { CameraComponentSystem } from './components/camera/system.js';
import { LightComponentSystem } from './components/light/system.js';
import { ScriptComponentSystem } from './components/script/system.js';
import { RenderHandler } from '../resources/render.js';
import { AnimationHandler } from '../resources/animation.js';
import { AnimClipHandler } from '../resources/anim-clip.js';
import { AnimStateGraphHandler } from '../resources/anim-state-graph.js';
import { AudioHandler } from '../resources/audio.js';
import { BinaryHandler } from '../resources/binary.js';
import { ContainerHandler } from '../resources/container.js';
import { CssHandler } from '../resources/css.js';
import { CubemapHandler } from '../resources/cubemap.js';
import { FolderHandler } from '../resources/folder.js';
import { FontHandler } from '../resources/font.js';
import { HierarchyHandler } from '../resources/hierarchy.js';
import { HtmlHandler } from '../resources/html.js';
import { JsonHandler } from '../resources/json.js';
import { MaterialHandler } from '../resources/material.js';
import { ModelHandler } from '../resources/model.js';
import { SceneHandler } from '../resources/scene.js';
import { ScriptHandler } from '../resources/script.js';
import { ShaderHandler } from '../resources/shader.js';
import { SpriteHandler } from '../resources/sprite.js';
import { TemplateHandler } from '../resources/template.js';
import { TextHandler } from '../resources/text.js';
import { TextureAtlasHandler } from '../resources/texture-atlas.js';
import { TextureHandler } from '../resources/texture.js';
import { XrManager } from '../xr/xr-manager.js';

class Application extends AppBase {
  constructor(canvas, options = {}) {
    super(canvas);
    const appOptions = new AppOptions();
    appOptions.graphicsDevice = this.createDevice(canvas, options);
    this.addComponentSystems(appOptions);
    this.addResourceHandles(appOptions);
    appOptions.elementInput = options.elementInput;
    appOptions.keyboard = options.keyboard;
    appOptions.mouse = options.mouse;
    appOptions.touch = options.touch;
    appOptions.gamepads = options.gamepads;
    appOptions.scriptPrefix = options.scriptPrefix;
    appOptions.assetPrefix = options.assetPrefix;
    appOptions.scriptsOrder = options.scriptsOrder;
    appOptions.soundManager = new SoundManager(options);
    appOptions.lightmapper = Lightmapper;
    appOptions.batchManager = BatchManager;
    appOptions.xr = XrManager;
    this.init(appOptions);
  }

  createDevice(canvas, options) {
    if (!options.graphicsDeviceOptions) {
      options.graphicsDeviceOptions = {};
    }

    if (platform.browser && !!navigator.xr) {
      options.graphicsDeviceOptions.xrCompatible = true;
    }

    options.graphicsDeviceOptions.alpha = options.graphicsDeviceOptions.alpha || false;
    return new WebglGraphicsDevice(canvas, options.graphicsDeviceOptions);
  }

  addComponentSystems(appOptions) {
    appOptions.componentSystems = [RigidBodyComponentSystem, CollisionComponentSystem, JointComponentSystem, AnimationComponentSystem, AnimComponentSystem, ModelComponentSystem, RenderComponentSystem, CameraComponentSystem, LightComponentSystem, script.legacy ? ScriptLegacyComponentSystem : ScriptComponentSystem, AudioSourceComponentSystem, SoundComponentSystem, AudioListenerComponentSystem, ParticleSystemComponentSystem, ScreenComponentSystem, ElementComponentSystem, ButtonComponentSystem, ScrollViewComponentSystem, ScrollbarComponentSystem, SpriteComponentSystem, LayoutGroupComponentSystem, LayoutChildComponentSystem, ZoneComponentSystem];
  }

  addResourceHandles(appOptions) {
    appOptions.resourceHandlers = [RenderHandler, AnimationHandler, AnimClipHandler, AnimStateGraphHandler, ModelHandler, MaterialHandler, TextureHandler, TextHandler, JsonHandler, AudioHandler, ScriptHandler, SceneHandler, CubemapHandler, HtmlHandler, CssHandler, ShaderHandler, HierarchyHandler, FolderHandler, FontHandler, BinaryHandler, TextureAtlasHandler, SpriteHandler, TemplateHandler, ContainerHandler];
  }

}

export { Application };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwbGljYXRpb24uanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvYXBwbGljYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGxhdGZvcm0gfSBmcm9tICcuLi9jb3JlL3BsYXRmb3JtLmpzJztcblxuaW1wb3J0IHsgV2ViZ2xHcmFwaGljc0RldmljZSB9IGZyb20gJy4uL2dyYXBoaWNzL3dlYmdsL3dlYmdsLWdyYXBoaWNzLWRldmljZS5qcyc7XG5cbmltcG9ydCB7IFNvdW5kTWFuYWdlciB9IGZyb20gJy4uL3NvdW5kL21hbmFnZXIuanMnO1xuXG5pbXBvcnQgeyBMaWdodG1hcHBlciB9IGZyb20gJy4uL3NjZW5lL2xpZ2h0bWFwcGVyL2xpZ2h0bWFwcGVyLmpzJztcbmltcG9ydCB7IEJhdGNoTWFuYWdlciB9IGZyb20gJy4uL3NjZW5lL2JhdGNoaW5nL2JhdGNoLW1hbmFnZXIuanMnO1xuXG5pbXBvcnQgeyBBcHBCYXNlIH0gZnJvbSAnLi9hcHAtYmFzZS5qcyc7XG5pbXBvcnQgeyBBcHBPcHRpb25zIH0gZnJvbSAnLi9hcHAtb3B0aW9ucy5qcyc7XG5pbXBvcnQgeyBzY3JpcHQgfSBmcm9tICcuL3NjcmlwdC5qcyc7XG5pbXBvcnQgeyBBbmltYXRpb25Db21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvYW5pbWF0aW9uL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBBbmltQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2FuaW0vc3lzdGVtLmpzJztcbmltcG9ydCB7IEF1ZGlvTGlzdGVuZXJDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvYXVkaW8tbGlzdGVuZXIvc3lzdGVtLmpzJztcbmltcG9ydCB7IEF1ZGlvU291cmNlQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2F1ZGlvLXNvdXJjZS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgQnV0dG9uQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2J1dHRvbi9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgQ29sbGlzaW9uQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2NvbGxpc2lvbi9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgRWxlbWVudENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9lbGVtZW50L3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBKb2ludENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9qb2ludC9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgTGF5b3V0Q2hpbGRDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvbGF5b3V0LWNoaWxkL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBMYXlvdXRHcm91cENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9sYXlvdXQtZ3JvdXAvc3lzdGVtLmpzJztcbmltcG9ydCB7IE1vZGVsQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL21vZGVsL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9wYXJ0aWNsZS1zeXN0ZW0vc3lzdGVtLmpzJztcbmltcG9ydCB7IFJlbmRlckNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9yZW5kZXIvc3lzdGVtLmpzJztcbmltcG9ydCB7IFJpZ2lkQm9keUNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9yaWdpZC1ib2R5L3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBTY3JlZW5Db21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvc2NyZWVuL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBTY3JpcHRMZWdhY3lDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvc2NyaXB0LWxlZ2FjeS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgU2Nyb2xsVmlld0NvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9zY3JvbGwtdmlldy9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgU2Nyb2xsYmFyQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3Njcm9sbGJhci9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgU291bmRDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvc291bmQvc3lzdGVtLmpzJztcbmltcG9ydCB7IFNwcml0ZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9zcHJpdGUvc3lzdGVtLmpzJztcbmltcG9ydCB7IFpvbmVDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvem9uZS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgQ2FtZXJhQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2NhbWVyYS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgTGlnaHRDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvbGlnaHQvc3lzdGVtLmpzJztcbmltcG9ydCB7IFNjcmlwdENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9zY3JpcHQvc3lzdGVtLmpzJztcblxuaW1wb3J0IHsgUmVuZGVySGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9yZW5kZXIuanMnO1xuaW1wb3J0IHsgQW5pbWF0aW9uSGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9hbmltYXRpb24uanMnO1xuaW1wb3J0IHsgQW5pbUNsaXBIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL2FuaW0tY2xpcC5qcyc7XG5pbXBvcnQgeyBBbmltU3RhdGVHcmFwaEhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvYW5pbS1zdGF0ZS1ncmFwaC5qcyc7XG5pbXBvcnQgeyBBdWRpb0hhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvYXVkaW8uanMnO1xuaW1wb3J0IHsgQmluYXJ5SGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9iaW5hcnkuanMnO1xuaW1wb3J0IHsgQ29udGFpbmVySGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9jb250YWluZXIuanMnO1xuaW1wb3J0IHsgQ3NzSGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9jc3MuanMnO1xuaW1wb3J0IHsgQ3ViZW1hcEhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvY3ViZW1hcC5qcyc7XG5pbXBvcnQgeyBGb2xkZXJIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL2ZvbGRlci5qcyc7XG5pbXBvcnQgeyBGb250SGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9mb250LmpzJztcbmltcG9ydCB7IEhpZXJhcmNoeUhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvaGllcmFyY2h5LmpzJztcbmltcG9ydCB7IEh0bWxIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL2h0bWwuanMnO1xuaW1wb3J0IHsgSnNvbkhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvanNvbi5qcyc7XG5pbXBvcnQgeyBNYXRlcmlhbEhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvbWF0ZXJpYWwuanMnO1xuaW1wb3J0IHsgTW9kZWxIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL21vZGVsLmpzJztcbmltcG9ydCB7IFNjZW5lSGFuZGxlciB9IGZyb20gJy4uL3Jlc291cmNlcy9zY2VuZS5qcyc7XG5pbXBvcnQgeyBTY3JpcHRIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL3NjcmlwdC5qcyc7XG5pbXBvcnQgeyBTaGFkZXJIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL3NoYWRlci5qcyc7XG5pbXBvcnQgeyBTcHJpdGVIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL3Nwcml0ZS5qcyc7XG5pbXBvcnQgeyBUZW1wbGF0ZUhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvdGVtcGxhdGUuanMnO1xuaW1wb3J0IHsgVGV4dEhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvdGV4dC5qcyc7XG5pbXBvcnQgeyBUZXh0dXJlQXRsYXNIYW5kbGVyIH0gZnJvbSAnLi4vcmVzb3VyY2VzL3RleHR1cmUtYXRsYXMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZUhhbmRsZXIgfSBmcm9tICcuLi9yZXNvdXJjZXMvdGV4dHVyZS5qcyc7XG5cbmltcG9ydCB7IFhyTWFuYWdlciB9IGZyb20gJy4uL3hyL3hyLW1hbmFnZXIuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vaW5wdXQvZWxlbWVudC1pbnB1dC5qcycpLkVsZW1lbnRJbnB1dH0gRWxlbWVudElucHV0ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vaW5wdXQvZ2FtZS1wYWRzLmpzJykuR2FtZVBhZHN9IEdhbWVQYWRzICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vaW5wdXQva2V5Ym9hcmQuanMnKS5LZXlib2FyZH0gS2V5Ym9hcmQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi9pbnB1dC9tb3VzZS5qcycpLk1vdXNlfSBNb3VzZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL2lucHV0L3RvdWNoLWRldmljZS5qcycpLlRvdWNoRGV2aWNlfSBUb3VjaERldmljZSAqL1xuXG4vKipcbiAqIEFuIEFwcGxpY2F0aW9uIHJlcHJlc2VudHMgYW5kIG1hbmFnZXMgeW91ciBQbGF5Q2FudmFzIGFwcGxpY2F0aW9uLiBJZiB5b3UgYXJlIGRldmVsb3BpbmcgdXNpbmdcbiAqIHRoZSBQbGF5Q2FudmFzIEVkaXRvciwgdGhlIEFwcGxpY2F0aW9uIGlzIGNyZWF0ZWQgZm9yIHlvdS4gWW91IGNhbiBhY2Nlc3MgeW91ciBBcHBsaWNhdGlvblxuICogaW5zdGFuY2UgaW4geW91ciBzY3JpcHRzLiBCZWxvdyBpcyBhIHNrZWxldG9uIHNjcmlwdCB3aGljaCBzaG93cyBob3cgeW91IGNhbiBhY2Nlc3MgdGhlXG4gKiBhcHBsaWNhdGlvbiAnYXBwJyBwcm9wZXJ0eSBpbnNpZGUgdGhlIGluaXRpYWxpemUgYW5kIHVwZGF0ZSBmdW5jdGlvbnM6XG4gKlxuICogYGBgamF2YXNjcmlwdFxuICogLy8gRWRpdG9yIGV4YW1wbGU6IGFjY2Vzc2luZyB0aGUgcGMuQXBwbGljYXRpb24gZnJvbSBhIHNjcmlwdFxuICogdmFyIE15U2NyaXB0ID0gcGMuY3JlYXRlU2NyaXB0KCdteVNjcmlwdCcpO1xuICpcbiAqIE15U2NyaXB0LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gKiAgICAgLy8gRXZlcnkgc2NyaXB0IGluc3RhbmNlIGhhcyBhIHByb3BlcnR5ICd0aGlzLmFwcCcgYWNjZXNzaWJsZSBpbiB0aGUgaW5pdGlhbGl6ZS4uLlxuICogICAgIHZhciBhcHAgPSB0aGlzLmFwcDtcbiAqIH07XG4gKlxuICogTXlTY3JpcHQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKGR0KSB7XG4gKiAgICAgLy8gLi4uYW5kIHVwZGF0ZSBmdW5jdGlvbnMuXG4gKiAgICAgdmFyIGFwcCA9IHRoaXMuYXBwO1xuICogfTtcbiAqIGBgYFxuICpcbiAqIElmIHlvdSBhcmUgdXNpbmcgdGhlIEVuZ2luZSB3aXRob3V0IHRoZSBFZGl0b3IsIHlvdSBoYXZlIHRvIGNyZWF0ZSB0aGUgYXBwbGljYXRpb24gaW5zdGFuY2VcbiAqIG1hbnVhbGx5LlxuICpcbiAqIEBhdWdtZW50cyBBcHBCYXNlXG4gKi9cbmNsYXNzIEFwcGxpY2F0aW9uIGV4dGVuZHMgQXBwQmFzZSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEFwcGxpY2F0aW9uIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBjYW52YXMgLSBUaGUgY2FudmFzIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIFRoZSBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgdGhlIEFwcGxpY2F0aW9uLlxuICAgICAqIEBwYXJhbSB7RWxlbWVudElucHV0fSBbb3B0aW9ucy5lbGVtZW50SW5wdXRdIC0gSW5wdXQgaGFuZGxlciBmb3Ige0BsaW5rIEVsZW1lbnRDb21wb25lbnR9cy5cbiAgICAgKiBAcGFyYW0ge0tleWJvYXJkfSBbb3B0aW9ucy5rZXlib2FyZF0gLSBLZXlib2FyZCBoYW5kbGVyIGZvciBpbnB1dC5cbiAgICAgKiBAcGFyYW0ge01vdXNlfSBbb3B0aW9ucy5tb3VzZV0gLSBNb3VzZSBoYW5kbGVyIGZvciBpbnB1dC5cbiAgICAgKiBAcGFyYW0ge1RvdWNoRGV2aWNlfSBbb3B0aW9ucy50b3VjaF0gLSBUb3VjaERldmljZSBoYW5kbGVyIGZvciBpbnB1dC5cbiAgICAgKiBAcGFyYW0ge0dhbWVQYWRzfSBbb3B0aW9ucy5nYW1lcGFkc10gLSBHYW1lcGFkIGhhbmRsZXIgZm9yIGlucHV0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5zY3JpcHRQcmVmaXhdIC0gUHJlZml4IHRvIGFwcGx5IHRvIHNjcmlwdCB1cmxzIGJlZm9yZSBsb2FkaW5nLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5hc3NldFByZWZpeF0gLSBQcmVmaXggdG8gYXBwbHkgdG8gYXNzZXQgdXJscyBiZWZvcmUgbG9hZGluZy5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnMuZ3JhcGhpY3NEZXZpY2VPcHRpb25zXSAtIE9wdGlvbnMgb2JqZWN0IHRoYXQgaXMgcGFzc2VkIGludG8gdGhlXG4gICAgICoge0BsaW5rIEdyYXBoaWNzRGV2aWNlfSBjb25zdHJ1Y3Rvci5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBbb3B0aW9ucy5zY3JpcHRzT3JkZXJdIC0gU2NyaXB0cyBpbiBvcmRlciBvZiBsb2FkaW5nIGZpcnN0LlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gRW5naW5lLW9ubHkgZXhhbXBsZTogY3JlYXRlIHRoZSBhcHBsaWNhdGlvbiBtYW51YWxseVxuICAgICAqIHZhciBhcHAgPSBuZXcgcGMuQXBwbGljYXRpb24oY2FudmFzLCBvcHRpb25zKTtcbiAgICAgKlxuICAgICAqIC8vIFN0YXJ0IHRoZSBhcHBsaWNhdGlvbidzIG1haW4gbG9vcFxuICAgICAqIGFwcC5zdGFydCgpO1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhcywgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHN1cGVyKGNhbnZhcyk7XG5cbiAgICAgICAgY29uc3QgYXBwT3B0aW9ucyA9IG5ldyBBcHBPcHRpb25zKCk7XG5cbiAgICAgICAgYXBwT3B0aW9ucy5ncmFwaGljc0RldmljZSA9IHRoaXMuY3JlYXRlRGV2aWNlKGNhbnZhcywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuYWRkQ29tcG9uZW50U3lzdGVtcyhhcHBPcHRpb25zKTtcbiAgICAgICAgdGhpcy5hZGRSZXNvdXJjZUhhbmRsZXMoYXBwT3B0aW9ucyk7XG5cbiAgICAgICAgYXBwT3B0aW9ucy5lbGVtZW50SW5wdXQgPSBvcHRpb25zLmVsZW1lbnRJbnB1dDtcbiAgICAgICAgYXBwT3B0aW9ucy5rZXlib2FyZCA9IG9wdGlvbnMua2V5Ym9hcmQ7XG4gICAgICAgIGFwcE9wdGlvbnMubW91c2UgPSBvcHRpb25zLm1vdXNlO1xuICAgICAgICBhcHBPcHRpb25zLnRvdWNoID0gb3B0aW9ucy50b3VjaDtcbiAgICAgICAgYXBwT3B0aW9ucy5nYW1lcGFkcyA9IG9wdGlvbnMuZ2FtZXBhZHM7XG5cbiAgICAgICAgYXBwT3B0aW9ucy5zY3JpcHRQcmVmaXggPSBvcHRpb25zLnNjcmlwdFByZWZpeDtcbiAgICAgICAgYXBwT3B0aW9ucy5hc3NldFByZWZpeCA9IG9wdGlvbnMuYXNzZXRQcmVmaXg7XG4gICAgICAgIGFwcE9wdGlvbnMuc2NyaXB0c09yZGVyID0gb3B0aW9ucy5zY3JpcHRzT3JkZXI7XG5cbiAgICAgICAgYXBwT3B0aW9ucy5zb3VuZE1hbmFnZXIgPSBuZXcgU291bmRNYW5hZ2VyKG9wdGlvbnMpO1xuICAgICAgICBhcHBPcHRpb25zLmxpZ2h0bWFwcGVyID0gTGlnaHRtYXBwZXI7XG4gICAgICAgIGFwcE9wdGlvbnMuYmF0Y2hNYW5hZ2VyID0gQmF0Y2hNYW5hZ2VyO1xuICAgICAgICBhcHBPcHRpb25zLnhyID0gWHJNYW5hZ2VyO1xuXG4gICAgICAgIHRoaXMuaW5pdChhcHBPcHRpb25zKTtcbiAgICB9XG5cbiAgICBjcmVhdGVEZXZpY2UoY2FudmFzLCBvcHRpb25zKSB7XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9ucykge1xuICAgICAgICAgICAgb3B0aW9ucy5ncmFwaGljc0RldmljZU9wdGlvbnMgPSB7IH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBsYXRmb3JtLmJyb3dzZXIgJiYgISFuYXZpZ2F0b3IueHIpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuZ3JhcGhpY3NEZXZpY2VPcHRpb25zLnhyQ29tcGF0aWJsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9ucy5ncmFwaGljc0RldmljZU9wdGlvbnMuYWxwaGEgPSBvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9ucy5hbHBoYSB8fCBmYWxzZTtcblxuICAgICAgICByZXR1cm4gbmV3IFdlYmdsR3JhcGhpY3NEZXZpY2UoY2FudmFzLCBvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9ucyk7XG4gICAgfVxuXG4gICAgYWRkQ29tcG9uZW50U3lzdGVtcyhhcHBPcHRpb25zKSB7XG4gICAgICAgIGFwcE9wdGlvbnMuY29tcG9uZW50U3lzdGVtcyA9IFtcbiAgICAgICAgICAgIFJpZ2lkQm9keUNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIENvbGxpc2lvbkNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIEpvaW50Q29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQW5pbWF0aW9uQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQW5pbUNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIE1vZGVsQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgUmVuZGVyQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQ2FtZXJhQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgTGlnaHRDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBzY3JpcHQubGVnYWN5ID8gU2NyaXB0TGVnYWN5Q29tcG9uZW50U3lzdGVtIDogU2NyaXB0Q29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQXVkaW9Tb3VyY2VDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBTb3VuZENvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIEF1ZGlvTGlzdGVuZXJDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIFNjcmVlbkNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIEVsZW1lbnRDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBCdXR0b25Db21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBTY3JvbGxWaWV3Q29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgU2Nyb2xsYmFyQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgU3ByaXRlQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgTGF5b3V0R3JvdXBDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBMYXlvdXRDaGlsZENvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIFpvbmVDb21wb25lbnRTeXN0ZW1cbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBhZGRSZXNvdXJjZUhhbmRsZXMoYXBwT3B0aW9ucykge1xuICAgICAgICBhcHBPcHRpb25zLnJlc291cmNlSGFuZGxlcnMgPSBbXG4gICAgICAgICAgICBSZW5kZXJIYW5kbGVyLFxuICAgICAgICAgICAgQW5pbWF0aW9uSGFuZGxlcixcbiAgICAgICAgICAgIEFuaW1DbGlwSGFuZGxlcixcbiAgICAgICAgICAgIEFuaW1TdGF0ZUdyYXBoSGFuZGxlcixcbiAgICAgICAgICAgIE1vZGVsSGFuZGxlcixcbiAgICAgICAgICAgIE1hdGVyaWFsSGFuZGxlcixcbiAgICAgICAgICAgIFRleHR1cmVIYW5kbGVyLFxuICAgICAgICAgICAgVGV4dEhhbmRsZXIsXG4gICAgICAgICAgICBKc29uSGFuZGxlcixcbiAgICAgICAgICAgIEF1ZGlvSGFuZGxlcixcbiAgICAgICAgICAgIFNjcmlwdEhhbmRsZXIsXG4gICAgICAgICAgICBTY2VuZUhhbmRsZXIsXG4gICAgICAgICAgICBDdWJlbWFwSGFuZGxlcixcbiAgICAgICAgICAgIEh0bWxIYW5kbGVyLFxuICAgICAgICAgICAgQ3NzSGFuZGxlcixcbiAgICAgICAgICAgIFNoYWRlckhhbmRsZXIsXG4gICAgICAgICAgICBIaWVyYXJjaHlIYW5kbGVyLFxuICAgICAgICAgICAgRm9sZGVySGFuZGxlcixcbiAgICAgICAgICAgIEZvbnRIYW5kbGVyLFxuICAgICAgICAgICAgQmluYXJ5SGFuZGxlcixcbiAgICAgICAgICAgIFRleHR1cmVBdGxhc0hhbmRsZXIsXG4gICAgICAgICAgICBTcHJpdGVIYW5kbGVyLFxuICAgICAgICAgICAgVGVtcGxhdGVIYW5kbGVyLFxuICAgICAgICAgICAgQ29udGFpbmVySGFuZGxlclxuICAgICAgICBdO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQXBwbGljYXRpb24gfTtcbiJdLCJuYW1lcyI6WyJBcHBsaWNhdGlvbiIsIkFwcEJhc2UiLCJjb25zdHJ1Y3RvciIsImNhbnZhcyIsIm9wdGlvbnMiLCJhcHBPcHRpb25zIiwiQXBwT3B0aW9ucyIsImdyYXBoaWNzRGV2aWNlIiwiY3JlYXRlRGV2aWNlIiwiYWRkQ29tcG9uZW50U3lzdGVtcyIsImFkZFJlc291cmNlSGFuZGxlcyIsImVsZW1lbnRJbnB1dCIsImtleWJvYXJkIiwibW91c2UiLCJ0b3VjaCIsImdhbWVwYWRzIiwic2NyaXB0UHJlZml4IiwiYXNzZXRQcmVmaXgiLCJzY3JpcHRzT3JkZXIiLCJzb3VuZE1hbmFnZXIiLCJTb3VuZE1hbmFnZXIiLCJsaWdodG1hcHBlciIsIkxpZ2h0bWFwcGVyIiwiYmF0Y2hNYW5hZ2VyIiwiQmF0Y2hNYW5hZ2VyIiwieHIiLCJYck1hbmFnZXIiLCJpbml0IiwiZ3JhcGhpY3NEZXZpY2VPcHRpb25zIiwicGxhdGZvcm0iLCJicm93c2VyIiwibmF2aWdhdG9yIiwieHJDb21wYXRpYmxlIiwiYWxwaGEiLCJXZWJnbEdyYXBoaWNzRGV2aWNlIiwiY29tcG9uZW50U3lzdGVtcyIsIlJpZ2lkQm9keUNvbXBvbmVudFN5c3RlbSIsIkNvbGxpc2lvbkNvbXBvbmVudFN5c3RlbSIsIkpvaW50Q29tcG9uZW50U3lzdGVtIiwiQW5pbWF0aW9uQ29tcG9uZW50U3lzdGVtIiwiQW5pbUNvbXBvbmVudFN5c3RlbSIsIk1vZGVsQ29tcG9uZW50U3lzdGVtIiwiUmVuZGVyQ29tcG9uZW50U3lzdGVtIiwiQ2FtZXJhQ29tcG9uZW50U3lzdGVtIiwiTGlnaHRDb21wb25lbnRTeXN0ZW0iLCJzY3JpcHQiLCJsZWdhY3kiLCJTY3JpcHRMZWdhY3lDb21wb25lbnRTeXN0ZW0iLCJTY3JpcHRDb21wb25lbnRTeXN0ZW0iLCJBdWRpb1NvdXJjZUNvbXBvbmVudFN5c3RlbSIsIlNvdW5kQ29tcG9uZW50U3lzdGVtIiwiQXVkaW9MaXN0ZW5lckNvbXBvbmVudFN5c3RlbSIsIlBhcnRpY2xlU3lzdGVtQ29tcG9uZW50U3lzdGVtIiwiU2NyZWVuQ29tcG9uZW50U3lzdGVtIiwiRWxlbWVudENvbXBvbmVudFN5c3RlbSIsIkJ1dHRvbkNvbXBvbmVudFN5c3RlbSIsIlNjcm9sbFZpZXdDb21wb25lbnRTeXN0ZW0iLCJTY3JvbGxiYXJDb21wb25lbnRTeXN0ZW0iLCJTcHJpdGVDb21wb25lbnRTeXN0ZW0iLCJMYXlvdXRHcm91cENvbXBvbmVudFN5c3RlbSIsIkxheW91dENoaWxkQ29tcG9uZW50U3lzdGVtIiwiWm9uZUNvbXBvbmVudFN5c3RlbSIsInJlc291cmNlSGFuZGxlcnMiLCJSZW5kZXJIYW5kbGVyIiwiQW5pbWF0aW9uSGFuZGxlciIsIkFuaW1DbGlwSGFuZGxlciIsIkFuaW1TdGF0ZUdyYXBoSGFuZGxlciIsIk1vZGVsSGFuZGxlciIsIk1hdGVyaWFsSGFuZGxlciIsIlRleHR1cmVIYW5kbGVyIiwiVGV4dEhhbmRsZXIiLCJKc29uSGFuZGxlciIsIkF1ZGlvSGFuZGxlciIsIlNjcmlwdEhhbmRsZXIiLCJTY2VuZUhhbmRsZXIiLCJDdWJlbWFwSGFuZGxlciIsIkh0bWxIYW5kbGVyIiwiQ3NzSGFuZGxlciIsIlNoYWRlckhhbmRsZXIiLCJIaWVyYXJjaHlIYW5kbGVyIiwiRm9sZGVySGFuZGxlciIsIkZvbnRIYW5kbGVyIiwiQmluYXJ5SGFuZGxlciIsIlRleHR1cmVBdGxhc0hhbmRsZXIiLCJTcHJpdGVIYW5kbGVyIiwiVGVtcGxhdGVIYW5kbGVyIiwiQ29udGFpbmVySGFuZGxlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZ0dBLE1BQU1BLFdBQU4sU0FBMEJDLE9BQTFCLENBQWtDO0FBdUI5QkMsRUFBQUEsV0FBVyxDQUFDQyxNQUFELEVBQVNDLE9BQU8sR0FBRyxFQUFuQixFQUF1QjtBQUM5QixJQUFBLEtBQUEsQ0FBTUQsTUFBTixDQUFBLENBQUE7QUFFQSxJQUFBLE1BQU1FLFVBQVUsR0FBRyxJQUFJQyxVQUFKLEVBQW5CLENBQUE7SUFFQUQsVUFBVSxDQUFDRSxjQUFYLEdBQTRCLElBQUEsQ0FBS0MsWUFBTCxDQUFrQkwsTUFBbEIsRUFBMEJDLE9BQTFCLENBQTVCLENBQUE7SUFDQSxJQUFLSyxDQUFBQSxtQkFBTCxDQUF5QkosVUFBekIsQ0FBQSxDQUFBO0lBQ0EsSUFBS0ssQ0FBQUEsa0JBQUwsQ0FBd0JMLFVBQXhCLENBQUEsQ0FBQTtBQUVBQSxJQUFBQSxVQUFVLENBQUNNLFlBQVgsR0FBMEJQLE9BQU8sQ0FBQ08sWUFBbEMsQ0FBQTtBQUNB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
