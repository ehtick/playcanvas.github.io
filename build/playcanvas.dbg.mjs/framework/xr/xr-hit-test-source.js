import { EventHandler } from '../../core/event-handler.js';
import { Quat } from '../../core/math/quat.js';
import { Vec3 } from '../../core/math/vec3.js';

/**
 * @type {Vec3[]}
 * @ignore
 */
const poolVec3 = [];

/**
 * @type {Quat[]}
 * @ignore
 */
const poolQuat = [];

/**
 * Represents XR hit test source, which provides access to hit results of real world geometry from
 * AR session.
 *
 * @augments EventHandler
 */
class XrHitTestSource extends EventHandler {
  /**
   * Create a new XrHitTestSource instance.
   *
   * @param {import('./xr-manager.js').XrManager} manager - WebXR Manager.
   * @param {*} xrHitTestSource - XRHitTestSource object that is created by WebXR API.
   * @param {boolean} transient - True if XRHitTestSource created for input source profile.
   * @hideconstructor
   */
  constructor(manager, xrHitTestSource, transient) {
    super();
    /**
     * @type {import('./xr-manager.js').XrManager}
     * @private
     */
    this.manager = void 0;
    /**
     * @type {XRHitTestSource}
     * @private
     */
    this._xrHitTestSource = void 0;
    /**
     * @type {boolean}
     * @private
     */
    this._transient = void 0;
    this.manager = manager;
    this._xrHitTestSource = xrHitTestSource;
    this._transient = transient;
  }

  /**
   * Fired when {@link XrHitTestSource} is removed.
   *
   * @event XrHitTestSource#remove
   * @example
   * hitTestSource.once('remove', function () {
   *     // hit test source has been removed
   * });
   */

  /**
   * Fired when hit test source receives new results. It provides transform information that
   * tries to match real world picked geometry.
   *
   * @event XrHitTestSource#result
   * @param {Vec3} position - Position of hit test.
   * @param {Quat} rotation - Rotation of hit test.
   * @param {import('./xr-input-source.js').XrInputSource|null} inputSource - If is transient hit
   * test source, then it will provide related input source.
   * @example
   * hitTestSource.on('result', function (position, rotation, inputSource) {
   *     target.setPosition(position);
   *     target.setRotation(rotation);
   * });
   */

  /**
   * Stop and remove hit test source.
   */
  remove() {
    if (!this._xrHitTestSource) return;
    const sources = this.manager.hitTest.sources;
    const ind = sources.indexOf(this);
    if (ind !== -1) sources.splice(ind, 1);
    this.onStop();
  }

  /** @ignore */
  onStop() {
    this._xrHitTestSource.cancel();
    this._xrHitTestSource = null;
    this.fire('remove');
    this.manager.hitTest.fire('remove', this);
  }

  /**
   * @param {*} frame - XRFrame from requestAnimationFrame callback.
   * @ignore
   */
  update(frame) {
    if (this._transient) {
      const transientResults = frame.getHitTestResultsForTransientInput(this._xrHitTestSource);
      for (let i = 0; i < transientResults.length; i++) {
        const transientResult = transientResults[i];
        let inputSource;
        if (transientResult.inputSource) inputSource = this.manager.input._getByInputSource(transientResult.inputSource);
        this.updateHitResults(transientResult.results, inputSource);
      }
    } else {
      this.updateHitResults(frame.getHitTestResults(this._xrHitTestSource));
    }
  }

  /**
   * @param {XRTransientInputHitTestResult[]} results - Hit test results.
   * @param {XRHitTestSource} inputSource - Input source.
   * @private
   */
  updateHitResults(results, inputSource) {
    for (let i = 0; i < results.length; i++) {
      const pose = results[i].getPose(this.manager._referenceSpace);
      let position = poolVec3.pop();
      if (!position) position = new Vec3();
      position.copy(pose.transform.position);
      let rotation = poolQuat.pop();
      if (!rotation) rotation = new Quat();
      rotation.copy(pose.transform.orientation);
      this.fire('result', position, rotation, inputSource);
      this.manager.hitTest.fire('result', this, position, rotation, inputSource);
      poolVec3.push(position);
      poolQuat.push(rotation);
    }
  }
}

export { XrHitTestSource };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHItaGl0LXRlc3Qtc291cmNlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL3hyL3hyLWhpdC10ZXN0LXNvdXJjZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tICcuLi8uLi9jb3JlL2V2ZW50LWhhbmRsZXIuanMnO1xuaW1wb3J0IHsgUXVhdCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9xdWF0LmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjMy5qcyc7XG5cbi8qKlxuICogQHR5cGUge1ZlYzNbXX1cbiAqIEBpZ25vcmVcbiAqL1xuY29uc3QgcG9vbFZlYzMgPSBbXTtcblxuLyoqXG4gKiBAdHlwZSB7UXVhdFtdfVxuICogQGlnbm9yZVxuICovXG5jb25zdCBwb29sUXVhdCA9IFtdO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgWFIgaGl0IHRlc3Qgc291cmNlLCB3aGljaCBwcm92aWRlcyBhY2Nlc3MgdG8gaGl0IHJlc3VsdHMgb2YgcmVhbCB3b3JsZCBnZW9tZXRyeSBmcm9tXG4gKiBBUiBzZXNzaW9uLlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgWHJIaXRUZXN0U291cmNlIGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7aW1wb3J0KCcuL3hyLW1hbmFnZXIuanMnKS5Yck1hbmFnZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBtYW5hZ2VyO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1hSSGl0VGVzdFNvdXJjZX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF94ckhpdFRlc3RTb3VyY2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF90cmFuc2llbnQ7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgWHJIaXRUZXN0U291cmNlIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4veHItbWFuYWdlci5qcycpLlhyTWFuYWdlcn0gbWFuYWdlciAtIFdlYlhSIE1hbmFnZXIuXG4gICAgICogQHBhcmFtIHsqfSB4ckhpdFRlc3RTb3VyY2UgLSBYUkhpdFRlc3RTb3VyY2Ugb2JqZWN0IHRoYXQgaXMgY3JlYXRlZCBieSBXZWJYUiBBUEkuXG4gICAgICogQHBhcmFtIHtib29sZWFufSB0cmFuc2llbnQgLSBUcnVlIGlmIFhSSGl0VGVzdFNvdXJjZSBjcmVhdGVkIGZvciBpbnB1dCBzb3VyY2UgcHJvZmlsZS5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobWFuYWdlciwgeHJIaXRUZXN0U291cmNlLCB0cmFuc2llbnQpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xuICAgICAgICB0aGlzLl94ckhpdFRlc3RTb3VyY2UgPSB4ckhpdFRlc3RTb3VyY2U7XG4gICAgICAgIHRoaXMuX3RyYW5zaWVudCA9IHRyYW5zaWVudDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHtAbGluayBYckhpdFRlc3RTb3VyY2V9IGlzIHJlbW92ZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgWHJIaXRUZXN0U291cmNlI3JlbW92ZVxuICAgICAqIEBleGFtcGxlXG4gICAgICogaGl0VGVzdFNvdXJjZS5vbmNlKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICogICAgIC8vIGhpdCB0ZXN0IHNvdXJjZSBoYXMgYmVlbiByZW1vdmVkXG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGhpdCB0ZXN0IHNvdXJjZSByZWNlaXZlcyBuZXcgcmVzdWx0cy4gSXQgcHJvdmlkZXMgdHJhbnNmb3JtIGluZm9ybWF0aW9uIHRoYXRcbiAgICAgKiB0cmllcyB0byBtYXRjaCByZWFsIHdvcmxkIHBpY2tlZCBnZW9tZXRyeS5cbiAgICAgKlxuICAgICAqIEBldmVudCBYckhpdFRlc3RTb3VyY2UjcmVzdWx0XG4gICAgICogQHBhcmFtIHtWZWMzfSBwb3NpdGlvbiAtIFBvc2l0aW9uIG9mIGhpdCB0ZXN0LlxuICAgICAqIEBwYXJhbSB7UXVhdH0gcm90YXRpb24gLSBSb3RhdGlvbiBvZiBoaXQgdGVzdC5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi94ci1pbnB1dC1zb3VyY2UuanMnKS5YcklucHV0U291cmNlfG51bGx9IGlucHV0U291cmNlIC0gSWYgaXMgdHJhbnNpZW50IGhpdFxuICAgICAqIHRlc3Qgc291cmNlLCB0aGVuIGl0IHdpbGwgcHJvdmlkZSByZWxhdGVkIGlucHV0IHNvdXJjZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGhpdFRlc3RTb3VyY2Uub24oJ3Jlc3VsdCcsIGZ1bmN0aW9uIChwb3NpdGlvbiwgcm90YXRpb24sIGlucHV0U291cmNlKSB7XG4gICAgICogICAgIHRhcmdldC5zZXRQb3NpdGlvbihwb3NpdGlvbik7XG4gICAgICogICAgIHRhcmdldC5zZXRSb3RhdGlvbihyb3RhdGlvbik7XG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBTdG9wIGFuZCByZW1vdmUgaGl0IHRlc3Qgc291cmNlLlxuICAgICAqL1xuICAgIHJlbW92ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl94ckhpdFRlc3RTb3VyY2UpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgY29uc3Qgc291cmNlcyA9IHRoaXMubWFuYWdlci5oaXRUZXN0LnNvdXJjZXM7XG4gICAgICAgIGNvbnN0IGluZCA9IHNvdXJjZXMuaW5kZXhPZih0aGlzKTtcbiAgICAgICAgaWYgKGluZCAhPT0gLTEpIHNvdXJjZXMuc3BsaWNlKGluZCwgMSk7XG5cbiAgICAgICAgdGhpcy5vblN0b3AoKTtcbiAgICB9XG5cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIG9uU3RvcCgpIHtcbiAgICAgICAgdGhpcy5feHJIaXRUZXN0U291cmNlLmNhbmNlbCgpO1xuICAgICAgICB0aGlzLl94ckhpdFRlc3RTb3VyY2UgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlJyk7XG4gICAgICAgIHRoaXMubWFuYWdlci5oaXRUZXN0LmZpcmUoJ3JlbW92ZScsIHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Kn0gZnJhbWUgLSBYUkZyYW1lIGZyb20gcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGNhbGxiYWNrLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICB1cGRhdGUoZnJhbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RyYW5zaWVudCkge1xuICAgICAgICAgICAgY29uc3QgdHJhbnNpZW50UmVzdWx0cyA9IGZyYW1lLmdldEhpdFRlc3RSZXN1bHRzRm9yVHJhbnNpZW50SW5wdXQodGhpcy5feHJIaXRUZXN0U291cmNlKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJhbnNpZW50UmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zaWVudFJlc3VsdCA9IHRyYW5zaWVudFJlc3VsdHNbaV07XG4gICAgICAgICAgICAgICAgbGV0IGlucHV0U291cmNlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRyYW5zaWVudFJlc3VsdC5pbnB1dFNvdXJjZSlcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRTb3VyY2UgPSB0aGlzLm1hbmFnZXIuaW5wdXQuX2dldEJ5SW5wdXRTb3VyY2UodHJhbnNpZW50UmVzdWx0LmlucHV0U291cmNlKTtcblxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSGl0UmVzdWx0cyh0cmFuc2llbnRSZXN1bHQucmVzdWx0cywgaW5wdXRTb3VyY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVIaXRSZXN1bHRzKGZyYW1lLmdldEhpdFRlc3RSZXN1bHRzKHRoaXMuX3hySGl0VGVzdFNvdXJjZSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtYUlRyYW5zaWVudElucHV0SGl0VGVzdFJlc3VsdFtdfSByZXN1bHRzIC0gSGl0IHRlc3QgcmVzdWx0cy5cbiAgICAgKiBAcGFyYW0ge1hSSGl0VGVzdFNvdXJjZX0gaW5wdXRTb3VyY2UgLSBJbnB1dCBzb3VyY2UuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB1cGRhdGVIaXRSZXN1bHRzKHJlc3VsdHMsIGlucHV0U291cmNlKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcG9zZSA9IHJlc3VsdHNbaV0uZ2V0UG9zZSh0aGlzLm1hbmFnZXIuX3JlZmVyZW5jZVNwYWNlKTtcblxuICAgICAgICAgICAgbGV0IHBvc2l0aW9uID0gcG9vbFZlYzMucG9wKCk7XG4gICAgICAgICAgICBpZiAoIXBvc2l0aW9uKSBwb3NpdGlvbiA9IG5ldyBWZWMzKCk7XG4gICAgICAgICAgICBwb3NpdGlvbi5jb3B5KHBvc2UudHJhbnNmb3JtLnBvc2l0aW9uKTtcblxuICAgICAgICAgICAgbGV0IHJvdGF0aW9uID0gcG9vbFF1YXQucG9wKCk7XG4gICAgICAgICAgICBpZiAoIXJvdGF0aW9uKSByb3RhdGlvbiA9IG5ldyBRdWF0KCk7XG4gICAgICAgICAgICByb3RhdGlvbi5jb3B5KHBvc2UudHJhbnNmb3JtLm9yaWVudGF0aW9uKTtcblxuICAgICAgICAgICAgdGhpcy5maXJlKCdyZXN1bHQnLCBwb3NpdGlvbiwgcm90YXRpb24sIGlucHV0U291cmNlKTtcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5oaXRUZXN0LmZpcmUoJ3Jlc3VsdCcsIHRoaXMsIHBvc2l0aW9uLCByb3RhdGlvbiwgaW5wdXRTb3VyY2UpO1xuXG4gICAgICAgICAgICBwb29sVmVjMy5wdXNoKHBvc2l0aW9uKTtcbiAgICAgICAgICAgIHBvb2xRdWF0LnB1c2gocm90YXRpb24pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBYckhpdFRlc3RTb3VyY2UgfTtcbiJdLCJuYW1lcyI6WyJwb29sVmVjMyIsInBvb2xRdWF0IiwiWHJIaXRUZXN0U291cmNlIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJtYW5hZ2VyIiwieHJIaXRUZXN0U291cmNlIiwidHJhbnNpZW50IiwiX3hySGl0VGVzdFNvdXJjZSIsIl90cmFuc2llbnQiLCJyZW1vdmUiLCJzb3VyY2VzIiwiaGl0VGVzdCIsImluZCIsImluZGV4T2YiLCJzcGxpY2UiLCJvblN0b3AiLCJjYW5jZWwiLCJmaXJlIiwidXBkYXRlIiwiZnJhbWUiLCJ0cmFuc2llbnRSZXN1bHRzIiwiZ2V0SGl0VGVzdFJlc3VsdHNGb3JUcmFuc2llbnRJbnB1dCIsImkiLCJsZW5ndGgiLCJ0cmFuc2llbnRSZXN1bHQiLCJpbnB1dFNvdXJjZSIsImlucHV0IiwiX2dldEJ5SW5wdXRTb3VyY2UiLCJ1cGRhdGVIaXRSZXN1bHRzIiwicmVzdWx0cyIsImdldEhpdFRlc3RSZXN1bHRzIiwicG9zZSIsImdldFBvc2UiLCJfcmVmZXJlbmNlU3BhY2UiLCJwb3NpdGlvbiIsInBvcCIsIlZlYzMiLCJjb3B5IiwidHJhbnNmb3JtIiwicm90YXRpb24iLCJRdWF0Iiwib3JpZW50YXRpb24iLCJwdXNoIl0sIm1hcHBpbmdzIjoiOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxRQUFRLEdBQUcsRUFBRSxDQUFBOztBQUVuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLFFBQVEsR0FBRyxFQUFFLENBQUE7O0FBRW5CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLGVBQWUsU0FBU0MsWUFBWSxDQUFDO0FBbUJ2QztBQUNKO0FBQ0E7QUFD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
