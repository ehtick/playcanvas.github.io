import { WasmModule } from '../../core/wasm-module.js';
import { ABSOLUTE_URL } from '../asset/constants.js';
import { DracoWorker } from './draco-worker.js';
import { Debug } from '../../core/debug.js';
import { http } from '../../platform/net/http.js';

const downloadMaxRetries = 3;

// JobQueue keeps track of a set of web workers and enqueues jobs
// on them. To keep workload as balanced as possible (but also keep
// workers busy) workers have a maximum of 2 jobs assigned at any
// one time.
class JobQueue {
  constructor() {
    // list of workers with: [[0 jobs], [1 job], [2 jobs]]
    this.workers = [[], [], []];
    this.jobId = 0;
    this.jobQueue = [];
    this.jobCallbacks = new Map();
    this.run = (worker, job) => {
      worker.postMessage({
        type: 'decodeMesh',
        jobId: job.jobId,
        buffer: job.buffer
      }, [job.buffer]);
    };
  }

  // initialize the queue with worker instances
  init(workers) {
    workers.forEach(worker => {
      worker.addEventListener('message', message => {
        const data = message.data;
        const callback = this.jobCallbacks.get(data.jobId);
        if (callback) {
          callback(data.error, {
            indices: data.indices,
            vertices: data.vertices
          });
        }
        this.jobCallbacks.delete(data.jobId);
        if (this.jobQueue.length > 0) {
          const job = this.jobQueue.shift();
          this.run(worker, job);
        } else {
          const index2 = this.workers[2].indexOf(worker);
          if (index2 !== -1) {
            this.workers[2].splice(index2, 1);
            this.workers[1].push(worker);
          } else {
            const index1 = this.workers[1].indexOf(worker);
            if (index1 !== -1) {
              this.workers[1].splice(index1, 1);
              this.workers[0].push(worker);
            } else {
              // logical error
              Debug.error('logical error');
            }
          }
        }
      });
    });

    // assign workers to the first queue
    this.workers[0] = workers;

    // run queued up jobs
    while (this.jobQueue.length && (this.workers[0].length || this.workers[1].length)) {
      const job = this.jobQueue.shift();
      if (this.workers[0].length > 0) {
        const worker = this.workers[0].shift();
        this.workers[1].push(worker);
        this.run(worker, job);
      } else {
        const worker = this.workers[1].shift();
        this.workers[2].push(worker);
        this.run(worker, job);
      }
    }
  }
  enqueueJob(buffer, callback) {
    const job = {
      jobId: this.jobId++,
      buffer: buffer
    };
    this.jobCallbacks.set(job.jobId, callback);
    if (this.workers[0].length > 0) {
      const worker = this.workers[0].shift();
      this.workers[1].push(worker);
      this.run(worker, job);
    } else if (this.workers[1].length > 0) {
      const worker = this.workers[1].shift();
      this.workers[2].push(worker);
      this.run(worker, job);
    } else {
      this.jobQueue.push(job);
    }
  }
}
const downloadScript = url => {
  return new Promise((resolve, reject) => {
    const options = {
      cache: true,
      responseType: 'text',
      retry: downloadMaxRetries > 0,
      maxRetries: downloadMaxRetries
    };
    http.get(url, options, (err, response) => {
      if (err) {
        reject(err);
      } else {
        resolve(response);
      }
    });
  });
};
const compileModule = url => {
  const compileManual = () => {
    return fetch(url).then(result => result.arrayBuffer()).then(buffer => WebAssembly.compile(buffer));
  };
  const compileStreaming = () => {
    return WebAssembly.compileStreaming(fetch(url)).catch(err => {
      Debug.warn(`compileStreaming() failed for ${url} (${err}), falling back to arraybuffer download.`);
      return compileManual();
    });
  };

  // download and compile wasm module
  return WebAssembly.compileStreaming ? compileStreaming() : compileManual();
};
const defaultNumWorkers = 1;
let jobQueue;
let lazyConfig;
const initializeWorkers = config => {
  if (jobQueue) {
    return true;
  }
  if (!config) {
    if (lazyConfig) {
      config = lazyConfig;
    } else {
      const moduleConfig = WasmModule.getConfig('DracoDecoderModule');
      if (moduleConfig) {
        config = {
          jsUrl: moduleConfig.glueUrl,
          wasmUrl: moduleConfig.wasmUrl,
          numWorkers: moduleConfig.numWorkers
        };
      } else {
        config = {
          jsUrl: '/draco.wasm.js',
          wasmUrl: '/draco.wasm.wasm',
          numWorkers: defaultNumWorkers
        };
      }
    }
  }
  if (!config.jsUrl || !config.wasmUrl) {
    return false;
  }

  // create the job queue
  jobQueue = new JobQueue();

  // worker urls must be absolute
  const absoluteUrl = url => {
    return ABSOLUTE_URL.test(url) ? url : new URL(window.location.href).origin + url;
  };
  const jsUrl = absoluteUrl(config.jsUrl);
  const wasmUrl = absoluteUrl(config.wasmUrl);
  Promise.all([downloadScript(jsUrl), compileModule(wasmUrl)]).then(([dracoSource, dracoModule]) => {
    // build worker source
    const code = ['/* draco */', dracoSource, '/* worker */', `(\n${DracoWorker.toString()}\n)()\n\n`].join('\n');
    const blob = new Blob([code], {
      type: 'application/javascript'
    });
    const workerUrl = URL.createObjectURL(blob);
    const numWorkers = Math.max(1, Math.min(16, config.numWorkers || defaultNumWorkers));

    // create worker instances
    const workers = [];
    for (let i = 0; i < numWorkers; ++i) {
      const worker = new Worker(workerUrl);
      worker.postMessage({
        type: 'init',
        module: dracoModule
      });
      workers.push(worker);
    }
    jobQueue.init(workers);
  });
  return true;
};

/**
 * Initialize the Draco mesh decoder.
 *
 * @param {object} [config] - The Draco decoder configuration.
 * @param {string} [config.jsUrl] - URL of glue script.
 * @param {string} [config.wasmUrl] - URL of the wasm module.
 * @param {number} [config.numWorkers] - Number of workers to use for decoding (default is 1).
 * @param {boolean} [config.lazyInit] - Wait for first decode request before initializing workers
 * (default is false). Otherwise initialize workers immediately.
 */
const dracoInitialize = config => {
  if (config.lazyInit) {
    lazyConfig = config;
  } else {
    initializeWorkers(config);
  }
};

/**
 * Enqueue a buffer for decoding.
 *
 * @param {ArrayBuffer} buffer - The draco data to decode.
 * @param {Function} callback - Callback function to receive decoded result.
 * @returns {boolean} True if the draco worker was initialized and false otherwise.
 * @ignore
 */
const dracoDecode = (buffer, callback) => {
  if (!initializeWorkers()) {
    return false;
  }
  jobQueue.enqueueJob(buffer, callback);
  return true;
};

export { dracoDecode, dracoInitialize };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhY28tZGVjb2Rlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9wYXJzZXJzL2RyYWNvLWRlY29kZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgV2FzbU1vZHVsZSB9IGZyb20gXCIuLi8uLi9jb3JlL3dhc20tbW9kdWxlLmpzXCI7XG5pbXBvcnQgeyBBQlNPTFVURV9VUkwgfSBmcm9tIFwiLi4vYXNzZXQvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgeyBEcmFjb1dvcmtlciB9IGZyb20gXCIuL2RyYWNvLXdvcmtlci5qc1wiO1xuaW1wb3J0IHsgRGVidWcgfSBmcm9tIFwiLi4vLi4vY29yZS9kZWJ1Zy5qc1wiO1xuaW1wb3J0IHsgaHR0cCB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL25ldC9odHRwLmpzJztcblxuY29uc3QgZG93bmxvYWRNYXhSZXRyaWVzID0gMztcblxuLy8gSm9iUXVldWUga2VlcHMgdHJhY2sgb2YgYSBzZXQgb2Ygd2ViIHdvcmtlcnMgYW5kIGVucXVldWVzIGpvYnNcbi8vIG9uIHRoZW0uIFRvIGtlZXAgd29ya2xvYWQgYXMgYmFsYW5jZWQgYXMgcG9zc2libGUgKGJ1dCBhbHNvIGtlZXBcbi8vIHdvcmtlcnMgYnVzeSkgd29ya2VycyBoYXZlIGEgbWF4aW11bSBvZiAyIGpvYnMgYXNzaWduZWQgYXQgYW55XG4vLyBvbmUgdGltZS5cbmNsYXNzIEpvYlF1ZXVlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gbGlzdCBvZiB3b3JrZXJzIHdpdGg6IFtbMCBqb2JzXSwgWzEgam9iXSwgWzIgam9ic11dXG4gICAgICAgIHRoaXMud29ya2VycyA9IFtbXSwgW10sIFtdXTtcbiAgICAgICAgdGhpcy5qb2JJZCA9IDA7XG4gICAgICAgIHRoaXMuam9iUXVldWUgPSBbXTtcbiAgICAgICAgdGhpcy5qb2JDYWxsYmFja3MgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMucnVuID0gKHdvcmtlciwgam9iKSA9PiB7XG4gICAgICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdkZWNvZGVNZXNoJyxcbiAgICAgICAgICAgICAgICBqb2JJZDogam9iLmpvYklkLFxuICAgICAgICAgICAgICAgIGJ1ZmZlcjogam9iLmJ1ZmZlclxuICAgICAgICAgICAgfSwgW2pvYi5idWZmZXJdKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBpbml0aWFsaXplIHRoZSBxdWV1ZSB3aXRoIHdvcmtlciBpbnN0YW5jZXNcbiAgICBpbml0KHdvcmtlcnMpIHtcbiAgICAgICAgd29ya2Vycy5mb3JFYWNoKCh3b3JrZXIpID0+IHtcbiAgICAgICAgICAgIHdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gbWVzc2FnZS5kYXRhO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5qb2JDYWxsYmFja3MuZ2V0KGRhdGEuam9iSWQpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhLmVycm9yLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2VzOiBkYXRhLmluZGljZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNlczogZGF0YS52ZXJ0aWNlc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5qb2JDYWxsYmFja3MuZGVsZXRlKGRhdGEuam9iSWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuam9iUXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBqb2IgPSB0aGlzLmpvYlF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucnVuKHdvcmtlciwgam9iKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleDIgPSB0aGlzLndvcmtlcnNbMl0uaW5kZXhPZih3b3JrZXIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXgyICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZXJzWzJdLnNwbGljZShpbmRleDIsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZXJzWzFdLnB1c2god29ya2VyKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4MSA9IHRoaXMud29ya2Vyc1sxXS5pbmRleE9mKHdvcmtlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXgxICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud29ya2Vyc1sxXS5zcGxpY2UoaW5kZXgxLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtlcnNbMF0ucHVzaCh3b3JrZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2dpY2FsIGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcuZXJyb3IoJ2xvZ2ljYWwgZXJyb3InKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhc3NpZ24gd29ya2VycyB0byB0aGUgZmlyc3QgcXVldWVcbiAgICAgICAgdGhpcy53b3JrZXJzWzBdID0gd29ya2VycztcblxuICAgICAgICAvLyBydW4gcXVldWVkIHVwIGpvYnNcbiAgICAgICAgd2hpbGUgKHRoaXMuam9iUXVldWUubGVuZ3RoICYmICh0aGlzLndvcmtlcnNbMF0ubGVuZ3RoIHx8IHRoaXMud29ya2Vyc1sxXS5sZW5ndGgpKSB7XG4gICAgICAgICAgICBjb25zdCBqb2IgPSB0aGlzLmpvYlF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICBpZiAodGhpcy53b3JrZXJzWzBdLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB3b3JrZXIgPSB0aGlzLndvcmtlcnNbMF0uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLndvcmtlcnNbMV0ucHVzaCh3b3JrZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMucnVuKHdvcmtlciwgam9iKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd29ya2VyID0gdGhpcy53b3JrZXJzWzFdLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy53b3JrZXJzWzJdLnB1c2god29ya2VyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJ1bih3b3JrZXIsIGpvYik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBlbnF1ZXVlSm9iKGJ1ZmZlciwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3Qgam9iID0ge1xuICAgICAgICAgICAgam9iSWQ6IHRoaXMuam9iSWQrKyxcbiAgICAgICAgICAgIGJ1ZmZlcjogYnVmZmVyXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuam9iQ2FsbGJhY2tzLnNldChqb2Iuam9iSWQsIGNhbGxiYWNrKTtcblxuICAgICAgICBpZiAodGhpcy53b3JrZXJzWzBdLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmtlciA9IHRoaXMud29ya2Vyc1swXS5zaGlmdCgpO1xuICAgICAgICAgICAgdGhpcy53b3JrZXJzWzFdLnB1c2god29ya2VyKTtcbiAgICAgICAgICAgIHRoaXMucnVuKHdvcmtlciwgam9iKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLndvcmtlcnNbMV0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgd29ya2VyID0gdGhpcy53b3JrZXJzWzFdLnNoaWZ0KCk7XG4gICAgICAgICAgICB0aGlzLndvcmtlcnNbMl0ucHVzaCh3b3JrZXIpO1xuICAgICAgICAgICAgdGhpcy5ydW4od29ya2VyLCBqb2IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5qb2JRdWV1ZS5wdXNoKGpvYik7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNvbnN0IGRvd25sb2FkU2NyaXB0ID0gKHVybCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBjYWNoZTogdHJ1ZSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgcmV0cnk6IGRvd25sb2FkTWF4UmV0cmllcyA+IDAsXG4gICAgICAgICAgICBtYXhSZXRyaWVzOiBkb3dubG9hZE1heFJldHJpZXNcbiAgICAgICAgfTtcblxuICAgICAgICBodHRwLmdldCh1cmwsIG9wdGlvbnMsIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IGNvbXBpbGVNb2R1bGUgPSAodXJsKSA9PiB7XG4gICAgY29uc3QgY29tcGlsZU1hbnVhbCA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGZldGNoKHVybClcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiByZXN1bHQuYXJyYXlCdWZmZXIoKSlcbiAgICAgICAgICAgIC50aGVuKGJ1ZmZlciA9PiBXZWJBc3NlbWJseS5jb21waWxlKGJ1ZmZlcikpO1xuICAgIH07XG5cbiAgICBjb25zdCBjb21waWxlU3RyZWFtaW5nID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gV2ViQXNzZW1ibHkuY29tcGlsZVN0cmVhbWluZyhmZXRjaCh1cmwpKVxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBEZWJ1Zy53YXJuKGBjb21waWxlU3RyZWFtaW5nKCkgZmFpbGVkIGZvciAke3VybH0gKCR7ZXJyfSksIGZhbGxpbmcgYmFjayB0byBhcnJheWJ1ZmZlciBkb3dubG9hZC5gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGlsZU1hbnVhbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8vIGRvd25sb2FkIGFuZCBjb21waWxlIHdhc20gbW9kdWxlXG4gICAgcmV0dXJuIFdlYkFzc2VtYmx5LmNvbXBpbGVTdHJlYW1pbmcgPyBjb21waWxlU3RyZWFtaW5nKCkgOiBjb21waWxlTWFudWFsKCk7XG59O1xuXG5jb25zdCBkZWZhdWx0TnVtV29ya2VycyA9IDE7XG5cbmxldCBqb2JRdWV1ZTtcbmxldCBsYXp5Q29uZmlnO1xuXG5jb25zdCBpbml0aWFsaXplV29ya2VycyA9IChjb25maWcpID0+IHtcbiAgICBpZiAoam9iUXVldWUpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgICAgaWYgKGxhenlDb25maWcpIHtcbiAgICAgICAgICAgIGNvbmZpZyA9IGxhenlDb25maWc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBtb2R1bGVDb25maWcgPSBXYXNtTW9kdWxlLmdldENvbmZpZygnRHJhY29EZWNvZGVyTW9kdWxlJyk7XG4gICAgICAgICAgICBpZiAobW9kdWxlQ29uZmlnKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICBqc1VybDogbW9kdWxlQ29uZmlnLmdsdWVVcmwsXG4gICAgICAgICAgICAgICAgICAgIHdhc21Vcmw6IG1vZHVsZUNvbmZpZy53YXNtVXJsLFxuICAgICAgICAgICAgICAgICAgICBudW1Xb3JrZXJzOiBtb2R1bGVDb25maWcubnVtV29ya2Vyc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICAgICAganNVcmw6ICcvZHJhY28ud2FzbS5qcycsXG4gICAgICAgICAgICAgICAgICAgIHdhc21Vcmw6ICcvZHJhY28ud2FzbS53YXNtJyxcbiAgICAgICAgICAgICAgICAgICAgbnVtV29ya2VyczogZGVmYXVsdE51bVdvcmtlcnNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFjb25maWcuanNVcmwgfHwgIWNvbmZpZy53YXNtVXJsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgdGhlIGpvYiBxdWV1ZVxuICAgIGpvYlF1ZXVlID0gbmV3IEpvYlF1ZXVlKCk7XG5cbiAgICAvLyB3b3JrZXIgdXJscyBtdXN0IGJlIGFic29sdXRlXG4gICAgY29uc3QgYWJzb2x1dGVVcmwgPSAodXJsKSA9PiB7XG4gICAgICAgIHJldHVybiBBQlNPTFVURV9VUkwudGVzdCh1cmwpID8gdXJsIDogbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZikub3JpZ2luICsgdXJsO1xuICAgIH07XG4gICAgY29uc3QganNVcmwgPSBhYnNvbHV0ZVVybChjb25maWcuanNVcmwpO1xuICAgIGNvbnN0IHdhc21VcmwgPSBhYnNvbHV0ZVVybChjb25maWcud2FzbVVybCk7XG4gICAgUHJvbWlzZS5hbGwoW2Rvd25sb2FkU2NyaXB0KGpzVXJsKSwgY29tcGlsZU1vZHVsZSh3YXNtVXJsKV0pXG4gICAgICAgIC50aGVuKChbZHJhY29Tb3VyY2UsIGRyYWNvTW9kdWxlXSkgPT4ge1xuICAgICAgICAgICAgLy8gYnVpbGQgd29ya2VyIHNvdXJjZVxuICAgICAgICAgICAgY29uc3QgY29kZSA9IFtcbiAgICAgICAgICAgICAgICAnLyogZHJhY28gKi8nLFxuICAgICAgICAgICAgICAgIGRyYWNvU291cmNlLFxuICAgICAgICAgICAgICAgICcvKiB3b3JrZXIgKi8nLFxuICAgICAgICAgICAgICAgIGAoXFxuJHtEcmFjb1dvcmtlci50b1N0cmluZygpfVxcbikoKVxcblxcbmBcbiAgICAgICAgICAgIF0uam9pbignXFxuJyk7XG4gICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvZGVdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JyB9KTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmtlclVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICBjb25zdCBudW1Xb3JrZXJzID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oMTYsIGNvbmZpZy5udW1Xb3JrZXJzIHx8IGRlZmF1bHROdW1Xb3JrZXJzKSk7XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSB3b3JrZXIgaW5zdGFuY2VzXG4gICAgICAgICAgICBjb25zdCB3b3JrZXJzID0gW107XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdvcmtlcnM7ICsraSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtlciA9IG5ldyBXb3JrZXIod29ya2VyVXJsKTtcbiAgICAgICAgICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW5pdCcsXG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZTogZHJhY29Nb2R1bGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB3b3JrZXJzLnB1c2god29ya2VyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpvYlF1ZXVlLmluaXQod29ya2Vycyk7XG4gICAgICAgIH0pO1xuXG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemUgdGhlIERyYWNvIG1lc2ggZGVjb2Rlci5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gW2NvbmZpZ10gLSBUaGUgRHJhY28gZGVjb2RlciBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIHtzdHJpbmd9IFtjb25maWcuanNVcmxdIC0gVVJMIG9mIGdsdWUgc2NyaXB0LlxuICogQHBhcmFtIHtzdHJpbmd9IFtjb25maWcud2FzbVVybF0gLSBVUkwgb2YgdGhlIHdhc20gbW9kdWxlLlxuICogQHBhcmFtIHtudW1iZXJ9IFtjb25maWcubnVtV29ya2Vyc10gLSBOdW1iZXIgb2Ygd29ya2VycyB0byB1c2UgZm9yIGRlY29kaW5nIChkZWZhdWx0IGlzIDEpLlxuICogQHBhcmFtIHtib29sZWFufSBbY29uZmlnLmxhenlJbml0XSAtIFdhaXQgZm9yIGZpcnN0IGRlY29kZSByZXF1ZXN0IGJlZm9yZSBpbml0aWFsaXppbmcgd29ya2Vyc1xuICogKGRlZmF1bHQgaXMgZmFsc2UpLiBPdGhlcndpc2UgaW5pdGlhbGl6ZSB3b3JrZXJzIGltbWVkaWF0ZWx5LlxuICovXG5jb25zdCBkcmFjb0luaXRpYWxpemUgPSAoY29uZmlnKSA9PiB7XG4gICAgaWYgKGNvbmZpZy5sYXp5SW5pdCkge1xuICAgICAgICBsYXp5Q29uZmlnID0gY29uZmlnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGluaXRpYWxpemVXb3JrZXJzKGNvbmZpZyk7XG4gICAgfVxufTtcblxuLyoqXG4gKiBFbnF1ZXVlIGEgYnVmZmVyIGZvciBkZWNvZGluZy5cbiAqXG4gKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBidWZmZXIgLSBUaGUgZHJhY28gZGF0YSB0byBkZWNvZGUuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIHJlY2VpdmUgZGVjb2RlZCByZXN1bHQuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZHJhY28gd29ya2VyIHdhcyBpbml0aWFsaXplZCBhbmQgZmFsc2Ugb3RoZXJ3aXNlLlxuICogQGlnbm9yZVxuICovXG5jb25zdCBkcmFjb0RlY29kZSA9IChidWZmZXIsIGNhbGxiYWNrKSA9PiB7XG4gICAgaWYgKCFpbml0aWFsaXplV29ya2VycygpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgam9iUXVldWUuZW5xdWV1ZUpvYihidWZmZXIsIGNhbGxiYWNrKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbmV4cG9ydCB7XG4gICAgZHJhY29Jbml0aWFsaXplLFxuICAgIGRyYWNvRGVjb2RlXG59O1xuIl0sIm5hbWVzIjpbImRvd25sb2FkTWF4UmV0cmllcyIsIkpvYlF1ZXVlIiwiY29uc3RydWN0b3IiLCJ3b3JrZXJzIiwiam9iSWQiLCJqb2JRdWV1ZSIsImpvYkNhbGxiYWNrcyIsIk1hcCIsInJ1biIsIndvcmtlciIsImpvYiIsInBvc3RNZXNzYWdlIiwidHlwZSIsImJ1ZmZlciIsImluaXQiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm1lc3NhZ2UiLCJkYXRhIiwiY2FsbGJhY2siLCJnZXQiLCJlcnJvciIsImluZGljZXMiLCJ2ZXJ0aWNlcyIsImRlbGV0ZSIsImxlbmd0aCIsInNoaWZ0IiwiaW5kZXgyIiwiaW5kZXhPZiIsInNwbGljZSIsInB1c2giLCJpbmRleDEiLCJEZWJ1ZyIsImVucXVldWVKb2IiLCJzZXQiLCJkb3dubG9hZFNjcmlwdCIsInVybCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib3B0aW9ucyIsImNhY2hlIiwicmVzcG9uc2VUeXBlIiwicmV0cnkiLCJtYXhSZXRyaWVzIiwiaHR0cCIsImVyciIsInJlc3BvbnNlIiwiY29tcGlsZU1vZHVsZSIsImNvbXBpbGVNYW51YWwiLCJmZXRjaCIsInRoZW4iLCJyZXN1bHQiLCJhcnJheUJ1ZmZlciIsIldlYkFzc2VtYmx5IiwiY29tcGlsZSIsImNvbXBpbGVTdHJlYW1pbmciLCJjYXRjaCIsIndhcm4iLCJkZWZhdWx0TnVtV29ya2VycyIsImxhenlDb25maWciLCJpbml0aWFsaXplV29ya2VycyIsImNvbmZpZyIsIm1vZHVsZUNvbmZpZyIsIldhc21Nb2R1bGUiLCJnZXRDb25maWciLCJqc1VybCIsImdsdWVVcmwiLCJ3YXNtVXJsIiwibnVtV29ya2VycyIsImFic29sdXRlVXJsIiwiQUJTT0xVVEVfVVJMIiwidGVzdCIsIlVSTCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsIm9yaWdpbiIsImFsbCIsImRyYWNvU291cmNlIiwiZHJhY29Nb2R1bGUiLCJjb2RlIiwiRHJhY29Xb3JrZXIiLCJ0b1N0cmluZyIsImpvaW4iLCJibG9iIiwiQmxvYiIsIndvcmtlclVybCIsImNyZWF0ZU9iamVjdFVSTCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJpIiwiV29ya2VyIiwibW9kdWxlIiwiZHJhY29Jbml0aWFsaXplIiwibGF6eUluaXQiLCJkcmFjb0RlY29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTUEsTUFBTUEsa0JBQWtCLEdBQUcsQ0FBQyxDQUFBOztBQUU1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLFFBQVEsQ0FBQztBQUNYQyxFQUFBQSxXQUFXQSxHQUFHO0FBQ1Y7SUFDQSxJQUFJLENBQUNDLE9BQU8sR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDM0IsSUFBSSxDQUFDQyxLQUFLLEdBQUcsQ0FBQyxDQUFBO0lBQ2QsSUFBSSxDQUFDQyxRQUFRLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLElBQUEsSUFBSSxDQUFDQyxZQUFZLEdBQUcsSUFBSUMsR0FBRyxFQUFFLENBQUE7QUFDN0IsSUFBQSxJQUFJLENBQUNDLEdBQUcsR0FBRyxDQUFDQyxNQUFNLEVBQUVDLEdBQUcsS0FBSztNQUN4QkQsTUFBTSxDQUFDRSxXQUFXLENBQUM7QUFDZkMsUUFBQUEsSUFB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
