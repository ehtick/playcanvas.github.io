/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';
import { Color } from '../../../core/math/color.js';
import { Vec2 } from '../../../core/math/vec2.js';
import { Vec3 } from '../../../core/math/vec3.js';
import { Texture } from '../../../platform/graphics/texture.js';
import { BoundingBox } from '../../../core/shape/bounding-box.js';
import { SPECULAR_BLINN, SPECULAR_PHONG } from '../../../scene/constants.js';
import { StandardMaterial } from '../../../scene/materials/standard-material.js';
import { StandardMaterialValidator } from '../../../scene/materials/standard-material-validator.js';
import { standardMaterialParameterTypes } from '../../../scene/materials/standard-material-parameters.js';

/**
 * Convert incoming JSON data into a {@link StandardMaterial}.
 *
 * @ignore
 */
class JsonStandardMaterialParser {
  constructor() {
    this._validator = null;
  }
  parse(input) {
    const migrated = this.migrate(input);
    const validated = this._validate(migrated);
    const material = new StandardMaterial();
    this.initialize(material, validated);
    return material;
  }

  /**
   * Initialize material properties from the material data block e.g. Loading from server.
   *
   * @param {StandardMaterial} material - The material to be initialized.
   * @param {object} data - The data block that is used to initialize.
   */
  initialize(material, data) {
    // usual flow is that data is validated in resource loader
    // but if not, validate here.
    if (!data.validated) {
      data = this._validate(data);
    }
    if (data.chunks) {
      material.chunks = _extends({}, data.chunks);
    }

    // initialize material values from the input data
    for (const key in data) {
      const type = standardMaterialParameterTypes[key];
      const value = data[key];
      if (type === 'vec2') {
        material[key] = new Vec2(value[0], value[1]);
      } else if (type === 'rgb') {
        material[key] = new Color(value[0], value[1], value[2]);
      } else if (type === 'texture') {
        if (value instanceof Texture) {
          material[key] = value;
        } else if (!(material[key] instanceof Texture && typeof value === 'number' && value > 0)) {
          material[key] = null;
        }
        // OTHERWISE: material already has a texture assigned, but data contains a valid asset id (which means the asset isn't yet loaded)
        // leave current texture (probably a placeholder) until the asset is loaded
      } else if (type === 'cubemap') {
        if (value instanceof Texture) {
          material[key] = value;
        } else if (!(material[key] instanceof Texture && typeof value === 'number' && value > 0)) {
          material[key] = null;
        }

        // clearing the cubemap must also clear the prefiltered data
        if (key === 'cubeMap' && !value) {
          material.prefilteredCubemaps = null;
        }

        // OTHERWISE: material already has a texture assigned, but data contains a valid asset id (which means the asset isn't yet loaded)
        // leave current texture (probably a placeholder) until the asset is loaded
      } else if (type === 'boundingbox') {
        const center = new Vec3(value.center[0], value.center[1], value.center[2]);
        const halfExtents = new Vec3(value.halfExtents[0], value.halfExtents[1], value.halfExtents[2]);
        material[key] = new BoundingBox(center, halfExtents);
      } else {
        // number, boolean and enum types don't require type creation
        material[key] = data[key];
      }
    }
    material.update();
  }

  // convert any properties that are out of date
  // or from old versions into current version
  migrate(data) {
    // replace old shader property with new shadingModel property
    if (data.shadingModel === undefined) {
      if (data.shader === 'blinn') {
        data.shadingModel = SPECULAR_BLINN;
      } else {
        data.shadingModel = SPECULAR_PHONG;
      }
    }
    if (data.shader) delete data.shader;

    // make JS style
    if (data.mapping_format) {
      data.mappingFormat = data.mapping_format;
      delete data.mapping_format;
    }
    let i;
    // list of properties that have been renamed in StandardMaterial
    // but may still exists in data in old format
    const RENAMED_PROPERTIES = [['bumpMapFactor', 'bumpiness'], ['aoUvSet', 'aoMapUv'], ['aoMapVertexColor', 'aoVertexColor'], ['diffuseMapVertexColor', 'diffuseVertexColor'], ['emissiveMapVertexColor', 'emissiveVertexColor'], ['specularMapVertexColor', 'specularVertexColor'], ['metalnessMapVertexColor', 'metalnessVertexColor'], ['opacityMapVertexColor', 'opacityVertexColor'], ['glossMapVertexColor', 'glossVertexColor'], ['lightMapVertexColor', 'lightVertexColor'], ['diffuseMapTint', 'diffuseTint'], ['specularMapTint', 'specularTint'], ['emissiveMapTint', 'emissiveTint'], ['metalnessMapTint', 'metalnessTint'], ['clearCoatGlossiness', 'clearCoatGloss']];

    // if an old property name exists without a new one,
    // move property into new name and delete old one.
    for (i = 0; i < RENAMED_PROPERTIES.length; i++) {
      const _old = RENAMED_PROPERTIES[i][0];
      const _new = RENAMED_PROPERTIES[i][1];
      if (data[_old] !== undefined && !(data[_new] !== undefined)) {
        data[_new] = data[_old];
        delete data[_old];
      }
    }

    // Properties that may exist in input data, but are now ignored
    const DEPRECATED_PROPERTIES = ['fresnelFactor', 'shadowSampleType'];
    for (i = 0; i < DEPRECATED_PROPERTIES.length; i++) {
      const name = DEPRECATED_PROPERTIES[i];
      if (data.hasOwnProperty(name)) {
        delete data[name];
      }
    }
    return data;
  }

  // check for invalid properties
  _validate(data) {
    if (!data.validated) {
      if (!this._validator) {
        this._validator = new StandardMaterialValidator();
      }
      this._validator.validate(data);
    }
    return data;
  }
}

export { JsonStandardMaterialParser };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNvbi1zdGFuZGFyZC1tYXRlcmlhbC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9wYXJzZXJzL21hdGVyaWFsL2pzb24tc3RhbmRhcmQtbWF0ZXJpYWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi9jb3JlL21hdGgvY29sb3IuanMnO1xuaW1wb3J0IHsgVmVjMiB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC92ZWMyLmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi8uLi9jb3JlL21hdGgvdmVjMy5qcyc7XG5cbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy90ZXh0dXJlLmpzJztcblxuaW1wb3J0IHsgQm91bmRpbmdCb3ggfSBmcm9tICcuLi8uLi8uLi9jb3JlL3NoYXBlL2JvdW5kaW5nLWJveC5qcyc7XG5cbmltcG9ydCB7IFNQRUNVTEFSX0JMSU5OLCBTUEVDVUxBUl9QSE9ORyB9IGZyb20gJy4uLy4uLy4uL3NjZW5lL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7IFN0YW5kYXJkTWF0ZXJpYWwgfSBmcm9tICcuLi8uLi8uLi9zY2VuZS9tYXRlcmlhbHMvc3RhbmRhcmQtbWF0ZXJpYWwuanMnO1xuaW1wb3J0IHsgU3RhbmRhcmRNYXRlcmlhbFZhbGlkYXRvciB9IGZyb20gJy4uLy4uLy4uL3NjZW5lL21hdGVyaWFscy9zdGFuZGFyZC1tYXRlcmlhbC12YWxpZGF0b3IuanMnO1xuaW1wb3J0IHsgc3RhbmRhcmRNYXRlcmlhbFBhcmFtZXRlclR5cGVzIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmUvbWF0ZXJpYWxzL3N0YW5kYXJkLW1hdGVyaWFsLXBhcmFtZXRlcnMuanMnO1xuXG4vKipcbiAqIENvbnZlcnQgaW5jb21pbmcgSlNPTiBkYXRhIGludG8gYSB7QGxpbmsgU3RhbmRhcmRNYXRlcmlhbH0uXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBKc29uU3RhbmRhcmRNYXRlcmlhbFBhcnNlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuX3ZhbGlkYXRvciA9IG51bGw7XG4gICAgfVxuXG4gICAgcGFyc2UoaW5wdXQpIHtcbiAgICAgICAgY29uc3QgbWlncmF0ZWQgPSB0aGlzLm1pZ3JhdGUoaW5wdXQpO1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWQgPSB0aGlzLl92YWxpZGF0ZShtaWdyYXRlZCk7XG5cbiAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgU3RhbmRhcmRNYXRlcmlhbCgpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemUobWF0ZXJpYWwsIHZhbGlkYXRlZCk7XG5cbiAgICAgICAgcmV0dXJuIG1hdGVyaWFsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgbWF0ZXJpYWwgcHJvcGVydGllcyBmcm9tIHRoZSBtYXRlcmlhbCBkYXRhIGJsb2NrIGUuZy4gTG9hZGluZyBmcm9tIHNlcnZlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RhbmRhcmRNYXRlcmlhbH0gbWF0ZXJpYWwgLSBUaGUgbWF0ZXJpYWwgdG8gYmUgaW5pdGlhbGl6ZWQuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBUaGUgZGF0YSBibG9jayB0aGF0IGlzIHVzZWQgdG8gaW5pdGlhbGl6ZS5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplKG1hdGVyaWFsLCBkYXRhKSB7XG4gICAgICAgIC8vIHVzdWFsIGZsb3cgaXMgdGhhdCBkYXRhIGlzIHZhbGlkYXRlZCBpbiByZXNvdXJjZSBsb2FkZXJcbiAgICAgICAgLy8gYnV0IGlmIG5vdCwgdmFsaWRhdGUgaGVyZS5cbiAgICAgICAgaWYgKCFkYXRhLnZhbGlkYXRlZCkge1xuICAgICAgICAgICAgZGF0YSA9IHRoaXMuX3ZhbGlkYXRlKGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuY2h1bmtzKSB7XG4gICAgICAgICAgICBtYXRlcmlhbC5jaHVua3MgPSB7IC4uLmRhdGEuY2h1bmtzIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpbml0aWFsaXplIG1hdGVyaWFsIHZhbHVlcyBmcm9tIHRoZSBpbnB1dCBkYXRhXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBzdGFuZGFyZE1hdGVyaWFsUGFyYW1ldGVyVHlwZXNba2V5XTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3ZlYzInKSB7XG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxba2V5XSA9IG5ldyBWZWMyKHZhbHVlWzBdLCB2YWx1ZVsxXSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdyZ2InKSB7XG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxba2V5XSA9IG5ldyBDb2xvcih2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3RleHR1cmUnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgVGV4dHVyZSkge1xuICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbFtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghKG1hdGVyaWFsW2tleV0gaW5zdGFuY2VvZiBUZXh0dXJlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgdmFsdWUgPiAwKSkge1xuICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbFtrZXldID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gT1RIRVJXSVNFOiBtYXRlcmlhbCBhbHJlYWR5IGhhcyBhIHRleHR1cmUgYXNzaWduZWQsIGJ1dCBkYXRhIGNvbnRhaW5zIGEgdmFsaWQgYXNzZXQgaWQgKHdoaWNoIG1lYW5zIHRoZSBhc3NldCBpc24ndCB5ZXQgbG9hZGVkKVxuICAgICAgICAgICAgICAgIC8vIGxlYXZlIGN1cnJlbnQgdGV4dHVyZSAocHJvYmFibHkgYSBwbGFjZWhvbGRlcikgdW50aWwgdGhlIGFzc2V0IGlzIGxvYWRlZFxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnY3ViZW1hcCcpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBUZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdGVyaWFsW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCEobWF0ZXJpYWxba2V5XSBpbnN0YW5jZW9mIFRleHR1cmUgJiYgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiB2YWx1ZSA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdGVyaWFsW2tleV0gPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGNsZWFyaW5nIHRoZSBjdWJlbWFwIG11c3QgYWxzbyBjbGVhciB0aGUgcHJlZmlsdGVyZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdjdWJlTWFwJyAmJiAhdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0ZXJpYWwucHJlZmlsdGVyZWRDdWJlbWFwcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gT1RIRVJXSVNFOiBtYXRlcmlhbCBhbHJlYWR5IGhhcyBhIHRleHR1cmUgYXNzaWduZWQsIGJ1dCBkYXRhIGNvbnRhaW5zIGEgdmFsaWQgYXNzZXQgaWQgKHdoaWNoIG1lYW5zIHRoZSBhc3NldCBpc24ndCB5ZXQgbG9hZGVkKVxuICAgICAgICAgICAgICAgIC8vIGxlYXZlIGN1cnJlbnQgdGV4dHVyZSAocHJvYmFibHkgYSBwbGFjZWhvbGRlcikgdW50aWwgdGhlIGFzc2V0IGlzIGxvYWRlZFxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYm91bmRpbmdib3gnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VudGVyID0gbmV3IFZlYzModmFsdWUuY2VudGVyWzBdLCB2YWx1ZS5jZW50ZXJbMV0sIHZhbHVlLmNlbnRlclsyXSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgVmVjMyh2YWx1ZS5oYWxmRXh0ZW50c1swXSwgdmFsdWUuaGFsZkV4dGVudHNbMV0sIHZhbHVlLmhhbGZFeHRlbnRzWzJdKTtcbiAgICAgICAgICAgICAgICBtYXRlcmlhbFtrZXldID0gbmV3IEJvdW5kaW5nQm94KGNlbnRlciwgaGFsZkV4dGVudHMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBudW1iZXIsIGJvb2xlYW4gYW5kIGVudW0gdHlwZXMgZG9uJ3QgcmVxdWlyZSB0eXBlIGNyZWF0aW9uXG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxba2V5XSA9IGRhdGFba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG1hdGVyaWFsLnVwZGF0ZSgpO1xuICAgIH1cblxuICAgIC8vIGNvbnZlcnQgYW55IHByb3BlcnRpZXMgdGhhdCBhcmUgb3V0IG9mIGRhdGVcbiAgICAvLyBvciBmcm9tIG9sZCB2ZXJzaW9ucyBpbnRvIGN1cnJlbnQgdmVyc2lvblxuICAgIG1pZ3JhdGUoZGF0YSkge1xuICAgICAgICAvLyByZXBsYWNlIG9sZCBzaGFkZXIgcHJvcGVydHkgd2l0aCBuZXcgc2hhZGluZ01vZGVsIHByb3BlcnR5XG4gICAgICAgIGlmIChkYXRhLnNoYWRpbmdNb2RlbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5zaGFkZXIgPT09ICdibGlubicpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnNoYWRpbmdNb2RlbCA9IFNQRUNVTEFSX0JMSU5OO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkYXRhLnNoYWRpbmdNb2RlbCA9IFNQRUNVTEFSX1BIT05HO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhLnNoYWRlcikgZGVsZXRlIGRhdGEuc2hhZGVyO1xuXG4gICAgICAgIC8vIG1ha2UgSlMgc3R5bGVcbiAgICAgICAgaWYgKGRhdGEubWFwcGluZ19mb3JtYXQpIHtcbiAgICAgICAgICAgIGRhdGEubWFwcGluZ0Zvcm1hdCA9IGRhdGEubWFwcGluZ19mb3JtYXQ7XG4gICAgICAgICAgICBkZWxldGUgZGF0YS5tYXBwaW5nX2Zvcm1hdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpO1xuICAgICAgICAvLyBsaXN0IG9mIHByb3BlcnRpZXMgdGhhdCBoYXZlIGJlZW4gcmVuYW1lZCBpbiBTdGFuZGFyZE1hdGVyaWFsXG4gICAgICAgIC8vIGJ1dCBtYXkgc3RpbGwgZXhpc3RzIGluIGRhdGEgaW4gb2xkIGZvcm1hdFxuICAgICAgICBjb25zdCBSRU5BTUVEX1BST1BFUlRJRVMgPSBbXG4gICAgICAgICAgICBbJ2J1bXBNYXBGYWN0b3InLCAnYnVtcGluZXNzJ10sXG5cbiAgICAgICAgICAgIFsnYW9VdlNldCcsICdhb01hcFV2J10sXG5cbiAgICAgICAgICAgIFsnYW9NYXBWZXJ0ZXhDb2xvcicsICdhb1ZlcnRleENvbG9yJ10sXG4gICAgICAgICAgICBbJ2RpZmZ1c2VNYXBWZXJ0ZXhDb2xvcicsICdkaWZmdXNlVmVydGV4Q29sb3InXSxcbiAgICAgICAgICAgIFsnZW1pc3NpdmVNYXBWZXJ0ZXhDb2xvcicsICdlbWlzc2l2ZVZlcnRleENvbG9yJ10sXG4gICAgICAgICAgICBbJ3NwZWN1bGFyTWFwVmVydGV4Q29sb3InLCAnc3BlY3VsYXJWZXJ0ZXhDb2xvciddLFxuICAgICAgICAgICAgWydtZXRhbG5lc3NNYXBWZXJ0ZXhDb2xvcicsICdtZXRhbG5lc3NWZXJ0ZXhDb2xvciddLFxuICAgICAgICAgICAgWydvcGFjaXR5TWFwVmVydGV4Q29sb3InLCAnb3BhY2l0eVZlcnRleENvbG9yJ10sXG4gICAgICAgICAgICBbJ2dsb3NzTWFwVmVydGV4Q29sb3InLCAnZ2xvc3NWZXJ0ZXhDb2xvciddLFxuICAgICAgICAgICAgWydsaWdodE1hcFZlcnRleENvbG9yJywgJ2xpZ2h0VmVydGV4Q29sb3InXSxcblxuICAgICAgICAgICAgWydkaWZmdXNlTWFwVGludCcsICdkaWZmdXNlVGludCddLFxuICAgICAgICAgICAgWydzcGVjdWxhck1hcFRpbnQnLCAnc3BlY3VsYXJUaW50J10sXG4gICAgICAgICAgICBbJ2VtaXNzaXZlTWFwVGludCcsICdlbWlzc2l2ZVRpbnQnXSxcbiAgICAgICAgICAgIFsnbWV0YWxuZXNzTWFwVGludCcsICdtZXRhbG5lc3NUaW50J10sXG5cbiAgICAgICAgICAgIFsnY2xlYXJDb2F0R2xvc3NpbmVzcycsICdjbGVhckNvYXRHbG9zcyddXG4gICAgICAgIF07XG5cbiAgICAgICAgLy8gaWYgYW4gb2xkIHByb3BlcnR5IG5hbWUgZXhpc3RzIHdpdGhvdXQgYSBuZXcgb25lLFxuICAgICAgICAvLyBtb3ZlIHByb3BlcnR5IGludG8gbmV3IG5hbWUgYW5kIGRlbGV0ZSBvbGQgb25lLlxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgUkVOQU1FRF9QUk9QRVJUSUVTLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBfb2xkID0gUkVOQU1FRF9QUk9QRVJUSUVTW2ldWzBdO1xuICAgICAgICAgICAgY29uc3QgX25ldyA9IFJFTkFNRURfUFJPUEVSVElFU1tpXVsxXTtcblxuICAgICAgICAgICAgaWYgKGRhdGFbX29sZF0gIT09IHVuZGVmaW5lZCAmJiAhKGRhdGFbX25ld10gIT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgICAgICAgICBkYXRhW19uZXddID0gZGF0YVtfb2xkXTtcbiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YVtfb2xkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByb3BlcnRpZXMgdGhhdCBtYXkgZXhpc3QgaW4gaW5wdXQgZGF0YSwgYnV0IGFyZSBub3cgaWdub3JlZFxuICAgICAgICBjb25zdCBERVBSRUNBVEVEX1BST1BFUlRJRVMgPSBbXG4gICAgICAgICAgICAnZnJlc25lbEZhY3RvcicsXG4gICAgICAgICAgICAnc2hhZG93U2FtcGxlVHlwZSdcbiAgICAgICAgXTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgREVQUkVDQVRFRF9QUk9QRVJUSUVTLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gREVQUkVDQVRFRF9QUk9QRVJUSUVTW2ldO1xuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YVtuYW1lXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGZvciBpbnZhbGlkIHByb3BlcnRpZXNcbiAgICBfdmFsaWRhdGUoZGF0YSkge1xuICAgICAgICBpZiAoIWRhdGEudmFsaWRhdGVkKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbGlkYXRvciA9IG5ldyBTdGFuZGFyZE1hdGVyaWFsVmFsaWRhdG9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl92YWxpZGF0b3IudmFsaWRhdGUoZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxufVxuXG5leHBvcnQgeyBKc29uU3RhbmRhcmRNYXRlcmlhbFBhcnNlciB9O1xuIl0sIm5hbWVzIjpbIkpzb25TdGFuZGFyZE1hdGVyaWFsUGFyc2VyIiwiY29uc3RydWN0b3IiLCJfdmFsaWRhdG9yIiwicGFyc2UiLCJpbnB1dCIsIm1pZ3JhdGVkIiwibWlncmF0ZSIsInZhbGlkYXRlZCIsIl92YWxpZGF0ZSIsIm1hdGVyaWFsIiwiU3RhbmRhcmRNYXRlcmlhbCIsImluaXRpYWxpemUiLCJkYXRhIiwiY2h1bmtzIiwia2V5IiwidHlwZSIsInN0YW5kYXJkTWF0ZXJpYWxQYXJhbWV0ZXJUeXBlcyIsInZhbHVlIiwiVmVjMiIsIkNvbG9yIiwiVGV4dHVyZSIsInByZWZpbHRlcmVkQ3ViZW1hcHMiLCJjZW50ZXIiLCJWZWMzIiwiaGFsZkV4dGVudHMiLCJCb3VuZGluZ0JveCIsInVwZGF0ZSIsInNoYWRpbmdNb2RlbCIsInVuZGVmaW5lZCIsInNoYWRlciIsIlNQRUNVTEFSX0JMSU5OIiwiU1BFQ1VMQVJfUEhPTkciLCJtYXBwaW5nX2Zvcm1hdCIsIm1hcHBpbmdGb3JtYXQiLCJpIiwiUkVOQU1FRF9QUk9QRVJUSUVTIiwibGVuZ3RoIiwiX29sZCIsIl9uZXciLCJERVBSRUNBVEVEX1BST1BFUlRJRVMiLCJuYW1lIiwiaGFzT3duUHJvcGVydHkiLCJTdGFuZGFyZE1hdGVyaWFsVmFsaWRhdG9yIiwidmFsaWRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsMEJBQTBCLENBQUM7QUFDN0JDLEVBQUFBLFdBQVcsR0FBRztJQUNWLElBQUksQ0FBQ0MsVUFBVSxHQUFHLElBQUksQ0FBQTtBQUMxQixHQUFBO0VBRUFDLEtBQUssQ0FBQ0MsS0FBSyxFQUFFO0FBQ1QsSUFBQSxNQUFNQyxRQUFRLEdBQUcsSUFBSSxDQUFDQyxPQUFPLENBQUNGLEtBQUssQ0FBQyxDQUFBO0FBQ3BDLElBQUEsTUFBTUcsU0FBUyxHQUFHLElBQUksQ0FBQ0MsU0FBUyxDQUFDSCxRQUFRLENBQUMsQ0FBQTtBQUUxQyxJQUFBLE1BQU1JLFFBQVEsR0FBRyxJQUFJQyxnQkFBZ0IsRUFBRSxDQUFBO0FBQ3ZDLElBQUEsSUFBSSxDQUFDQyxVQUFVLENBQUNGLFFBQVEsRUFBRUYsU0FBUyxDQUFDLENBQUE7QUFFcEMsSUFBQSxPQUFPRSxRQUFRLENBQUE7QUFDbkIsR0FBQTs7QUFF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
