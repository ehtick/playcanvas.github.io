/**
 * @license
 * PlayCanvas Engine v1.57.0 revision f1998a31e (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { guid } from '../core/guid.js';
import { GraphNode } from '../scene/graph-node.js';
import { AppBase } from './app-base.js';

const _enableList = [];

class Entity extends GraphNode {
  constructor(name, app) {
    super(name);
    this.anim = void 0;
    this.animation = void 0;
    this.audiolistener = void 0;
    this.button = void 0;
    this.camera = void 0;
    this.collision = void 0;
    this.element = void 0;
    this.layoutchild = void 0;
    this.layoutgroup = void 0;
    this.light = void 0;
    this.model = void 0;
    this.particlesystem = void 0;
    this.render = void 0;
    this.rigidbody = void 0;
    this.screen = void 0;
    this.script = void 0;
    this.scrollbar = void 0;
    this.scrollview = void 0;
    this.sound = void 0;
    this.sprite = void 0;
    this.c = {};
    this._app = void 0;
    this._destroying = false;
    this._guid = null;
    this._template = false;
    if (name instanceof AppBase) app = name;

    if (!app) {
      app = AppBase.getApplication();

      if (!app) {
        throw new Error("Couldn't find current application");
      }
    }

    this._app = app;
  }

  addComponent(type, data) {
    const system = this._app.systems[type];

    if (!system) {
      Debug.error(`addComponent: System ${type} doesn't exist`);
      return null;
    }

    if (this.c[type]) {
      Debug.warn(`addComponent: Entity already has ${type} component`);
      return null;
    }

    return system.addComponent(this, data);
  }

  removeComponent(type) {
    const system = this._app.systems[type];

    if (!system) {
      Debug.error(`addComponent: System ${type} doesn't exist`);
      return;
    }

    if (!this.c[type]) {
      Debug.warn(`removeComponent: Entity doesn't have ${type} component`);
      return;
    }

    system.removeComponent(this);
  }

  findComponent(type) {
    const entity = this.findOne(function (node) {
      return node.c && node.c[type];
    });
    return entity && entity.c[type];
  }

  findComponents(type) {
    const entities = this.find(function (node) {
      return node.c && node.c[type];
    });
    return entities.map(function (entity) {
      return entity.c[type];
    });
  }

  getGuid() {
    if (!this._guid) {
      this.setGuid(guid.create());
    }

    return this._guid;
  }

  setGuid(guid) {
    const index = this._app._entityIndex;

    if (this._guid) {
      delete index[this._guid];
    }

    this._guid = guid;
    index[this._guid] = this;
  }

  _notifyHierarchyStateChanged(node, enabled) {
    let enableFirst = false;
    if (node === this && _enableList.length === 0) enableFirst = true;
    node._beingEnabled = true;

    node._onHierarchyStateChanged(enabled);

    if (node._onHierarchyStatePostChanged) _enableList.push(node);
    const c = node._children;

    for (let i = 0, len = c.length; i < len; i++) {
      if (c[i]._enabled) this._notifyHierarchyStateChanged(c[i], enabled);
    }

    node._beingEnabled = false;

    if (enableFirst) {
      for (let i = 0; i < _enableList.length; i++) {
        _enableList[i]._onHierarchyStatePostChanged();
      }

      _enableList.length = 0;
    }
  }

  _onHierarchyStateChanged(enabled) {
    super._onHierarchyStateChanged(enabled);

    const components = this.c;

    for (const type in components) {
      if (components.hasOwnProperty(type)) {
        const component = components[type];

        if (component.enabled) {
          if (enabled) {
            component.onEnable();
          } else {
            component.onDisable();
          }
        }
      }
    }
  }

  _onHierarchyStatePostChanged() {
    const components = this.c;

    for (const type in components) {
      if (components.hasOwnProperty(type)) components[type].onPostStateChange();
    }
  }

  findByGuid(guid) {
    if (this._guid === guid) return this;
    const e = this._app._entityIndex[guid];

    if (e && (e === this || e.isDescendantOf(this))) {
      return e;
    }

    return null;
  }

  destroy() {
    this._destroying = true;

    for (const name in this.c) {
      this.c[name].enabled = false;
    }

    for (const name in this.c) {
      this.c[name].system.removeComponent(this);
    }

    if (this._parent) this._parent.removeChild(this);
    const children = this._children;

    while (children.length) {
      const child = children.pop();
      child._parent = null;

      if (child instanceof Entity) {
        child.destroy();
      }
    }

    this.fire('destroy', this);
    this.off();

    if (this._guid) {
      delete this._app._entityIndex[this._guid];
    }

    this._destroying = false;
  }

  clone() {
    const duplicatedIdsMap = {};

    const clone = this._cloneRecursively(duplicatedIdsMap);

    duplicatedIdsMap[this.getGuid()] = clone;
    resolveDuplicatedEntityReferenceProperties(this, this, clone, duplicatedIdsMap);
    return clone;
  }

  _cloneRecursively(duplicatedIdsMap) {
    const clone = new this.constructor(this._app);

    super._cloneInternal(clone);

    for (const type in this.c) {
      const component = this.c[type];
      component.system.cloneComponent(this, clone);
    }

    for (let i = 0; i < this._children.length; i++) {
      const oldChild = this._children[i];

      if (oldChild instanceof Entity) {
        const newChild = oldChild._cloneRecursively(duplicatedIdsMap);

        clone.addChild(newChild);
        duplicatedIdsMap[oldChild.getGuid()] = newChild;
      }
    }

    return clone;
  }

}

function resolveDuplicatedEntityReferenceProperties(oldSubtreeRoot, oldEntity, newEntity, duplicatedIdsMap) {
  if (oldEntity instanceof Entity) {
    const components = oldEntity.c;

    for (const componentName in components) {
      const component = components[componentName];
      const entityProperties = component.system.getPropertiesOfType('entity');

      for (let i = 0, len = entityProperties.length; i < len; i++) {
        const propertyDescriptor = entityProperties[i];
        const propertyName = propertyDescriptor.name;
        const oldEntityReferenceId = component[propertyName];
        const entityIsWithinOldSubtree = !!oldSubtreeRoot.findByGuid(oldEntityReferenceId);

        if (entityIsWithinOldSubtree) {
          const newEntityReferenceId = duplicatedIdsMap[oldEntityReferenceId].getGuid();

          if (newEntityReferenceId) {
            newEntity.c[componentName][propertyName] = newEntityReferenceId;
          } else {
            Debug.warn('Could not find corresponding entity id when resolving duplicated entity references');
          }
        }
      }
    }

    if (components.script && !newEntity._app.useLegacyScriptAttributeCloning) {
      newEntity.script.resolveDuplicatedEntityReferenceProperties(components.script, duplicatedIdsMap);
    }

    if (components.render) {
      newEntity.render.resolveDuplicatedEntityReferenceProperties(components.render, duplicatedIdsMap);
    }

    if (components.anim) {
      newEntity.anim.resolveDuplicatedEntityReferenceProperties(components.anim, duplicatedIdsMap);
    }

    const _old = oldEntity.children.filter(function (e) {
      return e instanceof Entity;
    });

    const _new = newEntity.children.filter(function (e) {
      return e instanceof Entity;
    });

    for (let i = 0, len = _old.length; i < len; i++) {
      resolveDuplicatedEntityReferenceProperties(oldSubtreeRoot, _old[i], _new[i], duplicatedIdsMap);
    }
  }
}

export { Entity };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2VudGl0eS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgZ3VpZCB9IGZyb20gJy4uL2NvcmUvZ3VpZC5qcyc7XG5cbmltcG9ydCB7IEdyYXBoTm9kZSB9IGZyb20gJy4uL3NjZW5lL2dyYXBoLW5vZGUuanMnO1xuXG5pbXBvcnQgeyBBcHBCYXNlIH0gZnJvbSAnLi9hcHAtYmFzZS5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvY29tcG9uZW50LmpzJykuQ29tcG9uZW50fSBDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvYW5pbS9jb21wb25lbnQuanMnKS5BbmltQ29tcG9uZW50fSBBbmltQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2FuaW1hdGlvbi9jb21wb25lbnQuanMnKS5BbmltYXRpb25Db21wb25lbnR9IEFuaW1hdGlvbkNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9hdWRpby1saXN0ZW5lci9jb21wb25lbnQuanMnKS5BdWRpb0xpc3RlbmVyQ29tcG9uZW50fSBBdWRpb0xpc3RlbmVyQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2J1dHRvbi9jb21wb25lbnQuanMnKS5CdXR0b25Db21wb25lbnR9IEJ1dHRvbkNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9jYW1lcmEvY29tcG9uZW50LmpzJykuQ2FtZXJhQ29tcG9uZW50fSBDYW1lcmFDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvY29sbGlzaW9uL2NvbXBvbmVudC5qcycpLkNvbGxpc2lvbkNvbXBvbmVudH0gQ29sbGlzaW9uQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2VsZW1lbnQvY29tcG9uZW50LmpzJykuRWxlbWVudENvbXBvbmVudH0gRWxlbWVudENvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9sYXlvdXQtY2hpbGQvY29tcG9uZW50LmpzJykuTGF5b3V0Q2hpbGRDb21wb25lbnR9IExheW91dENoaWxkQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL2xheW91dC1ncm91cC9jb21wb25lbnQuanMnKS5MYXlvdXRHcm91cENvbXBvbmVudH0gTGF5b3V0R3JvdXBDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvbGlnaHQvY29tcG9uZW50LmpzJykuTGlnaHRDb21wb25lbnR9IExpZ2h0Q29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL21vZGVsL2NvbXBvbmVudC5qcycpLk1vZGVsQ29tcG9uZW50fSBNb2RlbENvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9wYXJ0aWNsZS1zeXN0ZW0vY29tcG9uZW50LmpzJykuUGFydGljbGVTeXN0ZW1Db21wb25lbnR9IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3JlbmRlci9jb21wb25lbnQuanMnKS5SZW5kZXJDb21wb25lbnR9IFJlbmRlckNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9yaWdpZC1ib2R5L2NvbXBvbmVudC5qcycpLlJpZ2lkQm9keUNvbXBvbmVudH0gUmlnaWRCb2R5Q29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3NjcmVlbi9jb21wb25lbnQuanMnKS5TY3JlZW5Db21wb25lbnR9IFNjcmVlbkNvbXBvbmVudCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vY29tcG9uZW50cy9zY3JpcHQvY29tcG9uZW50LmpzJykuU2NyaXB0Q29tcG9uZW50fSBTY3JpcHRDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvc2Nyb2xsYmFyL2NvbXBvbmVudC5qcycpLlNjcm9sbGJhckNvbXBvbmVudH0gU2Nyb2xsYmFyQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3Njcm9sbC12aWV3L2NvbXBvbmVudC5qcycpLlNjcm9sbFZpZXdDb21wb25lbnR9IFNjcm9sbFZpZXdDb21wb25lbnQgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2NvbXBvbmVudHMvc291bmQvY29tcG9uZW50LmpzJykuU291bmRDb21wb25lbnR9IFNvdW5kQ29tcG9uZW50ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9jb21wb25lbnRzL3Nwcml0ZS9jb21wb25lbnQuanMnKS5TcHJpdGVDb21wb25lbnR9IFNwcml0ZUNvbXBvbmVudCAqL1xuXG4vKipcbiAqIEB0eXBlIHtHcmFwaE5vZGVbXX1cbiAqIEBpZ25vcmVcbiAqL1xuY29uc3QgX2VuYWJsZUxpc3QgPSBbXTtcblxuLyoqXG4gKiBUaGUgRW50aXR5IGlzIHRoZSBjb3JlIHByaW1pdGl2ZSBvZiBhIFBsYXlDYW52YXMgZ2FtZS4gR2VuZXJhbGx5IHNwZWFraW5nIGFuIG9iamVjdCBpbiB5b3VyIGdhbWVcbiAqIHdpbGwgY29uc2lzdCBvZiBhbiB7QGxpbmsgRW50aXR5fSwgYW5kIGEgc2V0IG9mIHtAbGluayBDb21wb25lbnR9cyB3aGljaCBhcmUgbWFuYWdlZCBieSB0aGVpclxuICogcmVzcGVjdGl2ZSB7QGxpbmsgQ29tcG9uZW50U3lzdGVtfXMuIE9uZSBvZiB0aG9zZSBjb21wb25lbnRzIG1heWJlIGEge0BsaW5rIFNjcmlwdENvbXBvbmVudH1cbiAqIHdoaWNoIGFsbG93cyB5b3UgdG8gd3JpdGUgY3VzdG9tIGNvZGUgdG8gYXR0YWNoIHRvIHlvdXIgRW50aXR5LlxuICpcbiAqIFRoZSBFbnRpdHkgdW5pcXVlbHkgaWRlbnRpZmllcyB0aGUgb2JqZWN0IGFuZCBhbHNvIHByb3ZpZGVzIGEgdHJhbnNmb3JtIGZvciBwb3NpdGlvbiBhbmRcbiAqIG9yaWVudGF0aW9uIHdoaWNoIGl0IGluaGVyaXRzIGZyb20ge0BsaW5rIEdyYXBoTm9kZX0gc28gY2FuIGJlIGFkZGVkIGludG8gdGhlIHNjZW5lIGdyYXBoLiBUaGVcbiAqIENvbXBvbmVudCBhbmQgQ29tcG9uZW50U3lzdGVtIHByb3ZpZGUgdGhlIGxvZ2ljIHRvIGdpdmUgYW4gRW50aXR5IGEgc3BlY2lmaWMgdHlwZSBvZiBiZWhhdmlvci5cbiAqIGUuZy4gdGhlIGFiaWxpdHkgdG8gcmVuZGVyIGEgbW9kZWwgb3IgcGxheSBhIHNvdW5kLiBDb21wb25lbnRzIGFyZSBzcGVjaWZpYyB0byBhbiBpbnN0YW5jZSBvZiBhblxuICogRW50aXR5IGFuZCBhcmUgYXR0YWNoZWQgKGUuZy4gYHRoaXMuZW50aXR5Lm1vZGVsYCkgQ29tcG9uZW50U3lzdGVtcyBhbGxvdyBhY2Nlc3MgdG8gYWxsIEVudGl0aWVzXG4gKiBhbmQgQ29tcG9uZW50cyBhbmQgYXJlIGF0dGFjaGVkIHRvIHRoZSB7QGxpbmsgQXBwQmFzZX0uXG4gKlxuICogQGF1Z21lbnRzIEdyYXBoTm9kZVxuICovXG5jbGFzcyBFbnRpdHkgZXh0ZW5kcyBHcmFwaE5vZGUge1xuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBBbmltQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtBbmltQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBhbmltO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIEFuaW1hdGlvbkNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7QW5pbWF0aW9uQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBhbmltYXRpb247XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgQXVkaW9MaXN0ZW5lckNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7QXVkaW9MaXN0ZW5lckNvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgYXVkaW9saXN0ZW5lcjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBCdXR0b25Db21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge0J1dHRvbkNvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgYnV0dG9uO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIENhbWVyYUNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Q2FtZXJhQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBjYW1lcmE7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgQ29sbGlzaW9uQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtDb2xsaXNpb25Db21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIGNvbGxpc2lvbjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBFbGVtZW50Q29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtFbGVtZW50Q29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBlbGVtZW50O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIExheW91dENoaWxkQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtMYXlvdXRDaGlsZENvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgbGF5b3V0Y2hpbGQ7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgTGF5b3V0R3JvdXBDb21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge0xheW91dEdyb3VwQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBsYXlvdXRncm91cDtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBMaWdodENvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7TGlnaHRDb21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIGxpZ2h0O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIE1vZGVsQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtNb2RlbENvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgbW9kZWw7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgUGFydGljbGVTeXN0ZW1Db21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge1BhcnRpY2xlU3lzdGVtQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBwYXJ0aWNsZXN5c3RlbTtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBSZW5kZXJDb21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge1JlbmRlckNvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgcmVuZGVyO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIFJpZ2lkQm9keUNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7UmlnaWRCb2R5Q29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICByaWdpZGJvZHk7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgU2NyZWVuQ29tcG9uZW50fSBhdHRhY2hlZCB0byB0aGlzIGVudGl0eS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtTY3JlZW5Db21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIHNjcmVlbjtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBTY3JpcHRDb21wb25lbnR9IGF0dGFjaGVkIHRvIHRoaXMgZW50aXR5LlxuICAgICAqXG4gICAgICogQHR5cGUge1NjcmlwdENvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgc2NyaXB0O1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIFNjcm9sbGJhckNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U2Nyb2xsYmFyQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBzY3JvbGxiYXI7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSB7QGxpbmsgU2Nyb2xsVmlld0NvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U2Nyb2xsVmlld0NvbXBvbmVudHx1bmRlZmluZWR9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgc2Nyb2xsdmlldztcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHtAbGluayBTb3VuZENvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U291bmRDb21wb25lbnR8dW5kZWZpbmVkfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIHNvdW5kO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUge0BsaW5rIFNwcml0ZUNvbXBvbmVudH0gYXR0YWNoZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7U3ByaXRlQ29tcG9uZW50fHVuZGVmaW5lZH1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBzcHJpdGU7XG5cbiAgICAvKipcbiAgICAgKiBDb21wb25lbnQgc3RvcmFnZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLCBDb21wb25lbnQ+fVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjID0ge307XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7QXBwQmFzZX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9hcHA7XG5cbiAgICAvKipcbiAgICAgKiBVc2VkIGJ5IGNvbXBvbmVudCBzeXN0ZW1zIHRvIHNwZWVkIHVwIGRlc3RydWN0aW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIF9kZXN0cm95aW5nID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7c3RyaW5nfG51bGx9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ3VpZCA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBVc2VkIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiB0aGUgZW50aXRpZXMgb2YgYSB0ZW1wbGF0ZSByb290IGluc3RhbmNlLCB3aGljaCBoYXZlIGl0IHNldCB0b1xuICAgICAqIHRydWUsIGFuZCB0aGUgY2xvbmVkIGluc3RhbmNlIGVudGl0aWVzIChzZXQgdG8gZmFsc2UpLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIF90ZW1wbGF0ZSA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEVudGl0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbbmFtZV0gLSBUaGUgbm9uLXVuaXF1ZSBuYW1lIG9mIHRoZSBlbnRpdHksIGRlZmF1bHQgaXMgXCJVbnRpdGxlZFwiLlxuICAgICAqIEBwYXJhbSB7QXBwQmFzZX0gW2FwcF0gLSBUaGUgYXBwbGljYXRpb24gdGhlIGVudGl0eSBiZWxvbmdzIHRvLCBkZWZhdWx0IGlzIHRoZSBjdXJyZW50IGFwcGxpY2F0aW9uLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGVudGl0eSA9IG5ldyBwYy5FbnRpdHkoKTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhIENvbXBvbmVudCB0byB0aGUgRW50aXR5XG4gICAgICogZW50aXR5LmFkZENvbXBvbmVudChcImNhbWVyYVwiLCB7XG4gICAgICogICAgIGZvdjogNDUsXG4gICAgICogICAgIG5lYXJDbGlwOiAxLFxuICAgICAqICAgICBmYXJDbGlwOiAxMDAwMFxuICAgICAqIH0pO1xuICAgICAqXG4gICAgICogLy8gQWRkIHRoZSBFbnRpdHkgaW50byB0aGUgc2NlbmUgZ3JhcGhcbiAgICAgKiBhcHAucm9vdC5hZGRDaGlsZChlbnRpdHkpO1xuICAgICAqXG4gICAgICogLy8gTW92ZSB0aGUgZW50aXR5XG4gICAgICogZW50aXR5LnRyYW5zbGF0ZSgxMCwgMCwgMCk7XG4gICAgICpcbiAgICAgKiAvLyBPciB0cmFuc2xhdGUgaXQgYnkgc2V0dGluZyBpdHMgcG9zaXRpb24gZGlyZWN0bHlcbiAgICAgKiB2YXIgcCA9IGVudGl0eS5nZXRQb3NpdGlvbigpO1xuICAgICAqIGVudGl0eS5zZXRQb3NpdGlvbihwLnggKyAxMCwgcC55LCBwLnopO1xuICAgICAqXG4gICAgICogLy8gQ2hhbmdlIHRoZSBlbnRpdHkncyByb3RhdGlvbiBpbiBsb2NhbCBzcGFjZVxuICAgICAqIHZhciBlID0gZW50aXR5LmdldExvY2FsRXVsZXJBbmdsZXMoKTtcbiAgICAgKiBlbnRpdHkuc2V0TG9jYWxFdWxlckFuZ2xlcyhlLngsIGUueSArIDkwLCBlLnopO1xuICAgICAqXG4gICAgICogLy8gT3IgdXNlIHJvdGF0ZUxvY2FsXG4gICAgICogZW50aXR5LnJvdGF0ZUxvY2FsKDAsIDkwLCAwKTtcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBhcHApIHtcbiAgICAgICAgc3VwZXIobmFtZSk7XG5cbiAgICAgICAgaWYgKG5hbWUgaW5zdGFuY2VvZiBBcHBCYXNlKSBhcHAgPSBuYW1lO1xuXG4gICAgICAgIGlmICghYXBwKSB7XG4gICAgICAgICAgICBhcHAgPSBBcHBCYXNlLmdldEFwcGxpY2F0aW9uKCk7IC8vIGdldCB0aGUgY3VycmVudCBhcHBsaWNhdGlvblxuICAgICAgICAgICAgaWYgKCFhcHApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZG4ndCBmaW5kIGN1cnJlbnQgYXBwbGljYXRpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9hcHAgPSBhcHA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IGNvbXBvbmVudCBhbmQgYWRkIGl0IHRvIHRoZSBlbnRpdHkuIFVzZSB0aGlzIHRvIGFkZCBmdW5jdGlvbmFsaXR5IHRvIHRoZSBlbnRpdHlcbiAgICAgKiBsaWtlIHJlbmRlcmluZyBhIG1vZGVsLCBwbGF5aW5nIHNvdW5kcyBhbmQgc28gb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSBuYW1lIG9mIHRoZSBjb21wb25lbnQgdG8gYWRkLiBWYWxpZCBzdHJpbmdzIGFyZTpcbiAgICAgKlxuICAgICAqIC0gXCJhbmltXCIgLSBzZWUge0BsaW5rIEFuaW1Db21wb25lbnR9XG4gICAgICogLSBcImFuaW1hdGlvblwiIC0gc2VlIHtAbGluayBBbmltYXRpb25Db21wb25lbnR9XG4gICAgICogLSBcImF1ZGlvbGlzdGVuZXJcIiAtIHNlZSB7QGxpbmsgQXVkaW9MaXN0ZW5lckNvbXBvbmVudH1cbiAgICAgKiAtIFwiYnV0dG9uXCIgLSBzZWUge0BsaW5rIEJ1dHRvbkNvbXBvbmVudH1cbiAgICAgKiAtIFwiY2FtZXJhXCIgLSBzZWUge0BsaW5rIENhbWVyYUNvbXBvbmVudH1cbiAgICAgKiAtIFwiY29sbGlzaW9uXCIgLSBzZWUge0BsaW5rIENvbGxpc2lvbkNvbXBvbmVudH1cbiAgICAgKiAtIFwiZWxlbWVudFwiIC0gc2VlIHtAbGluayBFbGVtZW50Q29tcG9uZW50fVxuICAgICAqIC0gXCJsYXlvdXRjaGlsZFwiIC0gc2VlIHtAbGluayBMYXlvdXRDaGlsZENvbXBvbmVudH1cbiAgICAgKiAtIFwibGF5b3V0Z3JvdXBcIiAtIHNlZSB7QGxpbmsgTGF5b3V0R3JvdXBDb21wb25lbnR9XG4gICAgICogLSBcImxpZ2h0XCIgLSBzZWUge0BsaW5rIExpZ2h0Q29tcG9uZW50fVxuICAgICAqIC0gXCJtb2RlbFwiIC0gc2VlIHtAbGluayBNb2RlbENvbXBvbmVudH1cbiAgICAgKiAtIFwicGFydGljbGVzeXN0ZW1cIiAtIHNlZSB7QGxpbmsgUGFydGljbGVTeXN0ZW1Db21wb25lbnR9XG4gICAgICogLSBcInJlbmRlclwiIC0gc2VlIHtAbGluayBSZW5kZXJDb21wb25lbnR9XG4gICAgICogLSBcInJpZ2lkYm9keVwiIC0gc2VlIHtAbGluayBSaWdpZEJvZHlDb21wb25lbnR9XG4gICAgICogLSBcInNjcmVlblwiIC0gc2VlIHtAbGluayBTY3JlZW5Db21wb25lbnR9XG4gICAgICogLSBcInNjcmlwdFwiIC0gc2VlIHtAbGluayBTY3JpcHRDb21wb25lbnR9XG4gICAgICogLSBcInNjcm9sbGJhclwiIC0gc2VlIHtAbGluayBTY3JvbGxiYXJDb21wb25lbnR9XG4gICAgICogLSBcInNjcm9sbHZpZXdcIiAtIHNlZSB7QGxpbmsgU2Nyb2xsVmlld0NvbXBvbmVudH1cbiAgICAgKiAtIFwic291bmRcIiAtIHNlZSB7QGxpbmsgU291bmRDb21wb25lbnR9XG4gICAgICogLSBcInNwcml0ZVwiIC0gc2VlIHtAbGluayBTcHJpdGVDb21wb25lbnR9XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIC0gVGhlIGluaXRpYWxpemF0aW9uIGRhdGEgZm9yIHRoZSBzcGVjaWZpYyBjb21wb25lbnQgdHlwZS4gUmVmZXIgdG9cbiAgICAgKiBlYWNoIHNwZWNpZmljIGNvbXBvbmVudCdzIEFQSSByZWZlcmVuY2UgcGFnZSBmb3IgZGV0YWlscyBvbiB2YWxpZCB2YWx1ZXMgZm9yIHRoaXMgcGFyYW1ldGVyLlxuICAgICAqIEByZXR1cm5zIHtDb21wb25lbnR8bnVsbH0gVGhlIG5ldyBDb21wb25lbnQgdGhhdCB3YXMgYXR0YWNoZWQgdG8gdGhlIGVudGl0eSBvciBudWxsIGlmIHRoZXJlXG4gICAgICogd2FzIGFuIGVycm9yLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGVudGl0eSA9IG5ldyBwYy5FbnRpdHkoKTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhIGxpZ2h0IGNvbXBvbmVudCB3aXRoIGRlZmF1bHQgcHJvcGVydGllc1xuICAgICAqIGVudGl0eS5hZGRDb21wb25lbnQoXCJsaWdodFwiKTtcbiAgICAgKlxuICAgICAqIC8vIEFkZCBhIGNhbWVyYSBjb21wb25lbnQgd2l0aCBzb21lIHNwZWNpZmllZCBwcm9wZXJ0aWVzXG4gICAgICogZW50aXR5LmFkZENvbXBvbmVudChcImNhbWVyYVwiLCB7XG4gICAgICogICAgIGZvdjogNDUsXG4gICAgICogICAgIGNsZWFyQ29sb3I6IG5ldyBwYy5Db2xvcigxLCAwLCAwKVxuICAgICAqIH0pO1xuICAgICAqL1xuICAgIGFkZENvbXBvbmVudCh0eXBlLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IHRoaXMuX2FwcC5zeXN0ZW1zW3R5cGVdO1xuICAgICAgICBpZiAoIXN5c3RlbSkge1xuICAgICAgICAgICAgRGVidWcuZXJyb3IoYGFkZENvbXBvbmVudDogU3lzdGVtICR7dHlwZX0gZG9lc24ndCBleGlzdGApO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY1t0eXBlXSkge1xuICAgICAgICAgICAgRGVidWcud2FybihgYWRkQ29tcG9uZW50OiBFbnRpdHkgYWxyZWFkeSBoYXMgJHt0eXBlfSBjb21wb25lbnRgKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzeXN0ZW0uYWRkQ29tcG9uZW50KHRoaXMsIGRhdGEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIGNvbXBvbmVudCBmcm9tIHRoZSBFbnRpdHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSBuYW1lIG9mIHRoZSBDb21wb25lbnQgdHlwZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBlbnRpdHkgPSBuZXcgcGMuRW50aXR5KCk7XG4gICAgICogZW50aXR5LmFkZENvbXBvbmVudChcImxpZ2h0XCIpOyAvLyBhZGQgbmV3IGxpZ2h0IGNvbXBvbmVudFxuICAgICAqXG4gICAgICogZW50aXR5LnJlbW92ZUNvbXBvbmVudChcImxpZ2h0XCIpOyAvLyByZW1vdmUgbGlnaHQgY29tcG9uZW50XG4gICAgICovXG4gICAgcmVtb3ZlQ29tcG9uZW50KHR5cGUpIHtcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gdGhpcy5fYXBwLnN5c3RlbXNbdHlwZV07XG4gICAgICAgIGlmICghc3lzdGVtKSB7XG4gICAgICAgICAgICBEZWJ1Zy5lcnJvcihgYWRkQ29tcG9uZW50OiBTeXN0ZW0gJHt0eXBlfSBkb2Vzbid0IGV4aXN0YCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNbdHlwZV0pIHtcbiAgICAgICAgICAgIERlYnVnLndhcm4oYHJlbW92ZUNvbXBvbmVudDogRW50aXR5IGRvZXNuJ3QgaGF2ZSAke3R5cGV9IGNvbXBvbmVudGApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN5c3RlbS5yZW1vdmVDb21wb25lbnQodGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VhcmNoIHRoZSBlbnRpdHkgYW5kIGFsbCBvZiBpdHMgZGVzY2VuZGFudHMgZm9yIHRoZSBmaXJzdCBjb21wb25lbnQgb2Ygc3BlY2lmaWVkIHR5cGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSBuYW1lIG9mIHRoZSBjb21wb25lbnQgdHlwZSB0byByZXRyaWV2ZS5cbiAgICAgKiBAcmV0dXJucyB7Q29tcG9uZW50fSBBIGNvbXBvbmVudCBvZiBzcGVjaWZpZWQgdHlwZSwgaWYgdGhlIGVudGl0eSBvciBhbnkgb2YgaXRzIGRlc2NlbmRhbnRzXG4gICAgICogaGFzIG9uZS4gUmV0dXJucyB1bmRlZmluZWQgb3RoZXJ3aXNlLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gR2V0IHRoZSBmaXJzdCBmb3VuZCBsaWdodCBjb21wb25lbnQgaW4gdGhlIGhpZXJhcmNoeSB0cmVlIHRoYXQgc3RhcnRzIHdpdGggdGhpcyBlbnRpdHlcbiAgICAgKiB2YXIgbGlnaHQgPSBlbnRpdHkuZmluZENvbXBvbmVudChcImxpZ2h0XCIpO1xuICAgICAqL1xuICAgIGZpbmRDb21wb25lbnQodHlwZSkge1xuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmZpbmRPbmUoZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBub2RlLmMgJiYgbm9kZS5jW3R5cGVdO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGVudGl0eSAmJiBlbnRpdHkuY1t0eXBlXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2ggdGhlIGVudGl0eSBhbmQgYWxsIG9mIGl0cyBkZXNjZW5kYW50cyBmb3IgYWxsIGNvbXBvbmVudHMgb2Ygc3BlY2lmaWVkIHR5cGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSBuYW1lIG9mIHRoZSBjb21wb25lbnQgdHlwZSB0byByZXRyaWV2ZS5cbiAgICAgKiBAcmV0dXJucyB7Q29tcG9uZW50W119IEFsbCBjb21wb25lbnRzIG9mIHNwZWNpZmllZCB0eXBlIGluIHRoZSBlbnRpdHkgb3IgYW55IG9mIGl0c1xuICAgICAqIGRlc2NlbmRhbnRzLiBSZXR1cm5zIGVtcHR5IGFycmF5IGlmIG5vbmUgZm91bmQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAvLyBHZXQgYWxsIGxpZ2h0IGNvbXBvbmVudHMgaW4gdGhlIGhpZXJhcmNoeSB0cmVlIHRoYXQgc3RhcnRzIHdpdGggdGhpcyBlbnRpdHlcbiAgICAgKiB2YXIgbGlnaHRzID0gZW50aXR5LmZpbmRDb21wb25lbnRzKFwibGlnaHRcIik7XG4gICAgICovXG4gICAgZmluZENvbXBvbmVudHModHlwZSkge1xuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuZmluZChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5vZGUuYyAmJiBub2RlLmNbdHlwZV07XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZW50aXRpZXMubWFwKGZ1bmN0aW9uIChlbnRpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBlbnRpdHkuY1t0eXBlXTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBHVUlEIHZhbHVlIGZvciB0aGlzIEVudGl0eS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBHVUlEIG9mIHRoZSBFbnRpdHkuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGdldEd1aWQoKSB7XG4gICAgICAgIC8vIGlmIHRoZSBndWlkIGhhc24ndCBiZWVuIHNldCB5ZXQgdGhlbiBzZXQgaXQgbm93IGJlZm9yZSByZXR1cm5pbmcgaXRcbiAgICAgICAgaWYgKCF0aGlzLl9ndWlkKSB7XG4gICAgICAgICAgICB0aGlzLnNldEd1aWQoZ3VpZC5jcmVhdGUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fZ3VpZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIEdVSUQgdmFsdWUgZm9yIHRoaXMgRW50aXR5LiBOb3RlIHRoYXQgaXQgaXMgdW5saWtlbHkgdGhhdCB5b3Ugc2hvdWxkIG5lZWQgdG8gY2hhbmdlXG4gICAgICogdGhlIEdVSUQgdmFsdWUgb2YgYW4gRW50aXR5IGF0IHJ1bi10aW1lLiBEb2luZyBzbyB3aWxsIGNvcnJ1cHQgdGhlIGdyYXBoIHRoaXMgRW50aXR5IGlzIGluLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGd1aWQgLSBUaGUgR1VJRCB0byBhc3NpZ24gdG8gdGhlIEVudGl0eS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgc2V0R3VpZChndWlkKSB7XG4gICAgICAgIC8vIHJlbW92ZSBjdXJyZW50IGd1aWQgZnJvbSBlbnRpdHlJbmRleFxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2FwcC5fZW50aXR5SW5kZXg7XG4gICAgICAgIGlmICh0aGlzLl9ndWlkKSB7XG4gICAgICAgICAgICBkZWxldGUgaW5kZXhbdGhpcy5fZ3VpZF07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhZGQgbmV3IGd1aWQgdG8gZW50aXR5SW5kZXhcbiAgICAgICAgdGhpcy5fZ3VpZCA9IGd1aWQ7XG4gICAgICAgIGluZGV4W3RoaXMuX2d1aWRdID0gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0dyYXBoTm9kZX0gbm9kZSAtIFRoZSBub2RlIHRvIHVwZGF0ZS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGVuYWJsZWQgLSBFbmFibGUgb3IgZGlzYWJsZSB0aGUgbm9kZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9ub3RpZnlIaWVyYXJjaHlTdGF0ZUNoYW5nZWQobm9kZSwgZW5hYmxlZCkge1xuICAgICAgICBsZXQgZW5hYmxlRmlyc3QgPSBmYWxzZTtcbiAgICAgICAgaWYgKG5vZGUgPT09IHRoaXMgJiYgX2VuYWJsZUxpc3QubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgZW5hYmxlRmlyc3QgPSB0cnVlO1xuXG4gICAgICAgIG5vZGUuX2JlaW5nRW5hYmxlZCA9IHRydWU7XG5cbiAgICAgICAgbm9kZS5fb25IaWVyYXJjaHlTdGF0ZUNoYW5nZWQoZW5hYmxlZCk7XG5cbiAgICAgICAgaWYgKG5vZGUuX29uSGllcmFyY2h5U3RhdGVQb3N0Q2hhbmdlZClcbiAgICAgICAgICAgIF9lbmFibGVMaXN0LnB1c2gobm9kZSk7XG5cbiAgICAgICAgY29uc3QgYyA9IG5vZGUuX2NoaWxkcmVuO1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgaWYgKGNbaV0uX2VuYWJsZWQpXG4gICAgICAgICAgICAgICAgdGhpcy5fbm90aWZ5SGllcmFyY2h5U3RhdGVDaGFuZ2VkKGNbaV0sIGVuYWJsZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbm9kZS5fYmVpbmdFbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGVuYWJsZUZpcnN0KSB7XG4gICAgICAgICAgICAvLyBkbyBub3QgY2FjaGUgdGhlIGxlbmd0aCBoZXJlLCBhcyBlbmFibGVMaXN0IG1heSBiZSBhZGRlZCB0byBkdXJpbmcgbG9vcFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBfZW5hYmxlTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIF9lbmFibGVMaXN0W2ldLl9vbkhpZXJhcmNoeVN0YXRlUG9zdENoYW5nZWQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX2VuYWJsZUxpc3QubGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlZCAtIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBub2RlLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX29uSGllcmFyY2h5U3RhdGVDaGFuZ2VkKGVuYWJsZWQpIHtcbiAgICAgICAgc3VwZXIuX29uSGllcmFyY2h5U3RhdGVDaGFuZ2VkKGVuYWJsZWQpO1xuXG4gICAgICAgIC8vIGVuYWJsZSAvIGRpc2FibGUgYWxsIHRoZSBjb21wb25lbnRzXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLmM7XG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGNvbXBvbmVudHNbdHlwZV07XG4gICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQub25FbmFibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5vbkRpc2FibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAcHJpdmF0ZSAqL1xuICAgIF9vbkhpZXJhcmNoeVN0YXRlUG9zdENoYW5nZWQoKSB7XG4gICAgICAgIC8vIHBvc3QgZW5hYmxlIGFsbCB0aGUgY29tcG9uZW50c1xuICAgICAgICBjb25zdCBjb21wb25lbnRzID0gdGhpcy5jO1xuICAgICAgICBmb3IgKGNvbnN0IHR5cGUgaW4gY29tcG9uZW50cykge1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkodHlwZSkpXG4gICAgICAgICAgICAgICAgY29tcG9uZW50c1t0eXBlXS5vblBvc3RTdGF0ZUNoYW5nZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhIGRlc2NlbmRhbnQgb2YgdGhpcyBlbnRpdHkgd2l0aCB0aGUgR1VJRC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIC0gVGhlIEdVSUQgdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcmV0dXJucyB7RW50aXR5fG51bGx9IFRoZSBlbnRpdHkgd2l0aCB0aGUgbWF0Y2hpbmcgR1VJRCBvciBudWxsIGlmIG5vIGVudGl0eSBpcyBmb3VuZC5cbiAgICAgKi9cbiAgICBmaW5kQnlHdWlkKGd1aWQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2d1aWQgPT09IGd1aWQpIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLl9hcHAuX2VudGl0eUluZGV4W2d1aWRdO1xuICAgICAgICBpZiAoZSAmJiAoZSA9PT0gdGhpcyB8fCBlLmlzRGVzY2VuZGFudE9mKHRoaXMpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWxsIGNvbXBvbmVudHMgZnJvbSB0aGUgRW50aXR5IGFuZCBkZXRhY2ggaXQgZnJvbSB0aGUgRW50aXR5IGhpZXJhcmNoeS4gVGhlblxuICAgICAqIHJlY3Vyc2l2ZWx5IGRlc3Ryb3kgYWxsIGFuY2VzdG9yIEVudGl0aWVzLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgZmlyc3RDaGlsZCA9IHRoaXMuZW50aXR5LmNoaWxkcmVuWzBdO1xuICAgICAqIGZpcnN0Q2hpbGQuZGVzdHJveSgpOyAvLyBkZWxldGUgY2hpbGQsIGFsbCBjb21wb25lbnRzIGFuZCByZW1vdmUgZnJvbSBoaWVyYXJjaHlcbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95aW5nID0gdHJ1ZTtcblxuICAgICAgICAvLyBEaXNhYmxlIGFsbCBlbmFibGVkIGNvbXBvbmVudHMgZmlyc3RcbiAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIHRoaXMuYykge1xuICAgICAgICAgICAgdGhpcy5jW25hbWVdLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSBhbGwgY29tcG9uZW50c1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gdGhpcy5jKSB7XG4gICAgICAgICAgICB0aGlzLmNbbmFtZV0uc3lzdGVtLnJlbW92ZUNvbXBvbmVudCh0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERldGFjaCBmcm9tIHBhcmVudFxuICAgICAgICBpZiAodGhpcy5fcGFyZW50KVxuICAgICAgICAgICAgdGhpcy5fcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMpO1xuXG4gICAgICAgIC8vIHJlY3Vyc2l2ZWx5IGRlc3Ryb3kgYWxsIGNoaWxkcmVuXG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5fY2hpbGRyZW47XG4gICAgICAgIHdoaWxlIChjaGlsZHJlbi5sZW5ndGgpIHtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGEgY2hpbGQgZnJvbSB0aGUgYXJyYXkgYW5kIGRpc2Nvbm5lY3QgaXQgZnJvbSB0aGUgcGFyZW50XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuLnBvcCgpO1xuICAgICAgICAgICAgY2hpbGQuX3BhcmVudCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEVudGl0eSkge1xuICAgICAgICAgICAgICAgIGNoaWxkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGZpcmUgZGVzdHJveSBldmVudFxuICAgICAgICB0aGlzLmZpcmUoJ2Rlc3Ryb3knLCB0aGlzKTtcblxuICAgICAgICAvLyBjbGVhciBhbGwgZXZlbnRzXG4gICAgICAgIHRoaXMub2ZmKCk7XG5cbiAgICAgICAgLy8gcmVtb3ZlIGZyb20gZW50aXR5IGluZGV4XG4gICAgICAgIGlmICh0aGlzLl9ndWlkKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fYXBwLl9lbnRpdHlJbmRleFt0aGlzLl9ndWlkXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2Rlc3Ryb3lpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBkZWVwIGNvcHkgb2YgdGhlIEVudGl0eS4gRHVwbGljYXRlIHRoZSBmdWxsIEVudGl0eSBoaWVyYXJjaHksIHdpdGggYWxsIENvbXBvbmVudHNcbiAgICAgKiBhbmQgYWxsIGRlc2NlbmRhbnRzLiBOb3RlLCB0aGlzIEVudGl0eSBpcyBub3QgaW4gdGhlIGhpZXJhcmNoeSBhbmQgbXVzdCBiZSBhZGRlZCBtYW51YWxseS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt0aGlzfSBBIG5ldyBFbnRpdHkgd2hpY2ggaXMgYSBkZWVwIGNvcHkgb2YgdGhlIG9yaWdpbmFsLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGUgPSB0aGlzLmVudGl0eS5jbG9uZSgpO1xuICAgICAqXG4gICAgICogLy8gQWRkIGNsb25lIGFzIGEgc2libGluZyB0byB0aGUgb3JpZ2luYWxcbiAgICAgKiB0aGlzLmVudGl0eS5wYXJlbnQuYWRkQ2hpbGQoZSk7XG4gICAgICovXG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IGR1cGxpY2F0ZWRJZHNNYXAgPSB7fTtcbiAgICAgICAgY29uc3QgY2xvbmUgPSB0aGlzLl9jbG9uZVJlY3Vyc2l2ZWx5KGR1cGxpY2F0ZWRJZHNNYXApO1xuICAgICAgICBkdXBsaWNhdGVkSWRzTWFwW3RoaXMuZ2V0R3VpZCgpXSA9IGNsb25lO1xuXG4gICAgICAgIHJlc29sdmVEdXBsaWNhdGVkRW50aXR5UmVmZXJlbmNlUHJvcGVydGllcyh0aGlzLCB0aGlzLCBjbG9uZSwgZHVwbGljYXRlZElkc01hcCk7XG5cbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0PHN0cmluZywgRW50aXR5Pn0gZHVwbGljYXRlZElkc01hcCAtIEEgbWFwIG9mIG9yaWdpbmFsIGVudGl0eSBHVUlEcyB0byBjbG9uZWRcbiAgICAgKiBlbnRpdGllcy5cbiAgICAgKiBAcmV0dXJucyB7dGhpc30gQSBuZXcgRW50aXR5IHdoaWNoIGlzIGEgZGVlcCBjb3B5IG9mIHRoZSBvcmlnaW5hbC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jbG9uZVJlY3Vyc2l2ZWx5KGR1cGxpY2F0ZWRJZHNNYXApIHtcbiAgICAgICAgLyoqIEB0eXBlIHt0aGlzfSAqL1xuICAgICAgICBjb25zdCBjbG9uZSA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX2FwcCk7XG4gICAgICAgIHN1cGVyLl9jbG9uZUludGVybmFsKGNsb25lKTtcblxuICAgICAgICBmb3IgKGNvbnN0IHR5cGUgaW4gdGhpcy5jKSB7XG4gICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmNbdHlwZV07XG4gICAgICAgICAgICBjb21wb25lbnQuc3lzdGVtLmNsb25lQ29tcG9uZW50KHRoaXMsIGNsb25lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZENoaWxkID0gdGhpcy5fY2hpbGRyZW5baV07XG4gICAgICAgICAgICBpZiAob2xkQ2hpbGQgaW5zdGFuY2VvZiBFbnRpdHkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IG9sZENoaWxkLl9jbG9uZVJlY3Vyc2l2ZWx5KGR1cGxpY2F0ZWRJZHNNYXApO1xuICAgICAgICAgICAgICAgIGNsb25lLmFkZENoaWxkKG5ld0NoaWxkKTtcbiAgICAgICAgICAgICAgICBkdXBsaWNhdGVkSWRzTWFwW29sZENoaWxkLmdldEd1aWQoKV0gPSBuZXdDaGlsZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG59XG5cbi8vIFdoZW4gYW4gZW50aXR5IHRoYXQgaGFzIHByb3BlcnRpZXMgdGhhdCBjb250YWluIHJlZmVyZW5jZXMgdG8gb3RoZXJcbi8vIGVudGl0aWVzIHdpdGhpbiBpdHMgc3VidHJlZSBpcyBkdXBsaWNhdGVkLCB0aGUgZXhwZWN0YXRpb24gb2YgdGhlXG4vLyB1c2VyIGlzIGxpa2VseSB0aGF0IHRob3NlIHByb3BlcnRpZXMgd2lsbCBiZSB1cGRhdGVkIHRvIHBvaW50IHRvXG4vLyB0aGUgY29ycmVzcG9uZGluZyBlbnRpdGllcyB3aXRoaW4gdGhlIG5ld2x5LWNyZWF0ZWQgZHVwbGljYXRlIHN1YnRyZWUuXG4vL1xuLy8gVG8gaGFuZGxlIHRoaXMsIHdlIG5lZWQgdG8gc2VhcmNoIGZvciBwcm9wZXJ0aWVzIHRoYXQgcmVmZXIgdG8gZW50aXRpZXNcbi8vIHdpdGhpbiB0aGUgb2xkIGR1cGxpY2F0ZWQgc3RydWN0dXJlLCBmaW5kIHRoZWlyIG5ld2x5LWNsb25lZCBwYXJ0bmVyc1xuLy8gd2l0aGluIHRoZSBuZXcgc3RydWN0dXJlLCBhbmQgdXBkYXRlIHRoZSByZWZlcmVuY2VzIGFjY29yZGluZ2x5LiBUaGlzXG4vLyBmdW5jdGlvbiBpbXBsZW1lbnRzIHRoYXQgcmVxdWlyZW1lbnQuXG5mdW5jdGlvbiByZXNvbHZlRHVwbGljYXRlZEVudGl0eVJlZmVyZW5jZVByb3BlcnRpZXMob2xkU3VidHJlZVJvb3QsIG9sZEVudGl0eSwgbmV3RW50aXR5LCBkdXBsaWNhdGVkSWRzTWFwKSB7XG4gICAgaWYgKG9sZEVudGl0eSBpbnN0YW5jZW9mIEVudGl0eSkge1xuICAgICAgICBjb25zdCBjb21wb25lbnRzID0gb2xkRW50aXR5LmM7XG5cbiAgICAgICAgLy8gSGFuZGxlIGNvbXBvbmVudCBwcm9wZXJ0aWVzXG4gICAgICAgIGZvciAoY29uc3QgY29tcG9uZW50TmFtZSBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBjb21wb25lbnRzW2NvbXBvbmVudE5hbWVdO1xuICAgICAgICAgICAgY29uc3QgZW50aXR5UHJvcGVydGllcyA9IGNvbXBvbmVudC5zeXN0ZW0uZ2V0UHJvcGVydGllc09mVHlwZSgnZW50aXR5Jyk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBlbnRpdHlQcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlEZXNjcmlwdG9yID0gZW50aXR5UHJvcGVydGllc1tpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eURlc2NyaXB0b3IubmFtZTtcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRFbnRpdHlSZWZlcmVuY2VJZCA9IGNvbXBvbmVudFtwcm9wZXJ0eU5hbWVdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eUlzV2l0aGluT2xkU3VidHJlZSA9ICEhb2xkU3VidHJlZVJvb3QuZmluZEJ5R3VpZChvbGRFbnRpdHlSZWZlcmVuY2VJZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5SXNXaXRoaW5PbGRTdWJ0cmVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0VudGl0eVJlZmVyZW5jZUlkID0gZHVwbGljYXRlZElkc01hcFtvbGRFbnRpdHlSZWZlcmVuY2VJZF0uZ2V0R3VpZCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdFbnRpdHlSZWZlcmVuY2VJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RW50aXR5LmNbY29tcG9uZW50TmFtZV1bcHJvcGVydHlOYW1lXSA9IG5ld0VudGl0eVJlZmVyZW5jZUlkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcud2FybignQ291bGQgbm90IGZpbmQgY29ycmVzcG9uZGluZyBlbnRpdHkgaWQgd2hlbiByZXNvbHZpbmcgZHVwbGljYXRlZCBlbnRpdHkgcmVmZXJlbmNlcycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIGVudGl0eSBzY3JpcHQgYXR0cmlidXRlc1xuICAgICAgICBpZiAoY29tcG9uZW50cy5zY3JpcHQgJiYgIW5ld0VudGl0eS5fYXBwLnVzZUxlZ2FjeVNjcmlwdEF0dHJpYnV0ZUNsb25pbmcpIHtcbiAgICAgICAgICAgIG5ld0VudGl0eS5zY3JpcHQucmVzb2x2ZUR1cGxpY2F0ZWRFbnRpdHlSZWZlcmVuY2VQcm9wZXJ0aWVzKGNvbXBvbmVudHMuc2NyaXB0LCBkdXBsaWNhdGVkSWRzTWFwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSBlbnRpdHkgcmVuZGVyIGF0dHJpYnV0ZXNcbiAgICAgICAgaWYgKGNvbXBvbmVudHMucmVuZGVyKSB7XG4gICAgICAgICAgICBuZXdFbnRpdHkucmVuZGVyLnJlc29sdmVEdXBsaWNhdGVkRW50aXR5UmVmZXJlbmNlUHJvcGVydGllcyhjb21wb25lbnRzLnJlbmRlciwgZHVwbGljYXRlZElkc01hcCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYW5kbGUgZW50aXR5IGFuaW0gYXR0cmlidXRlc1xuICAgICAgICBpZiAoY29tcG9uZW50cy5hbmltKSB7XG4gICAgICAgICAgICBuZXdFbnRpdHkuYW5pbS5yZXNvbHZlRHVwbGljYXRlZEVudGl0eVJlZmVyZW5jZVByb3BlcnRpZXMoY29tcG9uZW50cy5hbmltLCBkdXBsaWNhdGVkSWRzTWFwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlY3Vyc2UgaW50byBjaGlsZHJlbi4gTm90ZSB0aGF0IHdlIGNvbnRpbnVlIHRvIHBhc3MgaW4gdGhlIHNhbWUgYG9sZFN1YnRyZWVSb290YCxcbiAgICAgICAgLy8gaW4gb3JkZXIgdG8gY29ycmVjdGx5IGhhbmRsZSBjYXNlcyB3aGVyZSBhIGNoaWxkIGhhcyBhbiBlbnRpdHkgcmVmZXJlbmNlXG4gICAgICAgIC8vIGZpZWxkIHRoYXQgcG9pbnRzIHRvIGEgcGFyZW50IG9yIG90aGVyIGFuY2VzdG9yIHRoYXQgaXMgc3RpbGwgd2l0aGluIHRoZVxuICAgICAgICAvLyBkdXBsaWNhdGVkIHN1YnRyZWUuXG4gICAgICAgIGNvbnN0IF9vbGQgPSBvbGRFbnRpdHkuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gKGUgaW5zdGFuY2VvZiBFbnRpdHkpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgX25ldyA9IG5ld0VudGl0eS5jaGlsZHJlbi5maWx0ZXIoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiAoZSBpbnN0YW5jZW9mIEVudGl0eSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBfb2xkLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICByZXNvbHZlRHVwbGljYXRlZEVudGl0eVJlZmVyZW5jZVByb3BlcnRpZXMob2xkU3VidHJlZVJvb3QsIF9vbGRbaV0sIF9uZXdbaV0sIGR1cGxpY2F0ZWRJZHNNYXApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEZpcmVkIGFmdGVyIHRoZSBlbnRpdHkgaXMgZGVzdHJveWVkLlxuICpcbiAqIEBldmVudCBFbnRpdHkjZGVzdHJveVxuICogQHBhcmFtIHtFbnRpdHl9IGVudGl0eSAtIFRoZSBlbnRpdHkgdGhhdCB3YXMgZGVzdHJveWVkLlxuICogQGV4YW1wbGVcbiAqIGVudGl0eS5vbihcImRlc3Ryb3lcIiwgZnVuY3Rpb24gKGUpIHtcbiAqICAgICBjb25zb2xlLmxvZygnZW50aXR5ICcgKyBlLm5hbWUgKyAnIGhhcyBiZWVuIGRlc3Ryb3llZCcpO1xuICogfSk7XG4gKi9cblxuZXhwb3J0IHsgRW50aXR5IH07XG4iXSwibmFtZXMiOlsiX2VuYWJsZUxpc3QiLCJFbnRpdHkiLCJHcmFwaE5vZGUiLCJjb25zdHJ1Y3RvciIsIm5hbWUiLCJhcHAiLCJhbmltIiwiYW5pbWF0aW9uIiwiYXVkaW9saXN0ZW5lciIsImJ1dHRvbiIsImNhbWVyYSIsImNvbGxpc2lvbiIsImVsZW1lbnQiLCJsYXlvdXRjaGlsZCIsImxheW91dGdyb3VwIiwibGlnaHQiLCJtb2RlbCIsInBhcnRpY2xlc3lzdGVtIiwicmVuZGVyIiwicmlnaWRib2R5Iiwic2NyZWVuIiwic2NyaXB0Iiwic2Nyb2xsYmFyIiwic2Nyb2xsdmlldyIsInNvdW5kIiwic3ByaXRlIiwiYyIsIl9hcHAiLCJfZGVzdHJveWluZyIsIl9ndWlkIiwiX3RlbXBsYXRlIiwiQXBwQmFzZSIsImdldEFwcGxpY2F0aW9uIiwiRXJyb3IiLCJhZGRDb21wb25lbnQiLCJ0eXBlIiwiZGF0YSIsInN5c3RlbSIsInN5c3RlbXMiLCJEZWJ1ZyIsImVycm9yIiwid2FybiIsInJlbW92ZUNvbXBvbmVudCIsImZpbmRDb21wb25lbnQiLCJlbnRpdHkiLCJmaW5kT25lIiwibm9kZSIsImZpbmRDb21wb25lbnRzIiwiZW50aXRpZXMiLCJmaW5kIiwibWFwIiwiZ2V0R3VpZCIsInNldEd1aWQiLCJndWlkIiwiY3JlYXRlIiwiaW5kZXgiLCJfZW50aXR5SW5kZXgiLCJfbm90aWZ5SGllcmFyY2h5U3RhdGVDaGFuZ2VkIiwiZW5hYmxlZCIsImVuYWJsZUZpcnN0IiwibGVuZ3RoIiwiX2JlaW5nRW5hYmxlZCIsIl9vbkhpZXJhcmNoeVN0YXRlQ2hhbmdlZCIsIl9vbkhpZXJhcmNoeVN0YXRlUG9zdENoYW5nZWQiLCJwdXNoIiwiX2NoaWxkcmVuIiwiaSIsImxlbiIsIl9lbmFibGVkIiwiY29tcG9uZW50cyIsImhhc093blByb3BlcnR5IiwiY29tcG9uZW50Iiwib25FbmFibGUiLCJvbkRpc2FibGUiLCJvblBvc3RTdGF0ZUNoYW5nZSIsImZpbmRCeUd1aWQiLCJlIiwiaXNEZXNjZW5kYW50T2YiLCJkZXN0cm95IiwiX3BhcmVudCIsInJlbW92ZUNoaWxkIiwiY2hpbGRyZW4iLCJjaGlsZCIsInBvcCIsImZpcmUiLCJvZmYiLCJjbG9uZSIsImR1cGxpY2F0ZWRJZHNNYXAiLCJfY2xvbmVSZWN1cnNpdmVseSIsInJlc29sdmVEdXBsaWNhdGVkRW50aXR5UmVmZXJlbmNlUHJvcGVydGllcyIsIl9jbG9uZUludGVybmFsIiwiY2xvbmVDb21wb25lbnQiLCJvbGRDaGlsZCIsIm5ld0NoaWxkIiwiYWRkQ2hpbGQiLCJvbGRTdWJ0cmVlUm9vdCIsIm9sZEVudGl0eSIsIm5ld0VudGl0eSIsImNvbXBvbmVudE5hbWUiLCJlbnRpdHlQcm9wZXJ0aWVzIiwiZ2V0UHJvcGVydGllc09mVHlwZSIsInByb3BlcnR5RGVzY3JpcHRvciIsInByb3BlcnR5TmFtZSIsIm9sZEVudGl0eVJlZmVyZW5jZUlkIiwiZW50aXR5SXNXaXRoaW5PbGRTdWJ0cmVlIiwibmV3RW50aXR5UmVmZXJlbmNlSWQiLCJ1c2VMZWdhY3lTY3JpcHRBdHRyaWJ1dGVDbG9uaW5nIiwiX29sZCIsImZpbHRlciIsIl9uZXciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFpQ0EsTUFBTUEsV0FBVyxHQUFHLEVBQXBCLENBQUE7O0FBaUJBLE1BQU1DLE1BQU4sU0FBcUJDLFNBQXJCLENBQStCO0FBc08zQkMsRUFBQUEsV0FBVyxDQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBWTtBQUNuQixJQUFBLEtBQUEsQ0FBTUQsSUFBTixDQUFBLENBQUE7QUFEbUIsSUFBQSxJQUFBLENBL052QkUsSUErTnVCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0F2TnZCQyxTQXVOdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQS9NdkJDLGFBK011QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBdk12QkMsTUF1TXVCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0EvTHZCQyxNQStMdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQXZMdkJDLFNBdUx1QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBL0t2QkMsT0ErS3VCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0F2S3ZCQyxXQXVLdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQS9KdkJDLFdBK0p1QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBdkp2QkMsS0F1SnVCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0EvSXZCQyxLQStJdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQXZJdkJDLGNBdUl1QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBL0h2QkMsTUErSHVCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0F2SHZCQyxTQXVIdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQS9HdkJDLE1BK0d1QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBdkd2QkMsTUF1R3VCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0EvRnZCQyxTQStGdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQXZGdkJDLFVBdUZ1QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBL0V2QkMsS0ErRXVCLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0F2RXZCQyxNQXVFdUIsR0FBQSxLQUFBLENBQUEsQ0FBQTtJQUFBLElBL0R2QkMsQ0FBQUEsQ0ErRHVCLEdBL0RuQixFQStEbUIsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQXpEdkJDLElBeUR1QixHQUFBLEtBQUEsQ0FBQSxDQUFBO0lBQUEsSUFqRHZCQyxDQUFBQSxXQWlEdUIsR0FqRFQsS0FpRFMsQ0FBQTtJQUFBLElBM0N2QkMsQ0FBQUEsS0EyQ3VCLEdBM0NmLElBMkNlLENBQUE7SUFBQSxJQWxDdkJDLENBQUFBLFNBa0N1QixHQWxDWCxLQWtDVyxDQUFBO0FBR25CLElBQUEsSUFBSTFCLElBQUksWUFBWTJCLE9BQXBCLEVBQTZCMUIsR0FBRyxHQUFHRCxJQUFOLENBQUE7O0lBRTdCLElBQUksQ0FBQ0MsR0FBTCxFQUFVO0FBQ05BLE1BQUFBLEdBQUcsR0FBRzBCLE9BQU8sQ0FBQ0MsY0FBUixFQUFOLENBQUE7O01BQ0EsSUFBSSxDQUFDM0IsR0FBTCxFQUFVO0FBQ04sUUFBQSxNQUFNLElBQUk0QixLQUFKLENBQVUsbUNBQVYsQ0FBTixDQUFBO0FBQ0gsT0FBQTtBQUNKLEtBQUE7O0lBRUQsSUFBS04sQ0FBQUEsSUFBTCxHQUFZdEIsR0FBWixDQUFBO0FBQ0gsR0FBQTs7QUE2Q0Q2QixFQUFBQSxZQUFZLENBQUNDLElBQUQsRUFBT0MsSUFBUCxFQUFhO0lBQ3JCLE1BQU1DLE1BQU0sR0FBRyxJQUFLVixDQUFBQSxJQUFMLENBQVVXLE9BQVYsQ0FBa0JILElBQWxCLENBQWYsQ0FBQTs7SUFDQSxJQUFJLENBQUNFLE1BQUwsRUFBYTtBQUNURSxNQUFBQSxLQUFLLENBQUNDLEtBQU4sQ0FBYSxDQUFBLHFCQUFBLEVBQXVCTCxJQUFLLENBQXpDLGNBQUEsQ0FBQSxDQUFBLENBQUE7QUFDQSxNQUFBLE9BQU8sSUFBUCxDQUFBO0FBQ0gsS0FBQTs7QUFDRCxJQUFBLElBQUksSUFBS1QsQ0FBQUEsQ0FBTCxDQUFPUyxJQUFQLENBQUosRUFBa0I7QUFDZEksTUFBQUEsS0FBSyxDQUFDRSxJQUFOLENBQVksQ0FBQSxpQ0FBQSxFQUFtQ04sSUFBSyxDQUFwRCxVQUFBLENBQUEsQ0FBQSxDQUFBO0FBQ0EsTUFBQSxPQUFPLElBQVAsQ0FBQTtBQUNILEtBQUE7O0FBQ0QsSUFBQSxPQUFPRSxNQUFNLENBQUNILFlBQVAsQ0FBb0IsSUFBcEIsRUFBMEJFLElBQTFCLENBQVAsQ0FBQTtBQUNILEdBQUE7O0VBWURNLGVBQWUsQ0FBQ1AsSUFBRCxFQUFPO0lBQ2xCLE1BQU1FLE1BQU0sR0FBRyxJQUFLVixDQUFBQSxJQUFMLENBQVVXLE9BQVYsQ0FBa0JILElBQWxCLENBQWYsQ0FBQTs7SUFDQSxJQUFJLENBQUNFLE1BQUwsRUFBYTtBQUNURSxNQUFBQSxLQUFLLENBQUNDLEtBQU4sQ0FBYSxDQUFBLHFCQUFBLEVBQXVCTCxJQUFLLENBQXpDLGNBQUEsQ0FBQSxDQUFBLENBQUE7QUFDQSxNQUFBLE9BQUE7QUFDSCxLQUFBOztBQUNELElBQUEsSUFBSSxDQUFDLElBQUtULENBQUFBLENBQUwsQ0FBT1MsSUFBUCxDQUFMLEVBQW1CO0FBQ2ZJLE1BQUFBLEtBQUssQ0FBQ0UsSUFBTixDQUFZLENBQUEscUNBQUEsRUFBdUNOLElBQUssQ0FBeEQsVUFBQSxDQUFBLENBQUEsQ0FBQTtBQUNBLE1BQUEsT0FBQTtBQUNILEtBQUE7O0lBQ0RFLE1BQU0sQ0FBQ0ssZUFBUCxDQUF1QixJQUF2QixDQUFBLENBQUE7QUFDSCxHQUFBOztFQVlEQyxhQUFhLENBQUNSLElBQUQsRUFBTztBQUNoQixJQUFBLE1BQU1TLE1BQU0sR0FBRyxJQUFBLENBQUtDLE9BQUwsQ0FBYSxVQUFVQyxJQUFWLEVBQWdCO01BQ3hDLE9BQU9BLElBQUksQ0FBQ3BCLENBQUwsSUFBVW9CLElBQUksQ0FBQ3BCLENBQUwsQ0FBT1MsSUFBUCxDQUFqQixDQUFBO0FBQ0gsS0FGYyxDQUFmLENBQUE7QUFHQSxJQUFBLE9BQU9TLE1BQU0sSUFBSUEsTUFBTSxDQUFDbEIsQ0FBUCxDQUFTUyxJQUFULENBQWpCLENBQUE7QUFDSCxHQUFBOztFQVlEWSxjQUFjLENBQUNaLElBQUQsRUFBTztBQUNqQixJQUFBLE1BQU1hLFFBQVEsR0FBRyxJQUFBLENBQUtDLElBQUwsQ0FBVSxVQUFVSCxJQUFWLEVBQWdCO01BQ3ZDLE9BQU9BLElBQUksQ0FBQ3BCLENBQUwsSUFBVW9CLElBQUksQ0FBQ3BCLENBQUwsQ0FBT1MsSUFBUCxDQUFqQixDQUFBO0FBQ0gsS0FGZ0IsQ0FBakIsQ0FBQTtBQUdBLElBQUEsT0FBT2EsUUFBUSxDQUFDRSxHQUFULENBQWEsVUFBVU4sTUFBVixFQUFrQjtBQUNsQyxNQUFBLE9BQU9BLE1BQU0sQ0FBQ2xCLENBQVAsQ0FBU1MsSUFBVCxDQUFQLENBQUE7QUFDSCxLQUZNLENBQVAsQ0FBQTtBQUdILEdBQUE7O0FBUURnQixFQUFBQSxPQUFPLEdBQUc7SUFFTixJQUFJLENBQUMsSUFBS3RCLENBQUFBLEtBQVYsRUFBaUI7QUFDYixNQUFBLElBQUEsQ0FBS3VCLE9BQUwsQ0FBYUMsSUFBSSxDQUFDQyxNQUFMLEVBQWIsQ0FBQSxDQUFBO0FBQ0gsS0FBQTs7QUFFRCxJQUFBLE9BQU8sS0FBS3pCLEtBQVosQ0FBQTtBQUNILEdBQUE7O0VBU0R1QixPQUFPLENBQUNDLElBQUQsRUFBTztBQUVWLElBQUEsTUFBTUUsS0FBSyxHQUFHLElBQUs1QixDQUFBQSxJQUFMLENBQVU2QixZQUF4QixDQUFBOztJQUNBLElBQUksSUFBQSxDQUFLM0IsS0FBVCxFQUFnQjtBQUNaLE1BQUEsT0FBTzBCLEtBQUssQ0FBQyxJQUFLMUIsQ0FBQUEsS0FBTixDQUFaLENBQUE7QUFDSCxLQUFBOztJQUdELElBQUtBLENBQUFBLEtBQUwsR0FBYXdCLElBQWIsQ0FBQTtBQUNBRSxJQUFBQSxLQUFLLENBQUMsSUFBQSxDQUFLMUIsS0FBTixDQUFMLEdBQW9CLElBQXBCLENBQUE7QUFDSCxHQUFBOztBQU9ENEIsRUFBQUEsNEJBQTRCLENBQUNYLElBQUQsRUFBT1ksT0FBUCxFQUFnQjtJQUN4QyxJQUFJQyxXQUFXLEdBQUcsS0FBbEIsQ0FBQTtBQUNBLElBQUEsSUFBSWIsSUFBSSxLQUFLLElBQVQsSUFBaUI5QyxXQUFXLENBQUM0RCxNQUFaLEtBQXVCLENBQTVDLEVBQ0lELFdBQVcsR0FBRyxJQUFkLENBQUE7SUFFSmIsSUFBSSxDQUFDZSxhQUFMLEdBQXFCLElBQXJCLENBQUE7O0lBRUFmLElBQUksQ0FBQ2dCLHdCQUFMLENBQThCSixPQUE5QixDQUFBLENBQUE7O0lBRUEsSUFBSVosSUFBSSxDQUFDaUIsNEJBQVQsRUFDSS9ELFdBQVcsQ0FBQ2dFLElBQVosQ0FBaUJsQixJQUFqQixDQUFBLENBQUE7QUFFSixJQUFBLE1BQU1wQixDQUFDLEdBQUdvQixJQUFJLENBQUNtQixTQUFmLENBQUE7O0FBQ0EsSUFBQSxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFSLEVBQVdDLEdBQUcsR0FBR3pDLENBQUMsQ0FBQ2tDLE1BQXhCLEVBQWdDTSxDQUFDLEdBQUdDLEdBQXBDLEVBQXlDRCxDQUFDLEVBQTFDLEVBQThDO0FBQzFDLE1BQUEsSUFBSXhDLENBQUMsQ0FBQ3dDLENBQUQsQ0FBRCxDQUFLRSxRQUFULEVBQ0ksSUFBS1gsQ0FBQUEsNEJBQUwsQ0FBa0MvQixDQUFDLENBQUN3QyxDQUFELENBQW5DLEVBQXdDUixPQUF4QyxDQUFBLENBQUE7QUFDUCxLQUFBOztJQUVEWixJQUFJLENBQUNlLGFBQUwsR0FBcUIsS0FBckIsQ0FBQTs7QUFFQSxJQUFBLElBQUlGLFdBQUosRUFBaUI7QUFFYixNQUFBLEtBQUssSUFBSU8sQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR2xFLFdBQVcsQ0FBQzRELE1BQWhDLEVBQXdDTSxDQUFDLEVBQXpDLEVBQTZDO0FBQ3pDbEUsUUFBQUEsV0FBVyxDQUFDa0UsQ0FBRCxDQUFYLENBQWVILDRCQUFmLEVBQUEsQ0FBQTtBQUNILE9BQUE7O01BRUQvRCxXQUFXLENBQUM0RCxNQUFaLEdBQXFCLENBQXJCLENBQUE7QUFDSCxLQUFBO0FBQ0osR0FBQTs7RUFNREUsd0JBQXdCLENBQUNKLE9BQUQsRUFBVTtJQUM5QixLQUFNSSxDQUFBQSx3QkFBTixDQUErQkosT0FBL0IsQ0FBQSxDQUFBOztJQUdBLE1BQU1XLFVBQVUsR0FBRyxJQUFBLENBQUszQyxDQUF4QixDQUFBOztBQUNBLElBQUEsS0FBSyxNQUFNUyxJQUFYLElBQW1Ca0MsVUFBbkIsRUFBK0I7QUFDM0IsTUFBQSxJQUFJQSxVQUFVLENBQUNDLGNBQVgsQ0FBMEJuQyxJQUExQixDQUFKLEVBQXFDO0FBQ2pDLFFBQUEsTUFBTW9DLFNBQVMsR0FBR0YsVUFBVSxDQUFDbEMsSUFBRCxDQUE1QixDQUFBOztRQUNBLElBQUlvQyxTQUFTLENBQUNiLE9BQWQsRUFBdUI7QUFDbkIsVUFBQSxJQUFJQSxPQUFKLEVBQWE7QUFDVGEsWUFBQUEsU0FBUyxDQUFDQyxRQUFWLEVBQUEsQ0FBQTtBQUNILFdBRkQsTUFFTztBQUNIRCxZQUFBQSxTQUFTLENBQUNFLFNBQVYsRUFBQSxDQUFBO0FBQ0gsV0FBQTtBQUNKLFNBQUE7QUFDSixPQUFBO0FBQ0osS0FBQTtBQUNKLEdBQUE7O0FBR0RWLEVBQUFBLDRCQUE0QixHQUFHO0lBRTNCLE1BQU1NLFVBQVUsR0FBRyxJQUFBLENBQUszQyxDQUF4QixDQUFBOztBQUNBLElBQUEsS0FBSyxNQUFNUyxJQUFYLElBQW1Ca0MsVUFBbkIsRUFBK0I7QUFDM0IsTUFBQSxJQUFJQSxVQUFVLENBQUNDLGNBQVgsQ0FBMEJuQyxJQUExQixDQUFKLEVBQ0lrQyxVQUFVLENBQUNsQyxJQUFELENBQVYsQ0FBaUJ1QyxpQkFBakIsRUFBQSxDQUFBO0FBQ1AsS0FBQTtBQUNKLEdBQUE7O0VBUURDLFVBQVUsQ0FBQ3RCLElBQUQsRUFBTztBQUNiLElBQUEsSUFBSSxLQUFLeEIsS0FBTCxLQUFld0IsSUFBbkIsRUFBeUIsT0FBTyxJQUFQLENBQUE7SUFFekIsTUFBTXVCLENBQUMsR0FBRyxJQUFLakQsQ0FBQUEsSUFBTCxDQUFVNkIsWUFBVixDQUF1QkgsSUFBdkIsQ0FBVixDQUFBOztBQUNBLElBQUEsSUFBSXVCLENBQUMsS0FBS0EsQ0FBQyxLQUFLLElBQU4sSUFBY0EsQ0FBQyxDQUFDQyxjQUFGLENBQWlCLElBQWpCLENBQW5CLENBQUwsRUFBaUQ7QUFDN0MsTUFBQSxPQUFPRCxDQUFQLENBQUE7QUFDSCxLQUFBOztBQUVELElBQUEsT0FBTyxJQUFQLENBQUE7QUFDSCxHQUFBOztBQVVERSxFQUFBQSxPQUFPLEdBQUc7SUFDTixJQUFLbEQsQ0FBQUEsV0FBTCxHQUFtQixJQUFuQixDQUFBOztBQUdBLElBQUEsS0FBSyxNQUFNeEIsSUFBWCxJQUFtQixJQUFBLENBQUtzQixDQUF4QixFQUEyQjtBQUN2QixNQUFBLElBQUEsQ0FBS0EsQ0FBTCxDQUFPdEIsSUFBUCxDQUFhc0QsQ0FBQUEsT0FBYixHQUF1QixLQUF2QixDQUFBO0FBQ0gsS0FBQTs7QUFHRCxJQUFBLEtBQUssTUFBTXRELElBQVgsSUFBbUIsSUFBQSxDQUFLc0IsQ0FBeEIsRUFBMkI7TUFDdkIsSUFBS0EsQ0FBQUEsQ0FBTCxDQUFPdEIsSUFBUCxDQUFBLENBQWFpQyxNQUFiLENBQW9CSyxlQUFwQixDQUFvQyxJQUFwQyxDQUFBLENBQUE7QUFDSCxLQUFBOztJQUdELElBQUksSUFBQSxDQUFLcUMsT0FBVCxFQUNJLElBQUEsQ0FBS0EsT0FBTCxDQUFhQyxXQUFiLENBQXlCLElBQXpCLENBQUEsQ0FBQTtJQUdKLE1BQU1DLFFBQVEsR0FBRyxJQUFBLENBQUtoQixTQUF0QixDQUFBOztJQUNBLE9BQU9nQixRQUFRLENBQUNyQixNQUFoQixFQUF3QjtBQUdwQixNQUFBLE1BQU1zQixLQUFLLEdBQUdELFFBQVEsQ0FBQ0UsR0FBVCxFQUFkLENBQUE7TUFDQUQsS0FBSyxDQUFDSCxPQUFOLEdBQWdCLElBQWhCLENBQUE7O01BRUEsSUFBSUcsS0FBSyxZQUFZakYsTUFBckIsRUFBNkI7QUFDekJpRixRQUFBQSxLQUFLLENBQUNKLE9BQU4sRUFBQSxDQUFBO0FBQ0gsT0FBQTtBQUNKLEtBQUE7O0FBR0QsSUFBQSxJQUFBLENBQUtNLElBQUwsQ0FBVSxTQUFWLEVBQXFCLElBQXJCLENBQUEsQ0FBQTtBQUdBLElBQUEsSUFBQSxDQUFLQyxHQUFMLEVBQUEsQ0FBQTs7SUFHQSxJQUFJLElBQUEsQ0FBS3hELEtBQVQsRUFBZ0I7QUFDWixNQUFBLE9BQU8sS0FBS0YsSUFBTCxDQUFVNkIsWUFBVixDQUF1QixJQUFBLENBQUszQixLQUE1QixDQUFQLENBQUE7QUFDSCxLQUFBOztJQUVELElBQUtELENBQUFBLFdBQUwsR0FBbUIsS0FBbkIsQ0FBQTtBQUNILEdBQUE7O0FBYUQwRCxFQUFBQSxLQUFLLEdBQUc7SUFDSixNQUFNQyxnQkFBZ0IsR0FBRyxFQUF6QixDQUFBOztBQUNBLElBQUEsTUFBTUQsS0FBSyxHQUFHLElBQUEsQ0FBS0UsaUJBQUwsQ0FBdUJELGdCQUF2QixDQUFkLENBQUE7O0FBQ0FBLElBQUFBLGdCQUFnQixDQUFDLElBQUtwQyxDQUFBQSxPQUFMLEVBQUQsQ0FBaEIsR0FBbUNtQyxLQUFuQyxDQUFBO0lBRUFHLDBDQUEwQyxDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWFILEtBQWIsRUFBb0JDLGdCQUFwQixDQUExQyxDQUFBO0FBRUEsSUFBQSxPQUFPRCxLQUFQLENBQUE7QUFDSCxHQUFBOztFQVFERSxpQkFBaUIsQ0FBQ0QsZ0JBQUQsRUFBbUI7SUFFaEMsTUFBTUQsS0FBSyxHQUFHLElBQUksSUFBQSxDQUFLbkYsV0FBVCxDQUFxQixJQUFBLENBQUt3QixJQUExQixDQUFkLENBQUE7O0lBQ0EsS0FBTStELENBQUFBLGNBQU4sQ0FBcUJKLEtBQXJCLENBQUEsQ0FBQTs7QUFFQSxJQUFBLEtBQUssTUFBTW5ELElBQVgsSUFBbUIsSUFBQSxDQUFLVCxDQUF4QixFQUEyQjtBQUN2QixNQUFBLE1BQU02QyxTQUFTLEdBQUcsSUFBQSxDQUFLN0MsQ0FBTCxDQUFPUyxJQUFQLENBQWxCLENBQUE7QUFDQW9DLE1BQUFBLFNBQVMsQ0FBQ2xDLE1BQVYsQ0FBaUJzRCxjQUFqQixDQUFnQyxJQUFoQyxFQUFzQ0wsS0FBdEMsQ0FBQSxDQUFBO0FBQ0gsS0FBQTs7QUFFRCxJQUFBLEtBQUssSUFBSXBCLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUcsSUFBS0QsQ0FBQUEsU0FBTCxDQUFlTCxNQUFuQyxFQUEyQ00sQ0FBQyxFQUE1QyxFQUFnRDtBQUM1QyxNQUFBLE1BQU0wQixRQUFRLEdBQUcsSUFBQSxDQUFLM0IsU0FBTCxDQUFlQyxDQUFmLENBQWpCLENBQUE7O01BQ0EsSUFBSTBCLFFBQVEsWUFBWTNGLE1BQXhCLEVBQWdDO0FBQzVCLFFBQUEsTUFBTTRGLFFBQVEsR0FBR0QsUUFBUSxDQUFDSixpQkFBVCxDQUEyQkQsZ0JBQTNCLENBQWpCLENBQUE7O1FBQ0FELEtBQUssQ0FBQ1EsUUFBTixDQUFlRCxRQUFmLENBQUEsQ0FBQTtBQUNBTixRQUFBQSxnQkFBZ0IsQ0FBQ0ssUUFBUSxDQUFDekMsT0FBVCxFQUFELENBQWhCLEdBQXVDMEMsUUFBdkMsQ0FBQTtBQUNILE9BQUE7QUFDSixLQUFBOztBQUVELElBQUEsT0FBT1AsS0FBUCxDQUFBO0FBQ0gsR0FBQTs7QUFsa0IwQixDQUFBOztBQThrQi9CLFNBQVNHLDBDQUFULENBQW9ETSxjQUFwRCxFQUFvRUMsU0FBcEUsRUFBK0VDLFNBQS9FLEVBQTBGVixnQkFBMUYsRUFBNEc7RUFDeEcsSUFBSVMsU0FBUyxZQUFZL0YsTUFBekIsRUFBaUM7QUFDN0IsSUFBQSxNQUFNb0UsVUFBVSxHQUFHMkIsU0FBUyxDQUFDdEUsQ0FBN0IsQ0FBQTs7QUFHQSxJQUFBLEtBQUssTUFBTXdFLGFBQVgsSUFBNEI3QixVQUE1QixFQUF3QztBQUNwQyxNQUFBLE1BQU1FLFNBQVMsR0FBR0YsVUFBVSxDQUFDNkIsYUFBRCxDQUE1QixDQUFBO01BQ0EsTUFBTUMsZ0JBQWdCLEdBQUc1QixTQUFTLENBQUNsQyxNQUFWLENBQWlCK0QsbUJBQWpCLENBQXFDLFFBQXJDLENBQXpCLENBQUE7O0FBRUEsTUFBQSxLQUFLLElBQUlsQyxDQUFDLEdBQUcsQ0FBUixFQUFXQyxHQUFHLEdBQUdnQyxnQkFBZ0IsQ0FBQ3ZDLE1BQXZDLEVBQStDTSxDQUFDLEdBQUdDLEdBQW5ELEVBQXdERCxDQUFDLEVBQXpELEVBQTZEO0FBQ3pELFFBQUEsTUFBTW1DLGtCQUFrQixHQUFHRixnQkFBZ0IsQ0FBQ2pDLENBQUQsQ0FBM0MsQ0FBQTtBQUNBLFFBQUEsTUFBTW9DLFlBQVksR0FBR0Qsa0JBQWtCLENBQUNqRyxJQUF4QyxDQUFBO0FBQ0EsUUFBQSxNQUFNbUcsb0JBQW9CLEdBQUdoQyxTQUFTLENBQUMrQixZQUFELENBQXRDLENBQUE7UUFDQSxNQUFNRSx3QkFBd0IsR0FBRyxDQUFDLENBQUNULGNBQWMsQ0FBQ3BCLFVBQWYsQ0FBMEI0QixvQkFBMUIsQ0FBbkMsQ0FBQTs7QUFFQSxRQUFBLElBQUlDLHdCQUFKLEVBQThCO1VBQzFCLE1BQU1DLG9CQUFvQixHQUFHbEIsZ0JBQWdCLENBQUNnQixvQkFBRCxDQUFoQixDQUF1Q3BELE9BQXZDLEVBQTdCLENBQUE7O0FBRUEsVUFBQSxJQUFJc0Qsb0JBQUosRUFBMEI7QUFDdEJSLFlBQUFBLFNBQVMsQ0FBQ3ZFLENBQVYsQ0FBWXdFLGFBQVosQ0FBMkJJLENBQUFBLFlBQTNCLElBQTJDRyxvQkFBM0MsQ0FBQTtBQUNILFdBRkQsTUFFTztZQUNIbEUsS0FBSyxDQUFDRSxJQUFOLENBQVcsb0ZBQVgsQ0FBQSxDQUFBO0FBQ0gsV0FBQTtBQUNKLFNBQUE7QUFDSixPQUFBO0FBQ0osS0FBQTs7SUFHRCxJQUFJNEIsVUFBVSxDQUFDaEQsTUFBWCxJQUFxQixDQUFDNEUsU0FBUyxDQUFDdEUsSUFBVixDQUFlK0UsK0JBQXpDLEVBQTBFO01BQ3RFVCxTQUFTLENBQUM1RSxNQUFWLENBQWlCb0UsMENBQWpCLENBQTREcEIsVUFBVSxDQUFDaEQsTUFBdkUsRUFBK0VrRSxnQkFBL0UsQ0FBQSxDQUFBO0FBQ0gsS0FBQTs7SUFHRCxJQUFJbEIsVUFBVSxDQUFDbkQsTUFBZixFQUF1QjtNQUNuQitFLFNBQVMsQ0FBQy9FLE1BQVYsQ0FBaUJ1RSwwQ0FBakIsQ0FBNERwQixVQUFVLENBQUNuRCxNQUF2RSxFQUErRXFFLGdCQUEvRSxDQUFBLENBQUE7QUFDSCxLQUFBOztJQUdELElBQUlsQixVQUFVLENBQUMvRCxJQUFmLEVBQXFCO01BQ2pCMkYsU0FBUyxDQUFDM0YsSUFBVixDQUFlbUYsMENBQWYsQ0FBMERwQixVQUFVLENBQUMvRCxJQUFyRSxFQUEyRWlGLGdCQUEzRSxDQUFBLENBQUE7QUFDSCxLQUFBOztJQU1ELE1BQU1vQixJQUFJLEdBQUdYLFNBQVMsQ0FBQ2YsUUFBVixDQUFtQjJCLE1BQW5CLENBQTBCLFVBQVVoQyxDQUFWLEVBQWE7TUFDaEQsT0FBUUEsQ0FBQyxZQUFZM0UsTUFBckIsQ0FBQTtBQUNILEtBRlksQ0FBYixDQUFBOztJQUdBLE1BQU00RyxJQUFJLEdBQUdaLFNBQVMsQ0FBQ2hCLFFBQVYsQ0FBbUIyQixNQUFuQixDQUEwQixVQUFVaEMsQ0FBVixFQUFhO01BQ2hELE9BQVFBLENBQUMsWUFBWTNFLE1BQXJCLENBQUE7QUFDSCxLQUZZLENBQWIsQ0FBQTs7QUFJQSxJQUFBLEtBQUssSUFBSWlFLENBQUMsR0FBRyxDQUFSLEVBQVdDLEdBQUcsR0FBR3dDLElBQUksQ0FBQy9DLE1BQTNCLEVBQW1DTSxDQUFDLEdBQUdDLEdBQXZDLEVBQTRDRCxDQUFDLEVBQTdDLEVBQWlEO0FBQzdDdUIsTUFBQUEsMENBQTBDLENBQUNNLGNBQUQsRUFBaUJZLElBQUksQ0FBQ3pDLENBQUQsQ0FBckIsRUFBMEIyQyxJQUFJLENBQUMzQyxDQUFELENBQTlCLEVBQW1DcUIsZ0JBQW5DLENBQTFDLENBQUE7QUFDSCxLQUFBO0FBQ0osR0FBQTtBQUNKOzs7OyJ9
