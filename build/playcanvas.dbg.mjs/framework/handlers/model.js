import { path } from '../../core/path.js';
import { Http, http } from '../../platform/net/http.js';
import { getDefaultMaterial } from '../../scene/materials/default-material.js';
import { GlbModelParser } from '../parsers/glb-model.js';
import { JsonModelParser } from '../parsers/json-model.js';

/** @typedef {import('./handler.js').ResourceHandler} ResourceHandler */

/**
 * Callback used by {@link ModelHandler#addParser} to decide on which parser to use.
 *
 * @callback AddParserCallback
 * @param {string} url - The resource url.
 * @param {object} data - The raw model data.
 * @returns {boolean} Return true if this parser should be used to parse the data into a
 * {@link Model}.
 */

/**
 * Resource handler used for loading {@link Model} resources.
 *
 * @implements {ResourceHandler}
 */
class ModelHandler {
  /**
   * Type of the resource the handler handles.
   *
   * @type {string}
   */

  /**
   * Create a new ModelHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @hideconstructor
   */
  constructor(app) {
    this.handlerType = "model";
    this._parsers = [];
    this.device = app.graphicsDevice;
    this.assets = app.assets;
    this.defaultMaterial = getDefaultMaterial(this.device);
    this.maxRetries = 0;
    this.addParser(new JsonModelParser(this), function (url, data) {
      return path.getExtension(url) === '.json';
    });
    this.addParser(new GlbModelParser(this), function (url, data) {
      return path.getExtension(url) === '.glb';
    });
  }
  load(url, callback, asset) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }

    // we need to specify JSON for blob URLs
    const options = {
      retry: this.maxRetries > 0,
      maxRetries: this.maxRetries
    };
    if (url.load.startsWith('blob:') || url.load.startsWith('data:')) {
      if (path.getExtension(url.original).toLowerCase() === '.glb') {
        options.responseType = Http.ResponseType.ARRAY_BUFFER;
      } else {
        options.responseType = Http.ResponseType.JSON;
      }
    }
    http.get(url.load, options, (err, response) => {
      if (!callback) return;
      if (!err) {
        // parse the model
        for (let i = 0; i < this._parsers.length; i++) {
          const p = this._parsers[i];
          if (p.decider(url.original, response)) {
            p.parser.parse(response, (err, parseResult) => {
              if (err) {
                callback(err);
              } else {
                callback(null, parseResult);
              }
            }, asset);
            return;
          }
        }
        callback("No parsers found");
      } else {
        callback(`Error loading model: ${url.original} [${err}]`);
      }
    });
  }
  open(url, data) {
    // parse was done in open, return the data as-is
    return data;
  }
  patch(asset, assets) {
    if (!asset.resource) return;
    const data = asset.data;
    const self = this;
    asset.resource.meshInstances.forEach(function (meshInstance, i) {
      if (data.mapping) {
        const handleMaterial = function handleMaterial(asset) {
          if (asset.resource) {
            meshInstance.material = asset.resource;
          } else {
            asset.once('load', handleMaterial);
            assets.load(asset);
          }
          asset.once('remove', function (asset) {
            if (meshInstance.material === asset.resource) {
              meshInstance.material = self._defaultMaterial;
            }
          });
        };
        if (!data.mapping[i]) {
          meshInstance.material = self._defaultMaterial;
          return;
        }
        const id = data.mapping[i].material;
        const url = data.mapping[i].path;
        let material;
        if (id !== undefined) {
          // id mapping
          if (!id) {
            meshInstance.material = self._defaultMaterial;
          } else {
            material = assets.get(id);
            if (material) {
              handleMaterial(material);
            } else {
              assets.once('add:' + id, handleMaterial);
            }
          }
        } else if (url) {
          // url mapping
          const path = asset.getAbsoluteUrl(data.mapping[i].path);
          material = assets.getByUrl(path);
          if (material) {
            handleMaterial(material);
          } else {
            assets.once('add:url:' + path, handleMaterial);
          }
        }
      }
    });
  }

  /**
   * Add a parser that converts raw data into a {@link Model}. Default parser is for JSON models.
   *
   * @param {object} parser - See JsonModelParser for example.
   * @param {AddParserCallback} decider - Function that decides on which parser to use. Function
   * should take (url, data) arguments and return true if this parser should be used to parse the
   * data into a {@link Model}. The first parser to return true is used.
   */
  addParser(parser, decider) {
    this._parsers.push({
      parser: parser,
      decider: decider
    });
  }
}

export { ModelHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvaGFuZGxlcnMvbW9kZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGF0aCB9IGZyb20gJy4uLy4uL2NvcmUvcGF0aC5qcyc7XG5cbmltcG9ydCB7IGh0dHAsIEh0dHAgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9uZXQvaHR0cC5qcyc7XG5cbmltcG9ydCB7IGdldERlZmF1bHRNYXRlcmlhbCB9IGZyb20gJy4uLy4uL3NjZW5lL21hdGVyaWFscy9kZWZhdWx0LW1hdGVyaWFsLmpzJztcblxuaW1wb3J0IHsgR2xiTW9kZWxQYXJzZXIgfSBmcm9tICcuLi9wYXJzZXJzL2dsYi1tb2RlbC5qcyc7XG5pbXBvcnQgeyBKc29uTW9kZWxQYXJzZXIgfSBmcm9tICcuLi9wYXJzZXJzL2pzb24tbW9kZWwuanMnO1xuXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9oYW5kbGVyLmpzJykuUmVzb3VyY2VIYW5kbGVyfSBSZXNvdXJjZUhhbmRsZXIgKi9cblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBNb2RlbEhhbmRsZXIjYWRkUGFyc2VyfSB0byBkZWNpZGUgb24gd2hpY2ggcGFyc2VyIHRvIHVzZS5cbiAqXG4gKiBAY2FsbGJhY2sgQWRkUGFyc2VyQ2FsbGJhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcmVzb3VyY2UgdXJsLlxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBUaGUgcmF3IG1vZGVsIGRhdGEuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIHRydWUgaWYgdGhpcyBwYXJzZXIgc2hvdWxkIGJlIHVzZWQgdG8gcGFyc2UgdGhlIGRhdGEgaW50byBhXG4gKiB7QGxpbmsgTW9kZWx9LlxuICovXG5cbi8qKlxuICogUmVzb3VyY2UgaGFuZGxlciB1c2VkIGZvciBsb2FkaW5nIHtAbGluayBNb2RlbH0gcmVzb3VyY2VzLlxuICpcbiAqIEBpbXBsZW1lbnRzIHtSZXNvdXJjZUhhbmRsZXJ9XG4gKi9cbmNsYXNzIE1vZGVsSGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogVHlwZSBvZiB0aGUgcmVzb3VyY2UgdGhlIGhhbmRsZXIgaGFuZGxlcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAgaGFuZGxlclR5cGUgPSBcIm1vZGVsXCI7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgTW9kZWxIYW5kbGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gYXBwIC0gVGhlIHJ1bm5pbmcge0BsaW5rIEFwcEJhc2V9LlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgdGhpcy5fcGFyc2VycyA9IFtdO1xuICAgICAgICB0aGlzLmRldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcbiAgICAgICAgdGhpcy5hc3NldHMgPSBhcHAuYXNzZXRzO1xuICAgICAgICB0aGlzLmRlZmF1bHRNYXRlcmlhbCA9IGdldERlZmF1bHRNYXRlcmlhbCh0aGlzLmRldmljZSk7XG4gICAgICAgIHRoaXMubWF4UmV0cmllcyA9IDA7XG5cbiAgICAgICAgdGhpcy5hZGRQYXJzZXIobmV3IEpzb25Nb2RlbFBhcnNlcih0aGlzKSwgZnVuY3Rpb24gKHVybCwgZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIChwYXRoLmdldEV4dGVuc2lvbih1cmwpID09PSAnLmpzb24nKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkUGFyc2VyKG5ldyBHbGJNb2RlbFBhcnNlcih0aGlzKSwgZnVuY3Rpb24gKHVybCwgZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIChwYXRoLmdldEV4dGVuc2lvbih1cmwpID09PSAnLmdsYicpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsb2FkKHVybCwgY2FsbGJhY2ssIGFzc2V0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gd2UgbmVlZCB0byBzcGVjaWZ5IEpTT04gZm9yIGJsb2IgVVJMc1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgcmV0cnk6IHRoaXMubWF4UmV0cmllcyA+IDAsXG4gICAgICAgICAgICBtYXhSZXRyaWVzOiB0aGlzLm1heFJldHJpZXNcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodXJsLmxvYWQuc3RhcnRzV2l0aCgnYmxvYjonKSB8fCB1cmwubG9hZC5zdGFydHNXaXRoKCdkYXRhOicpKSB7XG4gICAgICAgICAgICBpZiAocGF0aC5nZXRFeHRlbnNpb24odXJsLm9yaWdpbmFsKS50b0xvd2VyQ2FzZSgpID09PSAnLmdsYicpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnJlc3BvbnNlVHlwZSA9IEh0dHAuUmVzcG9uc2VUeXBlLkFSUkFZX0JVRkZFUjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5yZXNwb25zZVR5cGUgPSBIdHRwLlJlc3BvbnNlVHlwZS5KU09OO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaHR0cC5nZXQodXJsLmxvYWQsIG9wdGlvbnMsIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWNhbGxiYWNrKVxuICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICAvLyBwYXJzZSB0aGUgbW9kZWxcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3BhcnNlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuX3BhcnNlcnNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHAuZGVjaWRlcih1cmwub3JpZ2luYWwsIHJlc3BvbnNlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcC5wYXJzZXIucGFyc2UocmVzcG9uc2UsIChlcnIsIHBhcnNlUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHBhcnNlUmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soXCJObyBwYXJzZXJzIGZvdW5kXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhgRXJyb3IgbG9hZGluZyBtb2RlbDogJHt1cmwub3JpZ2luYWx9IFske2Vycn1dYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhKSB7XG4gICAgICAgIC8vIHBhcnNlIHdhcyBkb25lIGluIG9wZW4sIHJldHVybiB0aGUgZGF0YSBhcy1pc1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBwYXRjaChhc3NldCwgYXNzZXRzKSB7XG4gICAgICAgIGlmICghYXNzZXQucmVzb3VyY2UpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGFzc2V0LmRhdGE7XG5cbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIGFzc2V0LnJlc291cmNlLm1lc2hJbnN0YW5jZXMuZm9yRWFjaChmdW5jdGlvbiAobWVzaEluc3RhbmNlLCBpKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5tYXBwaW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFuZGxlTWF0ZXJpYWwgPSBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2UubWF0ZXJpYWwgPSBhc3NldC5yZXNvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0Lm9uY2UoJ2xvYWQnLCBoYW5kbGVNYXRlcmlhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldHMubG9hZChhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhc3NldC5vbmNlKCdyZW1vdmUnLCBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNoSW5zdGFuY2UubWF0ZXJpYWwgPT09IGFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzaEluc3RhbmNlLm1hdGVyaWFsID0gc2VsZi5fZGVmYXVsdE1hdGVyaWFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhLm1hcHBpbmdbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzaEluc3RhbmNlLm1hdGVyaWFsID0gc2VsZi5fZGVmYXVsdE1hdGVyaWFsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSBkYXRhLm1hcHBpbmdbaV0ubWF0ZXJpYWw7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gZGF0YS5tYXBwaW5nW2ldLnBhdGg7XG4gICAgICAgICAgICAgICAgbGV0IG1hdGVyaWFsO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlkICE9PSB1bmRlZmluZWQpIHsgLy8gaWQgbWFwcGluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2UubWF0ZXJpYWwgPSBzZWxmLl9kZWZhdWx0TWF0ZXJpYWw7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbCA9IGFzc2V0cy5nZXQoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGVyaWFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTWF0ZXJpYWwobWF0ZXJpYWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NldHMub25jZSgnYWRkOicgKyBpZCwgaGFuZGxlTWF0ZXJpYWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXJsIG1hcHBpbmdcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aCA9IGFzc2V0LmdldEFic29sdXRlVXJsKGRhdGEubWFwcGluZ1tpXS5wYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgbWF0ZXJpYWwgPSBhc3NldHMuZ2V0QnlVcmwocGF0aCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGVyaWFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVNYXRlcmlhbChtYXRlcmlhbCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldHMub25jZSgnYWRkOnVybDonICsgcGF0aCwgaGFuZGxlTWF0ZXJpYWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBwYXJzZXIgdGhhdCBjb252ZXJ0cyByYXcgZGF0YSBpbnRvIGEge0BsaW5rIE1vZGVsfS4gRGVmYXVsdCBwYXJzZXIgaXMgZm9yIEpTT04gbW9kZWxzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHBhcnNlciAtIFNlZSBKc29uTW9kZWxQYXJzZXIgZm9yIGV4YW1wbGUuXG4gICAgICogQHBhcmFtIHtBZGRQYXJzZXJDYWxsYmFja30gZGVjaWRlciAtIEZ1bmN0aW9uIHRoYXQgZGVjaWRlcyBvbiB3aGljaCBwYXJzZXIgdG8gdXNlLiBGdW5jdGlvblxuICAgICAqIHNob3VsZCB0YWtlICh1cmwsIGRhdGEpIGFyZ3VtZW50cyBhbmQgcmV0dXJuIHRydWUgaWYgdGhpcyBwYXJzZXIgc2hvdWxkIGJlIHVzZWQgdG8gcGFyc2UgdGhlXG4gICAgICogZGF0YSBpbnRvIGEge0BsaW5rIE1vZGVsfS4gVGhlIGZpcnN0IHBhcnNlciB0byByZXR1cm4gdHJ1ZSBpcyB1c2VkLlxuICAgICAqL1xuICAgIGFkZFBhcnNlcihwYXJzZXIsIGRlY2lkZXIpIHtcbiAgICAgICAgdGhpcy5fcGFyc2Vycy5wdXNoKHtcbiAgICAgICAgICAgIHBhcnNlcjogcGFyc2VyLFxuICAgICAgICAgICAgZGVjaWRlcjogZGVjaWRlclxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IE1vZGVsSGFuZGxlciB9O1xuIl0sIm5hbWVzIjpbIk1vZGVsSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiaGFuZGxlclR5cGUiLCJfcGFyc2VycyIsImRldmljZSIsImdyYXBoaWNzRGV2aWNlIiwiYXNzZXRzIiwiZGVmYXVsdE1hdGVyaWFsIiwiZ2V0RGVmYXVsdE1hdGVyaWFsIiwibWF4UmV0cmllcyIsImFkZFBhcnNlciIsIkpzb25Nb2RlbFBhcnNlciIsInVybCIsImRhdGEiLCJwYXRoIiwiZ2V0RXh0ZW5zaW9uIiwiR2xiTW9kZWxQYXJzZXIiLCJsb2FkIiwiY2FsbGJhY2siLCJhc3NldCIsIm9yaWdpbmFsIiwib3B0aW9ucyIsInJldHJ5Iiwic3RhcnRzV2l0aCIsInRvTG93ZXJDYXNlIiwicmVzcG9uc2VUeXBlIiwiSHR0cCIsIlJlc3BvbnNlVHlwZSIsIkFSUkFZX0JVRkZFUiIsIkpTT04iLCJodHRwIiwiZ2V0IiwiZXJyIiwicmVzcG9uc2UiLCJpIiwibGVuZ3RoIiwicCIsImRlY2lkZXIiLCJwYXJzZXIiLCJwYXJzZSIsInBhcnNlUmVzdWx0Iiwib3BlbiIsInBhdGNoIiwicmVzb3VyY2UiLCJzZWxmIiwibWVzaEluc3RhbmNlcyIsImZvckVhY2giLCJtZXNoSW5zdGFuY2UiLCJtYXBwaW5nIiwiaGFuZGxlTWF0ZXJpYWwiLCJtYXRlcmlhbCIsIm9uY2UiLCJfZGVmYXVsdE1hdGVyaWFsIiwiaWQiLCJ1bmRlZmluZWQiLCJnZXRBYnNvbHV0ZVVybCIsImdldEJ5VXJsIiwicHVzaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBU0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxZQUFZLENBQUM7QUFDZjtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUdJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxHQUFHLEVBQUU7SUFBQSxJQVJqQkMsQ0FBQUEs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
