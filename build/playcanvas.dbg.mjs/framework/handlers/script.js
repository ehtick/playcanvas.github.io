/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { script } from '../script.js';
import { ScriptTypes } from '../script/script-types.js';

class ScriptHandler {

  constructor(app) {
    this.handlerType = "script";
    this._app = app;
    this._scripts = {};
    this._cache = {};
  }
  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    const self = this;
    script.app = this._app;
    this._loadScript(url.load, (err, url, extra) => {
      if (!err) {
        if (script.legacy) {
          let Type = null;
          if (ScriptTypes._types.length) {
            Type = ScriptTypes._types.pop();
          }
          if (Type) {
            this._scripts[url] = Type;
          } else {
            Type = null;
          }

          callback(null, Type, extra);
        } else {
          const obj = {};
          for (let i = 0; i < ScriptTypes._types.length; i++) obj[ScriptTypes._types[i].name] = ScriptTypes._types[i];
          ScriptTypes._types.length = 0;
          callback(null, obj, extra);

          delete self._loader._cache[url + 'script'];
        }
      } else {
        callback(err);
      }
    });
  }
  open(url, data) {
    return data;
  }
  patch(asset, assets) {}
  _loadScript(url, callback) {
    const head = document.head;
    const element = document.createElement('script');
    this._cache[url] = element;

    element.async = false;
    element.addEventListener('error', function (e) {
      callback(`Script: ${e.target.src} failed to load`);
    }, false);
    let done = false;
    element.onload = element.onreadystatechange = function () {
      if (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {
        done = true;
        callback(null, url, element);
      }
    };
    element.src = url;
    head.appendChild(element);
  }
}

export { ScriptHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL3NjcmlwdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzY3JpcHQgfSBmcm9tICcuLi9zY3JpcHQuanMnO1xuaW1wb3J0IHsgU2NyaXB0VHlwZXMgfSBmcm9tICcuLi9zY3JpcHQvc2NyaXB0LXR5cGVzLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vaGFuZGxlci5qcycpLlJlc291cmNlSGFuZGxlcn0gUmVzb3VyY2VIYW5kbGVyICovXG5cbi8qKlxuICogUmVzb3VyY2UgaGFuZGxlciBmb3IgbG9hZGluZyBKYXZhU2NyaXB0IGZpbGVzIGR5bmFtaWNhbGx5LiAgVHdvIHR5cGVzIG9mIEphdmFTY3JpcHQgZmlsZXMgY2FuIGJlXG4gKiBsb2FkZWQsIFBsYXlDYW52YXMgc2NyaXB0cyB3aGljaCBjb250YWluIGNhbGxzIHRvIHtAbGluayBjcmVhdGVTY3JpcHR9LCBvciByZWd1bGFyIEphdmFTY3JpcHRcbiAqIGZpbGVzLCBzdWNoIGFzIHRoaXJkLXBhcnR5IGxpYnJhcmllcy5cbiAqXG4gKiBAaW1wbGVtZW50cyB7UmVzb3VyY2VIYW5kbGVyfVxuICovXG5jbGFzcyBTY3JpcHRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBUeXBlIG9mIHRoZSByZXNvdXJjZSB0aGUgaGFuZGxlciBoYW5kbGVzLlxuICAgICAqXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBoYW5kbGVyVHlwZSA9IFwic2NyaXB0XCI7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU2NyaXB0SGFuZGxlciBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IGFwcCAtIFRoZSBydW5uaW5nIHtAbGluayBBcHBCYXNlfS5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHRoaXMuX2FwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5fc2NyaXB0cyA9IHsgfTtcbiAgICAgICAgdGhpcy5fY2FjaGUgPSB7IH07XG4gICAgfVxuXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8vIFNjcmlwdHMgZG9uJ3Qgc3VwcG9ydCBidW5kbGluZyBzaW5jZSB3ZSBjb25jYXRlbmF0ZSB0aGVtLiBCZWxvdyBpcyBmb3IgY29uc2lzdGVuY3kuXG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNjcmlwdC5hcHAgPSB0aGlzLl9hcHA7XG5cbiAgICAgICAgdGhpcy5fbG9hZFNjcmlwdCh1cmwubG9hZCwgKGVyciwgdXJsLCBleHRyYSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NyaXB0LmxlZ2FjeSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgVHlwZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBvcCB0aGUgdHlwZSBmcm9tIHRoZSBsb2FkaW5nIHN0YWNrXG4gICAgICAgICAgICAgICAgICAgIGlmIChTY3JpcHRUeXBlcy5fdHlwZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUeXBlID0gU2NyaXB0VHlwZXMuX3R5cGVzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIGluZGV4ZWQgYnkgVVJMXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRzW3VybF0gPSBUeXBlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhlIHJlc291cmNlXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIFR5cGUsIGV4dHJhKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7IH07XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBTY3JpcHRUeXBlcy5fdHlwZXMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbU2NyaXB0VHlwZXMuX3R5cGVzW2ldLm5hbWVdID0gU2NyaXB0VHlwZXMuX3R5cGVzW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgIFNjcmlwdFR5cGVzLl90eXBlcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIG9iaiwgZXh0cmEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGNhY2hlIGZvciBzY3JpcHRzXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzZWxmLl9sb2FkZXIuX2NhY2hlW3VybCArICdzY3JpcHQnXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhKSB7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIHBhdGNoKGFzc2V0LCBhc3NldHMpIHsgfVxuXG4gICAgX2xvYWRTY3JpcHQodXJsLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zdCBoZWFkID0gZG9jdW1lbnQuaGVhZDtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICB0aGlzLl9jYWNoZVt1cmxdID0gZWxlbWVudDtcblxuICAgICAgICAvLyB1c2UgYXN5bmM9ZmFsc2UgdG8gZm9yY2Ugc2NyaXB0cyB0byBleGVjdXRlIGluIG9yZGVyXG4gICAgICAgIGVsZW1lbnQuYXN5bmMgPSBmYWxzZTtcblxuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGBTY3JpcHQ6ICR7ZS50YXJnZXQuc3JjfSBmYWlsZWQgdG8gbG9hZGApO1xuICAgICAgICB9LCBmYWxzZSk7XG5cbiAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgZWxlbWVudC5vbmxvYWQgPSBlbGVtZW50Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghZG9uZSAmJiAoIXRoaXMucmVhZHlTdGF0ZSB8fCAodGhpcy5yZWFkeVN0YXRlID09PSAnbG9hZGVkJyB8fCB0aGlzLnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpKSkge1xuICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOyAvLyBwcmV2ZW50IGRvdWJsZSBldmVudCBmaXJpbmdcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB1cmwsIGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyBzZXQgdGhlIHNyYyBhdHRyaWJ1dGUgYWZ0ZXIgdGhlIG9ubG9hZCBjYWxsYmFjayBpcyBzZXQsIHRvIGF2b2lkIGFuIGluc3RhbnQgbG9hZGluZyBmYWlsaW5nIHRvIGZpcmUgdGhlIGNhbGxiYWNrXG4gICAgICAgIGVsZW1lbnQuc3JjID0gdXJsO1xuXG4gICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTY3JpcHRIYW5kbGVyIH07XG4iXSwibmFtZXMiOlsiU2NyaXB0SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiaGFuZGxlclR5cGUiLCJfYXBwIiwiX3NjcmlwdHMiLCJfY2FjaGUiLCJsb2FkIiwidXJsIiwiY2FsbGJhY2siLCJvcmlnaW5hbCIsInNlbGYiLCJzY3JpcHQiLCJfbG9hZFNjcmlwdCIsImVyciIsImV4dHJhIiwibGVnYWN5IiwiVHlwZSIsIlNjcmlwdFR5cGVzIiwiX3R5cGVzIiwibGVuZ3RoIiwicG9wIiwib2JqIiwiaSIsIm5hbWUiLCJfbG9hZGVyIiwib3BlbiIsImRhdGEiLCJwYXRjaCIsImFzc2V0IiwiYXNzZXRzIiwiaGVhZCIsImRvY3VtZW50IiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhc3luYyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGFyZ2V0Iiwic3JjIiwiZG9uZSIsIm9ubG9hZCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJhcHBlbmRDaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFZQSxNQUFNQSxhQUFhLENBQUM7O0VBY2hCQyxXQUFXLENBQUNDLEdBQUcsRUFBRTtJQUFBLElBUmpCQyxDQUFBQSxXQUFXLEdBQUcsUUFBUSxDQUFBO0lBU2xCLElBQUksQ0FBQ0MsSUFBSSxHQUFHRixHQUFHLENBQUE7QUFDZixJQUFBLElBQUksQ0FBQ0csUUFBUSxHQUFHLEVBQUcsQ0FBQTtBQUNuQixJQUFBLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEVBQUcsQ0FBQTtBQUNyQixHQUFBO0FBRUFDLEVBQUFBLElBQUksQ0FBQ0MsR0FBRyxFQUFFQyxRQUFRLEVBQUU7QUFFaEIsSUFBQSxJQUFJLE9BQU9ELEdBQUcsS0FBSyxRQUFRLEVBQUU7QUFDekJBLE1BQUFBLEdBQUcsR0FBRztBQUNGRCxRQUFBQSxJQUFJLEVBQUVDLEdBQUc7QUFDVEUsUUFBQUEsUUFB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
