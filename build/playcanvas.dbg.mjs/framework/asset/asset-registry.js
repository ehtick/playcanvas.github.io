/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { path } from '../../core/path.js';
import { Debug } from '../../core/debug.js';
import { EventHandler } from '../../core/event-handler.js';
import { TagsCache } from '../../core/tags-cache.js';
import { standardMaterialTextureParameters } from '../../scene/materials/standard-material-parameters.js';
import { script } from '../script.js';
import { Asset } from './asset.js';

class AssetRegistry extends EventHandler {
  constructor(loader) {
    super();
    this._loader = loader;
    this._assets = [];
    this._cache = {};
    this._names = {};
    this._tags = new TagsCache('_id');
    this._urls = {};

    this.prefix = null;
  }

  list(filters) {
    filters = filters || {};
    return this._assets.filter(asset => {
      let include = true;
      if (filters.preload !== undefined) {
        include = asset.preload === filters.preload;
      }
      return include;
    });
  }

  add(asset) {
    const index = this._assets.push(asset) - 1;
    let url;

    this._cache[asset.id] = index;
    if (!this._names[asset.name]) this._names[asset.name] = [];

    this._names[asset.name].push(index);
    if (asset.file) {
      url = asset.file.url;
      this._urls[url] = index;
    }
    asset.registry = this;

    this._tags.addItem(asset);
    asset.tags.on('add', this._onTagAdd, this);
    asset.tags.on('remove', this._onTagRemove, this);
    this.fire('add', asset);
    this.fire('add:' + asset.id, asset);
    if (url) this.fire('add:url:' + url, asset);
    if (asset.preload) this.load(asset);
  }

  remove(asset) {
    const idx = this._cache[asset.id];
    const url = asset.file ? asset.file.url : null;
    if (idx !== undefined) {
      this._assets.splice(idx, 1);

      delete this._cache[asset.id];

      this._names = {};

      this._urls = [];

      for (let i = 0, l = this._assets.length; i < l; i++) {
        const a = this._assets[i];
        this._cache[a.id] = i;
        if (!this._names[a.name]) {
          this._names[a.name] = [];
        }
        this._names[a.name].push(i);
        if (a.file) {
          this._urls[a.file.url] = i;
        }
      }

      this._tags.removeItem(asset);
      asset.tags.off('add', this._onTagAdd, this);
      asset.tags.off('remove', this._onTagRemove, this);
      asset.fire('remove', asset);
      this.fire('remove', asset);
      this.fire('remove:' + asset.id, asset);
      if (url) this.fire('remove:url:' + url, asset);
      return true;
    }

    return false;
  }

  get(id) {
    const idx = this._cache[id];
    return this._assets[idx];
  }

  getByUrl(url) {
    const idx = this._urls[url];
    return this._assets[idx];
  }

  load(asset) {
    if (asset.loading || asset.loaded) {
      return;
    }
    const file = asset.file;

    const _opened = resource => {
      if (resource instanceof Array) {
        asset.resources = resource;
      } else {
        asset.resource = resource;
      }

      this._loader.patch(asset, this);
      this.fire('load', asset);
      this.fire('load:' + asset.id, asset);
      if (file && file.url) this.fire('load:url:' + file.url, asset);
      asset.fire('load', asset);
    };

    const _loaded = (err, resource, extra) => {
      asset.loaded = true;
      asset.loading = false;
      if (err) {
        this.fire('error', err, asset);
        this.fire('error:' + asset.id, err, asset);
        asset.fire('error', err, asset);
      } else {
        if (!script.legacy && asset.type === 'script') {
          const handler = this._loader.getHandler('script');
          if (handler._cache[asset.id] && handler._cache[asset.id].parentNode === document.head) {
            document.head.removeChild(handler._cache[asset.id]);
          }
          handler._cache[asset.id] = extra;
        }
        _opened(resource);
      }
    };
    if (file || asset.type === 'cubemap') {
      this.fire('load:start', asset);
      this.fire('load:' + asset.id + ':start', asset);
      asset.loading = true;
      this._loader.load(asset.getFileUrl(), asset.type, _loaded, asset);
    } else {
      const resource = this._loader.open(asset.type, asset.data);
      asset.loaded = true;
      _opened(resource);
    }
  }

  loadFromUrl(url, type, callback) {
    this.loadFromUrlAndFilename(url, null, type, callback);
  }

  loadFromUrlAndFilename(url, filename, type, callback) {
    const name = path.getBasename(filename || url);
    const file = {
      filename: filename || name,
      url: url
    };
    let asset = this.getByUrl(url);
    if (!asset) {
      asset = new Asset(name, type, file);
      this.add(asset);
    } else if (asset.loaded) {
      callback(asset.loadFromUrlError || null, asset);
      return;
    }
    const startLoad = asset => {
      asset.once('load', loadedAsset => {
        if (type === 'material') {
          this._loadTextures(loadedAsset, (err, textures) => {
            callback(err, loadedAsset);
          });
        } else {
          callback(null, loadedAsset);
        }
      });
      asset.once('error', err => {
        if (err) {
          this.loadFromUrlError = err;
        }
        callback(err, asset);
      });
      this.load(asset);
    };
    if (asset.resource) {
      callback(null, asset);
    } else if (type === 'model') {
      this._loadModel(asset, startLoad);
    } else {
      startLoad(asset);
    }
  }

  _loadModel(modelAsset, continuation) {
    const url = modelAsset.getFileUrl();
    const ext = path.getExtension(url);
    if (ext === '.json' || ext === '.glb') {
      const dir = path.getDirectory(url);
      const basename = path.getBasename(url);

      const mappingUrl = path.join(dir, basename.replace(ext, '.mapping.json'));
      this._loader.load(mappingUrl, 'json', (err, data) => {
        if (err) {
          modelAsset.data = {
            mapping: []
          };
          continuation(modelAsset);
        } else {
          this._loadMaterials(modelAsset, data, (e, materials) => {
            modelAsset.data = data;
            continuation(modelAsset);
          });
        }
      });
    } else {
      continuation(modelAsset);
    }
  }

  _loadMaterials(modelAsset, mapping, callback) {
    const materials = [];
    let count = 0;
    const onMaterialLoaded = (err, materialAsset) => {
      this._loadTextures(materialAsset, (err, textures) => {
        materials.push(materialAsset);
        if (materials.length === count) {
          callback(null, materials);
        }
      });
    };
    for (let i = 0; i < mapping.mapping.length; i++) {
      const path = mapping.mapping[i].path;
      if (path) {
        count++;
        const url = modelAsset.getAbsoluteUrl(path);
        this.loadFromUrl(url, 'material', onMaterialLoaded);
      }
    }
    if (count === 0) {
      callback(null, materials);
    }
  }

  _loadTextures(materialAsset, callback) {
    const textures = [];
    let count = 0;
    const data = materialAsset.data;
    if (data.mappingFormat !== 'path') {
      Debug.warn(`Skipping: ${materialAsset.name}, material files must be mappingFormat: "path" to be loaded from URL`);
      callback(null, textures);
      return;
    }
    const onTextureLoaded = (err, texture) => {
      if (err) console.error(err);
      textures.push(texture);
      if (textures.length === count) {
        callback(null, textures);
      }
    };
    const texParams = standardMaterialTextureParameters;
    for (let i = 0; i < texParams.length; i++) {
      const path = data[texParams[i]];
      if (path && typeof path === 'string') {
        count++;
        const url = materialAsset.getAbsoluteUrl(path);
        this.loadFromUrl(url, 'texture', onTextureLoaded);
      }
    }
    if (count === 0) {
      callback(null, textures);
    }
  }

  findAll(name, type) {
    const idxs = this._names[name];
    if (idxs) {
      const assets = idxs.map(idx => {
        return this._assets[idx];
      });
      if (type) {
        return assets.filter(asset => {
          return asset.type === type;
        });
      }
      return assets;
    }
    return [];
  }
  _onTagAdd(tag, asset) {
    this._tags.add(tag, asset);
  }
  _onTagRemove(tag, asset) {
    this._tags.remove(tag, asset);
  }

  findByTag() {
    return this._tags.find(arguments);
  }

  filter(callback) {
    return this._assets.filter(asset => callback(asset));
  }

  find(name, type) {
    const asset = this.findAll(name, type);
    return asset.length > 0 ? asset[0] : null;
  }
}

export { AssetRegistry };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtcmVnaXN0cnkuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvYXNzZXQvYXNzZXQtcmVnaXN0cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGF0aCB9IGZyb20gJy4uLy4uL2NvcmUvcGF0aC5qcyc7XG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcbmltcG9ydCB7IFRhZ3NDYWNoZSB9IGZyb20gJy4uLy4uL2NvcmUvdGFncy1jYWNoZS5qcyc7XG5cbmltcG9ydCB7IHN0YW5kYXJkTWF0ZXJpYWxUZXh0dXJlUGFyYW1ldGVycyB9IGZyb20gJy4uLy4uL3NjZW5lL21hdGVyaWFscy9zdGFuZGFyZC1tYXRlcmlhbC1wYXJhbWV0ZXJzLmpzJztcblxuaW1wb3J0IHsgc2NyaXB0IH0gZnJvbSAnLi4vc2NyaXB0LmpzJztcblxuaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuL2Fzc2V0LmpzJztcblxuLyoqXG4gKiBDYWxsYmFjayB1c2VkIGJ5IHtAbGluayBBc3NldFJlZ2lzdHJ5I2ZpbHRlcn0gdG8gZmlsdGVyIGFzc2V0cy5cbiAqXG4gKiBAY2FsbGJhY2sgRmlsdGVyQXNzZXRDYWxsYmFja1xuICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBUaGUgY3VycmVudCBhc3NldCB0byBmaWx0ZXIuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIGB0cnVlYCB0byBpbmNsdWRlIGFzc2V0IHRvIHJlc3VsdCBsaXN0LlxuICovXG5cbi8qKlxuICogQ2FsbGJhY2sgdXNlZCBieSB7QGxpbmsgQXNzZXRSZWdpc3RyeSNsb2FkRnJvbVVybH0gYW5kIGNhbGxlZCB3aGVuIGFuIGFzc2V0IGlzIGxvYWRlZCAob3IgYW5cbiAqIGVycm9yIG9jY3VycykuXG4gKlxuICogQGNhbGxiYWNrIExvYWRBc3NldENhbGxiYWNrXG4gKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBlcnIgLSBUaGUgZXJyb3IgbWVzc2FnZSBpcyBudWxsIGlmIG5vIGVycm9ycyB3ZXJlIGVuY291bnRlcmVkLlxuICogQHBhcmFtIHtBc3NldH0gW2Fzc2V0XSAtIFRoZSBsb2FkZWQgYXNzZXQgaWYgbm8gZXJyb3JzIHdlcmUgZW5jb3VudGVyZWQuXG4gKi9cblxuLyoqXG4gKiBDb250YWluZXIgZm9yIGFsbCBhc3NldHMgdGhhdCBhcmUgYXZhaWxhYmxlIHRvIHRoaXMgYXBwbGljYXRpb24uIE5vdGUgdGhhdCBQbGF5Q2FudmFzIHNjcmlwdHNcbiAqIGFyZSBwcm92aWRlZCB3aXRoIGFuIEFzc2V0UmVnaXN0cnkgaW5zdGFuY2UgYXMgYGFwcC5hc3NldHNgLlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgQXNzZXRSZWdpc3RyeSBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGFuIGluc3RhbmNlIG9mIGFuIEFzc2V0UmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vaGFuZGxlcnMvbG9hZGVyLmpzJykuUmVzb3VyY2VMb2FkZXJ9IGxvYWRlciAtIFRoZSBSZXNvdXJjZUxvYWRlciB1c2VkIHRvXG4gICAgICogbG9hZCB0aGUgYXNzZXQgZmlsZXMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobG9hZGVyKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5fbG9hZGVyID0gbG9hZGVyO1xuXG4gICAgICAgIHRoaXMuX2Fzc2V0cyA9IFtdOyAvLyBsaXN0IG9mIGFsbCBhc3NldHNcbiAgICAgICAgdGhpcy5fY2FjaGUgPSB7fTsgLy8gaW5kZXggZm9yIGxvb2tpbmcgdXAgYXNzZXRzIGJ5IGlkXG4gICAgICAgIHRoaXMuX25hbWVzID0ge307IC8vIGluZGV4IGZvciBsb29raW5nIHVwIGFzc2V0cyBieSBuYW1lXG4gICAgICAgIHRoaXMuX3RhZ3MgPSBuZXcgVGFnc0NhY2hlKCdfaWQnKTsgLy8gaW5kZXggZm9yIGxvb2tpbmcgdXAgYnkgdGFnc1xuICAgICAgICB0aGlzLl91cmxzID0ge307IC8vIGluZGV4IGZvciBsb29raW5nIHVwIGFzc2V0cyBieSB1cmxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQSBVUkwgcHJlZml4IHRoYXQgd2lsbCBiZSBhZGRlZCB0byBhbGwgYXNzZXQgbG9hZGluZyByZXF1ZXN0cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHJlZml4ID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGFuIGFzc2V0IGNvbXBsZXRlcyBsb2FkaW5nLlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0UmVnaXN0cnkjbG9hZFxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgaGFzIGp1c3QgbG9hZGVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLmFzc2V0cy5vbihcImxvYWRcIiwgZnVuY3Rpb24gKGFzc2V0KSB7XG4gICAgICogICAgIGNvbnNvbGUubG9nKFwiYXNzZXQgbG9hZGVkOiBcIiArIGFzc2V0Lm5hbWUpO1xuICAgICAqIH0pO1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhbiBhc3NldCBjb21wbGV0ZXMgbG9hZGluZy5cbiAgICAgKlxuICAgICAqIEBldmVudCBBc3NldFJlZ2lzdHJ5I2xvYWQ6W2lkXVxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgaGFzIGp1c3QgbG9hZGVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGlkID0gMTIzNDU2O1xuICAgICAqIHZhciBhc3NldCA9IGFwcC5hc3NldHMuZ2V0KGlkKTtcbiAgICAgKiBhcHAuYXNzZXRzLm9uKFwibG9hZDpcIiArIGlkLCBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coXCJhc3NldCBsb2FkZWQ6IFwiICsgYXNzZXQubmFtZSk7XG4gICAgICogfSk7XG4gICAgICogYXBwLmFzc2V0cy5sb2FkKGFzc2V0KTtcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYW4gYXNzZXQgY29tcGxldGVzIGxvYWRpbmcuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQXNzZXRSZWdpc3RyeSNsb2FkOnVybDpbdXJsXVxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgaGFzIGp1c3QgbG9hZGVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGlkID0gMTIzNDU2O1xuICAgICAqIHZhciBhc3NldCA9IGFwcC5hc3NldHMuZ2V0KGlkKTtcbiAgICAgKiBhcHAuYXNzZXRzLm9uKFwibG9hZDp1cmw6XCIgKyBhc3NldC5maWxlLnVybCwgZnVuY3Rpb24gKGFzc2V0KSB7XG4gICAgICogICAgIGNvbnNvbGUubG9nKFwiYXNzZXQgbG9hZGVkOiBcIiArIGFzc2V0Lm5hbWUpO1xuICAgICAqIH0pO1xuICAgICAqIGFwcC5hc3NldHMubG9hZChhc3NldCk7XG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGFuIGFzc2V0IGlzIGFkZGVkIHRvIHRoZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBldmVudCBBc3NldFJlZ2lzdHJ5I2FkZFxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgd2FzIGFkZGVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLmFzc2V0cy5vbihcImFkZFwiLCBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coXCJOZXcgYXNzZXQgYWRkZWQ6IFwiICsgYXNzZXQubmFtZSk7XG4gICAgICogfSk7XG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGFuIGFzc2V0IGlzIGFkZGVkIHRvIHRoZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBldmVudCBBc3NldFJlZ2lzdHJ5I2FkZDpbaWRdXG4gICAgICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBUaGUgYXNzZXQgdGhhdCB3YXMgYWRkZWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgaWQgPSAxMjM0NTY7XG4gICAgICogYXBwLmFzc2V0cy5vbihcImFkZDpcIiArIGlkLCBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coXCJBc3NldCAxMjM0NTYgbG9hZGVkXCIpO1xuICAgICAqIH0pO1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhbiBhc3NldCBpcyBhZGRlZCB0byB0aGUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQXNzZXRSZWdpc3RyeSNhZGQ6dXJsOlt1cmxdXG4gICAgICogQHBhcmFtIHtBc3NldH0gYXNzZXQgLSBUaGUgYXNzZXQgdGhhdCB3YXMgYWRkZWQuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGFuIGFzc2V0IGlzIHJlbW92ZWQgZnJvbSB0aGUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQXNzZXRSZWdpc3RyeSNyZW1vdmVcbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0aGF0IHdhcyByZW1vdmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLmFzc2V0cy5vbihcInJlbW92ZVwiLCBmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coXCJBc3NldCByZW1vdmVkOiBcIiArIGFzc2V0Lm5hbWUpO1xuICAgICAqIH0pO1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhbiBhc3NldCBpcyByZW1vdmVkIGZyb20gdGhlIHJlZ2lzdHJ5LlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0UmVnaXN0cnkjcmVtb3ZlOltpZF1cbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0aGF0IHdhcyByZW1vdmVkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGlkID0gMTIzNDU2O1xuICAgICAqIGFwcC5hc3NldHMub24oXCJyZW1vdmU6XCIgKyBpZCwgZnVuY3Rpb24gKGFzc2V0KSB7XG4gICAgICogICAgIGNvbnNvbGUubG9nKFwiQXNzZXQgcmVtb3ZlZDogXCIgKyBhc3NldC5uYW1lKTtcbiAgICAgKiB9KTtcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYW4gYXNzZXQgaXMgcmVtb3ZlZCBmcm9tIHRoZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBldmVudCBBc3NldFJlZ2lzdHJ5I3JlbW92ZTp1cmw6W3VybF1cbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0aGF0IHdhcyByZW1vdmVkLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGFzc2V0IGxvYWRpbmcuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgQXNzZXRSZWdpc3RyeSNlcnJvclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlcnIgLSBUaGUgZXJyb3IgbWVzc2FnZS5cbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0aGF0IGdlbmVyYXRlZCB0aGUgZXJyb3IuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgaWQgPSAxMjM0NTY7XG4gICAgICogdmFyIGFzc2V0ID0gYXBwLmFzc2V0cy5nZXQoaWQpO1xuICAgICAqIGFwcC5hc3NldHMub24oXCJlcnJvclwiLCBmdW5jdGlvbiAoZXJyLCBhc3NldCkge1xuICAgICAqICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICogfSk7XG4gICAgICogYXBwLmFzc2V0cy5sb2FkKGFzc2V0KTtcbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIGR1cmluZyBhc3NldCBsb2FkaW5nLlxuICAgICAqXG4gICAgICogQGV2ZW50IEFzc2V0UmVnaXN0cnkjZXJyb3I6W2lkXVxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRoYXQgZ2VuZXJhdGVkIHRoZSBlcnJvci5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBpZCA9IDEyMzQ1NjtcbiAgICAgKiB2YXIgYXNzZXQgPSBhcHAuYXNzZXRzLmdldChpZCk7XG4gICAgICogYXBwLmFzc2V0cy5vbihcImVycm9yOlwiICsgaWQsIGZ1bmN0aW9uIChlcnIsIGFzc2V0KSB7XG4gICAgICogICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgKiB9KTtcbiAgICAgKiBhcHAuYXNzZXRzLmxvYWQoYXNzZXQpO1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgZmlsdGVyZWQgbGlzdCBvZiBhc3NldHMgZnJvbSB0aGUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZmlsdGVycyAtIFByb3BlcnRpZXMgdG8gZmlsdGVyIG9uLCBjdXJyZW50bHkgc3VwcG9ydHM6ICdwcmVsb2FkOiB0cnVlfGZhbHNlJy5cbiAgICAgKiBAcmV0dXJucyB7QXNzZXRbXX0gVGhlIGZpbHRlcmVkIGxpc3Qgb2YgYXNzZXRzLlxuICAgICAqL1xuICAgIGxpc3QoZmlsdGVycykge1xuICAgICAgICBmaWx0ZXJzID0gZmlsdGVycyB8fCB7fTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Fzc2V0cy5maWx0ZXIoKGFzc2V0KSA9PiB7XG4gICAgICAgICAgICBsZXQgaW5jbHVkZSA9IHRydWU7XG4gICAgICAgICAgICBpZiAoZmlsdGVycy5wcmVsb2FkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlID0gKGFzc2V0LnByZWxvYWQgPT09IGZpbHRlcnMucHJlbG9hZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaW5jbHVkZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGFuIGFzc2V0IHRvIHRoZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRvIGFkZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldCA9IG5ldyBwYy5Bc3NldChcIk15IEFzc2V0XCIsIFwidGV4dHVyZVwiLCB7XG4gICAgICogICAgIHVybDogXCIuLi9wYXRoL3RvL2ltYWdlLmpwZ1wiXG4gICAgICogfSk7XG4gICAgICogYXBwLmFzc2V0cy5hZGQoYXNzZXQpO1xuICAgICAqL1xuICAgIGFkZChhc3NldCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2Fzc2V0cy5wdXNoKGFzc2V0KSAtIDE7XG4gICAgICAgIGxldCB1cmw7XG5cbiAgICAgICAgLy8gaWQgY2FjaGVcbiAgICAgICAgdGhpcy5fY2FjaGVbYXNzZXQuaWRdID0gaW5kZXg7XG4gICAgICAgIGlmICghdGhpcy5fbmFtZXNbYXNzZXQubmFtZV0pXG4gICAgICAgICAgICB0aGlzLl9uYW1lc1thc3NldC5uYW1lXSA9IFtdO1xuXG4gICAgICAgIC8vIG5hbWUgY2FjaGVcbiAgICAgICAgdGhpcy5fbmFtZXNbYXNzZXQubmFtZV0ucHVzaChpbmRleCk7XG4gICAgICAgIGlmIChhc3NldC5maWxlKSB7XG4gICAgICAgICAgICB1cmwgPSBhc3NldC5maWxlLnVybDtcbiAgICAgICAgICAgIHRoaXMuX3VybHNbdXJsXSA9IGluZGV4O1xuICAgICAgICB9XG4gICAgICAgIGFzc2V0LnJlZ2lzdHJ5ID0gdGhpcztcblxuICAgICAgICAvLyB0YWdzIGNhY2hlXG4gICAgICAgIHRoaXMuX3RhZ3MuYWRkSXRlbShhc3NldCk7XG4gICAgICAgIGFzc2V0LnRhZ3Mub24oJ2FkZCcsIHRoaXMuX29uVGFnQWRkLCB0aGlzKTtcbiAgICAgICAgYXNzZXQudGFncy5vbigncmVtb3ZlJywgdGhpcy5fb25UYWdSZW1vdmUsIHRoaXMpO1xuXG4gICAgICAgIHRoaXMuZmlyZSgnYWRkJywgYXNzZXQpO1xuICAgICAgICB0aGlzLmZpcmUoJ2FkZDonICsgYXNzZXQuaWQsIGFzc2V0KTtcbiAgICAgICAgaWYgKHVybClcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnYWRkOnVybDonICsgdXJsLCBhc3NldCk7XG5cbiAgICAgICAgaWYgKGFzc2V0LnByZWxvYWQpXG4gICAgICAgICAgICB0aGlzLmxvYWQoYXNzZXQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhbiBhc3NldCBmcm9tIHRoZSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXNzZXR9IGFzc2V0IC0gVGhlIGFzc2V0IHRvIHJlbW92ZS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYXNzZXQgd2FzIHN1Y2Nlc3NmdWxseSByZW1vdmVkIGFuZCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgYXNzZXQgPSBhcHAuYXNzZXRzLmdldCgxMDApO1xuICAgICAqIGFwcC5hc3NldHMucmVtb3ZlKGFzc2V0KTtcbiAgICAgKi9cbiAgICByZW1vdmUoYXNzZXQpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5fY2FjaGVbYXNzZXQuaWRdO1xuICAgICAgICBjb25zdCB1cmwgPSBhc3NldC5maWxlID8gYXNzZXQuZmlsZS51cmwgOiBudWxsO1xuXG4gICAgICAgIGlmIChpZHggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gbGlzdFxuICAgICAgICAgICAgdGhpcy5fYXNzZXRzLnNwbGljZShpZHgsIDEpO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgaWQgLT4gaW5kZXggY2FjaGVcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9jYWNoZVthc3NldC5pZF07XG5cbiAgICAgICAgICAgIC8vIG5hbWUgY2FjaGUgbmVlZHMgdG8gYmUgY29tcGxldGVseSByZWJ1aWx0XG4gICAgICAgICAgICB0aGlzLl9uYW1lcyA9IHt9O1xuXG4gICAgICAgICAgICAvLyB1cmxzIGNhY2hlIG5lZWRzIHRvIGJlIGNvbXBsZXRlbHkgcmVidWlsdFxuICAgICAgICAgICAgdGhpcy5fdXJscyA9IFtdO1xuXG4gICAgICAgICAgICAvLyB1cGRhdGUgaWQgY2FjaGUgYW5kIHJlYnVpbGQgbmFtZSBjYWNoZVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLl9hc3NldHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX2Fzc2V0c1tpXTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2NhY2hlW2EuaWRdID0gaTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX25hbWVzW2EubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmFtZXNbYS5uYW1lXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lc1thLm5hbWVdLnB1c2goaSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYS5maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VybHNbYS5maWxlLnVybF0gPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdGFncyBjYWNoZVxuICAgICAgICAgICAgdGhpcy5fdGFncy5yZW1vdmVJdGVtKGFzc2V0KTtcbiAgICAgICAgICAgIGFzc2V0LnRhZ3Mub2ZmKCdhZGQnLCB0aGlzLl9vblRhZ0FkZCwgdGhpcyk7XG4gICAgICAgICAgICBhc3NldC50YWdzLm9mZigncmVtb3ZlJywgdGhpcy5fb25UYWdSZW1vdmUsIHRoaXMpO1xuXG4gICAgICAgICAgICBhc3NldC5maXJlKCdyZW1vdmUnLCBhc3NldCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3JlbW92ZScsIGFzc2V0KTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlOicgKyBhc3NldC5pZCwgYXNzZXQpO1xuICAgICAgICAgICAgaWYgKHVybClcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3JlbW92ZTp1cmw6JyArIHVybCwgYXNzZXQpO1xuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFzc2V0IG5vdCBpbiByZWdpc3RyeVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgYW4gYXNzZXQgZnJvbSB0aGUgcmVnaXN0cnkgYnkgaXRzIGlkIGZpZWxkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGlkIC0gVGhlIGlkIG9mIHRoZSBhc3NldCB0byBnZXQuXG4gICAgICogQHJldHVybnMge0Fzc2V0fSBUaGUgYXNzZXQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgYXNzZXQgPSBhcHAuYXNzZXRzLmdldCgxMDApO1xuICAgICAqL1xuICAgIGdldChpZCkge1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9jYWNoZVtpZF07XG4gICAgICAgIHJldHVybiB0aGlzLl9hc3NldHNbaWR4XTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhbiBhc3NldCBmcm9tIHRoZSByZWdpc3RyeSBieSBpdHMgZmlsZSdzIFVSTCBmaWVsZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgdXJsIG9mIHRoZSBhc3NldCB0byBnZXQuXG4gICAgICogQHJldHVybnMge0Fzc2V0fSBUaGUgYXNzZXQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgYXNzZXQgPSBhcHAuYXNzZXRzLmdldEJ5VXJsKFwiLi4vcGF0aC90by9pbWFnZS5qcGdcIik7XG4gICAgICovXG4gICAgZ2V0QnlVcmwodXJsKSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX3VybHNbdXJsXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Fzc2V0c1tpZHhdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGFzc2V0J3MgZmlsZSBmcm9tIGEgcmVtb3RlIHNvdXJjZS4gTGlzdGVuIGZvciBcImxvYWRcIiBldmVudHMgb24gdGhlIGFzc2V0IHRvIGZpbmRcbiAgICAgKiBvdXQgd2hlbiBpdCBpcyBsb2FkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBhc3NldCAtIFRoZSBhc3NldCB0byBsb2FkLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogLy8gbG9hZCBzb21lIGFzc2V0c1xuICAgICAqIHZhciBhc3NldHNUb0xvYWQgPSBbXG4gICAgICogICAgIGFwcC5hc3NldHMuZmluZChcIk15IEFzc2V0XCIpLFxuICAgICAqICAgICBhcHAuYXNzZXRzLmZpbmQoXCJBbm90aGVyIEFzc2V0XCIpXG4gICAgICogXTtcbiAgICAgKiB2YXIgY291bnQgPSAwO1xuICAgICAqIGFzc2V0c1RvTG9hZC5mb3JFYWNoKGZ1bmN0aW9uIChhc3NldFRvTG9hZCkge1xuICAgICAqICAgICBhc3NldFRvTG9hZC5yZWFkeShmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgKiAgICAgICAgIGNvdW50Kys7XG4gICAgICogICAgICAgICBpZiAoY291bnQgPT09IGFzc2V0c1RvTG9hZC5sZW5ndGgpIHtcbiAgICAgKiAgICAgICAgICAgICAvLyBkb25lXG4gICAgICogICAgICAgICB9XG4gICAgICogICAgIH0pO1xuICAgICAqICAgICBhcHAuYXNzZXRzLmxvYWQoYXNzZXRUb0xvYWQpO1xuICAgICAqIH0pO1xuICAgICAqL1xuICAgIGxvYWQoYXNzZXQpIHtcbiAgICAgICAgLy8gZG8gbm90aGluZyBpZiBhc3NldCBpcyBhbHJlYWR5IGxvYWRlZFxuICAgICAgICAvLyBub3RlOiBsb3RzIG9mIGNvZGUgY2FsbHMgYXNzZXRzLmxvYWQoKSBhc3N1bWluZyB0aGlzIGNoZWNrIGlzIHByZXNlbnRcbiAgICAgICAgLy8gZG9uJ3QgcmVtb3ZlIGl0IHdpdGhvdXQgdXBkYXRpbmcgY2FsbHMgdG8gYXNzZXRzLmxvYWQoKSB3aXRoIGNoZWNrcyBmb3IgdGhlIGFzc2V0LmxvYWRlZCBzdGF0ZVxuICAgICAgICBpZiAoYXNzZXQubG9hZGluZyB8fCBhc3NldC5sb2FkZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpbGUgPSBhc3NldC5maWxlO1xuXG4gICAgICAgIC8vIG9wZW4gaGFzIGNvbXBsZXRlZCBvbiB0aGUgcmVzb3VyY2VcbiAgICAgICAgY29uc3QgX29wZW5lZCA9IChyZXNvdXJjZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc291cmNlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICBhc3NldC5yZXNvdXJjZXMgPSByZXNvdXJjZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYXNzZXQucmVzb3VyY2UgPSByZXNvdXJjZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbGV0IGhhbmRsZXIgcGF0Y2ggdGhlIHJlc291cmNlXG4gICAgICAgICAgICB0aGlzLl9sb2FkZXIucGF0Y2goYXNzZXQsIHRoaXMpO1xuXG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2xvYWQnLCBhc3NldCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2xvYWQ6JyArIGFzc2V0LmlkLCBhc3NldCk7XG4gICAgICAgICAgICBpZiAoZmlsZSAmJiBmaWxlLnVybClcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ2xvYWQ6dXJsOicgKyBmaWxlLnVybCwgYXNzZXQpO1xuICAgICAgICAgICAgYXNzZXQuZmlyZSgnbG9hZCcsIGFzc2V0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBsb2FkIGhhcyBjb21wbGV0ZWQgb24gdGhlIHJlc291cmNlXG4gICAgICAgIGNvbnN0IF9sb2FkZWQgPSAoZXJyLCByZXNvdXJjZSwgZXh0cmEpID0+IHtcbiAgICAgICAgICAgIGFzc2V0LmxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICBhc3NldC5sb2FkaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ2Vycm9yJywgZXJyLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdlcnJvcjonICsgYXNzZXQuaWQsIGVyciwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIGFzc2V0LmZpcmUoJ2Vycm9yJywgZXJyLCBhc3NldCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICghc2NyaXB0LmxlZ2FjeSAmJiBhc3NldC50eXBlID09PSAnc2NyaXB0Jykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5fbG9hZGVyLmdldEhhbmRsZXIoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5fY2FjaGVbYXNzZXQuaWRdICYmIGhhbmRsZXIuX2NhY2hlW2Fzc2V0LmlkXS5wYXJlbnROb2RlID09PSBkb2N1bWVudC5oZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgb2xkIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQucmVtb3ZlQ2hpbGQoaGFuZGxlci5fY2FjaGVbYXNzZXQuaWRdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9jYWNoZVthc3NldC5pZF0gPSBleHRyYTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfb3BlbmVkKHJlc291cmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoZmlsZSB8fCBhc3NldC50eXBlID09PSAnY3ViZW1hcCcpIHtcbiAgICAgICAgICAgIC8vIHN0YXJ0IGxvYWRpbmcgdGhlIHJlc291cmNlXG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2xvYWQ6c3RhcnQnLCBhc3NldCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2xvYWQ6JyArIGFzc2V0LmlkICsgJzpzdGFydCcsIGFzc2V0KTtcblxuICAgICAgICAgICAgYXNzZXQubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9sb2FkZXIubG9hZChhc3NldC5nZXRGaWxlVXJsKCksIGFzc2V0LnR5cGUsIF9sb2FkZWQsIGFzc2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGFzc2V0IGhhcyBubyBmaWxlIHRvIGxvYWQsIG9wZW4gaXQgZGlyZWN0bHlcbiAgICAgICAgICAgIGNvbnN0IHJlc291cmNlID0gdGhpcy5fbG9hZGVyLm9wZW4oYXNzZXQudHlwZSwgYXNzZXQuZGF0YSk7XG4gICAgICAgICAgICBhc3NldC5sb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgX29wZW5lZChyZXNvdXJjZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2UgdGhpcyB0byBsb2FkIGFuZCBjcmVhdGUgYW4gYXNzZXQgaWYgeW91IGRvbid0IGhhdmUgYXNzZXRzIGNyZWF0ZWQuIFVzdWFsbHkgeW91IHdvdWxkXG4gICAgICogb25seSB1c2UgdGhpcyBpZiB5b3UgYXJlIG5vdCBpbnRlZ3JhdGVkIHdpdGggdGhlIFBsYXlDYW52YXMgRWRpdG9yLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSB1cmwgdG8gbG9hZC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSB0eXBlIG9mIGFzc2V0IHRvIGxvYWQuXG4gICAgICogQHBhcmFtIHtMb2FkQXNzZXRDYWxsYmFja30gY2FsbGJhY2sgLSBGdW5jdGlvbiBjYWxsZWQgd2hlbiBhc3NldCBpcyBsb2FkZWQsIHBhc3NlZCAoZXJyLFxuICAgICAqIGFzc2V0KSwgd2hlcmUgZXJyIGlzIG51bGwgaWYgbm8gZXJyb3JzIHdlcmUgZW5jb3VudGVyZWQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBhcHAuYXNzZXRzLmxvYWRGcm9tVXJsKFwiLi4vcGF0aC90by90ZXh0dXJlLmpwZ1wiLCBcInRleHR1cmVcIiwgZnVuY3Rpb24gKGVyciwgYXNzZXQpIHtcbiAgICAgKiAgICAgdmFyIHRleHR1cmUgPSBhc3NldC5yZXNvdXJjZTtcbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBsb2FkRnJvbVVybCh1cmwsIHR5cGUsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMubG9hZEZyb21VcmxBbmRGaWxlbmFtZSh1cmwsIG51bGwsIHR5cGUsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2UgdGhpcyB0byBsb2FkIGFuZCBjcmVhdGUgYW4gYXNzZXQgd2hlbiBib3RoIHRoZSBVUkwgYW5kIGZpbGVuYW1lIGFyZSByZXF1aXJlZC4gRm9yXG4gICAgICogZXhhbXBsZSwgdXNlIHRoaXMgZnVuY3Rpb24gd2hlbiBsb2FkaW5nIEJMT0IgYXNzZXRzLCB3aGVyZSB0aGUgVVJMIGRvZXMgbm90IGFkZXF1YXRlbHlcbiAgICAgKiBpZGVudGlmeSB0aGUgZmlsZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgdXJsIHRvIGxvYWQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVuYW1lIC0gVGhlIGZpbGVuYW1lIG9mIHRoZSBhc3NldCB0byBsb2FkLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHR5cGUgb2YgYXNzZXQgdG8gbG9hZC5cbiAgICAgKiBAcGFyYW0ge0xvYWRBc3NldENhbGxiYWNrfSBjYWxsYmFjayAtIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGFzc2V0IGlzIGxvYWRlZCwgcGFzc2VkIChlcnIsXG4gICAgICogYXNzZXQpLCB3aGVyZSBlcnIgaXMgbnVsbCBpZiBubyBlcnJvcnMgd2VyZSBlbmNvdW50ZXJlZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBmaWxlID0gbWFnaWNhbGx5QXR0YWluQUZpbGUoKTtcbiAgICAgKiBhcHAuYXNzZXRzLmxvYWRGcm9tVXJsQW5kRmlsZW5hbWUoVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSwgXCJ0ZXh0dXJlLnBuZ1wiLCBcInRleHR1cmVcIiwgZnVuY3Rpb24gKGVyciwgYXNzZXQpIHtcbiAgICAgKiAgICAgdmFyIHRleHR1cmUgPSBhc3NldC5yZXNvdXJjZTtcbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBsb2FkRnJvbVVybEFuZEZpbGVuYW1lKHVybCwgZmlsZW5hbWUsIHR5cGUsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBwYXRoLmdldEJhc2VuYW1lKGZpbGVuYW1lIHx8IHVybCk7XG5cbiAgICAgICAgY29uc3QgZmlsZSA9IHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSB8fCBuYW1lLFxuICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgYXNzZXQgPSB0aGlzLmdldEJ5VXJsKHVybCk7XG4gICAgICAgIGlmICghYXNzZXQpIHtcbiAgICAgICAgICAgIGFzc2V0ID0gbmV3IEFzc2V0KG5hbWUsIHR5cGUsIGZpbGUpO1xuICAgICAgICAgICAgdGhpcy5hZGQoYXNzZXQpO1xuICAgICAgICB9IGVsc2UgaWYgKGFzc2V0LmxvYWRlZCkge1xuICAgICAgICAgICAgLy8gYXNzZXQgaXMgYWxyZWFkeSBsb2FkZWRcbiAgICAgICAgICAgIGNhbGxiYWNrKGFzc2V0LmxvYWRGcm9tVXJsRXJyb3IgfHwgbnVsbCwgYXNzZXQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RhcnRMb2FkID0gKGFzc2V0KSA9PiB7XG4gICAgICAgICAgICBhc3NldC5vbmNlKCdsb2FkJywgKGxvYWRlZEFzc2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdtYXRlcmlhbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZFRleHR1cmVzKGxvYWRlZEFzc2V0LCAoZXJyLCB0ZXh0dXJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCBsb2FkZWRBc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGxvYWRlZEFzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFzc2V0Lm9uY2UoJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIHN0b3JlIHRoZSBlcnJvciBvbiB0aGUgYXNzZXQgaW4gY2FzZSB1c2VyIHJlcXVlc3RzIHRoaXMgYXNzZXQgYWdhaW5cbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEZyb21VcmxFcnJvciA9IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCBhc3NldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMubG9hZChhc3NldCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBhc3NldCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ21vZGVsJykge1xuICAgICAgICAgICAgdGhpcy5fbG9hZE1vZGVsKGFzc2V0LCBzdGFydExvYWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhcnRMb2FkKGFzc2V0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHByaXZhdGUgbWV0aG9kIHVzZWQgZm9yIGVuZ2luZS1vbmx5IGxvYWRpbmcgb2YgbW9kZWwgZGF0YVxuICAgIF9sb2FkTW9kZWwobW9kZWxBc3NldCwgY29udGludWF0aW9uKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IG1vZGVsQXNzZXQuZ2V0RmlsZVVybCgpO1xuICAgICAgICBjb25zdCBleHQgPSBwYXRoLmdldEV4dGVuc2lvbih1cmwpO1xuXG4gICAgICAgIGlmIChleHQgPT09ICcuanNvbicgfHwgZXh0ID09PSAnLmdsYicpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpciA9IHBhdGguZ2V0RGlyZWN0b3J5KHVybCk7XG4gICAgICAgICAgICBjb25zdCBiYXNlbmFtZSA9IHBhdGguZ2V0QmFzZW5hbWUodXJsKTtcblxuICAgICAgICAgICAgLy8gUGxheUNhbnZhcyBtb2RlbCBmb3JtYXQgc3VwcG9ydHMgbWF0ZXJpYWwgbWFwcGluZyBmaWxlXG4gICAgICAgICAgICBjb25zdCBtYXBwaW5nVXJsID0gcGF0aC5qb2luKGRpciwgYmFzZW5hbWUucmVwbGFjZShleHQsICcubWFwcGluZy5qc29uJykpO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGVyLmxvYWQobWFwcGluZ1VybCwgJ2pzb24nLCAoZXJyLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBtb2RlbEFzc2V0LmRhdGEgPSB7IG1hcHBpbmc6IFtdIH07XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVhdGlvbihtb2RlbEFzc2V0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkTWF0ZXJpYWxzKG1vZGVsQXNzZXQsIGRhdGEsIChlLCBtYXRlcmlhbHMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsQXNzZXQuZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51YXRpb24obW9kZWxBc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gb3RoZXIgbW9kZWwgZm9ybWF0IChlLmcuIG9iailcbiAgICAgICAgICAgIGNvbnRpbnVhdGlvbihtb2RlbEFzc2V0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHByaXZhdGUgbWV0aG9kIHVzZWQgZm9yIGVuZ2luZS1vbmx5IGxvYWRpbmcgb2YgbW9kZWwgbWF0ZXJpYWxzXG4gICAgX2xvYWRNYXRlcmlhbHMobW9kZWxBc3NldCwgbWFwcGluZywgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgbWF0ZXJpYWxzID0gW107XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG5cbiAgICAgICAgY29uc3Qgb25NYXRlcmlhbExvYWRlZCA9IChlcnIsIG1hdGVyaWFsQXNzZXQpID0+IHtcbiAgICAgICAgICAgIC8vIGxvYWQgZGVwZW5kZW50IHRleHR1cmVzXG4gICAgICAgICAgICB0aGlzLl9sb2FkVGV4dHVyZXMobWF0ZXJpYWxBc3NldCwgKGVyciwgdGV4dHVyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBtYXRlcmlhbHMucHVzaChtYXRlcmlhbEFzc2V0KTtcbiAgICAgICAgICAgICAgICBpZiAobWF0ZXJpYWxzLmxlbmd0aCA9PT0gY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgbWF0ZXJpYWxzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hcHBpbmcubWFwcGluZy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IG1hcHBpbmcubWFwcGluZ1tpXS5wYXRoO1xuICAgICAgICAgICAgaWYgKHBhdGgpIHtcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IG1vZGVsQXNzZXQuZ2V0QWJzb2x1dGVVcmwocGF0aCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkRnJvbVVybCh1cmwsICdtYXRlcmlhbCcsIG9uTWF0ZXJpYWxMb2FkZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBtYXRlcmlhbHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gcHJpdmF0ZSBtZXRob2QgdXNlZCBmb3IgZW5naW5lLW9ubHkgbG9hZGluZyBvZiB0aGUgdGV4dHVyZXMgcmVmZXJlbmNlZCBieVxuICAgIC8vIHRoZSBtYXRlcmlhbCBhc3NldFxuICAgIF9sb2FkVGV4dHVyZXMobWF0ZXJpYWxBc3NldCwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgdGV4dHVyZXMgPSBbXTtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcblxuICAgICAgICBjb25zdCBkYXRhID0gbWF0ZXJpYWxBc3NldC5kYXRhO1xuICAgICAgICBpZiAoZGF0YS5tYXBwaW5nRm9ybWF0ICE9PSAncGF0aCcpIHtcbiAgICAgICAgICAgIERlYnVnLndhcm4oYFNraXBwaW5nOiAke21hdGVyaWFsQXNzZXQubmFtZX0sIG1hdGVyaWFsIGZpbGVzIG11c3QgYmUgbWFwcGluZ0Zvcm1hdDogXCJwYXRoXCIgdG8gYmUgbG9hZGVkIGZyb20gVVJMYCk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCB0ZXh0dXJlcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvblRleHR1cmVMb2FkZWQgPSAoZXJyLCB0ZXh0dXJlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICB0ZXh0dXJlcy5wdXNoKHRleHR1cmUpO1xuICAgICAgICAgICAgaWYgKHRleHR1cmVzLmxlbmd0aCA9PT0gY291bnQpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB0ZXh0dXJlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgdGV4UGFyYW1zID0gc3RhbmRhcmRNYXRlcmlhbFRleHR1cmVQYXJhbWV0ZXJzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleFBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGRhdGFbdGV4UGFyYW1zW2ldXTtcbiAgICAgICAgICAgIGlmIChwYXRoICYmIHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gbWF0ZXJpYWxBc3NldC5nZXRBYnNvbHV0ZVVybChwYXRoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRGcm9tVXJsKHVybCwgJ3RleHR1cmUnLCBvblRleHR1cmVMb2FkZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCB0ZXh0dXJlcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYWxsIEFzc2V0cyB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSBhbmQgdHlwZSBmb3VuZCBpbiB0aGUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBBc3NldHMgdG8gZmluZC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3R5cGVdIC0gVGhlIHR5cGUgb2YgdGhlIEFzc2V0cyB0byBmaW5kLlxuICAgICAqIEByZXR1cm5zIHtBc3NldFtdfSBBIGxpc3Qgb2YgYWxsIEFzc2V0cyBmb3VuZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldHMgPSBhcHAuYXNzZXRzLmZpbmRBbGwoXCJteVRleHR1cmVBc3NldFwiLCBcInRleHR1cmVcIik7XG4gICAgICogY29uc29sZS5sb2coXCJGb3VuZCBcIiArIGFzc2V0cy5sZW5ndGggKyBcIiBhc3NldHMgY2FsbGVkIFwiICsgbmFtZSk7XG4gICAgICovXG4gICAgZmluZEFsbChuYW1lLCB0eXBlKSB7XG4gICAgICAgIGNvbnN0IGlkeHMgPSB0aGlzLl9uYW1lc1tuYW1lXTtcbiAgICAgICAgaWYgKGlkeHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGFzc2V0cyA9IGlkeHMubWFwKChpZHgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYXNzZXRzW2lkeF07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRzLmZpbHRlcigoYXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhc3NldC50eXBlID09PSB0eXBlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0cztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBfb25UYWdBZGQodGFnLCBhc3NldCkge1xuICAgICAgICB0aGlzLl90YWdzLmFkZCh0YWcsIGFzc2V0KTtcbiAgICB9XG5cbiAgICBfb25UYWdSZW1vdmUodGFnLCBhc3NldCkge1xuICAgICAgICB0aGlzLl90YWdzLnJlbW92ZSh0YWcsIGFzc2V0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYWxsIEFzc2V0cyB0aGF0IHNhdGlzZnkgdGhlIHNlYXJjaCBxdWVyeS4gUXVlcnkgY2FuIGJlIHNpbXBseSBhIHN0cmluZywgb3IgY29tbWFcbiAgICAgKiBzZXBhcmF0ZWQgc3RyaW5ncywgdG8gaGF2ZSBpbmNsdXNpdmUgcmVzdWx0cyBvZiBhc3NldHMgdGhhdCBtYXRjaCBhdCBsZWFzdCBvbmUgcXVlcnkuIEFcbiAgICAgKiBxdWVyeSB0aGF0IGNvbnNpc3RzIG9mIGFuIGFycmF5IG9mIHRhZ3MgY2FuIGJlIHVzZWQgdG8gbWF0Y2ggYXNzZXRzIHRoYXQgaGF2ZSBlYWNoIHRhZyBvZlxuICAgICAqIGFycmF5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHsuLi4qfSBxdWVyeSAtIE5hbWUgb2YgYSB0YWcgb3IgYXJyYXkgb2YgdGFncy5cbiAgICAgKiBAcmV0dXJucyB7QXNzZXRbXX0gQSBsaXN0IG9mIGFsbCBBc3NldHMgbWF0Y2hlZCBxdWVyeS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldHMgPSBhcHAuYXNzZXRzLmZpbmRCeVRhZyhcImxldmVsLTFcIik7XG4gICAgICogLy8gcmV0dXJucyBhbGwgYXNzZXRzIHRoYXQgdGFnZ2VkIGJ5IGBsZXZlbC0xYFxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIGFzc2V0cyA9IGFwcC5hc3NldHMuZmluZEJ5VGFnKFwibGV2ZWwtMVwiLCBcImxldmVsLTJcIik7XG4gICAgICogLy8gcmV0dXJucyBhbGwgYXNzZXRzIHRoYXQgdGFnZ2VkIGJ5IGBsZXZlbC0xYCBPUiBgbGV2ZWwtMmBcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldHMgPSBhcHAuYXNzZXRzLmZpbmRCeVRhZyhbXCJsZXZlbC0xXCIsIFwibW9uc3RlclwiXSk7XG4gICAgICogLy8gcmV0dXJucyBhbGwgYXNzZXRzIHRoYXQgdGFnZ2VkIGJ5IGBsZXZlbC0xYCBBTkQgYG1vbnN0ZXJgXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgYXNzZXRzID0gYXBwLmFzc2V0cy5maW5kQnlUYWcoW1wibGV2ZWwtMVwiLCBcIm1vbnN0ZXJcIl0sIFtcImxldmVsLTJcIiwgXCJtb25zdGVyXCJdKTtcbiAgICAgKiAvLyByZXR1cm5zIGFsbCBhc3NldHMgdGhhdCB0YWdnZWQgYnkgKGBsZXZlbC0xYCBBTkQgYG1vbnN0ZXJgKSBPUiAoYGxldmVsLTJgIEFORCBgbW9uc3RlcmApXG4gICAgICovXG4gICAgZmluZEJ5VGFnKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFncy5maW5kKGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGFsbCBBc3NldHMgdGhhdCBzYXRpc2Z5IGEgZmlsdGVyIGNhbGxiYWNrLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtGaWx0ZXJBc3NldENhbGxiYWNrfSBjYWxsYmFjayAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgdG8gZmlsdGVyIGFzc2V0cy5cbiAgICAgKiBSZXR1cm4gYHRydWVgIHRvIGluY2x1ZGUgYW4gYXNzZXQgaW4gdGhlIHJldHVybmVkIGFycmF5LlxuICAgICAqIEByZXR1cm5zIHtBc3NldFtdfSBBIGxpc3Qgb2YgYWxsIEFzc2V0cyBmb3VuZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBhc3NldHMgPSBhcHAuYXNzZXRzLmZpbHRlcihmdW5jdGlvbiAoYXNzZXQpIHtcbiAgICAgKiAgICAgcmV0dXJuIGFzc2V0Lm5hbWUuaW5kZXhPZignbW9uc3RlcicpICE9PSAtMTtcbiAgICAgKiB9KTtcbiAgICAgKiBjb25zb2xlLmxvZyhcIkZvdW5kIFwiICsgYXNzZXRzLmxlbmd0aCArIFwiIGFzc2V0cywgd2hlcmUgbmFtZXMgY29udGFpbnMgJ21vbnN0ZXInXCIpO1xuICAgICAqL1xuICAgIGZpbHRlcihjYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXNzZXRzLmZpbHRlcihhc3NldCA9PiBjYWxsYmFjayhhc3NldCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgZmlyc3QgQXNzZXQgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYW5kIHR5cGUgZm91bmQgaW4gdGhlIHJlZ2lzdHJ5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgQXNzZXQgdG8gZmluZC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3R5cGVdIC0gVGhlIHR5cGUgb2YgdGhlIEFzc2V0IHRvIGZpbmQuXG4gICAgICogQHJldHVybnMge0Fzc2V0fG51bGx9IEEgc2luZ2xlIEFzc2V0IG9yIG51bGwgaWYgbm8gQXNzZXQgaXMgZm91bmQuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiB2YXIgYXNzZXQgPSBhcHAuYXNzZXRzLmZpbmQoXCJteVRleHR1cmVBc3NldFwiLCBcInRleHR1cmVcIik7XG4gICAgICovXG4gICAgZmluZChuYW1lLCB0eXBlKSB7XG4gICAgICAgIC8vIGZpbmRBbGwgcmV0dXJucyBhbiBlbXB0eSBhcnJheSB0aGUgaWYgdGhlIGFzc2V0IGNhbm5vdCBiZSBmb3VuZCBzbyBgYXNzZXRgIGlzXG4gICAgICAgIC8vIG5ldmVyIG51bGwvdW5kZWZpbmVkXG4gICAgICAgIGNvbnN0IGFzc2V0ID0gdGhpcy5maW5kQWxsKG5hbWUsIHR5cGUpO1xuICAgICAgICByZXR1cm4gYXNzZXQubGVuZ3RoID4gMCA/IGFzc2V0WzBdIDogbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IEFzc2V0UmVnaXN0cnkgfTtcbiJdLCJuYW1lcyI6WyJBc3NldFJlZ2lzdHJ5IiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJsb2FkZXIiLCJfbG9hZGVyIiwiX2Fzc2V0cyIsIl9jYWNoZSIsIl9uYW1lcyIsIl90YWdzIiwiVGFnc0NhY2hlIiwiX3VybHMiLCJwcmVmaXgiLCJsaXN0IiwiZmlsdGVycyIsImZpbHRlciIsImFzc2V0IiwiaW5jbHVkZSIsInByZWxvYWQiLCJ1bmRlZmluZWQiLCJhZGQiLCJpbmRleCIsInB1c2giLCJ1cmwiLCJpZCIsIm5hbWUiLCJmaWxlIiwicmVnaXN0cnkiLCJhZGRJdGVtIiwidGFncyIsIm9uIiwiX29uVGFnQWRkIiwiX29uVGFnUmVtb3ZlIiwiZmlyZSIsImxvYWQiLCJyZW1vdmUiLCJpZHgiLCJzcGxpY2UiLCJpIiwibCIsImxlbmd0aCIsImEiLCJyZW1vdmVJdGVtIiwib2ZmIiwiZ2V0IiwiZ2V0QnlVcmwiLCJsb2FkaW5nIiwibG9hZGVkIiwiX29wZW5lZCIsInJlc291cmNlIiwiQXJyYXkiLCJyZXNvdXJjZXMiLCJwYXRjaCIsIl9sb2FkZWQiLCJlcnIiLCJleHRyYSIsInNjcmlwdCIsImxlZ2FjeSIsInR5cGUiLCJoYW5kbGVyIiwiZ2V0SGFuZGxlciIsInBhcmVudE5vZGUiLCJkb2N1bWVudCIsImhlYWQiLCJyZW1vdmVDaGlsZCIsImdldEZpbGVVcmwiLCJvcGVuIiwiZGF0YSIsImxvYWRGcm9tVXJsIiwiY2FsbGJhY2siLCJsb2FkRnJvbVVybEFuZEZpbGVuYW1lIiwiZmlsZW5hbWUiLCJwYXRoIiwiZ2V0QmFzZW5hbWUiLCJBc3NldCIsImxvYWRGcm9tVXJsRXJyb3IiLCJzdGFydExvYWQiLCJvbmNlIiwibG9hZGVkQXNzZXQiLCJfbG9hZFRleHR1cmVzIiwidGV4dHVyZXMiLCJfbG9hZE1vZGVsIiwibW9kZWxBc3NldCIsImNvbnRpbnVhdGlvbiIsImV4dCIsImdldEV4dGVuc2lvbiIsImRpciIsImdldERpcmVjdG9yeSIsImJhc2VuYW1lIiwibWFwcGluZ1VybCIsImpvaW4iLCJyZXBsYWNlIiwibWFwcGluZyIsIl9sb2FkTWF0ZXJpYWxzIiwiZSIsIm1hdGVyaWFscyIsImNvdW50Iiwib25NYXRlcmlhbExvYWRlZCIsIm1hdGVyaWFsQXNzZXQiLCJnZXRBYnNvbHV0ZVVybCIsIm1hcHBpbmdGb3JtYXQiLCJEZWJ1ZyIsIndhcm4iLCJvblRleHR1cmVMb2FkZWQiLCJ0ZXh0dXJlIiwiY29uc29sZSIsImVycm9yIiwidGV4UGFyYW1zIiwic3RhbmRhcmRNYXRlcmlhbFRleHR1cmVQYXJhbWV0ZXJzIiwiZmluZEFsbCIsImlkeHMiLCJhc3NldHMiLCJtYXAiLCJ0YWciLCJmaW5kQnlUYWci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
