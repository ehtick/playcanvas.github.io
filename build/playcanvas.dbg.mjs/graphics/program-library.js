/**
 * @license
 * PlayCanvas Engine v1.58.0-dev revision e102f2b2a (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../core/debug.js';
import { version, revision } from '../core/core.js';
import { Shader } from './shader.js';
import { SHADER_FORWARD, SHADER_SHADOW, SHADER_DEPTH, SHADER_PICK } from '../scene/constants.js';
import { StandardMaterial } from '../scene/materials/standard-material.js';
import { ShaderPass } from '../scene/shader-pass.js';
import { DeviceCache } from './device-cache.js';

const programLibraryDeviceCache = new DeviceCache();

class ProgramLibrary {
  constructor(device) {
    this.processedCache = new Map();
    this._device = device;
    this._cache = {};
    this._generators = {};
    this._isClearingCache = false;
    this._precached = false;
    this._programsCollection = [];
    this._defaultStdMatOption = {};
    this._defaultStdMatOptionMin = {};
    const m = new StandardMaterial();
    m.shaderOptBuilder.updateRef(this._defaultStdMatOption, {}, m, null, [], SHADER_FORWARD, null);
    m.shaderOptBuilder.updateMinRef(this._defaultStdMatOptionMin, {}, m, null, [], SHADER_SHADOW, null);
  }

  destroy() {
    this.clearCache();
  }

  register(name, generator) {
    if (!this.isRegistered(name)) {
      this._generators[name] = generator;
    }
  }

  unregister(name) {
    if (this.isRegistered(name)) {
      delete this._generators[name];
    }
  }

  isRegistered(name) {
    const generator = this._generators[name];
    return generator !== undefined;
  }

  generateShader(generator, name, key, options) {
    let shader = this._cache[key];

    if (!shader) {
      let lights;

      if (options.lights) {
        lights = options.lights;
        options.lights = lights.map(function (l) {
          const lcopy = l.clone ? l.clone() : l;
          lcopy.key = l.key;
          return lcopy;
        });
      }

      this.storeNewProgram(name, options);
      if (options.lights) options.lights = lights;
      if (this._precached) Debug.log(`ProgramLibrary#getProgram: Cache miss for shader ${name} key ${key} after shaders precaching`);
      const device = this._device;
      const shaderDefinition = generator.createShaderDefinition(device, options);
      shaderDefinition.name = `${name}-pass:${options.pass}`;
      shader = this._cache[key] = new Shader(device, shaderDefinition);
    }

    return shader;
  }

  getProgram(name, options, processingOptions) {
    const generator = this._generators[name];

    if (!generator) {
      Debug.warn(`ProgramLibrary#getProgram: No program library functions registered for: ${name}`);
      return null;
    }

    const generationKey = generator.generateKey(options);
    const processingKey = JSON.stringify(processingOptions);
    const totalKey = `${generationKey}#${processingKey}`;
    let processedShader = this.processedCache.get(totalKey);

    if (!processedShader) {
      const generatedShader = this.generateShader(generator, name, generationKey, options);
      Debug.assert(generatedShader);
      const generatedShaderDef = generatedShader.definition;
      const shaderDefinition = {
        attributes: generatedShaderDef.attributes,
        vshader: generatedShaderDef.vshader,
        fshader: generatedShaderDef.fshader,
        processingOptions: processingOptions
      };
      processedShader = new Shader(this._device, shaderDefinition);
      this.processedCache.set(totalKey, processedShader);
    }

    return processedShader;
  }

  storeNewProgram(name, options) {
    let opt = {};

    if (name === "standard") {
      const defaultMat = this._getDefaultStdMatOptions(options.pass);

      for (const p in options) {
        if (options.hasOwnProperty(p) && defaultMat[p] !== options[p] || p === "pass") opt[p] = options[p];
      }
    } else {
      opt = options;
    }

    this._programsCollection.push(JSON.stringify({
      name: name,
      options: opt
    }));
  }

  dumpPrograms() {
    let text = 'let device = pc.app ? pc.app.graphicsDevice : pc.Application.getApplication().graphicsDevice;\n';
    text += 'let shaders = [';
    if (this._programsCollection[0]) text += '\n\t' + this._programsCollection[0];

    for (let i = 1; i < this._programsCollection.length; ++i) {
      text += ',\n\t' + this._programsCollection[i];
    }

    text += '\n];\n';
    text += 'device.getProgramLibrary().precompile(shaders);\n';
    text += 'if (pc.version != \"' + version + '\" || pc.revision != \"' + revision + '\")\n';
    text += '\tconsole.warn(\"precompile-shaders.js: engine version mismatch, rebuild shaders lib with current engine\");';
    const element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', 'precompile-shaders.js');
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  }

  clearCache() {
    const cache = this._cache;
    this._isClearingCache = true;

    for (const key in cache) {
      if (cache.hasOwnProperty(key)) {
        cache[key].destroy();
      }
    }

    this._cache = {};
    this._isClearingCache = false;
  }

  removeFromCache(shader) {
    if (this._isClearingCache) return;
    const cache = this._cache;

    for (const key in cache) {
      if (cache.hasOwnProperty(key)) {
        if (cache[key] === shader) {
          delete cache[key];
          break;
        }
      }
    }
  }

  _getDefaultStdMatOptions(pass) {
    return pass === SHADER_DEPTH || pass === SHADER_PICK || ShaderPass.isShadow(pass) ? this._defaultStdMatOptionMin : this._defaultStdMatOption;
  }

  precompile(cache) {
    if (cache) {
      const shaders = new Array(cache.length);

      for (let i = 0; i < cache.length; i++) {
        if (cache[i].name === "standard") {
          const opt = cache[i].options;

          const defaultMat = this._getDefaultStdMatOptions(opt.pass);

          for (const p in defaultMat) {
            if (defaultMat.hasOwnProperty(p) && opt[p] === undefined) opt[p] = defaultMat[p];
          }
        }

        shaders[i] = this.getProgram(cache[i].name, cache[i].options);
      }
    }

    this._precached = true;
  }

}

function getProgramLibrary(device) {
  return programLibraryDeviceCache.get(device, () => {
    return new ProgramLibrary(device);
  });
}

export { ProgramLibrary, getProgramLibrary };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZ3JhbS1saWJyYXJ5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZ3JhcGhpY3MvcHJvZ3JhbS1saWJyYXJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyB2ZXJzaW9uLCByZXZpc2lvbiB9IGZyb20gJy4uL2NvcmUvY29yZS5qcyc7XG5cbmltcG9ydCB7IFNoYWRlciB9IGZyb20gJy4vc2hhZGVyLmpzJztcblxuaW1wb3J0IHsgU0hBREVSX0ZPUldBUkQsIFNIQURFUl9ERVBUSCwgU0hBREVSX1BJQ0ssIFNIQURFUl9TSEFET1cgfSBmcm9tICcuLi9zY2VuZS9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgU3RhbmRhcmRNYXRlcmlhbCB9IGZyb20gJy4uL3NjZW5lL21hdGVyaWFscy9zdGFuZGFyZC1tYXRlcmlhbC5qcyc7XG5pbXBvcnQgeyBTaGFkZXJQYXNzIH0gZnJvbSAnLi4vc2NlbmUvc2hhZGVyLXBhc3MuanMnO1xuaW1wb3J0IHsgRGV2aWNlQ2FjaGUgfSBmcm9tICcuL2RldmljZS1jYWNoZS5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBHcmFwaGljc0RldmljZSAqL1xuXG4vLyBEZXZpY2UgY2FjaGUgc3RvcmluZyBhIHByb2dyYW0gbGlicmFyeVxuY29uc3QgcHJvZ3JhbUxpYnJhcnlEZXZpY2VDYWNoZSA9IG5ldyBEZXZpY2VDYWNoZSgpO1xuXG4vKipcbiAqIEEgY2xhc3MgcmVzcG9uc2libGUgZm9yIGNyZWF0aW9uIGFuZCBjYWNoaW5nIG9mIHJlcXVpcmVkIHNoYWRlcnMuXG4gKiBUaGVyZSBpcyBhIHR3byBsZXZlbCBjYWNoZS4gVGhlIGZpcnN0IGxldmVsIGdlbmVyYXRlcyB0aGUgc2hhZGVyIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBvcHRpb25zLlxuICogVGhlIHNlY29uZCBsZXZlbCBwcm9jZXNzZXMgdGhpcyBnZW5lcmF0ZWQgc2hhZGVyIHVzaW5nIHByb2Nlc3Npbmcgb3B0aW9ucyAtIGluIG1vc3QgY2FzZXNcbiAqIG1vZGlmaWVzIGl0IHRvIHN1cHBvcnQgdW5pZm9ybSBidWZmZXJzLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgUHJvZ3JhbUxpYnJhcnkge1xuICAgIC8qKlxuICAgICAqIEEgY2FjaGUgb2Ygc2hhZGVycyBwcm9jZXNzZWQgdXNpbmcgcHJvY2Vzc2luZyBvcHRpb25zLlxuICAgICAqXG4gICAgICogQHR5cGUge01hcDxzdHJpbmcsIFNoYWRlcj59XG4gICAgICovXG4gICAgcHJvY2Vzc2VkQ2FjaGUgPSBuZXcgTWFwKCk7XG5cbiAgICBjb25zdHJ1Y3RvcihkZXZpY2UpIHtcbiAgICAgICAgdGhpcy5fZGV2aWNlID0gZGV2aWNlO1xuICAgICAgICB0aGlzLl9jYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLl9nZW5lcmF0b3JzID0ge307XG4gICAgICAgIHRoaXMuX2lzQ2xlYXJpbmdDYWNoZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9wcmVjYWNoZWQgPSBmYWxzZTtcblxuICAgICAgICAvLyBVbmlxdWUgbm9uLWNhY2hlZCBwcm9ncmFtcyBjb2xsZWN0aW9uIHRvIGR1bXAgYW5kIHVwZGF0ZSBnYW1lIHNoYWRlcnMgY2FjaGVcbiAgICAgICAgdGhpcy5fcHJvZ3JhbXNDb2xsZWN0aW9uID0gW107XG4gICAgICAgIHRoaXMuX2RlZmF1bHRTdGRNYXRPcHRpb24gPSB7fTtcbiAgICAgICAgdGhpcy5fZGVmYXVsdFN0ZE1hdE9wdGlvbk1pbiA9IHt9O1xuXG4gICAgICAgIGNvbnN0IG0gPSBuZXcgU3RhbmRhcmRNYXRlcmlhbCgpO1xuICAgICAgICBtLnNoYWRlck9wdEJ1aWxkZXIudXBkYXRlUmVmKFxuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdFN0ZE1hdE9wdGlvbiwge30sIG0sIG51bGwsIFtdLCBTSEFERVJfRk9SV0FSRCwgbnVsbCk7XG4gICAgICAgIG0uc2hhZGVyT3B0QnVpbGRlci51cGRhdGVNaW5SZWYoXG4gICAgICAgICAgICB0aGlzLl9kZWZhdWx0U3RkTWF0T3B0aW9uTWluLCB7fSwgbSwgbnVsbCwgW10sIFNIQURFUl9TSEFET1csIG51bGwpO1xuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuICAgIH1cblxuICAgIHJlZ2lzdGVyKG5hbWUsIGdlbmVyYXRvcikge1xuICAgICAgICBpZiAoIXRoaXMuaXNSZWdpc3RlcmVkKG5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLl9nZW5lcmF0b3JzW25hbWVdID0gZ2VuZXJhdG9yO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdW5yZWdpc3RlcihuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUmVnaXN0ZXJlZChuYW1lKSkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2dlbmVyYXRvcnNbbmFtZV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc1JlZ2lzdGVyZWQobmFtZSkge1xuICAgICAgICBjb25zdCBnZW5lcmF0b3IgPSB0aGlzLl9nZW5lcmF0b3JzW25hbWVdO1xuICAgICAgICByZXR1cm4gKGdlbmVyYXRvciAhPT0gdW5kZWZpbmVkKTtcbiAgICB9XG5cbiAgICBnZW5lcmF0ZVNoYWRlcihnZW5lcmF0b3IsIG5hbWUsIGtleSwgb3B0aW9ucykge1xuICAgICAgICBsZXQgc2hhZGVyID0gdGhpcy5fY2FjaGVba2V5XTtcbiAgICAgICAgaWYgKCFzaGFkZXIpIHtcbiAgICAgICAgICAgIGxldCBsaWdodHM7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5saWdodHMpIHtcbiAgICAgICAgICAgICAgICBsaWdodHMgPSBvcHRpb25zLmxpZ2h0cztcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxpZ2h0cyA9IGxpZ2h0cy5tYXAoZnVuY3Rpb24gKGwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogcmVmYWN0b3IgdGhpcyB0byBhdm9pZCBjcmVhdGluZyBhIGNsb25lIG9mIHRoZSBsaWdodC5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGNvcHkgPSBsLmNsb25lID8gbC5jbG9uZSgpIDogbDtcbiAgICAgICAgICAgICAgICAgICAgbGNvcHkua2V5ID0gbC5rZXk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsY29weTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zdG9yZU5ld1Byb2dyYW0obmFtZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmxpZ2h0cylcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxpZ2h0cyA9IGxpZ2h0cztcblxuICAgICAgICAgICAgaWYgKHRoaXMuX3ByZWNhY2hlZClcbiAgICAgICAgICAgICAgICBEZWJ1Zy5sb2coYFByb2dyYW1MaWJyYXJ5I2dldFByb2dyYW06IENhY2hlIG1pc3MgZm9yIHNoYWRlciAke25hbWV9IGtleSAke2tleX0gYWZ0ZXIgc2hhZGVycyBwcmVjYWNoaW5nYCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXMuX2RldmljZTtcbiAgICAgICAgICAgIGNvbnN0IHNoYWRlckRlZmluaXRpb24gPSBnZW5lcmF0b3IuY3JlYXRlU2hhZGVyRGVmaW5pdGlvbihkZXZpY2UsIG9wdGlvbnMpO1xuICAgICAgICAgICAgc2hhZGVyRGVmaW5pdGlvbi5uYW1lID0gYCR7bmFtZX0tcGFzczoke29wdGlvbnMucGFzc31gO1xuICAgICAgICAgICAgc2hhZGVyID0gdGhpcy5fY2FjaGVba2V5XSA9IG5ldyBTaGFkZXIoZGV2aWNlLCBzaGFkZXJEZWZpbml0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2hhZGVyO1xuICAgIH1cblxuICAgIGdldFByb2dyYW0obmFtZSwgb3B0aW9ucywgcHJvY2Vzc2luZ09wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgZ2VuZXJhdG9yID0gdGhpcy5fZ2VuZXJhdG9yc1tuYW1lXTtcbiAgICAgICAgaWYgKCFnZW5lcmF0b3IpIHtcbiAgICAgICAgICAgIERlYnVnLndhcm4oYFByb2dyYW1MaWJyYXJ5I2dldFByb2dyYW06IE5vIHByb2dyYW0gbGlicmFyeSBmdW5jdGlvbnMgcmVnaXN0ZXJlZCBmb3I6ICR7bmFtZX1gKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gd2UgaGF2ZSBhIGtleSBmb3Igc2hhZGVyIHNvdXJjZSBjb2RlIGdlbmVyYXRpb24sIGEga2V5IGZvciBpdHMgZnVydGhlciBwcm9jZXNzaW5nIHRvIHdvcmsgd2l0aFxuICAgICAgICAvLyB1bmlmb3JtIGJ1ZmZlcnMsIGFuZCBhIGZpbmFsIGtleSB0byBnZXQgdGhlIHByb2Nlc3NlZCBzaGFkZXIgZnJvbSB0aGUgY2FjaGVcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbktleSA9IGdlbmVyYXRvci5nZW5lcmF0ZUtleShvcHRpb25zKTtcbiAgICAgICAgY29uc3QgcHJvY2Vzc2luZ0tleSA9IEpTT04uc3RyaW5naWZ5KHByb2Nlc3NpbmdPcHRpb25zKTtcbiAgICAgICAgY29uc3QgdG90YWxLZXkgPSBgJHtnZW5lcmF0aW9uS2V5fSMke3Byb2Nlc3NpbmdLZXl9YDtcblxuICAgICAgICAvLyBkbyB3ZSBoYXZlIGZpbmFsIHByb2Nlc3NlZCBzaGFkZXJcbiAgICAgICAgbGV0IHByb2Nlc3NlZFNoYWRlciA9IHRoaXMucHJvY2Vzc2VkQ2FjaGUuZ2V0KHRvdGFsS2V5KTtcbiAgICAgICAgaWYgKCFwcm9jZXNzZWRTaGFkZXIpIHtcblxuICAgICAgICAgICAgLy8gZ2V0IGdlbmVyYXRlZCBzaGFkZXJcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRlZFNoYWRlciA9IHRoaXMuZ2VuZXJhdGVTaGFkZXIoZ2VuZXJhdG9yLCBuYW1lLCBnZW5lcmF0aW9uS2V5LCBvcHRpb25zKTtcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChnZW5lcmF0ZWRTaGFkZXIpO1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgYSBzaGFkZXIgZGVmaW5pdGlvbiBmb3IgdGhlIHNoYWRlciB0aGF0IHdpbGwgaW5jbHVkZSB0aGUgcHJvY2Vzc2luZ09wdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRlZFNoYWRlckRlZiA9IGdlbmVyYXRlZFNoYWRlci5kZWZpbml0aW9uO1xuICAgICAgICAgICAgY29uc3Qgc2hhZGVyRGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiBnZW5lcmF0ZWRTaGFkZXJEZWYuYXR0cmlidXRlcyxcbiAgICAgICAgICAgICAgICB2c2hhZGVyOiBnZW5lcmF0ZWRTaGFkZXJEZWYudnNoYWRlcixcbiAgICAgICAgICAgICAgICBmc2hhZGVyOiBnZW5lcmF0ZWRTaGFkZXJEZWYuZnNoYWRlcixcbiAgICAgICAgICAgICAgICBwcm9jZXNzaW5nT3B0aW9uczogcHJvY2Vzc2luZ09wdGlvbnNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGFkZCBuZXcgc2hhZGVyIHRvIHRoZSBwcm9jZXNzZWQgY2FjaGVcbiAgICAgICAgICAgIHByb2Nlc3NlZFNoYWRlciA9IG5ldyBTaGFkZXIodGhpcy5fZGV2aWNlLCBzaGFkZXJEZWZpbml0aW9uKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc2VkQ2FjaGUuc2V0KHRvdGFsS2V5LCBwcm9jZXNzZWRTaGFkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZFNoYWRlcjtcbiAgICB9XG5cbiAgICBzdG9yZU5ld1Byb2dyYW0obmFtZSwgb3B0aW9ucykge1xuICAgICAgICBsZXQgb3B0ID0ge307XG4gICAgICAgIGlmIChuYW1lID09PSBcInN0YW5kYXJkXCIpIHtcbiAgICAgICAgICAgIC8vIEZvciBzdGFuZGFyZCBtYXRlcmlhbCBzYXZpbmcgYWxsIGRlZmF1bHQgdmFsdWVzIGlzIG92ZXJraWxsLCBzbyB3ZSBzdG9yZSBvbmx5IGRpZmZcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRNYXQgPSB0aGlzLl9nZXREZWZhdWx0U3RkTWF0T3B0aW9ucyhvcHRpb25zLnBhc3MpO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHAgaW4gb3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmICgob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShwKSAmJiBkZWZhdWx0TWF0W3BdICE9PSBvcHRpb25zW3BdKSB8fCBwID09PSBcInBhc3NcIilcbiAgICAgICAgICAgICAgICAgICAgb3B0W3BdID0gb3B0aW9uc1twXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE90aGVyIHNoYWRlcnMgaGF2ZSBvbmx5IGRvemVuIHBhcmFtc1xuICAgICAgICAgICAgb3B0ID0gb3B0aW9ucztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3Byb2dyYW1zQ29sbGVjdGlvbi5wdXNoKEpTT04uc3RyaW5naWZ5KHsgbmFtZTogbmFtZSwgb3B0aW9uczogb3B0IH0pKTtcbiAgICB9XG5cbiAgICAvLyBydW4gcGMuYXBwLmdyYXBoaWNzRGV2aWNlLmdldFByb2dyYW1MaWJyYXJ5KCkuZHVtcFByb2dyYW1zKCk7IGZyb20gYnJvd3NlciBjb25zb2xlIHRvIGJ1aWxkIHNoYWRlciBvcHRpb25zIHNjcmlwdFxuICAgIGR1bXBQcm9ncmFtcygpIHtcbiAgICAgICAgbGV0IHRleHQgPSAnbGV0IGRldmljZSA9IHBjLmFwcCA/IHBjLmFwcC5ncmFwaGljc0RldmljZSA6IHBjLkFwcGxpY2F0aW9uLmdldEFwcGxpY2F0aW9uKCkuZ3JhcGhpY3NEZXZpY2U7XFxuJztcbiAgICAgICAgdGV4dCArPSAnbGV0IHNoYWRlcnMgPSBbJztcbiAgICAgICAgaWYgKHRoaXMuX3Byb2dyYW1zQ29sbGVjdGlvblswXSlcbiAgICAgICAgICAgIHRleHQgKz0gJ1xcblxcdCcgKyB0aGlzLl9wcm9ncmFtc0NvbGxlY3Rpb25bMF07XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5fcHJvZ3JhbXNDb2xsZWN0aW9uLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0ZXh0ICs9ICcsXFxuXFx0JyArIHRoaXMuX3Byb2dyYW1zQ29sbGVjdGlvbltpXTtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9ICdcXG5dO1xcbic7XG4gICAgICAgIHRleHQgKz0gJ2RldmljZS5nZXRQcm9ncmFtTGlicmFyeSgpLnByZWNvbXBpbGUoc2hhZGVycyk7XFxuJztcbiAgICAgICAgdGV4dCArPSAnaWYgKHBjLnZlcnNpb24gIT0gXFxcIicgKyB2ZXJzaW9uICsgJ1xcXCIgfHwgcGMucmV2aXNpb24gIT0gXFxcIicgKyByZXZpc2lvbiArICdcXFwiKVxcbic7XG4gICAgICAgIHRleHQgKz0gJ1xcdGNvbnNvbGUud2FybihcXFwicHJlY29tcGlsZS1zaGFkZXJzLmpzOiBlbmdpbmUgdmVyc2lvbiBtaXNtYXRjaCwgcmVidWlsZCBzaGFkZXJzIGxpYiB3aXRoIGN1cnJlbnQgZW5naW5lXFxcIik7JztcblxuICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsICdkYXRhOnRleHQvcGxhaW47Y2hhcnNldD11dGYtOCwnICsgZW5jb2RlVVJJQ29tcG9uZW50KHRleHQpKTtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgJ3ByZWNvbXBpbGUtc2hhZGVycy5qcycpO1xuICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgIGVsZW1lbnQuY2xpY2soKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtZW50KTtcbiAgICB9XG5cbiAgICBjbGVhckNhY2hlKCkge1xuICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuX2NhY2hlO1xuICAgICAgICB0aGlzLl9pc0NsZWFyaW5nQ2FjaGUgPSB0cnVlO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBjYWNoZSkge1xuICAgICAgICAgICAgaWYgKGNhY2hlLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICBjYWNoZVtrZXldLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLl9pc0NsZWFyaW5nQ2FjaGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZW1vdmVGcm9tQ2FjaGUoc2hhZGVyKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc0NsZWFyaW5nQ2FjaGUpIHJldHVybjsgLy8gZG9uJ3QgZGVsZXRlIGJ5IG9uZSB3aGVuIGNsZWFyaW5nIHdob2xlIGNhY2hlXG4gICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fY2FjaGU7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGNhY2hlKSB7XG4gICAgICAgICAgICBpZiAoY2FjaGUuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGlmIChjYWNoZVtrZXldID09PSBzaGFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNhY2hlW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9nZXREZWZhdWx0U3RkTWF0T3B0aW9ucyhwYXNzKSB7XG4gICAgICAgIHJldHVybiAocGFzcyA9PT0gU0hBREVSX0RFUFRIIHx8IHBhc3MgPT09IFNIQURFUl9QSUNLIHx8IFNoYWRlclBhc3MuaXNTaGFkb3cocGFzcykpID9cbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRTdGRNYXRPcHRpb25NaW4gOiB0aGlzLl9kZWZhdWx0U3RkTWF0T3B0aW9uO1xuICAgIH1cblxuICAgIHByZWNvbXBpbGUoY2FjaGUpIHtcbiAgICAgICAgaWYgKGNhY2hlKSB7XG4gICAgICAgICAgICBjb25zdCBzaGFkZXJzID0gbmV3IEFycmF5KGNhY2hlLmxlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhY2hlLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IG9wdGlvbnMgZm9yIHRoZSBzdGFuZGFyZCBtYXRlcmlhbHMgYXJlIG5vdCBzdG9yZWQsIGFuZCBzbyB0aGV5IGFyZSBpbnNlcnRlZFxuICAgICAgICAgICAgICAgIC8vIGJhY2sgaW50byB0aGUgbG9hZGVkIG9wdGlvbnNcbiAgICAgICAgICAgICAgICBpZiAoY2FjaGVbaV0ubmFtZSA9PT0gXCJzdGFuZGFyZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdCA9IGNhY2hlW2ldLm9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRNYXQgPSB0aGlzLl9nZXREZWZhdWx0U3RkTWF0T3B0aW9ucyhvcHQucGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcCBpbiBkZWZhdWx0TWF0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdE1hdC5oYXNPd25Qcm9wZXJ0eShwKSAmJiBvcHRbcF0gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRbcF0gPSBkZWZhdWx0TWF0W3BdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2hhZGVyc1tpXSA9IHRoaXMuZ2V0UHJvZ3JhbShjYWNoZVtpXS5uYW1lLCBjYWNoZVtpXS5vcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9wcmVjYWNoZWQgPSB0cnVlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHByb2dyYW0gbGlicmFyeSBmb3IgYSBzcGVjaWZpZWQgaW5zdGFuY2Ugb2YgYSBkZXZpY2UuXG4gKlxuICogQHBhcmFtIHtHcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlIGdyYXBoaWNzIGRldmljZSB1c2VkIHRvIG93biB0aGUgbWF0ZXJpYWwuXG4gKiBAcmV0dXJucyB7UHJvZ3JhbUxpYnJhcnl9IFRoZSBpbnN0YW5jZSBvZiB7QGxpbmsgUHJvZ3JhbUxpYnJhcnl9XG4gKiBAaWdub3JlXG4gKi9cbmZ1bmN0aW9uIGdldFByb2dyYW1MaWJyYXJ5KGRldmljZSkge1xuICAgIHJldHVybiBwcm9ncmFtTGlicmFyeURldmljZUNhY2hlLmdldChkZXZpY2UsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9ncmFtTGlicmFyeShkZXZpY2UpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgeyBQcm9ncmFtTGlicmFyeSwgZ2V0UHJvZ3JhbUxpYnJhcnkgfTtcbiJdLCJuYW1lcyI6WyJwcm9ncmFtTGlicmFyeURldmljZUNhY2hlIiwiRGV2aWNlQ2FjaGUiLCJQcm9ncmFtTGlicmFyeSIsImNvbnN0cnVjdG9yIiwiZGV2aWNlIiwicHJvY2Vzc2VkQ2FjaGUiLCJNYXAiLCJfZGV2aWNlIiwiX2NhY2hlIiwiX2dlbmVyYXRvcnMiLCJfaXNDbGVhcmluZ0NhY2hlIiwiX3ByZWNhY2hlZCIsIl9wcm9ncmFtc0NvbGxlY3Rpb24iLCJfZGVmYXVsdFN0ZE1hdE9wdGlvbiIsIl9kZWZhdWx0U3RkTWF0T3B0aW9uTWluIiwibSIsIlN0YW5kYXJkTWF0ZXJpYWwiLCJzaGFkZXJPcHRCdWlsZGVyIiwidXBkYXRlUmVmIiwiU0hBREVSX0ZPUldBUkQiLCJ1cGRhdGVNaW5SZWYiLCJTSEFERVJfU0hBRE9XIiwiZGVzdHJveSIsImNsZWFyQ2FjaGUiLCJyZWdpc3RlciIsIm5hbWUiLCJnZW5lcmF0b3IiLCJpc1JlZ2lzdGVyZWQiLCJ1bnJlZ2lzdGVyIiwidW5kZWZpbmVkIiwiZ2VuZXJhdGVTaGFkZXIiLCJrZXkiLCJvcHRpb25zIiwic2hhZGVyIiwibGlnaHRzIiwibWFwIiwibCIsImxjb3B5IiwiY2xvbmUiLCJzdG9yZU5ld1Byb2dyYW0iLCJEZWJ1ZyIsImxvZyIsInNoYWRlckRlZmluaXRpb24iLCJjcmVhdGVTaGFkZXJEZWZpbml0aW9uIiwicGFzcyIsIlNoYWRlciIsImdldFByb2dyYW0iLCJwcm9jZXNzaW5nT3B0aW9ucyIsIndhcm4iLCJnZW5lcmF0aW9uS2V5IiwiZ2VuZXJhdGVLZXkiLCJwcm9jZXNzaW5nS2V5IiwiSlNPTiIsInN0cmluZ2lmeSIsInRvdGFsS2V5IiwicHJvY2Vzc2VkU2hhZGVyIiwiZ2V0IiwiZ2VuZXJhdGVkU2hhZGVyIiwiYXNzZXJ0IiwiZ2VuZXJhdGVkU2hhZGVyRGVmIiwiZGVmaW5pdGlvbiIsImF0dHJpYnV0ZXMiLCJ2c2hhZGVyIiwiZnNoYWRlciIsInNldCIsIm9wdCIsImRlZmF1bHRNYXQiLCJfZ2V0RGVmYXVsdFN0ZE1hdE9wdGlvbnMiLCJwIiwiaGFzT3duUHJvcGVydHkiLCJwdXNoIiwiZHVtcFByb2dyYW1zIiwidGV4dCIsImkiLCJsZW5ndGgiLCJ2ZXJzaW9uIiwicmV2aXNpb24iLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwic3R5bGUiLCJkaXNwbGF5IiwiYm9keSIsImFwcGVuZENoaWxkIiwiY2xpY2siLCJyZW1vdmVDaGlsZCIsImNhY2hlIiwicmVtb3ZlRnJvbUNhY2hlIiwiU0hBREVSX0RFUFRIIiwiU0hBREVSX1BJQ0siLCJTaGFkZXJQYXNzIiwiaXNTaGFkb3ciLCJwcmVjb21waWxlIiwic2hhZGVycyIsIkFycmF5IiwiZ2V0UHJvZ3JhbUxpYnJhcnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFhQSxNQUFNQSx5QkFBeUIsR0FBRyxJQUFJQyxXQUFKLEVBQWxDLENBQUE7O0FBVUEsTUFBTUMsY0FBTixDQUFx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
