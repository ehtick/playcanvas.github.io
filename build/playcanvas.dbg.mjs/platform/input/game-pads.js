/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
const MAPS = {
  DEFAULT: {
    buttons: [
    // Face buttons
    'PAD_FACE_1', 'PAD_FACE_2', 'PAD_FACE_3', 'PAD_FACE_4',
    // Shoulder buttons
    'PAD_L_SHOULDER_1', 'PAD_R_SHOULDER_1', 'PAD_L_SHOULDER_2', 'PAD_R_SHOULDER_2',
    // Other buttons
    'PAD_SELECT', 'PAD_START', 'PAD_L_STICK_BUTTON', 'PAD_R_STICK_BUTTON',
    // D Pad
    'PAD_UP', 'PAD_DOWN', 'PAD_LEFT', 'PAD_RIGHT',
    // Vendor specific button
    'PAD_VENDOR'],
    axes: [
    // Analogue Sticks
    'PAD_L_STICK_X', 'PAD_L_STICK_Y', 'PAD_R_STICK_X', 'PAD_R_STICK_Y']
  },
  PS3: {
    buttons: [
    // X, O, TRI, SQ
    'PAD_FACE_1', 'PAD_FACE_2', 'PAD_FACE_4', 'PAD_FACE_3',
    // Shoulder buttons
    'PAD_L_SHOULDER_1', 'PAD_R_SHOULDER_1', 'PAD_L_SHOULDER_2', 'PAD_R_SHOULDER_2',
    // Other buttons
    'PAD_SELECT', 'PAD_START', 'PAD_L_STICK_BUTTON', 'PAD_R_STICK_BUTTON',
    // D Pad
    'PAD_UP', 'PAD_DOWN', 'PAD_LEFT', 'PAD_RIGHT', 'PAD_VENDOR'],
    axes: [
    // Analogue Sticks
    'PAD_L_STICK_X', 'PAD_L_STICK_Y', 'PAD_R_STICK_X', 'PAD_R_STICK_Y']
  }
};
const PRODUCT_CODES = {
  'Product: 0268': 'PS3'
};

/**
 * Input handler for accessing GamePad input.
 */
class GamePads {
  /**
   * Create a new GamePads instance.
   */
  constructor() {
    this.gamepadsSupported = !!navigator.getGamepads || !!navigator.webkitGetGamepads;
    this.current = [];
    this.previous = [];
    this.deadZone = 0.25;
  }

  /**
   * Update the current and previous state of the gamepads. This must be called every frame for
   * `wasPressed` to work.
   */
  update() {
    // move current buttons status into previous array
    for (let i = 0, l = this.current.length; i < l; i++) {
      const buttons = this.current[i].pad.buttons;
      const buttonsLen = buttons.length;
      for (let j = 0; j < buttonsLen; j++) {
        if (this.previous[i] === undefined) {
          this.previous[i] = [];
        }
        this.previous[i][j] = buttons[j].pressed;
      }
    }

    // update current
    this.poll(this.current);
  }

  /**
   * Poll for the latest data from the gamepad API.
   *
   * @param {object[]} [pads] - An optional array used to receive the gamepads mapping. This
   * array will be returned by this function.
   * @returns {object[]} An array of gamepads and mappings for the model of gamepad that is
   * attached.
   * @example
   * var gamepads = new pc.GamePads();
   * var pads = gamepads.poll();
   */
  poll(pads = []) {
    if (pads.length > 0) {
      pads.length = 0;
    }
    if (this.gamepadsSupported) {
      const padDevices = navigator.getGamepads ? navigator.getGamepads() : navigator.webkitGetGamepads();
      for (let i = 0, len = padDevices.length; i < len; i++) {
        if (padDevices[i]) {
          pads.push({
            map: this.getMap(padDevices[i]),
            pad: padDevices[i]
          });
        }
      }
    }
    return pads;
  }
  getMap(pad) {
    for (const code in PRODUCT_CODES) {
      if (pad.id.indexOf(code) >= 0) {
        return MAPS[PRODUCT_CODES[code]];
      }
    }
    return MAPS.DEFAULT;
  }

  /**
   * Returns true if the button on the pad requested is pressed.
   *
   * @param {number} index - The index of the pad to check, use constants {@link PAD_1},
   * {@link PAD_2}, etc.
   * @param {number} button - The button to test, use constants {@link PAD_FACE_1}, etc.
   * @returns {boolean} True if the button is pressed.
   */
  isPressed(index, button) {
    if (!this.current[index]) {
      return false;
    }
    const key = this.current[index].map.buttons[button];
    return this.current[index].pad.buttons[pc[key]].pressed;
  }

  /**
   * Returns true if the button was pressed since the last frame.
   *
   * @param {number} index - The index of the pad to check, use constants {@link PAD_1},
   * {@link PAD_2}, etc.
   * @param {number} button - The button to test, use constants {@link PAD_FACE_1}, etc.
   * @returns {boolean} True if the button was pressed since the last frame.
   */
  wasPressed(index, button) {
    if (!this.current[index]) {
      return false;
    }
    const key = this.current[index].map.buttons[button];
    const i = pc[key];

    // Previous pad buttons may not have been populated yet
    // If this is the first time frame a pad has been detected
    return this.current[index].pad.buttons[i].pressed && !(this.previous[index] && this.previous[index][i]);
  }

  /**
   * Returns true if the button was released since the last frame.
   *
   * @param {number} index - The index of the pad to check, use constants {@link PAD_1},
   * {@link PAD_2}, etc.
   * @param {number} button - The button to test, use constants {@link PAD_FACE_1}, etc.
   * @returns {boolean} True if the button was released since the last frame.
   */
  wasReleased(index, button) {
    if (!this.current[index]) {
      return false;
    }
    const key = this.current[index].map.buttons[button];
    const i = pc[key];

    // Previous pad buttons may not have been populated yet
    // If this is the first time frame a pad has been detected
    return !this.current[index].pad.buttons[i].pressed && this.previous[index] && this.previous[index][i];
  }

  /**
   * Get the value of one of the analogue axes of the pad.
   *
   * @param {number} index - The index of the pad to check, use constants {@link PAD_1},
   * {@link PAD_2}, etc.
   * @param {number} axes - The axes to get the value of, use constants {@link PAD_L_STICK_X},
   * etc.
   * @returns {number} The value of the axis between -1 and 1.
   */
  getAxis(index, axes) {
    if (!this.current[index]) {
      return 0;
    }
    const key = this.current[index].map.axes[axes];
    let value = this.current[index].pad.axes[pc[key]];
    if (Math.abs(value) < this.deadZone) {
      value = 0;
    }
    return value;
  }
}

export { GamePads };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS1wYWRzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vaW5wdXQvZ2FtZS1wYWRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IE1BUFMgPSB7XG4gICAgREVGQVVMVDoge1xuICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAvLyBGYWNlIGJ1dHRvbnNcbiAgICAgICAgICAgICdQQURfRkFDRV8xJyxcbiAgICAgICAgICAgICdQQURfRkFDRV8yJyxcbiAgICAgICAgICAgICdQQURfRkFDRV8zJyxcbiAgICAgICAgICAgICdQQURfRkFDRV80JyxcblxuICAgICAgICAgICAgLy8gU2hvdWxkZXIgYnV0dG9uc1xuICAgICAgICAgICAgJ1BBRF9MX1NIT1VMREVSXzEnLFxuICAgICAgICAgICAgJ1BBRF9SX1NIT1VMREVSXzEnLFxuICAgICAgICAgICAgJ1BBRF9MX1NIT1VMREVSXzInLFxuICAgICAgICAgICAgJ1BBRF9SX1NIT1VMREVSXzInLFxuXG4gICAgICAgICAgICAvLyBPdGhlciBidXR0b25zXG4gICAgICAgICAgICAnUEFEX1NFTEVDVCcsXG4gICAgICAgICAgICAnUEFEX1NUQVJUJyxcbiAgICAgICAgICAgICdQQURfTF9TVElDS19CVVRUT04nLFxuICAgICAgICAgICAgJ1BBRF9SX1NUSUNLX0JVVFRPTicsXG5cbiAgICAgICAgICAgIC8vIEQgUGFkXG4gICAgICAgICAgICAnUEFEX1VQJyxcbiAgICAgICAgICAgICdQQURfRE9XTicsXG4gICAgICAgICAgICAnUEFEX0xFRlQnLFxuICAgICAgICAgICAgJ1BBRF9SSUdIVCcsXG5cbiAgICAgICAgICAgICAvLyBWZW5kb3Igc3BlY2lmaWMgYnV0dG9uXG4gICAgICAgICAgICAnUEFEX1ZFTkRPUidcbiAgICAgICAgXSxcblxuICAgICAgICBheGVzOiBbXG4gICAgICAgICAgICAvLyBBbmFsb2d1ZSBTdGlja3NcbiAgICAgICAgICAgICdQQURfTF9TVElDS19YJyxcbiAgICAgICAgICAgICdQQURfTF9TVElDS19ZJyxcbiAgICAgICAgICAgICdQQURfUl9TVElDS19YJyxcbiAgICAgICAgICAgICdQQURfUl9TVElDS19ZJ1xuICAgICAgICBdXG4gICAgfSxcblxuICAgIFBTMzoge1xuICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAvLyBYLCBPLCBUUkksIFNRXG4gICAgICAgICAgICAnUEFEX0ZBQ0VfMScsXG4gICAgICAgICAgICAnUEFEX0ZBQ0VfMicsXG4gICAgICAgICAgICAnUEFEX0ZBQ0VfNCcsXG4gICAgICAgICAgICAnUEFEX0ZBQ0VfMycsXG5cbiAgICAgICAgICAgIC8vIFNob3VsZGVyIGJ1dHRvbnNcbiAgICAgICAgICAgICdQQURfTF9TSE9VTERFUl8xJyxcbiAgICAgICAgICAgICdQQURfUl9TSE9VTERFUl8xJyxcbiAgICAgICAgICAgICdQQURfTF9TSE9VTERFUl8yJyxcbiAgICAgICAgICAgICdQQURfUl9TSE9VTERFUl8yJyxcblxuICAgICAgICAgICAgLy8gT3RoZXIgYnV0dG9uc1xuICAgICAgICAgICAgJ1BBRF9TRUxFQ1QnLFxuICAgICAgICAgICAgJ1BBRF9TVEFSVCcsXG4gICAgICAgICAgICAnUEFEX0xfU1RJQ0tfQlVUVE9OJyxcbiAgICAgICAgICAgICdQQURfUl9TVElDS19CVVRUT04nLFxuXG4gICAgICAgICAgICAvLyBEIFBhZFxuICAgICAgICAgICAgJ1BBRF9VUCcsXG4gICAgICAgICAgICAnUEFEX0RPV04nLFxuICAgICAgICAgICAgJ1BBRF9MRUZUJyxcbiAgICAgICAgICAgICdQQURfUklHSFQnLFxuXG4gICAgICAgICAgICAnUEFEX1ZFTkRPUidcbiAgICAgICAgXSxcblxuICAgICAgICBheGVzOiBbXG4gICAgICAgICAgICAvLyBBbmFsb2d1ZSBTdGlja3NcbiAgICAgICAgICAgICdQQURfTF9TVElDS19YJyxcbiAgICAgICAgICAgICdQQURfTF9TVElDS19ZJyxcbiAgICAgICAgICAgICdQQURfUl9TVElDS19YJyxcbiAgICAgICAgICAgICdQQURfUl9TVElDS19ZJ1xuICAgICAgICBdXG4gICAgfVxufTtcblxuY29uc3QgUFJPRFVDVF9DT0RFUyA9IHtcbiAgICAnUHJvZHVjdDogMDI2OCc6ICdQUzMnXG59O1xuXG4vKipcbiAqIElucHV0IGhhbmRsZXIgZm9yIGFjY2Vzc2luZyBHYW1lUGFkIGlucHV0LlxuICovXG5jbGFzcyBHYW1lUGFkcyB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEdhbWVQYWRzIGluc3RhbmNlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmdhbWVwYWRzU3VwcG9ydGVkID0gISFuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMgfHwgISFuYXZpZ2F0b3Iud2Via2l0R2V0R2FtZXBhZHM7XG5cbiAgICAgICAgdGhpcy5jdXJyZW50ID0gW107XG4gICAgICAgIHRoaXMucHJldmlvdXMgPSBbXTtcblxuICAgICAgICB0aGlzLmRlYWRab25lID0gMC4yNTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGN1cnJlbnQgYW5kIHByZXZpb3VzIHN0YXRlIG9mIHRoZSBnYW1lcGFkcy4gVGhpcyBtdXN0IGJlIGNhbGxlZCBldmVyeSBmcmFtZSBmb3JcbiAgICAgKiBgd2FzUHJlc3NlZGAgdG8gd29yay5cbiAgICAgKi9cbiAgICB1cGRhdGUoKSB7XG4gICAgICAgIC8vIG1vdmUgY3VycmVudCBidXR0b25zIHN0YXR1cyBpbnRvIHByZXZpb3VzIGFycmF5XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5jdXJyZW50Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgYnV0dG9ucyA9IHRoaXMuY3VycmVudFtpXS5wYWQuYnV0dG9ucztcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnNMZW4gPSBidXR0b25zLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYnV0dG9uc0xlbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldmlvdXNbaV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzW2ldID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucHJldmlvdXNbaV1bal0gPSBidXR0b25zW2pdLnByZXNzZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB1cGRhdGUgY3VycmVudFxuICAgICAgICB0aGlzLnBvbGwodGhpcy5jdXJyZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQb2xsIGZvciB0aGUgbGF0ZXN0IGRhdGEgZnJvbSB0aGUgZ2FtZXBhZCBBUEkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdFtdfSBbcGFkc10gLSBBbiBvcHRpb25hbCBhcnJheSB1c2VkIHRvIHJlY2VpdmUgdGhlIGdhbWVwYWRzIG1hcHBpbmcuIFRoaXNcbiAgICAgKiBhcnJheSB3aWxsIGJlIHJldHVybmVkIGJ5IHRoaXMgZnVuY3Rpb24uXG4gICAgICogQHJldHVybnMge29iamVjdFtdfSBBbiBhcnJheSBvZiBnYW1lcGFkcyBhbmQgbWFwcGluZ3MgZm9yIHRoZSBtb2RlbCBvZiBnYW1lcGFkIHRoYXQgaXNcbiAgICAgKiBhdHRhY2hlZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBnYW1lcGFkcyA9IG5ldyBwYy5HYW1lUGFkcygpO1xuICAgICAqIHZhciBwYWRzID0gZ2FtZXBhZHMucG9sbCgpO1xuICAgICAqL1xuICAgIHBvbGwocGFkcyA9IFtdKSB7XG4gICAgICAgIGlmIChwYWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHBhZHMubGVuZ3RoID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmdhbWVwYWRzU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBjb25zdCBwYWREZXZpY2VzID0gbmF2aWdhdG9yLmdldEdhbWVwYWRzID8gbmF2aWdhdG9yLmdldEdhbWVwYWRzKCkgOiBuYXZpZ2F0b3Iud2Via2l0R2V0R2FtZXBhZHMoKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYWREZXZpY2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhZERldmljZXNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcGFkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogdGhpcy5nZXRNYXAocGFkRGV2aWNlc1tpXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWQ6IHBhZERldmljZXNbaV1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYWRzO1xuICAgIH1cblxuICAgIGdldE1hcChwYWQpIHtcbiAgICAgICAgZm9yIChjb25zdCBjb2RlIGluIFBST0RVQ1RfQ09ERVMpIHtcbiAgICAgICAgICAgIGlmIChwYWQuaWQuaW5kZXhPZihjb2RlKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1BUFNbUFJPRFVDVF9DT0RFU1tjb2RlXV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gTUFQUy5ERUZBVUxUO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYnV0dG9uIG9uIHRoZSBwYWQgcmVxdWVzdGVkIGlzIHByZXNzZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggb2YgdGhlIHBhZCB0byBjaGVjaywgdXNlIGNvbnN0YW50cyB7QGxpbmsgUEFEXzF9LFxuICAgICAqIHtAbGluayBQQURfMn0sIGV0Yy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYnV0dG9uIC0gVGhlIGJ1dHRvbiB0byB0ZXN0LCB1c2UgY29uc3RhbnRzIHtAbGluayBQQURfRkFDRV8xfSwgZXRjLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSBidXR0b24gaXMgcHJlc3NlZC5cbiAgICAgKi9cbiAgICBpc1ByZXNzZWQoaW5kZXgsIGJ1dHRvbikge1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudFtpbmRleF0pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3VycmVudFtpbmRleF0ubWFwLmJ1dHRvbnNbYnV0dG9uXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFtpbmRleF0ucGFkLmJ1dHRvbnNbcGNba2V5XV0ucHJlc3NlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGJ1dHRvbiB3YXMgcHJlc3NlZCBzaW5jZSB0aGUgbGFzdCBmcmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgcGFkIHRvIGNoZWNrLCB1c2UgY29uc3RhbnRzIHtAbGluayBQQURfMX0sXG4gICAgICoge0BsaW5rIFBBRF8yfSwgZXRjLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBidXR0b24gLSBUaGUgYnV0dG9uIHRvIHRlc3QsIHVzZSBjb25zdGFudHMge0BsaW5rIFBBRF9GQUNFXzF9LCBldGMuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGJ1dHRvbiB3YXMgcHJlc3NlZCBzaW5jZSB0aGUgbGFzdCBmcmFtZS5cbiAgICAgKi9cbiAgICB3YXNQcmVzc2VkKGluZGV4LCBidXR0b24pIHtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRbaW5kZXhdKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBrZXkgPSB0aGlzLmN1cnJlbnRbaW5kZXhdLm1hcC5idXR0b25zW2J1dHRvbl07XG4gICAgICAgIGNvbnN0IGkgPSBwY1trZXldO1xuXG4gICAgICAgIC8vIFByZXZpb3VzIHBhZCBidXR0b25zIG1heSBub3QgaGF2ZSBiZWVuIHBvcHVsYXRlZCB5ZXRcbiAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgZmlyc3QgdGltZSBmcmFtZSBhIHBhZCBoYXMgYmVlbiBkZXRlY3RlZFxuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50W2luZGV4XS5wYWQuYnV0dG9uc1tpXS5wcmVzc2VkICYmICEodGhpcy5wcmV2aW91c1tpbmRleF0gJiYgdGhpcy5wcmV2aW91c1tpbmRleF1baV0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYnV0dG9uIHdhcyByZWxlYXNlZCBzaW5jZSB0aGUgbGFzdCBmcmFtZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgcGFkIHRvIGNoZWNrLCB1c2UgY29uc3RhbnRzIHtAbGluayBQQURfMX0sXG4gICAgICoge0BsaW5rIFBBRF8yfSwgZXRjLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBidXR0b24gLSBUaGUgYnV0dG9uIHRvIHRlc3QsIHVzZSBjb25zdGFudHMge0BsaW5rIFBBRF9GQUNFXzF9LCBldGMuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGJ1dHRvbiB3YXMgcmVsZWFzZWQgc2luY2UgdGhlIGxhc3QgZnJhbWUuXG4gICAgICovXG4gICAgd2FzUmVsZWFzZWQoaW5kZXgsIGJ1dHRvbikge1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudFtpbmRleF0pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3VycmVudFtpbmRleF0ubWFwLmJ1dHRvbnNbYnV0dG9uXTtcbiAgICAgICAgY29uc3QgaSA9IHBjW2tleV07XG5cbiAgICAgICAgLy8gUHJldmlvdXMgcGFkIGJ1dHRvbnMgbWF5IG5vdCBoYXZlIGJlZW4gcG9wdWxhdGVkIHlldFxuICAgICAgICAvLyBJZiB0aGlzIGlzIHRoZSBmaXJzdCB0aW1lIGZyYW1lIGEgcGFkIGhhcyBiZWVuIGRldGVjdGVkXG4gICAgICAgIHJldHVybiAhdGhpcy5jdXJyZW50W2luZGV4XS5wYWQuYnV0dG9uc1tpXS5wcmVzc2VkICYmICh0aGlzLnByZXZpb3VzW2luZGV4XSAmJiB0aGlzLnByZXZpb3VzW2luZGV4XVtpXSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB2YWx1ZSBvZiBvbmUgb2YgdGhlIGFuYWxvZ3VlIGF4ZXMgb2YgdGhlIHBhZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgcGFkIHRvIGNoZWNrLCB1c2UgY29uc3RhbnRzIHtAbGluayBQQURfMX0sXG4gICAgICoge0BsaW5rIFBBRF8yfSwgZXRjLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBheGVzIC0gVGhlIGF4ZXMgdG8gZ2V0IHRoZSB2YWx1ZSBvZiwgdXNlIGNvbnN0YW50cyB7QGxpbmsgUEFEX0xfU1RJQ0tfWH0sXG4gICAgICogZXRjLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB2YWx1ZSBvZiB0aGUgYXhpcyBiZXR3ZWVuIC0xIGFuZCAxLlxuICAgICAqL1xuICAgIGdldEF4aXMoaW5kZXgsIGF4ZXMpIHtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRbaW5kZXhdKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY3VycmVudFtpbmRleF0ubWFwLmF4ZXNbYXhlc107XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuY3VycmVudFtpbmRleF0ucGFkLmF4ZXNbcGNba2V5XV07XG5cbiAgICAgICAgaWYgKE1hdGguYWJzKHZhbHVlKSA8IHRoaXMuZGVhZFpvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxufVxuXG5leHBvcnQgeyBHYW1lUGFkcyB9O1xuIl0sIm5hbWVzIjpbIk1BUFMiLCJERUZBVUxUIiwiYnV0dG9ucyIsImF4ZXMiLCJQUzMiLCJQUk9EVUNUX0NPREVTIiwiR2FtZVBhZHMiLCJjb25zdHJ1Y3RvciIsImdhbWVwYWRzU3VwcG9ydGVkIiwibmF2aWdhdG9yIiwiZ2V0R2FtZXBhZHMiLCJ3ZWJraXRHZXRHYW1lcGFkcyIsImN1cnJlbnQiLCJwcmV2aW91cyIsImRlYWRab25lIiwidXBkYXRlIiwiaSIsImwiLCJsZW5ndGgiLCJwYWQiLCJidXR0b25zTGVuIiwiaiIsInVuZGVmaW5lZCIsInByZXNzZWQiLCJwb2xsIiwicGFkcyIsInBhZERldmljZXMiLCJsZW4iLCJwdXNoIiwibWFwIiwiZ2V0TWFwIiwiY29kZSIsImlkIiwiaW5kZXhPZiIsImlzUHJlc3NlZCIsImluZGV4IiwiYnV0dG9uIiwia2V5IiwicGMiLCJ3YXNQcmVzc2VkIiwid2FzUmVsZWFzZWQiLCJnZXRBeGlzIiwidmFsdWUiLCJNYXRoIiwiYWJzIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE1BQU1BLElBQUksR0FBRztBQUNUQyxFQUFBQSxPQUFPLEVBQUU7QUFDTEMsSUFBQUEsT0FBTyxFQUFFO0FBQ0w7QUFDQSxJQUFBLFlBQVksRUFDWixZQUFZLEVBQ1osWUFBWSxFQUNaLFlBQVk7QUFFWjtBQUNBLElBQUEsa0JBQWtCLEVBQ2xCLGtCQUFrQixFQUNsQixrQkFBa0IsRUFDbEIsa0JBQWtCO0FBRWxCO0FBQ0EsSUFBQSxZQUFZLEVBQ1osV0FBVyxFQUNYLG9CQUFvQixFQUNwQixvQkFBb0I7QUFFcEI7QUFDQSxJQUFBLFFBQVEsRUFDUixVQUFVLEVBQ1YsVUFBVSxFQUNWLFdBQVc7QUFFVjtBQUNELElBQUEsWUFBWSxDQUNmO0FBRURDLElBQUFBLElBQUksRUFBRTtBQUNGO0FBQ0EsSUFBQSxlQUFl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
