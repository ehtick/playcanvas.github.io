/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { EventHandler } from '../../core/event-handler.js';
import { platform } from '../../core/platform.js';
import { now } from '../../core/time.js';
import { PRIMITIVE_TRIFAN, PRIMITIVE_POINTS } from './constants.js';
import { ScopeSpace } from './scope-space.js';

const EVENT_RESIZE = 'resizecanvas';

class GraphicsDevice extends EventHandler {

  constructor(canvas) {
    super();
    this.canvas = void 0;
    this.deviceType = void 0;
    this.scope = void 0;
    this.boneLimit = void 0;
    this.maxAnisotropy = void 0;
    this.maxCubeMapSize = void 0;
    this.maxTextureSize = void 0;
    this.maxVolumeSize = void 0;
    this.precision = void 0;
    this.renderTarget = null;
    this.insideRenderPass = false;
    this.supportsInstancing = void 0;
    this.supportsUniformBuffers = false;
    this.textureFloatRenderable = void 0;
    this.textureHalfFloatRenderable = void 0;
    this.canvas = canvas;

    this._width = 0;
    this._height = 0;

    this._maxPixelRatio = platform.browser ? Math.min(1, window.devicePixelRatio) : 1;

    this.shaders = [];
    this.buffers = [];

    this.textures = [];

    this.targets = [];
    this._vram = {
      texShadow: 0,
      texAsset: 0,
      texLightmap: 0,
      tex: 0,
      vb: 0,
      ib: 0,
      ub: 0
    };
    this._shaderStats = {
      vsCompiled: 0,
      fsCompiled: 0,
      linked: 0,
      materialShaders: 0,
      compileTime: 0
    };
    this.initializeContextCaches();

    this._drawCallsPerFrame = 0;
    this._shaderSwitchesPerFrame = 0;
    this._primsPerFrame = [];
    for (let i = PRIMITIVE_POINTS; i <= PRIMITIVE_TRIFAN; i++) {
      this._primsPerFrame[i] = 0;
    }
    this._renderTargetCreationTime = 0;

    this.scope = new ScopeSpace("Device");
    this.textureBias = this.scope.resolve("textureBias");
    this.textureBias.setValue(0.0);
  }

  destroy() {
    this.fire('destroy');
  }
  onDestroyShader(shader) {
    this.fire('destroy:shader', shader);
    const idx = this.shaders.indexOf(shader);
    if (idx !== -1) {
      this.shaders.splice(idx, 1);
    }
  }

  postDestroy() {
    this.scope = null;
    this.canvas = null;
  }

  toJSON(key) {
    return undefined;
  }
  initializeContextCaches() {
    this.indexBuffer = null;
    this.vertexBuffers = [];
    this.shader = null;
    this.renderTarget = null;
  }

  setRenderTarget(renderTarget) {
    this.renderTarget = renderTarget;
  }

  setIndexBuffer(indexBuffer) {
    this.indexBuffer = indexBuffer;
  }

  setVertexBuffer(vertexBuffer) {
    if (vertexBuffer) {
      this.vertexBuffers.push(vertexBuffer);
    }
  }

  getRenderTarget() {
    return this.renderTarget;
  }

  initRenderTarget(target) {
    if (target.initialized) return;
    const startTime = now();
    this.fire('fbo:create', {
      timestamp: startTime,
      target: this
    });
    target.init();
    this.targets.push(target);
    this._renderTargetCreationTime += now() - startTime;
  }

  _isBrowserInterface(texture) {
    return this._isImageBrowserInterface(texture) || typeof HTMLCanvasElement !== 'undefined' && texture instanceof HTMLCanvasElement || typeof HTMLVideoElement !== 'undefined' && texture instanceof HTMLVideoElement;
  }
  _isImageBrowserInterface(texture) {
    return typeof ImageBitmap !== 'undefined' && texture instanceof ImageBitmap || typeof HTMLImageElement !== 'undefined' && texture instanceof HTMLImageElement;
  }

  resizeCanvas(width, height) {
    this._width = width;
    this._height = height;
    const ratio = Math.min(this._maxPixelRatio, platform.browser ? window.devicePixelRatio : 1);
    width = Math.floor(width * ratio);
    height = Math.floor(height * ratio);
    if (this.canvas.width !== width || this.canvas.height !== height) {
      this.canvas.width = width;
      this.canvas.height = height;
      this.fire(EVENT_RESIZE, width, height);
    }
  }

  setResolution(width, height) {
    this._width = width;
    this._height = height;
    this.canvas.width = width;
    this.canvas.height = height;
    this.fire(EVENT_RESIZE, width, height);
  }
  updateClientRect() {
    this.clientRect = this.canvas.getBoundingClientRect();
  }

  get width() {
    Debug.error("GraphicsDevice.width is not implemented on current device.");
    return this.canvas.width;
  }

  get height() {
    Debug.error("GraphicsDevice.height is not implemented on current device.");
    return this.canvas.height;
  }

  set fullscreen(fullscreen) {
    Debug.error("GraphicsDevice.fullscreen is not implemented on current device.");
  }
  get fullscreen() {
    Debug.error("GraphicsDevice.fullscreen is not implemented on current device.");
    return false;
  }

  set maxPixelRatio(ratio) {
    this._maxPixelRatio = ratio;
    this.resizeCanvas(this._width, this._height);
  }
  get maxPixelRatio() {
    return this._maxPixelRatio;
  }

  getBoneLimit() {
    return this.boneLimit;
  }

  setBoneLimit(maxBones) {
    this.boneLimit = maxBones;
  }
}

export { GraphicsDevice };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGhpY3MtZGV2aWNlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3MvZ3JhcGhpY3MtZGV2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tICcuLi8uLi9jb3JlL2V2ZW50LWhhbmRsZXIuanMnO1xuaW1wb3J0IHsgcGxhdGZvcm0gfSBmcm9tICcuLi8uLi9jb3JlL3BsYXRmb3JtLmpzJztcbmltcG9ydCB7IG5vdyB9IGZyb20gJy4uLy4uL2NvcmUvdGltZS5qcyc7XG5cbmltcG9ydCB7XG4gICAgUFJJTUlUSVZFX1BPSU5UUywgUFJJTUlUSVZFX1RSSUZBTlxufSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBTY29wZVNwYWNlIH0gZnJvbSAnLi9zY29wZS1zcGFjZS5qcyc7XG5cbmNvbnN0IEVWRU5UX1JFU0laRSA9ICdyZXNpemVjYW52YXMnO1xuXG4vKipcbiAqIFRoZSBncmFwaGljcyBkZXZpY2UgbWFuYWdlcyB0aGUgdW5kZXJseWluZyBncmFwaGljcyBjb250ZXh0LiBJdCBpcyByZXNwb25zaWJsZSBmb3Igc3VibWl0dGluZ1xuICogcmVuZGVyIHN0YXRlIGNoYW5nZXMgYW5kIGdyYXBoaWNzIHByaW1pdGl2ZXMgdG8gdGhlIGhhcmR3YXJlLiBBIGdyYXBoaWNzIGRldmljZSBpcyB0aWVkIHRvIGFcbiAqIHNwZWNpZmljIGNhbnZhcyBIVE1MIGVsZW1lbnQuIEl0IGlzIHZhbGlkIHRvIGhhdmUgbW9yZSB0aGFuIG9uZSBjYW52YXMgZWxlbWVudCBwZXIgcGFnZSBhbmRcbiAqIGNyZWF0ZSBhIG5ldyBncmFwaGljcyBkZXZpY2UgYWdhaW5zdCBlYWNoLlxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqL1xuY2xhc3MgR3JhcGhpY3NEZXZpY2UgZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIFRoZSBjYW52YXMgRE9NIGVsZW1lbnQgdGhhdCBwcm92aWRlcyB0aGUgdW5kZXJseWluZyBXZWJHTCBjb250ZXh0IHVzZWQgYnkgdGhlIGdyYXBoaWNzIGRldmljZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtIVE1MQ2FudmFzRWxlbWVudH1cbiAgICAgKi9cbiAgICBjYW52YXM7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZ3JhcGhpY3MgZGV2aWNlIHR5cGUsIERFVklDRVRZUEVfV0VCR0wgb3IgREVWSUNFVFlQRV9XRUJHUFUuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBkZXZpY2VUeXBlO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNjb3BlIG5hbWVzcGFjZSBmb3Igc2hhZGVyIGF0dHJpYnV0ZXMgYW5kIHZhcmlhYmxlcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtTY29wZVNwYWNlfVxuICAgICAqL1xuICAgIHNjb3BlO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHN1cHBvcnRlZCBib25lcyB1c2luZyB1bmlmb3JtIGJ1ZmZlcnMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIGJvbmVMaW1pdDtcblxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIHN1cHBvcnRlZCB0ZXh0dXJlIGFuaXNvdHJvcHkgc2V0dGluZy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgbWF4QW5pc290cm9weTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIHN1cHBvcnRlZCBkaW1lbnNpb24gb2YgYSBjdWJlIG1hcC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgbWF4Q3ViZU1hcFNpemU7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbWF4aW11bSBzdXBwb3J0ZWQgZGltZW5zaW9uIG9mIGEgdGV4dHVyZS5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgbWF4VGV4dHVyZVNpemU7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbWF4aW11bSBzdXBwb3J0ZWQgZGltZW5zaW9uIG9mIGEgM0QgdGV4dHVyZSAoYW55IGF4aXMpLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBtYXhWb2x1bWVTaXplO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGhpZ2hlc3Qgc2hhZGVyIHByZWNpc2lvbiBzdXBwb3J0ZWQgYnkgdGhpcyBncmFwaGljcyBkZXZpY2UuIENhbiBiZSAnaGlwaHAnLCAnbWVkaXVtcCcgb3JcbiAgICAgKiAnbG93cCcuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHByZWNpc2lvbjtcblxuICAgIC8qKlxuICAgICAqIEN1cnJlbnRseSBhY3RpdmUgcmVuZGVyIHRhcmdldC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtpbXBvcnQoJy4vcmVuZGVyLXRhcmdldC5qcycpLlJlbmRlclRhcmdldH1cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgcmVuZGVyVGFyZ2V0ID0gbnVsbDtcblxuICAgIC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cbiAgICBpbnNpZGVSZW5kZXJQYXNzID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIGhhcmR3YXJlIGluc3RhbmNpbmcgaXMgc3VwcG9ydGVkLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgc3VwcG9ydHNJbnN0YW5jaW5nO1xuXG4gICAgLyoqXG4gICAgICogVHJ1ZSBpZiB0aGUgZGV2aWNlIHN1cHBvcnRzIHVuaWZvcm0gYnVmZmVycy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBzdXBwb3J0c1VuaWZvcm1CdWZmZXJzID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIDMyLWJpdCBmbG9hdGluZy1wb2ludCB0ZXh0dXJlcyBjYW4gYmUgdXNlZCBhcyBhIGZyYW1lIGJ1ZmZlci5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqL1xuICAgIHRleHR1cmVGbG9hdFJlbmRlcmFibGU7XG5cbiAgICAgLyoqXG4gICAgICAqIFRydWUgaWYgMTYtYml0IGZsb2F0aW5nLXBvaW50IHRleHR1cmVzIGNhbiBiZSB1c2VkIGFzIGEgZnJhbWUgYnVmZmVyLlxuICAgICAgKlxuICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICovXG4gICAgdGV4dHVyZUhhbGZGbG9hdFJlbmRlcmFibGU7XG5cbiAgICBjb25zdHJ1Y3RvcihjYW52YXMpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcblxuICAgICAgICAvLyBsb2NhbCB3aWR0aC9oZWlnaHQgd2l0aG91dCBwaXhlbFJhdGlvIGFwcGxpZWRcbiAgICAgICAgdGhpcy5fd2lkdGggPSAwO1xuICAgICAgICB0aGlzLl9oZWlnaHQgPSAwO1xuXG4gICAgICAgIC8vIFNvbWUgZGV2aWNlcyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyBjYW4gYmUgbGVzcyB0aGFuIG9uZVxuICAgICAgICAvLyBlZyBPY3VsdXMgUXVlc3QgMSB3aGljaCByZXR1cm5zIGEgd2luZG93LmRldmljZVBpeGVsUmF0aW8gb2YgMC44XG4gICAgICAgIHRoaXMuX21heFBpeGVsUmF0aW8gPSBwbGF0Zm9ybS5icm93c2VyID8gTWF0aC5taW4oMSwgd2luZG93LmRldmljZVBpeGVsUmF0aW8pIDogMTtcblxuICAgICAgICAvLyBBcnJheSBvZiBvYmplY3RzIHRoYXQgbmVlZCB0byBiZSByZS1pbml0aWFsaXplZCBhZnRlciBhIGNvbnRleHQgcmVzdG9yZSBldmVudFxuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi9zaGFkZXIuanMnKS5TaGFkZXJbXX0gKi9cbiAgICAgICAgdGhpcy5zaGFkZXJzID0gW107XG5cbiAgICAgICAgdGhpcy5idWZmZXJzID0gW107XG5cbiAgICAgICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4vdGV4dHVyZS5qcycpLlRleHR1cmVbXX0gKi9cbiAgICAgICAgdGhpcy50ZXh0dXJlcyA9IFtdO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuL3JlbmRlci10YXJnZXQuanMnKS5SZW5kZXJUYXJnZXRbXX0gKi9cbiAgICAgICAgdGhpcy50YXJnZXRzID0gW107XG5cbiAgICAgICAgdGhpcy5fdnJhbSA9IHtcbiAgICAgICAgICAgIC8vICNpZiBfUFJPRklMRVJcbiAgICAgICAgICAgIHRleFNoYWRvdzogMCxcbiAgICAgICAgICAgIHRleEFzc2V0OiAwLFxuICAgICAgICAgICAgdGV4TGlnaHRtYXA6IDAsXG4gICAgICAgICAgICAvLyAjZW5kaWZcbiAgICAgICAgICAgIHRleDogMCxcbiAgICAgICAgICAgIHZiOiAwLFxuICAgICAgICAgICAgaWI6IDAsXG4gICAgICAgICAgICB1YjogMFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3NoYWRlclN0YXRzID0ge1xuICAgICAgICAgICAgdnNDb21waWxlZDogMCxcbiAgICAgICAgICAgIGZzQ29tcGlsZWQ6IDAsXG4gICAgICAgICAgICBsaW5rZWQ6IDAsXG4gICAgICAgICAgICBtYXRlcmlhbFNoYWRlcnM6IDAsXG4gICAgICAgICAgICBjb21waWxlVGltZTogMFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbnRleHRDYWNoZXMoKTtcblxuICAgICAgICAvLyBQcm9maWxlciBzdGF0c1xuICAgICAgICB0aGlzLl9kcmF3Q2FsbHNQZXJGcmFtZSA9IDA7XG4gICAgICAgIHRoaXMuX3NoYWRlclN3aXRjaGVzUGVyRnJhbWUgPSAwO1xuXG4gICAgICAgIHRoaXMuX3ByaW1zUGVyRnJhbWUgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IFBSSU1JVElWRV9QT0lOVFM7IGkgPD0gUFJJTUlUSVZFX1RSSUZBTjsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9wcmltc1BlckZyYW1lW2ldID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRDcmVhdGlvblRpbWUgPSAwO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgU2NvcGVOYW1lc3BhY2UgZm9yIHNoYWRlciBhdHRyaWJ1dGVzIGFuZCB2YXJpYWJsZXNcbiAgICAgICAgdGhpcy5zY29wZSA9IG5ldyBTY29wZVNwYWNlKFwiRGV2aWNlXCIpO1xuXG4gICAgICAgIHRoaXMudGV4dHVyZUJpYXMgPSB0aGlzLnNjb3BlLnJlc29sdmUoXCJ0ZXh0dXJlQmlhc1wiKTtcbiAgICAgICAgdGhpcy50ZXh0dXJlQmlhcy5zZXRWYWx1ZSgwLjApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gdGhlIGNhbnZhcyBpcyByZXNpemVkLlxuICAgICAqXG4gICAgICogQGV2ZW50IEdyYXBoaWNzRGV2aWNlI3Jlc2l6ZWNhbnZhc1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSBuZXcgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBuZXcgaGVpZ2h0IG9mIHRoZSBjYW52YXMgaW4gcGl4ZWxzLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogRGVzdHJveSB0aGUgZ3JhcGhpY3MgZGV2aWNlLlxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIC8vIGZpcmUgdGhlIGRlc3Ryb3kgZXZlbnQuXG4gICAgICAgIC8vIHRleHR1cmVzIGFuZCBvdGhlciBkZXZpY2UgcmVzb3VyY2VzIG1heSBkZXN0cm95IHRoZW1zZWx2ZXMgaW4gcmVzcG9uc2UuXG4gICAgICAgIHRoaXMuZmlyZSgnZGVzdHJveScpO1xuICAgIH1cblxuICAgIG9uRGVzdHJveVNoYWRlcihzaGFkZXIpIHtcbiAgICAgICAgdGhpcy5maXJlKCdkZXN0cm95OnNoYWRlcicsIHNoYWRlcik7XG5cbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5zaGFkZXJzLmluZGV4T2Yoc2hhZGVyKTtcbiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuc2hhZGVycy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGV4ZWN1dGVzIGFmdGVyIHRoZSBleHRlbmRlZCBjbGFzc2VzIGhhdmUgZXhlY3V0ZWQgdGhlaXIgZGVzdHJveSBmdW5jdGlvblxuICAgIHBvc3REZXN0cm95KCkge1xuICAgICAgICB0aGlzLnNjb3BlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIGRvbid0IHN0cmluZ2lmeSBHcmFwaGljc0RldmljZSB0byBKU09OIGJ5IEpTT04uc3RyaW5naWZ5XG4gICAgdG9KU09OKGtleSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGluaXRpYWxpemVDb250ZXh0Q2FjaGVzKCkge1xuICAgICAgICB0aGlzLmluZGV4QnVmZmVyID0gbnVsbDtcbiAgICAgICAgdGhpcy52ZXJ0ZXhCdWZmZXJzID0gW107XG4gICAgICAgIHRoaXMuc2hhZGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5yZW5kZXJUYXJnZXQgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHNwZWNpZmllZCByZW5kZXIgdGFyZ2V0IG9uIHRoZSBkZXZpY2UuIElmIG51bGwgaXMgcGFzc2VkIGFzIGEgcGFyYW1ldGVyLCB0aGUgYmFja1xuICAgICAqIGJ1ZmZlciBiZWNvbWVzIHRoZSBjdXJyZW50IHRhcmdldCBmb3IgYWxsIHJlbmRlcmluZyBvcGVyYXRpb25zLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vcmVuZGVyLXRhcmdldC5qcycpLlJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG9cbiAgICAgKiBhY3RpdmF0ZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIFNldCBhIHJlbmRlciB0YXJnZXQgdG8gcmVjZWl2ZSBhbGwgcmVuZGVyaW5nIG91dHB1dFxuICAgICAqIGRldmljZS5zZXRSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KTtcbiAgICAgKlxuICAgICAqIC8vIFNldCB0aGUgYmFjayBidWZmZXIgdG8gcmVjZWl2ZSBhbGwgcmVuZGVyaW5nIG91dHB1dFxuICAgICAqIGRldmljZS5zZXRSZW5kZXJUYXJnZXQobnVsbCk7XG4gICAgICovXG4gICAgc2V0UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCkge1xuICAgICAgICB0aGlzLnJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBjdXJyZW50IGluZGV4IGJ1ZmZlciBvbiB0aGUgZ3JhcGhpY3MgZGV2aWNlLiBPbiBzdWJzZXF1ZW50IGNhbGxzIHRvXG4gICAgICoge0BsaW5rIEdyYXBoaWNzRGV2aWNlI2RyYXd9LCB0aGUgc3BlY2lmaWVkIGluZGV4IGJ1ZmZlciB3aWxsIGJlIHVzZWQgdG8gcHJvdmlkZSBpbmRleCBkYXRhXG4gICAgICogZm9yIGFueSBpbmRleGVkIHByaW1pdGl2ZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9pbmRleC1idWZmZXIuanMnKS5JbmRleEJ1ZmZlcn0gaW5kZXhCdWZmZXIgLSBUaGUgaW5kZXggYnVmZmVyIHRvIGFzc2lnbiB0b1xuICAgICAqIHRoZSBkZXZpY2UuXG4gICAgICovXG4gICAgc2V0SW5kZXhCdWZmZXIoaW5kZXhCdWZmZXIpIHtcbiAgICAgICAgLy8gU3RvcmUgdGhlIGluZGV4IGJ1ZmZlclxuICAgICAgICB0aGlzLmluZGV4QnVmZmVyID0gaW5kZXhCdWZmZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgY3VycmVudCB2ZXJ0ZXggYnVmZmVyIG9uIHRoZSBncmFwaGljcyBkZXZpY2UuIE9uIHN1YnNlcXVlbnQgY2FsbHMgdG9cbiAgICAgKiB7QGxpbmsgR3JhcGhpY3NEZXZpY2UjZHJhd30sIHRoZSBzcGVjaWZpZWQgdmVydGV4IGJ1ZmZlcihzKSB3aWxsIGJlIHVzZWQgdG8gcHJvdmlkZSB2ZXJ0ZXhcbiAgICAgKiBkYXRhIGZvciBhbnkgcHJpbWl0aXZlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL3ZlcnRleC1idWZmZXIuanMnKS5WZXJ0ZXhCdWZmZXJ9IHZlcnRleEJ1ZmZlciAtIFRoZSB2ZXJ0ZXggYnVmZmVyIHRvXG4gICAgICogYXNzaWduIHRvIHRoZSBkZXZpY2UuXG4gICAgICovXG4gICAgc2V0VmVydGV4QnVmZmVyKHZlcnRleEJ1ZmZlcikge1xuXG4gICAgICAgIGlmICh2ZXJ0ZXhCdWZmZXIpIHtcbiAgICAgICAgICAgIHRoaXMudmVydGV4QnVmZmVycy5wdXNoKHZlcnRleEJ1ZmZlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBRdWVyaWVzIHRoZSBjdXJyZW50bHkgc2V0IHJlbmRlciB0YXJnZXQgb24gdGhlIGRldmljZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtpbXBvcnQoJy4vcmVuZGVyLXRhcmdldC5qcycpLlJlbmRlclRhcmdldH0gVGhlIGN1cnJlbnQgcmVuZGVyIHRhcmdldC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIEdldCB0aGUgY3VycmVudCByZW5kZXIgdGFyZ2V0XG4gICAgICogdmFyIHJlbmRlclRhcmdldCA9IGRldmljZS5nZXRSZW5kZXJUYXJnZXQoKTtcbiAgICAgKi9cbiAgICBnZXRSZW5kZXJUYXJnZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbmRlclRhcmdldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHJlbmRlciB0YXJnZXQgYmVmb3JlIGl0IGNhbiBiZSB1c2VkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vcmVuZGVyLXRhcmdldC5qcycpLlJlbmRlclRhcmdldH0gdGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG8gYmVcbiAgICAgKiBpbml0aWFsaXplZC5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgaW5pdFJlbmRlclRhcmdldCh0YXJnZXQpIHtcblxuICAgICAgICBpZiAodGFyZ2V0LmluaXRpYWxpemVkKSByZXR1cm47XG5cbiAgICAgICAgLy8gI2lmIF9QUk9GSUxFUlxuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBub3coKTtcbiAgICAgICAgdGhpcy5maXJlKCdmYm86Y3JlYXRlJywge1xuICAgICAgICAgICAgdGltZXN0YW1wOiBzdGFydFRpbWUsXG4gICAgICAgICAgICB0YXJnZXQ6IHRoaXNcbiAgICAgICAgfSk7XG4gICAgICAgIC8vICNlbmRpZlxuXG4gICAgICAgIHRhcmdldC5pbml0KCk7XG4gICAgICAgIHRoaXMudGFyZ2V0cy5wdXNoKHRhcmdldCk7XG5cbiAgICAgICAgLy8gI2lmIF9QUk9GSUxFUlxuICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRDcmVhdGlvblRpbWUgKz0gbm93KCkgLSBzdGFydFRpbWU7XG4gICAgICAgIC8vICNlbmRpZlxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcG9ydHMgd2hldGhlciBhIHRleHR1cmUgc291cmNlIGlzIGEgY2FudmFzLCBpbWFnZSwgdmlkZW8gb3IgSW1hZ2VCaXRtYXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0geyp9IHRleHR1cmUgLSBUZXh0dXJlIHNvdXJjZSBkYXRhLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSB0ZXh0dXJlIGlzIGEgY2FudmFzLCBpbWFnZSwgdmlkZW8gb3IgSW1hZ2VCaXRtYXAgYW5kIGZhbHNlXG4gICAgICogb3RoZXJ3aXNlLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBfaXNCcm93c2VySW50ZXJmYWNlKHRleHR1cmUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW1hZ2VCcm93c2VySW50ZXJmYWNlKHRleHR1cmUpIHx8XG4gICAgICAgICAgICAgICAgKHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgdGV4dHVyZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50KSB8fFxuICAgICAgICAgICAgICAgICh0eXBlb2YgSFRNTFZpZGVvRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgdGV4dHVyZSBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQpO1xuICAgIH1cblxuICAgIF9pc0ltYWdlQnJvd3NlckludGVyZmFjZSh0ZXh0dXJlKSB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIEltYWdlQml0bWFwICE9PSAndW5kZWZpbmVkJyAmJiB0ZXh0dXJlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXApIHx8XG4gICAgICAgICAgICAgICAodHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIHRleHR1cmUgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBjYW52YXMsIHRoZW4gZmlyZXMgdGhlIGByZXNpemVjYW52YXNgIGV2ZW50LiBOb3RlIHRoYXQgdGhlXG4gICAgICogc3BlY2lmaWVkIHdpZHRoIGFuZCBoZWlnaHQgdmFsdWVzIHdpbGwgYmUgbXVsdGlwbGllZCBieSB0aGUgdmFsdWUgb2ZcbiAgICAgKiB7QGxpbmsgR3JhcGhpY3NEZXZpY2UjbWF4UGl4ZWxSYXRpb30gdG8gZ2l2ZSB0aGUgZmluYWwgcmVzdWx0YW50IHdpZHRoIGFuZCBoZWlnaHQgZm9yIHRoZVxuICAgICAqIGNhbnZhcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSBuZXcgd2lkdGggb2YgdGhlIGNhbnZhcy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIG5ldyBoZWlnaHQgb2YgdGhlIGNhbnZhcy5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgcmVzaXplQ2FudmFzKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fd2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgICAgIGNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5fbWF4UGl4ZWxSYXRpbywgcGxhdGZvcm0uYnJvd3NlciA/IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIDogMSk7XG4gICAgICAgIHdpZHRoID0gTWF0aC5mbG9vcih3aWR0aCAqIHJhdGlvKTtcbiAgICAgICAgaGVpZ2h0ID0gTWF0aC5mbG9vcihoZWlnaHQgKiByYXRpbyk7XG5cbiAgICAgICAgaWYgKHRoaXMuY2FudmFzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmNhbnZhcy5oZWlnaHQgIT09IGhlaWdodCkge1xuICAgICAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuZmlyZShFVkVOVF9SRVNJWkUsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgY2FudmFzLCB0aGVuIGZpcmVzIHRoZSBgcmVzaXplY2FudmFzYCBldmVudC4gTm90ZSB0aGF0IHRoZVxuICAgICAqIHZhbHVlIG9mIHtAbGluayBHcmFwaGljc0RldmljZSNtYXhQaXhlbFJhdGlvfSBpcyBpZ25vcmVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIG5ldyB3aWR0aCBvZiB0aGUgY2FudmFzLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgbmV3IGhlaWdodCBvZiB0aGUgY2FudmFzLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBzZXRSZXNvbHV0aW9uKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fd2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMuZmlyZShFVkVOVF9SRVNJWkUsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cblxuICAgIHVwZGF0ZUNsaWVudFJlY3QoKSB7XG4gICAgICAgIHRoaXMuY2xpZW50UmVjdCA9IHRoaXMuY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdpZHRoIG9mIHRoZSBiYWNrIGJ1ZmZlciBpbiBwaXhlbHMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgRGVidWcuZXJyb3IoXCJHcmFwaGljc0RldmljZS53aWR0aCBpcyBub3QgaW1wbGVtZW50ZWQgb24gY3VycmVudCBkZXZpY2UuXCIpO1xuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMud2lkdGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGVpZ2h0IG9mIHRoZSBiYWNrIGJ1ZmZlciBpbiBwaXhlbHMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBoZWlnaHQoKSB7XG4gICAgICAgIERlYnVnLmVycm9yKFwiR3JhcGhpY3NEZXZpY2UuaGVpZ2h0IGlzIG5vdCBpbXBsZW1lbnRlZCBvbiBjdXJyZW50IGRldmljZS5cIik7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVsbHNjcmVlbiBtb2RlLlxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgc2V0IGZ1bGxzY3JlZW4oZnVsbHNjcmVlbikge1xuICAgICAgICBEZWJ1Zy5lcnJvcihcIkdyYXBoaWNzRGV2aWNlLmZ1bGxzY3JlZW4gaXMgbm90IGltcGxlbWVudGVkIG9uIGN1cnJlbnQgZGV2aWNlLlwiKTtcbiAgICB9XG5cbiAgICBnZXQgZnVsbHNjcmVlbigpIHtcbiAgICAgICAgRGVidWcuZXJyb3IoXCJHcmFwaGljc0RldmljZS5mdWxsc2NyZWVuIGlzIG5vdCBpbXBsZW1lbnRlZCBvbiBjdXJyZW50IGRldmljZS5cIik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXhpbXVtIHBpeGVsIHJhdGlvLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgbWF4UGl4ZWxSYXRpbyhyYXRpbykge1xuICAgICAgICB0aGlzLl9tYXhQaXhlbFJhdGlvID0gcmF0aW87XG4gICAgICAgIHRoaXMucmVzaXplQ2FudmFzKHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpO1xuICAgIH1cblxuICAgIGdldCBtYXhQaXhlbFJhdGlvKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWF4UGl4ZWxSYXRpbztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBRdWVyaWVzIHRoZSBtYXhpbXVtIG51bWJlciBvZiBib25lcyB0aGF0IGNhbiBiZSByZWZlcmVuY2VkIGJ5IGEgc2hhZGVyLiBUaGUgc2hhZGVyXG4gICAgICogZ2VuZXJhdG9ycyAocHJvZ3JhbWxpYikgdXNlIHRoaXMgbnVtYmVyIHRvIHNwZWNpZnkgdGhlIG1hdHJpeCBhcnJheSBzaXplIG9mIHRoZSB1bmlmb3JtXG4gICAgICogJ21hdHJpeF9wb3NlWzBdJy4gVGhlIHZhbHVlIGlzIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIG51bWJlciBvZiBhdmFpbGFibGUgdW5pZm9ybSB2ZWN0b3JzXG4gICAgICogYXZhaWxhYmxlIGFmdGVyIHN1YnRyYWN0aW5nIHRoZSBudW1iZXIgdGFrZW4gYnkgYSB0eXBpY2FsIGhlYXZ5d2VpZ2h0IHNoYWRlci4gSWYgYSBkaWZmZXJlbnRcbiAgICAgKiBudW1iZXIgaXMgcmVxdWlyZWQsIGl0IGNhbiBiZSB0dW5lZCB2aWEge0BsaW5rIEdyYXBoaWNzRGV2aWNlI3NldEJvbmVMaW1pdH0uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbWF4aW11bSBudW1iZXIgb2YgYm9uZXMgdGhhdCBjYW4gYmUgc3VwcG9ydGVkIGJ5IHRoZSBob3N0IGhhcmR3YXJlLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBnZXRCb25lTGltaXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvbmVMaW1pdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTcGVjaWZpZXMgdGhlIG1heGltdW0gbnVtYmVyIG9mIGJvbmVzIHRoYXQgdGhlIGRldmljZSBjYW4gc3VwcG9ydCBvbiB0aGUgY3VycmVudCBoYXJkd2FyZS5cbiAgICAgKiBUaGlzIGZ1bmN0aW9uIGFsbG93cyB0aGUgZGVmYXVsdCBjYWxjdWxhdGVkIHZhbHVlIGJhc2VkIG9uIGF2YWlsYWJsZSB2ZWN0b3IgdW5pZm9ybXMgdG8gYmVcbiAgICAgKiBvdmVycmlkZGVuLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1heEJvbmVzIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGJvbmVzIHN1cHBvcnRlZCBieSB0aGUgaG9zdCBoYXJkd2FyZS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgc2V0Qm9uZUxpbWl0KG1heEJvbmVzKSB7XG4gICAgICAgIHRoaXMuYm9uZUxpbWl0ID0gbWF4Qm9uZXM7XG4gICAgfVxufVxuXG5leHBvcnQgeyBHcmFwaGljc0RldmljZSB9O1xuIl0sIm5hbWVzIjpbIkVWRU5UX1JFU0laRSIsIkdyYXBoaWNzRGV2aWNlIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJjYW52YXMiLCJkZXZpY2VUeXBlIiwic2NvcGUiLCJib25lTGltaXQiLCJtYXhBbmlzb3Ryb3B5IiwibWF4Q3ViZU1hcFNpemUiLCJtYXhUZXh0dXJlU2l6ZSIsIm1heFZvbHVtZVNpemUiLCJwcmVjaXNpb24iLCJyZW5kZXJUYXJnZXQiLCJpbnNpZGVSZW5kZXJQYXNzIiwic3VwcG9ydHNJbnN0YW5jaW5nIiwic3VwcG9ydHNVbmlmb3JtQnVmZmVycyIsInRleHR1cmVGbG9hdFJlbmRlcmFibGUiLCJ0ZXh0dXJlSGFsZkZsb2F0UmVuZGVyYWJsZSIsIl93aWR0aCIsIl9oZWlnaHQiLCJfbWF4UGl4ZWxSYXRpbyIsInBsYXRmb3JtIiwiYnJvd3NlciIsIk1hdGgiLCJtaW4iLCJ3aW5kb3ciLCJkZXZpY2VQaXhlbFJhdGlvIiwic2hhZGVycyIsImJ1ZmZlcnMiLCJ0ZXh0dXJlcyIsInRhcmdldHMiLCJfdnJhbSIsInRleFNoYWRvdyIsInRleEFzc2V0IiwidGV4TGlnaHRtYXAiLCJ0ZXgiLCJ2YiIsImliIiwidWIiLCJfc2hhZGVyU3RhdHMiLCJ2c0NvbXBpbGVkIiwiZnNDb21waWxlZCIsImxpbmtlZCIsIm1hdGVyaWFsU2hhZGVycyIsImNvbXBpbGVUaW1lIiwiaW5pdGlhbGl6ZUNvbnRleHRDYWNoZXMiLCJfZHJhd0NhbGxzUGVyRnJhbWUiLCJfc2hhZGVyU3dpdGNoZXNQZXJGcmFtZSIsIl9wcmltc1BlckZyYW1lIiwiaSIsIlBSSU1JVElWRV9QT0lOVFMiLCJQUklNSVRJVkVfVFJJRkFOIiwiX3JlbmRlclRhcmdldENyZWF0aW9uVGltZSIsIlNjb3BlU3BhY2UiLCJ0ZXh0dXJlQmlhcyIsInJlc29sdmUiLCJzZXRWYWx1ZSIsImRlc3Ryb3kiLCJmaXJlIiwib25EZXN0cm95U2hhZGVyIiwic2hhZGVyIiwiaWR4IiwiaW5kZXhPZiIsInNwbGljZSIsInBvc3REZXN0cm95IiwidG9KU09OIiwia2V5IiwidW5kZWZpbmVkIiwiaW5kZXhCdWZmZXIiLCJ2ZXJ0ZXhCdWZmZXJzIiwic2V0UmVuZGVyVGFyZ2V0Iiwic2V0SW5kZXhCdWZmZXIiLCJzZXRWZXJ0ZXhCdWZmZXIiLCJ2ZXJ0ZXhCdWZmZXIiLCJwdXNoIiwiZ2V0UmVuZGVyVGFyZ2V0IiwiaW5pdFJlbmRlclRhcmdldCIsInRhcmdldCIsImluaXRpYWxpemVkIiwic3RhcnRUaW1lIiwibm93IiwidGltZXN0YW1wIiwiaW5pdCIsIl9pc0Jyb3dzZXJJbnRlcmZhY2UiLCJ0ZXh0dXJlIiwiX2lzSW1hZ2VCcm93c2VySW50ZXJmYWNlIiwiSFRNTENhbnZhc0VsZW1lbnQiLCJIVE1MVmlkZW9FbGVtZW50IiwiSW1hZ2VCaXRtYXAiLCJIVE1MSW1hZ2VFbGVtZW50IiwicmVzaXplQ2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJyYXRpbyIsImZsb29yIiwic2V0UmVzb2x1dGlvbiIsInVwZGF0ZUNsaWVudFJlY3QiLCJjbGllbnRSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiRGVidWciLCJlcnJvciIsImZ1bGxzY3JlZW4iLCJtYXhQaXhlbFJhdGlvIiwiZ2V0Qm9uZUxpbWl0Iiwic2V0Qm9uZUxpbWl0IiwibWF4Qm9uZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVVBLE1BQU1BLFlBQVksR0FBRyxjQUFjLENBQUE7O0FBVW5DLE1BQU1DLGNBQWMsU0FBU0MsWUFBWSxDQUFDOztFQTBHdENDLFdBQVcsQ0FBQ0MsTUFBTSxFQUFFO0FBQ2hCLElBQUEsS0FBSyxFQUFFLENBQUE7QUFBQyxJQUFBLElBQUEsQ0FyR1pBLE1BQU0sR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQVFOQyxVQUFVLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FPVkMsS0FBSyxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBT0xDLFNBQVMsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEs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
