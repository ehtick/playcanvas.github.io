import { Debug } from '../../core/debug.js';
import { SEMANTIC_POSITION, SEMANTIC_NORMAL, SEMANTIC_TANGENT, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1, SEMANTIC_TEXCOORD2, SEMANTIC_TEXCOORD3, SEMANTIC_TEXCOORD4, SEMANTIC_TEXCOORD5, SEMANTIC_TEXCOORD6, SEMANTIC_TEXCOORD7, SEMANTIC_COLOR, SEMANTIC_BLENDINDICES, SEMANTIC_BLENDWEIGHT } from './constants.js';
import gles2PS from './shader-chunks/frag/gles2.js';
import gles3PS from './shader-chunks/frag/gles3.js';
import gles3VS from './shader-chunks/vert/gles3.js';
import webgpuPS from './shader-chunks/frag/webgpu.js';
import webgpuVS from './shader-chunks/vert/webgpu.js';
import sharedFS from './shader-chunks/frag/shared.js';

const _attrib2Semantic = {
  vertex_position: SEMANTIC_POSITION,
  vertex_normal: SEMANTIC_NORMAL,
  vertex_tangent: SEMANTIC_TANGENT,
  vertex_texCoord0: SEMANTIC_TEXCOORD0,
  vertex_texCoord1: SEMANTIC_TEXCOORD1,
  vertex_texCoord2: SEMANTIC_TEXCOORD2,
  vertex_texCoord3: SEMANTIC_TEXCOORD3,
  vertex_texCoord4: SEMANTIC_TEXCOORD4,
  vertex_texCoord5: SEMANTIC_TEXCOORD5,
  vertex_texCoord6: SEMANTIC_TEXCOORD6,
  vertex_texCoord7: SEMANTIC_TEXCOORD7,
  vertex_color: SEMANTIC_COLOR,
  vertex_boneIndices: SEMANTIC_BLENDINDICES,
  vertex_boneWeights: SEMANTIC_BLENDWEIGHT
};

/**
 * A class providing utility functions for shader creation.
 *
 * @ignore
 */
class ShaderUtils {
  /**
   * Creates a shader definition.
   *
   * @param {import('./graphics-device.js').GraphicsDevice} device - The graphics device.
   * @param {object} options - Object for passing optional arguments.
   * @param {string} [options.name] - A name of the shader.
   * @param {object} [options.attributes] - Attributes. Will be extracted from the vertexCode if
   * not provided.
   * @param {string} options.vertexCode - The vertex shader code.
   * @param {string} [options.vertexDefines] - The vertex shader defines.
   * @param {string} [options.vertexExtensions] - The vertex shader extensions code.
   * @param {string} [options.fragmentCode] - The fragment shader code.
   * @param {string} [options.fragmentDefines] - The fragment shader defines.
   * @param {string} [options.fragmentExtensions] - The fragment shader extensions code.
   * @param {string} [options.fragmentPreamble] - The preamble string for the fragment shader.
   * @param {boolean} [options.useTransformFeedback] - Whether to use transform feedback. Defaults
   * to false.
   * @returns {object} Returns the created shader definition.
   */
  static createDefinition(device, options) {
    var _options$name, _options$attributes;
    Debug.assert(options);
    const getDefines = (gpu, gl2, gl1, isVertex) => {
      const deviceIntro = device.isWebGPU ? gpu : device.webgl2 ? gl2 : ShaderUtils.gl1Extensions(device, options) + gl1;

      // a define per supported color attachment, which strips out unsupported output definitions in the deviceIntro
      let attachmentsDefine = '';
      for (let i = 0; i < device.maxColorAttachments; i++) {
        attachmentsDefine += `#define COLOR_ATTACHMENT_${i}\n`;
      }
      return attachmentsDefine + deviceIntro;
    };
    const name = (_options$name = options.name) != null ? _options$name : 'Untitled';

    // vertex code
    const vertDefines = options.vertexDefines || getDefines(webgpuVS, gles3VS, '');
    const vertCode = ShaderUtils.versionCode(device) + vertDefines + sharedFS + ShaderUtils.getShaderNameCode(name) + options.vertexCode;

    // fragment code
    const fragDefines = options.fragmentDefines || getDefines(webgpuPS, gles3PS, gles2PS);
    const fragCode = (options.fragmentPreamble || '') + ShaderUtils.versionCode(device) + fragDefines + ShaderUtils.precisionCode(device) + '\n' + sharedFS + ShaderUtils.getShaderNameCode(name) + (options.fragmentCode || ShaderUtils.dummyFragmentCode());

    // attributes
    const attribs = (_options$attributes = options.attributes) != null ? _options$attributes : ShaderUtils.collectAttributes(options.vertexCode);
    return {
      name: name,
      attributes: attribs,
      vshader: vertCode,
      fshader: fragCode,
      useTransformFeedback: options.useTransformFeedback
    };
  }

  // SpectorJS integration
  static getShaderNameCode(name) {
    return `#define SHADER_NAME ${name}\n`;
  }
  static gl1Extensions(device, options, isVertex) {
    let code;
    if (isVertex) {
      code = options.vertexExtensions ? `${options.vertexExtensions}\n` : '';
    } else {
      code = options.fragmentExtensions ? `${options.fragmentExtensions}\n` : '';

      // extensions used by default
      if (device.extStandardDerivatives) {
        code += "#extension GL_OES_standard_derivatives : enable\n";
      }
      if (device.extTextureLod) {
        code += "#extension GL_EXT_shader_texture_lod : enable\n";
        code += "#define SUPPORTS_TEXLOD\n";
      }
      if (device.extDrawBuffers) {
        code += "#extension GL_EXT_draw_buffers : require\n";
        code += "#define SUPPORTS_MRT\n";
      }
    }
    return code;
  }
  static dummyFragmentCode() {
    return "void main(void) {gl_FragColor = vec4(0.0);}";
  }
  static versionCode(device) {
    if (device.isWebGPU) {
      return '#version 450\n';
    }
    return device.webgl2 ? "#version 300 es\n" : "";
  }
  static precisionCode(device, forcePrecision) {
    let code = '';
    if (forcePrecision && forcePrecision !== 'highp' && forcePrecision !== 'mediump' && forcePrecision !== 'lowp') {
      forcePrecision = null;
    }
    if (forcePrecision) {
      if (forcePrecision === 'highp' && device.maxPrecision !== 'highp') {
        forcePrecision = 'mediump';
      }
      if (forcePrecision === 'mediump' && device.maxPrecision === 'lowp') {
        forcePrecision = 'lowp';
      }
    }
    const precision = forcePrecision ? forcePrecision : device.precision;
    if (!device.isWebGPU) {
      code = `precision ${precision} float;\n`;
      if (device.webgl2) {
        code += `precision ${precision} sampler2DShadow;\n`;
      }
    } else {
      // WebGPU

      code = `precision ${precision} float;\nprecision ${precision} int;\n`;
    }
    return code;
  }

  /**
   * Extract the attributes specified in a vertex shader.
   *
   * @param {string} vsCode - The vertex shader code.
   * @returns {Object<string, string>} The attribute name to semantic map.
   * @ignore
   */
  static collectAttributes(vsCode) {
    const attribs = {};
    let attrs = 0;
    let found = vsCode.indexOf("attribute");
    while (found >= 0) {
      if (found > 0 && vsCode[found - 1] === "/") break;
      const endOfLine = vsCode.indexOf(';', found);
      const startOfAttribName = vsCode.lastIndexOf(' ', endOfLine);
      const attribName = vsCode.substring(startOfAttribName + 1, endOfLine);
      const semantic = _attrib2Semantic[attribName];
      if (semantic !== undefined) {
        attribs[attribName] = semantic;
      } else {
        attribs[attribName] = "ATTR" + attrs;
        attrs++;
      }
      found = vsCode.indexOf("attribute", found + 1);
    }
    return attribs;
  }
}

export { ShaderUtils };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZGVyLXV0aWxzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3Mvc2hhZGVyLXV0aWxzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSBcIi4uLy4uL2NvcmUvZGVidWcuanNcIjtcbmltcG9ydCB7XG4gICAgU0VNQU5USUNfUE9TSVRJT04sIFNFTUFOVElDX05PUk1BTCwgU0VNQU5USUNfVEFOR0VOVCwgU0VNQU5USUNfVEVYQ09PUkQwLCBTRU1BTlRJQ19URVhDT09SRDEsIFNFTUFOVElDX1RFWENPT1JEMixcbiAgICBTRU1BTlRJQ19URVhDT09SRDMsIFNFTUFOVElDX1RFWENPT1JENCwgU0VNQU5USUNfVEVYQ09PUkQ1LCBTRU1BTlRJQ19URVhDT09SRDYsIFNFTUFOVElDX1RFWENPT1JENyxcbiAgICBTRU1BTlRJQ19DT0xPUiwgU0VNQU5USUNfQkxFTkRJTkRJQ0VTLCBTRU1BTlRJQ19CTEVORFdFSUdIVFxufSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCBnbGVzMkZTIGZyb20gJy4vc2hhZGVyLWNodW5rcy9mcmFnL2dsZXMyLmpzJztcbmltcG9ydCBnbGVzM0ZTIGZyb20gJy4vc2hhZGVyLWNodW5rcy9mcmFnL2dsZXMzLmpzJztcbmltcG9ydCBnbGVzM1ZTIGZyb20gJy4vc2hhZGVyLWNodW5rcy92ZXJ0L2dsZXMzLmpzJztcbmltcG9ydCB3ZWJncHVGUyBmcm9tICcuL3NoYWRlci1jaHVua3MvZnJhZy93ZWJncHUuanMnO1xuaW1wb3J0IHdlYmdwdVZTIGZyb20gJy4vc2hhZGVyLWNodW5rcy92ZXJ0L3dlYmdwdS5qcyc7XG5pbXBvcnQgc2hhcmVkRlMgZnJvbSAnLi9zaGFkZXItY2h1bmtzL2ZyYWcvc2hhcmVkLmpzJztcblxuY29uc3QgX2F0dHJpYjJTZW1hbnRpYyA9IHtcbiAgICB2ZXJ0ZXhfcG9zaXRpb246IFNFTUFOVElDX1BPU0lUSU9OLFxuICAgIHZlcnRleF9ub3JtYWw6IFNFTUFOVElDX05PUk1BTCxcbiAgICB2ZXJ0ZXhfdGFuZ2VudDogU0VNQU5USUNfVEFOR0VOVCxcbiAgICB2ZXJ0ZXhfdGV4Q29vcmQwOiBTRU1BTlRJQ19URVhDT09SRDAsXG4gICAgdmVydGV4X3RleENvb3JkMTogU0VNQU5USUNfVEVYQ09PUkQxLFxuICAgIHZlcnRleF90ZXhDb29yZDI6IFNFTUFOVElDX1RFWENPT1JEMixcbiAgICB2ZXJ0ZXhfdGV4Q29vcmQzOiBTRU1BTlRJQ19URVhDT09SRDMsXG4gICAgdmVydGV4X3RleENvb3JkNDogU0VNQU5USUNfVEVYQ09PUkQ0LFxuICAgIHZlcnRleF90ZXhDb29yZDU6IFNFTUFOVElDX1RFWENPT1JENSxcbiAgICB2ZXJ0ZXhfdGV4Q29vcmQ2OiBTRU1BTlRJQ19URVhDT09SRDYsXG4gICAgdmVydGV4X3RleENvb3JkNzogU0VNQU5USUNfVEVYQ09PUkQ3LFxuICAgIHZlcnRleF9jb2xvcjogU0VNQU5USUNfQ09MT1IsXG4gICAgdmVydGV4X2JvbmVJbmRpY2VzOiBTRU1BTlRJQ19CTEVORElORElDRVMsXG4gICAgdmVydGV4X2JvbmVXZWlnaHRzOiBTRU1BTlRJQ19CTEVORFdFSUdIVFxufTtcblxuLyoqXG4gKiBBIGNsYXNzIHByb3ZpZGluZyB1dGlsaXR5IGZ1bmN0aW9ucyBmb3Igc2hhZGVyIGNyZWF0aW9uLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgU2hhZGVyVXRpbHMge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBzaGFkZXIgZGVmaW5pdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBkZXZpY2UgLSBUaGUgZ3JhcGhpY3MgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gT2JqZWN0IGZvciBwYXNzaW5nIG9wdGlvbmFsIGFyZ3VtZW50cy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMubmFtZV0gLSBBIG5hbWUgb2YgdGhlIHNoYWRlci5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnMuYXR0cmlidXRlc10gLSBBdHRyaWJ1dGVzLiBXaWxsIGJlIGV4dHJhY3RlZCBmcm9tIHRoZSB2ZXJ0ZXhDb2RlIGlmXG4gICAgICogbm90IHByb3ZpZGVkLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnZlcnRleENvZGUgLSBUaGUgdmVydGV4IHNoYWRlciBjb2RlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy52ZXJ0ZXhEZWZpbmVzXSAtIFRoZSB2ZXJ0ZXggc2hhZGVyIGRlZmluZXMuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnZlcnRleEV4dGVuc2lvbnNdIC0gVGhlIHZlcnRleCBzaGFkZXIgZXh0ZW5zaW9ucyBjb2RlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5mcmFnbWVudENvZGVdIC0gVGhlIGZyYWdtZW50IHNoYWRlciBjb2RlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5mcmFnbWVudERlZmluZXNdIC0gVGhlIGZyYWdtZW50IHNoYWRlciBkZWZpbmVzLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5mcmFnbWVudEV4dGVuc2lvbnNdIC0gVGhlIGZyYWdtZW50IHNoYWRlciBleHRlbnNpb25zIGNvZGUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmZyYWdtZW50UHJlYW1ibGVdIC0gVGhlIHByZWFtYmxlIHN0cmluZyBmb3IgdGhlIGZyYWdtZW50IHNoYWRlci5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnVzZVRyYW5zZm9ybUZlZWRiYWNrXSAtIFdoZXRoZXIgdG8gdXNlIHRyYW5zZm9ybSBmZWVkYmFjay4gRGVmYXVsdHNcbiAgICAgKiB0byBmYWxzZS5cbiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSBSZXR1cm5zIHRoZSBjcmVhdGVkIHNoYWRlciBkZWZpbml0aW9uLlxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVhdGVEZWZpbml0aW9uKGRldmljZSwgb3B0aW9ucykge1xuICAgICAgICBEZWJ1Zy5hc3NlcnQob3B0aW9ucyk7XG5cbiAgICAgICAgY29uc3QgZ2V0RGVmaW5lcyA9IChncHUsIGdsMiwgZ2wxLCBpc1ZlcnRleCkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBkZXZpY2VJbnRybyA9IGRldmljZS5pc1dlYkdQVSA/IGdwdSA6XG4gICAgICAgICAgICAgICAgKGRldmljZS53ZWJnbDIgPyBnbDIgOiBTaGFkZXJVdGlscy5nbDFFeHRlbnNpb25zKGRldmljZSwgb3B0aW9ucykgKyBnbDEpO1xuXG4gICAgICAgICAgICAvLyBhIGRlZmluZSBwZXIgc3VwcG9ydGVkIGNvbG9yIGF0dGFjaG1lbnQsIHdoaWNoIHN0cmlwcyBvdXQgdW5zdXBwb3J0ZWQgb3V0cHV0IGRlZmluaXRpb25zIGluIHRoZSBkZXZpY2VJbnRyb1xuICAgICAgICAgICAgbGV0IGF0dGFjaG1lbnRzRGVmaW5lID0gJyc7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRldmljZS5tYXhDb2xvckF0dGFjaG1lbnRzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBhdHRhY2htZW50c0RlZmluZSArPSBgI2RlZmluZSBDT0xPUl9BVFRBQ0hNRU5UXyR7aX1cXG5gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYXR0YWNobWVudHNEZWZpbmUgKyBkZXZpY2VJbnRybztcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBuYW1lID0gb3B0aW9ucy5uYW1lID8/ICdVbnRpdGxlZCc7XG5cbiAgICAgICAgLy8gdmVydGV4IGNvZGVcbiAgICAgICAgY29uc3QgdmVydERlZmluZXMgPSBvcHRpb25zLnZlcnRleERlZmluZXMgfHwgZ2V0RGVmaW5lcyh3ZWJncHVWUywgZ2xlczNWUywgJycsIHRydWUpO1xuICAgICAgICBjb25zdCB2ZXJ0Q29kZSA9IFNoYWRlclV0aWxzLnZlcnNpb25Db2RlKGRldmljZSkgK1xuICAgICAgICAgICAgdmVydERlZmluZXMgK1xuICAgICAgICAgICAgc2hhcmVkRlMgK1xuICAgICAgICAgICAgU2hhZGVyVXRpbHMuZ2V0U2hhZGVyTmFtZUNvZGUobmFtZSkgK1xuICAgICAgICAgICAgb3B0aW9ucy52ZXJ0ZXhDb2RlO1xuXG4gICAgICAgIC8vIGZyYWdtZW50IGNvZGVcbiAgICAgICAgY29uc3QgZnJhZ0RlZmluZXMgPSBvcHRpb25zLmZyYWdtZW50RGVmaW5lcyB8fCBnZXREZWZpbmVzKHdlYmdwdUZTLCBnbGVzM0ZTLCBnbGVzMkZTLCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IGZyYWdDb2RlID0gKG9wdGlvbnMuZnJhZ21lbnRQcmVhbWJsZSB8fCAnJykgK1xuICAgICAgICAgICAgU2hhZGVyVXRpbHMudmVyc2lvbkNvZGUoZGV2aWNlKSArXG4gICAgICAgICAgICBmcmFnRGVmaW5lcyArXG4gICAgICAgICAgICBTaGFkZXJVdGlscy5wcmVjaXNpb25Db2RlKGRldmljZSkgKyAnXFxuJyArXG4gICAgICAgICAgICBzaGFyZWRGUyArXG4gICAgICAgICAgICBTaGFkZXJVdGlscy5nZXRTaGFkZXJOYW1lQ29kZShuYW1lKSArXG4gICAgICAgICAgICAob3B0aW9ucy5mcmFnbWVudENvZGUgfHwgU2hhZGVyVXRpbHMuZHVtbXlGcmFnbWVudENvZGUoKSk7XG5cbiAgICAgICAgLy8gYXR0cmlidXRlc1xuICAgICAgICBjb25zdCBhdHRyaWJzID0gb3B0aW9ucy5hdHRyaWJ1dGVzID8/IFNoYWRlclV0aWxzLmNvbGxlY3RBdHRyaWJ1dGVzKG9wdGlvbnMudmVydGV4Q29kZSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJzLFxuICAgICAgICAgICAgdnNoYWRlcjogdmVydENvZGUsXG4gICAgICAgICAgICBmc2hhZGVyOiBmcmFnQ29kZSxcbiAgICAgICAgICAgIHVzZVRyYW5zZm9ybUZlZWRiYWNrOiBvcHRpb25zLnVzZVRyYW5zZm9ybUZlZWRiYWNrXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gU3BlY3RvckpTIGludGVncmF0aW9uXG4gICAgc3RhdGljIGdldFNoYWRlck5hbWVDb2RlKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGAjZGVmaW5lIFNIQURFUl9OQU1FICR7bmFtZX1cXG5gO1xuICAgIH1cblxuICAgIHN0YXRpYyBnbDFFeHRlbnNpb25zKGRldmljZSwgb3B0aW9ucywgaXNWZXJ0ZXgpIHtcbiAgICAgICAgbGV0IGNvZGU7XG4gICAgICAgIGlmIChpc1ZlcnRleCkge1xuICAgICAgICAgICAgY29kZSA9IG9wdGlvbnMudmVydGV4RXh0ZW5zaW9ucyA/IGAke29wdGlvbnMudmVydGV4RXh0ZW5zaW9uc31cXG5gIDogJyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb2RlID0gb3B0aW9ucy5mcmFnbWVudEV4dGVuc2lvbnMgPyBgJHtvcHRpb25zLmZyYWdtZW50RXh0ZW5zaW9uc31cXG5gIDogJyc7XG5cbiAgICAgICAgICAgIC8vIGV4dGVuc2lvbnMgdXNlZCBieSBkZWZhdWx0XG4gICAgICAgICAgICBpZiAoZGV2aWNlLmV4dFN0YW5kYXJkRGVyaXZhdGl2ZXMpIHtcbiAgICAgICAgICAgICAgICBjb2RlICs9IFwiI2V4dGVuc2lvbiBHTF9PRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMgOiBlbmFibGVcXG5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZXZpY2UuZXh0VGV4dHVyZUxvZCkge1xuICAgICAgICAgICAgICAgIGNvZGUgKz0gXCIjZXh0ZW5zaW9uIEdMX0VYVF9zaGFkZXJfdGV4dHVyZV9sb2QgOiBlbmFibGVcXG5cIjtcbiAgICAgICAgICAgICAgICBjb2RlICs9IFwiI2RlZmluZSBTVVBQT1JUU19URVhMT0RcXG5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZXZpY2UuZXh0RHJhd0J1ZmZlcnMpIHtcbiAgICAgICAgICAgICAgICBjb2RlICs9IFwiI2V4dGVuc2lvbiBHTF9FWFRfZHJhd19idWZmZXJzIDogcmVxdWlyZVxcblwiO1xuICAgICAgICAgICAgICAgIGNvZGUgKz0gXCIjZGVmaW5lIFNVUFBPUlRTX01SVFxcblwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgfVxuXG4gICAgc3RhdGljIGR1bW15RnJhZ21lbnRDb2RlKCkge1xuICAgICAgICByZXR1cm4gXCJ2b2lkIG1haW4odm9pZCkge2dsX0ZyYWdDb2xvciA9IHZlYzQoMC4wKTt9XCI7XG4gICAgfVxuXG4gICAgc3RhdGljIHZlcnNpb25Db2RlKGRldmljZSkge1xuICAgICAgICBpZiAoZGV2aWNlLmlzV2ViR1BVKSB7XG4gICAgICAgICAgICByZXR1cm4gJyN2ZXJzaW9uIDQ1MFxcbic7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRldmljZS53ZWJnbDIgPyBcIiN2ZXJzaW9uIDMwMCBlc1xcblwiIDogXCJcIjtcbiAgICB9XG5cbiAgICBzdGF0aWMgcHJlY2lzaW9uQ29kZShkZXZpY2UsIGZvcmNlUHJlY2lzaW9uKSB7XG5cbiAgICAgICAgbGV0IGNvZGUgPSAnJztcblxuICAgICAgICBpZiAoZm9yY2VQcmVjaXNpb24gJiYgZm9yY2VQcmVjaXNpb24gIT09ICdoaWdocCcgJiYgZm9yY2VQcmVjaXNpb24gIT09ICdtZWRpdW1wJyAmJiBmb3JjZVByZWNpc2lvbiAhPT0gJ2xvd3AnKSB7XG4gICAgICAgICAgICBmb3JjZVByZWNpc2lvbiA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZm9yY2VQcmVjaXNpb24pIHtcbiAgICAgICAgICAgIGlmIChmb3JjZVByZWNpc2lvbiA9PT0gJ2hpZ2hwJyAmJiBkZXZpY2UubWF4UHJlY2lzaW9uICE9PSAnaGlnaHAnKSB7XG4gICAgICAgICAgICAgICAgZm9yY2VQcmVjaXNpb24gPSAnbWVkaXVtcCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZm9yY2VQcmVjaXNpb24gPT09ICdtZWRpdW1wJyAmJiBkZXZpY2UubWF4UHJlY2lzaW9uID09PSAnbG93cCcpIHtcbiAgICAgICAgICAgICAgICBmb3JjZVByZWNpc2lvbiA9ICdsb3dwJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IGZvcmNlUHJlY2lzaW9uID8gZm9yY2VQcmVjaXNpb24gOiBkZXZpY2UucHJlY2lzaW9uO1xuXG4gICAgICAgIGlmICghZGV2aWNlLmlzV2ViR1BVKSB7XG5cbiAgICAgICAgICAgIGNvZGUgPSBgcHJlY2lzaW9uICR7cHJlY2lzaW9ufSBmbG9hdDtcXG5gO1xuXG4gICAgICAgICAgICBpZiAoZGV2aWNlLndlYmdsMikge1xuICAgICAgICAgICAgICAgIGNvZGUgKz0gYHByZWNpc2lvbiAke3ByZWNpc2lvbn0gc2FtcGxlcjJEU2hhZG93O1xcbmA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHsgLy8gV2ViR1BVXG5cbiAgICAgICAgICAgIGNvZGUgPSBgcHJlY2lzaW9uICR7cHJlY2lzaW9ufSBmbG9hdDtcXG5wcmVjaXNpb24gJHtwcmVjaXNpb259IGludDtcXG5gO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvZGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCB0aGUgYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gYSB2ZXJ0ZXggc2hhZGVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZzQ29kZSAtIFRoZSB2ZXJ0ZXggc2hhZGVyIGNvZGUuXG4gICAgICogQHJldHVybnMge09iamVjdDxzdHJpbmcsIHN0cmluZz59IFRoZSBhdHRyaWJ1dGUgbmFtZSB0byBzZW1hbnRpYyBtYXAuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIHN0YXRpYyBjb2xsZWN0QXR0cmlidXRlcyh2c0NvZGUpIHtcbiAgICAgICAgY29uc3QgYXR0cmlicyA9IHt9O1xuICAgICAgICBsZXQgYXR0cnMgPSAwO1xuXG4gICAgICAgIGxldCBmb3VuZCA9IHZzQ29kZS5pbmRleE9mKFwiYXR0cmlidXRlXCIpO1xuICAgICAgICB3aGlsZSAoZm91bmQgPj0gMCkge1xuICAgICAgICAgICAgaWYgKGZvdW5kID4gMCAmJiB2c0NvZGVbZm91bmQgLSAxXSA9PT0gXCIvXCIpIGJyZWFrO1xuICAgICAgICAgICAgY29uc3QgZW5kT2ZMaW5lID0gdnNDb2RlLmluZGV4T2YoJzsnLCBmb3VuZCk7XG4gICAgICAgICAgICBjb25zdCBzdGFydE9mQXR0cmliTmFtZSA9IHZzQ29kZS5sYXN0SW5kZXhPZignICcsIGVuZE9mTGluZSk7XG4gICAgICAgICAgICBjb25zdCBhdHRyaWJOYW1lID0gdnNDb2RlLnN1YnN0cmluZyhzdGFydE9mQXR0cmliTmFtZSArIDEsIGVuZE9mTGluZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNlbWFudGljID0gX2F0dHJpYjJTZW1hbnRpY1thdHRyaWJOYW1lXTtcbiAgICAgICAgICAgIGlmIChzZW1hbnRpYyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYXR0cmlic1thdHRyaWJOYW1lXSA9IHNlbWFudGljO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJzW2F0dHJpYk5hbWVdID0gXCJBVFRSXCIgKyBhdHRycztcbiAgICAgICAgICAgICAgICBhdHRycysrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3VuZCA9IHZzQ29kZS5pbmRleE9mKFwiYXR0cmlidXRlXCIsIGZvdW5kICsgMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXR0cmlicztcbiAgICB9XG59XG5cbmV4cG9ydCB7IFNoYWRlclV0aWxzIH07XG4iXSwibmFtZXMiOlsiX2F0dHJpYjJTZW1hbnRpYyIsInZlcnRleF9wb3NpdGlvbiIsIlNFTUFOVElDX1BPU0lUSU9OIiwidmVydGV4X25vcm1hbCIsIlNFTUFOVElDX05PUk1BTCIsInZlcnRleF90YW5nZW50IiwiU0VNQU5USUNfVEFOR0VOVCIsInZlcnRleF90ZXhDb29yZDAiLCJTRU1BTlRJQ19URVhDT09SRDAiLCJ2ZXJ0ZXhfdGV4Q29vcmQxIiwiU0VNQU5USUNfVEVYQ09PUkQxIiwidmVydGV4X3RleENvb3JkMiIsIlNFTUFOVElDX1RFWENPT1JEMiIsInZlcnRleF90ZXhDb29yZDMiLCJTRU1BTlRJQ19URVhDT09SRDMiLCJ2ZXJ0ZXhfdGV4Q29vcmQ0IiwiU0VNQU5USUNfVEVYQ09PUkQ0IiwidmVydGV4X3RleENvb3JkNSIsIlNFTUFOVElDX1RFWENPT1JENSIsInZlcnRleF90ZXhDb29yZDYiLCJTRU1BTlRJQ19URVhDT09SRDYiLCJ2ZXJ0ZXhfdGV4Q29vcmQ3IiwiU0VNQU5USUNfVEVYQ09PUkQ3IiwidmVydGV4X2NvbG9yIiwiU0VNQU5USUNfQ09MT1IiLCJ2ZXJ0ZXhfYm9uZUluZGljZXMiLCJTRU1BTlRJQ19CTEVORElORElDRVMiLCJ2ZXJ0ZXhfYm9uZVdlaWdodHMiLCJTRU1BTlRJQ19CTEVORFdFSUdIVCIsIlNoYWRlclV0aWxzIiwiY3JlYXRlRGVmaW5pdGlvbiIsImRldmljZSIsIm9wdGlvbnMiLCJfb3B0aW9ucyRuYW1lIiwiX29wdGlvbnMkYXR0cmlidXRlcyIsIkRlYnVnIiwiYXNzZXJ0IiwiZ2V0RGVmaW5lcyIsImdwdSIsImdsMiIsImdsMSIsImlzVmVydGV4IiwiZGV2aWNlSW50cm8iLCJpc1dlYkdQVSIsIndlYmdsMiIsImdsMUV4dGVuc2lvbnMiLCJhdHRhY2htZW50c0RlZmluZSIsImkiLCJtYXhDb2xvckF0dGFjaG1lbnRzIiwibmFtZSIsInZlcnREZWZpbmVzIiwidmVydGV4RGVmaW5lcyIsIndlYmdwdVZTIiwiZ2xlczNWUyIsInZlcnRDb2RlIiwidmVyc2lvbkNvZGUiLCJzaGFyZWRGUyIsImdldFNoYWRlck5hbWVDb2RlIiwidmVydGV4Q29kZSIsImZyYWdEZWZpbmVzIiwiZnJhZ21lbnREZWZpbmVzIiwid2ViZ3B1RlMiLCJnbGVzM0ZTIiwiZ2xlczJGUyIsImZyYWdDb2RlIiwiZnJhZ21lbnRQcmVhbWJsZSIsInByZWNpc2lvbkNvZGUiLCJmcmFnbWVudENvZGUiLCJkdW1teUZyYWdtZW50Q29kZSIsImF0dHJpYnMiLCJhdHRyaWJ1dGVzIiwiY29sbGVjdEF0dHJpYnV0ZXMiLCJ2c2hhZGVyIiwiZnNoYWRlciIsInVzZVRyYW5zZm9ybUZlZWRiYWNrIiwiY29kZSIsInZlcnRleEV4dGVuc2lvbnMiLCJmcmFnbWVudEV4dGVuc2lvbnMiLCJleHRTdGFuZGFyZERlcml2YXRpdmVzIiwiZXh0VGV4dHVyZUxvZCIsImV4dERyYXdCdWZmZXJzIiwiZm9yY2VQcmVjaXNpb24iLCJtYXhQcmVjaXNpb24iLCJwcmVjaXNpb24iLCJ2c0NvZGUiLCJhdHRycyIsImZvdW5kIiwiaW5kZXhPZiIsImVuZE9mTGluZSIsInN0YXJ0T2ZBdHRyaWJOYW1lIiwibGFzdEluZGV4T2YiLCJhdHRyaWJOYW1lIiwic3Vic3RyaW5nIiwic2VtYW50aWMiLCJ1bmRlZmluZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWNBLE1BQU1BLGdCQUFnQixHQUFHO0FBQ3JCQyxFQUFBQSxlQUFlLEVBQUVDLGlCQUFpQjtBQUNsQ0MsRUFBQUEsYUFBYSxFQUFFQyxlQUFlO0FBQzlCQyxFQUFBQSxjQUFjLEVBQUVDLGdCQUFnQjtBQUNoQ0MsRUFBQUEsZ0JBQWdCLEVBQUVDLGtCQUFrQjtBQUNwQ0MsRUFBQUEsZ0JBQWdCLEVBQUVDLGtCQUFrQjtBQUNwQ0MsRUFBQUEsZ0JBQWdCLEVBQUVDLGtCQUFrQjtBQUNwQ0MsRUFBQUEsZ0JBQWdCLEVBQUVDLGtCQUFrQjtBQUNwQ0MsRUFBQUEsZ0JBQWdCLEVBQUVDLGtCQUFrQjtBQUNwQ0MsRUFBQUEsZ0JBQWdCLEVBQUVDLGtCQUFrQjtBQUNwQ0MsRUFBQUEsZ0JBQWdCLEVB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
