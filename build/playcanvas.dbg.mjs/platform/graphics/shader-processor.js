/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { uniformTypeToName, UNIFORM_BUFFER_DEFAULT_SLOT_NAME, SHADERSTAGE_VERTEX, SHADERSTAGE_FRAGMENT, BINDGROUP_MESH, semanticToLocation, TEXTUREDIMENSION_2D, TEXTUREDIMENSION_3D, TEXTUREDIMENSION_CUBE, TEXTUREDIMENSION_2D_ARRAY, SAMPLETYPE_FLOAT, SAMPLETYPE_UNFILTERABLE_FLOAT, SAMPLETYPE_DEPTH } from './constants.js';
import { UniformFormat, UniformBufferFormat } from './uniform-buffer-format.js';
import { BindBufferFormat, BindTextureFormat, BindGroupFormat } from './bind-group-format.js';

const KEYWORD = /[ \t]*(\battribute\b|\bvarying\b|\buniform\b)/g;

const KEYWORD_LINE = /(\battribute\b|\bvarying\b|\bout\b|\buniform\b)[ \t]*([^;]+)([;]+)/g;

const MARKER = '@@@';
const precisionQualifiers = new Set(['highp', 'mediump', 'lowp']);
const shadowSamplers = new Set(['sampler2DShadow', 'samplerCubeShadow']);
const textureDimensions = {
  sampler2D: TEXTUREDIMENSION_2D,
  sampler3D: TEXTUREDIMENSION_3D,
  samplerCube: TEXTUREDIMENSION_CUBE,
  samplerCubeShadow: TEXTUREDIMENSION_CUBE,
  sampler2DShadow: TEXTUREDIMENSION_2D,
  sampler2DArray: TEXTUREDIMENSION_2D_ARRAY,
  sampler2DArrayShadow: TEXTUREDIMENSION_2D_ARRAY
};
class UniformLine {
  constructor(line) {
    this.line = line;

    const words = line.trim().split(/\s+/);
    this.precision = undefined;
    this.type = words[0];
    this.name = words[1];

    if (precisionQualifiers.has(this.type)) {
      this.precision = words[0];
      this.type = words[1];
      this.name = words[2];
    }
    this.isSampler = this.type.indexOf('sampler') !== -1;
  }
}

class ShaderProcessor {
  static run(device, shaderDefinition, shader) {
    const varyingMap = new Map();

    const vertexExtracted = ShaderProcessor.extract(shaderDefinition.vshader);
    const fragmentExtracted = ShaderProcessor.extract(shaderDefinition.fshader);

    const attributesBlock = ShaderProcessor.processAttributes(vertexExtracted.attributes, shaderDefinition.attributes);

    const vertexVaryingsBlock = ShaderProcessor.processVaryings(vertexExtracted.varyings, varyingMap, true);

    const fragmentVaryingsBlock = ShaderProcessor.processVaryings(fragmentExtracted.varyings, varyingMap, false);

    const outBlock = ShaderProcessor.processOuts(fragmentExtracted.outs);

    const concatUniforms = vertexExtracted.uniforms.concat(fragmentExtracted.uniforms);
    const uniforms = Array.from(new Set(concatUniforms));

    const parsedUniforms = uniforms.map(line => new UniformLine(line));

    Debug.call(() => {
      const map = new Map();
      parsedUniforms.forEach(uni => {
        const existing = map.get(uni.name);
        Debug.assert(!existing, `Vertex and fragment shaders cannot use the same uniform name with different types: '${existing}' and '${uni.line}'`, shader);
        map.set(uni.name, uni.line);
      });
    });
    const uniformsData = ShaderProcessor.processUniforms(device, parsedUniforms, shaderDefinition.processingOptions);

    const vBlock = attributesBlock + '\n' + vertexVaryingsBlock + '\n' + uniformsData.code;
    const vshader = vertexExtracted.src.replace(MARKER, vBlock);

    const fBlock = fragmentVaryingsBlock + '\n' + outBlock + '\n' + uniformsData.code;
    const fshader = fragmentExtracted.src.replace(MARKER, fBlock);
    return {
      vshader: vshader,
      fshader: fshader,
      meshUniformBufferFormat: uniformsData.meshUniformBufferFormat,
      meshBindGroupFormat: uniformsData.meshBindGroupFormat
    };
  }

  static extract(src) {
    const attributes = [];
    const varyings = [];
    const outs = [];
    const uniforms = [];

    let replacement = `${MARKER}\n`;

    let match;
    while ((match = KEYWORD.exec(src)) !== null) {
      const keyword = match[1];
      switch (keyword) {
        case 'attribute':
        case 'varying':
        case 'uniform':
        case 'out':
          {
            KEYWORD_LINE.lastIndex = match.index;
            const lineMatch = KEYWORD_LINE.exec(src);
            if (keyword === 'attribute') {
              attributes.push(lineMatch[2]);
            } else if (keyword === 'varying') {
              varyings.push(lineMatch[2]);
            } else if (keyword === 'out') {
              outs.push(lineMatch[2]);
            } else if (keyword === 'uniform') {
              uniforms.push(lineMatch[2]);
            }

            src = ShaderProcessor.cutOut(src, match.index, KEYWORD_LINE.lastIndex, replacement);
            KEYWORD.lastIndex = match.index + replacement.length;

            replacement = '';
            break;
          }
      }
    }
    return {
      src,
      attributes,
      varyings,
      outs,
      uniforms
    };
  }

  static processUniforms(device, uniforms, processingOptions) {
    const uniformLinesSamplers = [];
    const uniformLinesNonSamplers = [];
    uniforms.forEach(uniform => {
      if (uniform.isSampler) {
        uniformLinesSamplers.push(uniform);
      } else {
        uniformLinesNonSamplers.push(uniform);
      }
    });

    const meshUniforms = [];
    uniformLinesNonSamplers.forEach(uniform => {
      if (!processingOptions.hasUniform(uniform.name)) {
        const uniformType = uniformTypeToName.indexOf(uniform.type);
        Debug.assert(uniformType >= 0, `Uniform type ${uniform.type} is not recognized on line [${uniform.line}]`);
        const uniformFormat = new UniformFormat(uniform.name, uniformType);
        meshUniforms.push(uniformFormat);
      }

    });

    const meshUniformBufferFormat = meshUniforms.length ? new UniformBufferFormat(device, meshUniforms) : null;

    const bufferFormats = [];
    if (meshUniformBufferFormat) {
      bufferFormats.push(new BindBufferFormat(UNIFORM_BUFFER_DEFAULT_SLOT_NAME, SHADERSTAGE_VERTEX | SHADERSTAGE_FRAGMENT));
    }

    const textureFormats = [];
    uniformLinesSamplers.forEach(uniform => {
      if (!processingOptions.hasTexture(uniform.name)) {
        let sampleType = SAMPLETYPE_FLOAT;
        if (uniform.precision === 'highp') sampleType = SAMPLETYPE_UNFILTERABLE_FLOAT;
        if (shadowSamplers.has(uniform.type)) sampleType = SAMPLETYPE_DEPTH;

        const dimension = textureDimensions[uniform.type];

        textureFormats.push(new BindTextureFormat(uniform.name, SHADERSTAGE_VERTEX | SHADERSTAGE_FRAGMENT, dimension, sampleType));
      }

    });

    const meshBindGroupFormat = new BindGroupFormat(device, bufferFormats, textureFormats);

    let code = '';
    processingOptions.uniformFormats.forEach((format, bindGroupIndex) => {
      if (format) {
        code += format.getShaderDeclaration(bindGroupIndex, 0);
      }
    });

    code += meshUniformBufferFormat.getShaderDeclaration(BINDGROUP_MESH, 0);

    processingOptions.bindGroupFormats.forEach((format, bindGroupIndex) => {
      if (format) {
        code += format.getShaderDeclarationTextures(bindGroupIndex);
      }
    });

    code += meshBindGroupFormat.getShaderDeclarationTextures(BINDGROUP_MESH);
    return {
      code,
      meshUniformBufferFormat,
      meshBindGroupFormat
    };
  }
  static processVaryings(varyingLines, varyingMap, isVertex) {
    let block = '';
    const op = isVertex ? 'out' : 'in';
    varyingLines.forEach((line, index) => {
      const words = ShaderProcessor.splitToWords(line);
      const type = words[0];
      const name = words[1];
      if (isVertex) {
        varyingMap.set(name, index);
      } else {
        Debug.assert(varyingMap.has(name), `Fragment shader requires varying [${name}] but vertex shader does not generate it.`);
        index = varyingMap.get(name);
      }

      block += `layout(location = ${index}) ${op} ${type} ${name};\n`;
    });
    return block;
  }
  static processOuts(outsLines) {
    let block = '';
    outsLines.forEach((line, index) => {
      block += `layout(location = ${index}) out ${line};\n`;
    });
    return block;
  }
  static processAttributes(attributeLines, shaderDefinitionAttributes) {
    let block = '';
    const usedLocations = {};
    attributeLines.forEach(line => {
      const words = ShaderProcessor.splitToWords(line);
      const type = words[0];
      const name = words[1];
      if (shaderDefinitionAttributes.hasOwnProperty(name)) {
        const semantic = shaderDefinitionAttributes[name];
        const location = semanticToLocation[semantic];
        Debug.assert(!usedLocations.hasOwnProperty(location), `WARNING: Two vertex attributes are mapped to the same location in a shader: ${usedLocations[location]} and ${semantic}`);
        usedLocations[location] = semantic;

        block += `layout(location = ${location}) in ${type} ${name};\n`;
      }
    });
    return block;
  }
  static splitToWords(line) {
    line = line.replace(/\s+/g, ' ').trim();
    return line.split(' ');
  }
  static cutOut(src, start, end, replacement) {
    return src.substring(0, start) + replacement + src.substring(end);
  }
}

export { ShaderProcessor };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZGVyLXByb2Nlc3Nvci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2dyYXBoaWNzL3NoYWRlci1wcm9jZXNzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7XG4gICAgQklOREdST1VQX01FU0gsIHVuaWZvcm1UeXBlVG9OYW1lLCBzZW1hbnRpY1RvTG9jYXRpb24sXG4gICAgU0hBREVSU1RBR0VfVkVSVEVYLCBTSEFERVJTVEFHRV9GUkFHTUVOVCxcbiAgICBVTklGT1JNX0JVRkZFUl9ERUZBVUxUX1NMT1RfTkFNRSxcbiAgICBTQU1QTEVUWVBFX0ZMT0FULCBTQU1QTEVUWVBFX0RFUFRILCBTQU1QTEVUWVBFX1VORklMVEVSQUJMRV9GTE9BVCxcbiAgICBURVhUVVJFRElNRU5TSU9OXzJELCBURVhUVVJFRElNRU5TSU9OXzJEX0FSUkFZLCBURVhUVVJFRElNRU5TSU9OX0NVQkUsIFRFWFRVUkVESU1FTlNJT05fM0Rcbn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVW5pZm9ybUZvcm1hdCwgVW5pZm9ybUJ1ZmZlckZvcm1hdCB9IGZyb20gJy4vdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzJztcbmltcG9ydCB7IEJpbmRHcm91cEZvcm1hdCwgQmluZEJ1ZmZlckZvcm1hdCwgQmluZFRleHR1cmVGb3JtYXQgfSBmcm9tICcuL2JpbmQtZ3JvdXAtZm9ybWF0LmpzJztcblxuLy8gYWNjZXB0ZWQga2V5d29yZHNcbi8vIFRPRE86ICdvdXQnIGtleXdvcmQgaXMgbm90IGluIHRoZSBsaXN0LCBhcyBoYW5kbGluZyBpdCBpcyBtb3JlIGNvbXBsaWNhdGVkIGR1ZVxuLy8gdG8gJ291dCcga2V5d29yZCBhbHNvIGJlaW5nIHVzZWQgdG8gbWFyayBvdXRwdXQgb25seSBmdW5jdGlvbiBwYXJhbWV0ZXJzLlxuY29uc3QgS0VZV09SRCA9IC9bIFxcdF0qKFxcYmF0dHJpYnV0ZVxcYnxcXGJ2YXJ5aW5nXFxifFxcYnVuaWZvcm1cXGIpL2c7XG5cbi8vIG1hdGNoICdhdHRyaWJ1dGUnIGFuZCBhbnl0aGluZyBlbHNlIHRpbGwgJzsnXG5jb25zdCBLRVlXT1JEX0xJTkUgPSAvKFxcYmF0dHJpYnV0ZVxcYnxcXGJ2YXJ5aW5nXFxifFxcYm91dFxcYnxcXGJ1bmlmb3JtXFxiKVsgXFx0XSooW147XSspKFs7XSspL2c7XG5cbi8vIG1hcmtlciBmb3IgYSBwbGFjZSBpbiB0aGUgc291cmNlIGNvZGUgdG8gYmUgcmVwbGFjZWQgYnkgY29kZVxuY29uc3QgTUFSS0VSID0gJ0BAQCc7XG5cbmNvbnN0IHByZWNpc2lvblF1YWxpZmllcnMgPSBuZXcgU2V0KFsnaGlnaHAnLCAnbWVkaXVtcCcsICdsb3dwJ10pO1xuY29uc3Qgc2hhZG93U2FtcGxlcnMgPSBuZXcgU2V0KFsnc2FtcGxlcjJEU2hhZG93JywgJ3NhbXBsZXJDdWJlU2hhZG93J10pO1xuY29uc3QgdGV4dHVyZURpbWVuc2lvbnMgPSB7XG4gICAgc2FtcGxlcjJEOiBURVhUVVJFRElNRU5TSU9OXzJELFxuICAgIHNhbXBsZXIzRDogVEVYVFVSRURJTUVOU0lPTl8zRCxcbiAgICBzYW1wbGVyQ3ViZTogVEVYVFVSRURJTUVOU0lPTl9DVUJFLFxuICAgIHNhbXBsZXJDdWJlU2hhZG93OiBURVhUVVJFRElNRU5TSU9OX0NVQkUsXG4gICAgc2FtcGxlcjJEU2hhZG93OiBURVhUVVJFRElNRU5TSU9OXzJELFxuICAgIHNhbXBsZXIyREFycmF5OiBURVhUVVJFRElNRU5TSU9OXzJEX0FSUkFZLFxuICAgIHNhbXBsZXIyREFycmF5U2hhZG93OiBURVhUVVJFRElNRU5TSU9OXzJEX0FSUkFZXG59O1xuXG5jbGFzcyBVbmlmb3JtTGluZSB7XG4gICAgY29uc3RydWN0b3IobGluZSkge1xuICAgICAgICB0aGlzLmxpbmUgPSBsaW5lO1xuXG4gICAgICAgIC8vIHNwbGl0IHRvIHdvcmRzIGhhbmRsaW5nIGFueSBudW1iZXIgb2Ygc3BhY2VzXG4gICAgICAgIGNvbnN0IHdvcmRzID0gbGluZS50cmltKCkuc3BsaXQoL1xccysvKTtcblxuICAgICAgICB0aGlzLnByZWNpc2lvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50eXBlID0gd29yZHNbMF07XG4gICAgICAgIHRoaXMubmFtZSA9IHdvcmRzWzFdO1xuXG4gICAgICAgIC8vIGlmIHRoaXMgaXMgYSBwcmVjaXNpb24gcXVhbGlmaWVyXG4gICAgICAgIGlmIChwcmVjaXNpb25RdWFsaWZpZXJzLmhhcyh0aGlzLnR5cGUpKSB7XG4gICAgICAgICAgICB0aGlzLnByZWNpc2lvbiA9IHdvcmRzWzBdO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gd29yZHNbMV07XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSB3b3Jkc1syXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaXNTYW1wbGVyID0gdGhpcy50eXBlLmluZGV4T2YoJ3NhbXBsZXInKSAhPT0gLTE7XG4gICAgfVxufVxuXG4vKipcbiAqIFB1cmUgc3RhdGljIGNsYXNzIGltcGxlbWVudGluZyBwcm9jZXNzaW5nIG9mIEdMU0wgc2hhZGVycy4gSXQgYWxsb2NhdGVzIGZpeGVkIGxvY2F0aW9ucyBmb3JcbiAqIGF0dHJpYnV0ZXMsIGFuZCBoYW5kbGVzIGNvbnZlcnNpb24gb2YgdW5pZm9ybXMgdG8gdW5pZm9ybSBidWZmZXJzLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgU2hhZGVyUHJvY2Vzc29yIHtcbiAgICAvKipcbiAgICAgKiBQcm9jZXNzIHRoZSBzaGFkZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9ncmFwaGljcy1kZXZpY2UuanMnKS5HcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlIGdyYXBoaWNzIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gc2hhZGVyRGVmaW5pdGlvbiAtIFRoZSBzaGFkZXIgZGVmaW5pdGlvbi5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9zaGFkZXIuanMnKS5TaGFkZXJ9IHNoYWRlciAtIFRoZSBzaGFkZXIgZGVmaW5pdGlvbi5cbiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSAtIFRoZSBwcm9jZXNzZWQgc2hhZGVyIGRhdGEuXG4gICAgICovXG4gICAgc3RhdGljIHJ1bihkZXZpY2UsIHNoYWRlckRlZmluaXRpb24sIHNoYWRlcikge1xuXG4gICAgICAgIC8qKiBAdHlwZSB7TWFwPHN0cmluZywgbnVtYmVyPn0gKi9cbiAgICAgICAgY29uc3QgdmFyeWluZ01hcCA9IG5ldyBNYXAoKTtcblxuICAgICAgICAvLyBleHRyYWN0IGxpbmVzIG9mIGludGVyZXN0cyBmcm9tIGJvdGggc2hhZGVyc1xuICAgICAgICBjb25zdCB2ZXJ0ZXhFeHRyYWN0ZWQgPSBTaGFkZXJQcm9jZXNzb3IuZXh0cmFjdChzaGFkZXJEZWZpbml0aW9uLnZzaGFkZXIpO1xuICAgICAgICBjb25zdCBmcmFnbWVudEV4dHJhY3RlZCA9IFNoYWRlclByb2Nlc3Nvci5leHRyYWN0KHNoYWRlckRlZmluaXRpb24uZnNoYWRlcik7XG5cbiAgICAgICAgLy8gVlMgLSBjb252ZXJ0IGEgbGlzdCBvZiBhdHRyaWJ1dGVzIHRvIGEgc2hhZGVyIGJsb2NrIHdpdGggZml4ZWQgbG9jYXRpb25zXG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXNCbG9jayA9IFNoYWRlclByb2Nlc3Nvci5wcm9jZXNzQXR0cmlidXRlcyh2ZXJ0ZXhFeHRyYWN0ZWQuYXR0cmlidXRlcywgc2hhZGVyRGVmaW5pdGlvbi5hdHRyaWJ1dGVzKTtcblxuICAgICAgICAvLyBWUyAtIGNvbnZlcnQgYSBsaXN0IG9mIHZhcnlpbmdzIHRvIGEgc2hhZGVyIGJsb2NrXG4gICAgICAgIGNvbnN0IHZlcnRleFZhcnlpbmdzQmxvY2sgPSBTaGFkZXJQcm9jZXNzb3IucHJvY2Vzc1ZhcnlpbmdzKHZlcnRleEV4dHJhY3RlZC52YXJ5aW5ncywgdmFyeWluZ01hcCwgdHJ1ZSk7XG5cbiAgICAgICAgLy8gRlMgLSBjb252ZXJ0IGEgbGlzdCBvZiB2YXJ5aW5ncyB0byBhIHNoYWRlciBibG9ja1xuICAgICAgICBjb25zdCBmcmFnbWVudFZhcnlpbmdzQmxvY2sgPSBTaGFkZXJQcm9jZXNzb3IucHJvY2Vzc1ZhcnlpbmdzKGZyYWdtZW50RXh0cmFjdGVkLnZhcnlpbmdzLCB2YXJ5aW5nTWFwLCBmYWxzZSk7XG5cbiAgICAgICAgLy8gRlMgLSBjb252ZXJ0IGEgbGlzdCBvZiBvdXRwdXRzIHRvIGEgc2hhZGVyIGJsb2NrXG4gICAgICAgIGNvbnN0IG91dEJsb2NrID0gU2hhZGVyUHJvY2Vzc29yLnByb2Nlc3NPdXRzKGZyYWdtZW50RXh0cmFjdGVkLm91dHMpO1xuXG4gICAgICAgIC8vIHVuaWZvcm1zIC0gbWVyZ2UgdmVydGV4IGFuZCBmcmFnbWVudCB1bmlmb3JtcywgYW5kIGNyZWF0ZSBzaGFyZWQgdW5pZm9ybSBidWZmZXJzXG4gICAgICAgIC8vIE5vdGUgdGhhdCBhcyBib3RoIHZlcnRleCBhbmQgZnJhZ21lbnQgY2FuIGRlY2xhcmUgdGhlIHNhbWUgdW5pZm9ybSwgd2UgbmVlZCB0byByZW1vdmUgZHVwbGljYXRlc1xuICAgICAgICBjb25zdCBjb25jYXRVbmlmb3JtcyA9IHZlcnRleEV4dHJhY3RlZC51bmlmb3Jtcy5jb25jYXQoZnJhZ21lbnRFeHRyYWN0ZWQudW5pZm9ybXMpO1xuICAgICAgICBjb25zdCB1bmlmb3JtcyA9IEFycmF5LmZyb20obmV3IFNldChjb25jYXRVbmlmb3JtcykpO1xuXG4gICAgICAgIC8vIHBhcnNlIHVuaWZvcm0gbGluZXNcbiAgICAgICAgY29uc3QgcGFyc2VkVW5pZm9ybXMgPSB1bmlmb3Jtcy5tYXAobGluZSA9PiBuZXcgVW5pZm9ybUxpbmUobGluZSkpO1xuXG4gICAgICAgIC8vIHZhbGlkYXRpb24gLSBhcyB1bmlmb3JtcyBnbyB0byBhIHNoYXJlZCB1bmlmb3JtIGJ1ZmZlciwgdmVydGV4IGFuZCBmcmFnbWVudCB2ZXJzaW9ucyBuZWVkIHRvIG1hdGNoXG4gICAgICAgIERlYnVnLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpO1xuICAgICAgICAgICAgcGFyc2VkVW5pZm9ybXMuZm9yRWFjaCgodW5pKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBtYXAuZ2V0KHVuaS5uYW1lKTtcbiAgICAgICAgICAgICAgICBEZWJ1Zy5hc3NlcnQoIWV4aXN0aW5nLCBgVmVydGV4IGFuZCBmcmFnbWVudCBzaGFkZXJzIGNhbm5vdCB1c2UgdGhlIHNhbWUgdW5pZm9ybSBuYW1lIHdpdGggZGlmZmVyZW50IHR5cGVzOiAnJHtleGlzdGluZ30nIGFuZCAnJHt1bmkubGluZX0nYCwgc2hhZGVyKTtcbiAgICAgICAgICAgICAgICBtYXAuc2V0KHVuaS5uYW1lLCB1bmkubGluZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHVuaWZvcm1zRGF0YSA9IFNoYWRlclByb2Nlc3Nvci5wcm9jZXNzVW5pZm9ybXMoZGV2aWNlLCBwYXJzZWRVbmlmb3Jtcywgc2hhZGVyRGVmaW5pdGlvbi5wcm9jZXNzaW5nT3B0aW9ucyk7XG5cbiAgICAgICAgLy8gVlMgLSBpbnNlcnQgdGhlIGJsb2NrcyB0byB0aGUgc291cmNlXG4gICAgICAgIGNvbnN0IHZCbG9jayA9IGF0dHJpYnV0ZXNCbG9jayArICdcXG4nICsgdmVydGV4VmFyeWluZ3NCbG9jayArICdcXG4nICsgdW5pZm9ybXNEYXRhLmNvZGU7XG4gICAgICAgIGNvbnN0IHZzaGFkZXIgPSB2ZXJ0ZXhFeHRyYWN0ZWQuc3JjLnJlcGxhY2UoTUFSS0VSLCB2QmxvY2spO1xuXG4gICAgICAgIC8vIEZTIC0gaW5zZXJ0IHRoZSBibG9ja3MgdG8gdGhlIHNvdXJjZVxuICAgICAgICBjb25zdCBmQmxvY2sgPSBmcmFnbWVudFZhcnlpbmdzQmxvY2sgKyAnXFxuJyArIG91dEJsb2NrICsgJ1xcbicgKyB1bmlmb3Jtc0RhdGEuY29kZTtcbiAgICAgICAgY29uc3QgZnNoYWRlciA9IGZyYWdtZW50RXh0cmFjdGVkLnNyYy5yZXBsYWNlKE1BUktFUiwgZkJsb2NrKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdnNoYWRlcjogdnNoYWRlcixcbiAgICAgICAgICAgIGZzaGFkZXI6IGZzaGFkZXIsXG4gICAgICAgICAgICBtZXNoVW5pZm9ybUJ1ZmZlckZvcm1hdDogdW5pZm9ybXNEYXRhLm1lc2hVbmlmb3JtQnVmZmVyRm9ybWF0LFxuICAgICAgICAgICAgbWVzaEJpbmRHcm91cEZvcm1hdDogdW5pZm9ybXNEYXRhLm1lc2hCaW5kR3JvdXBGb3JtYXRcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IHJlcXVpcmVkIGluZm9ybWF0aW9uIGZyb20gdGhlIHNoYWRlciBzb3VyY2UgY29kZS5cbiAgICBzdGF0aWMgZXh0cmFjdChzcmMpIHtcblxuICAgICAgICAvLyBjb2xsZWN0ZWQgZGF0YVxuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gW107XG4gICAgICAgIGNvbnN0IHZhcnlpbmdzID0gW107XG4gICAgICAgIGNvbnN0IG91dHMgPSBbXTtcbiAgICAgICAgY29uc3QgdW5pZm9ybXMgPSBbXTtcblxuICAgICAgICAvLyByZXBsYWNlbWVudCBtYXJrZXIgLSBtYXJrIGEgZmlyc3QgcmVwbGFjZW1lbnQgcGxhY2UsIHRoaXMgaXMgd2hlcmUgY29kZVxuICAgICAgICAvLyBibG9ja3MgYXJlIGluamVjdGVkIGxhdGVyXG4gICAgICAgIGxldCByZXBsYWNlbWVudCA9IGAke01BUktFUn1cXG5gO1xuXG4gICAgICAgIC8vIGV4dHJhY3QgcmVsZXZhbnQgcGFydHMgb2YgdGhlIHNoYWRlclxuICAgICAgICBsZXQgbWF0Y2g7XG4gICAgICAgIHdoaWxlICgobWF0Y2ggPSBLRVlXT1JELmV4ZWMoc3JjKSkgIT09IG51bGwpIHtcblxuICAgICAgICAgICAgY29uc3Qga2V5d29yZCA9IG1hdGNoWzFdO1xuICAgICAgICAgICAgc3dpdGNoIChrZXl3b3JkKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYXR0cmlidXRlJzpcbiAgICAgICAgICAgICAgICBjYXNlICd2YXJ5aW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICd1bmlmb3JtJzpcbiAgICAgICAgICAgICAgICBjYXNlICdvdXQnOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVhZCB0aGUgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JEX0xJTkUubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVNYXRjaCA9IEtFWVdPUkRfTElORS5leGVjKHNyYyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleXdvcmQgPT09ICdhdHRyaWJ1dGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2gobGluZU1hdGNoWzJdKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXl3b3JkID09PSAndmFyeWluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcnlpbmdzLnB1c2gobGluZU1hdGNoWzJdKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXl3b3JkID09PSAnb3V0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cy5wdXNoKGxpbmVNYXRjaFsyXSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5d29yZCA9PT0gJ3VuaWZvcm0nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1bmlmb3Jtcy5wdXNoKGxpbmVNYXRjaFsyXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjdXQgaXQgb3V0XG4gICAgICAgICAgICAgICAgICAgIHNyYyA9IFNoYWRlclByb2Nlc3Nvci5jdXRPdXQoc3JjLCBtYXRjaC5pbmRleCwgS0VZV09SRF9MSU5FLmxhc3RJbmRleCwgcmVwbGFjZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IG1hdGNoLmluZGV4ICsgcmVwbGFjZW1lbnQubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgcGxhY2UgYSBzaW5nbGUgcmVwbGFjZW1lbnQgbWFya2VyXG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzcmMsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzLFxuICAgICAgICAgICAgdmFyeWluZ3MsXG4gICAgICAgICAgICBvdXRzLFxuICAgICAgICAgICAgdW5pZm9ybXNcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcm9jZXNzIHRoZSBsaW5lcyB3aXRoIHVuaWZvcm1zLiBUaGUgZnVuY3Rpb24gcmVjZWl2ZXMgdGhlIGxpbmVzIGNvbnRhaW5pbmcgYWxsIHVuaWZvcm1zLFxuICAgICAqIGJvdGggbnVtZXJpY2FsIGFzIHdlbGwgYXMgdGV4dHVyZXMvc2FtcGxlcnMuIFRoZSBmdW5jdGlvbiBhbHNvIHJlY2VpdmVzIHRoZSBmb3JtYXQgb2YgdW5pZm9ybVxuICAgICAqIGJ1ZmZlcnMgKG51bWVyaWNhbCkgYW5kIGJpbmQgZ3JvdXBzICh0ZXh0dXJlcykgZm9yIHZpZXcgYW5kIG1hdGVyaWFsIGxldmVsLiBBbGwgdW5pZm9ybXMgdGhhdFxuICAgICAqIG1hdGNoIGFueSBvZiB0aG9zZSBhcmUgaWdub3JlZCwgYXMgdGhvc2Ugd291bGQgYmUgc3VwcGxpZWQgYnkgdmlldyAvIG1hdGVyaWFsIGxldmVsIGJ1ZmZlcnMuXG4gICAgICogQWxsIGxlZnRvdmVyIHVuaWZvcm1zIGNyZWF0ZSB1bmlmb3JtIGJ1ZmZlciBhbmQgYmluZCBncm91cCBmb3IgdGhlIG1lc2ggaXRzZWxmLCBjb250YWluaW5nXG4gICAgICogdW5pZm9ybXMgdGhhdCBjaGFuZ2Ugb24gdGhlIGxldmVsIG9mIHRoZSBtZXNoLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vZ3JhcGhpY3MtZGV2aWNlLmpzJykuR3JhcGhpY3NEZXZpY2V9IGRldmljZSAtIFRoZSBncmFwaGljcyBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtBcnJheTxVbmlmb3JtTGluZT59IHVuaWZvcm1zIC0gTGluZXMgY29udGFpbmluZyB1bmlmb3Jtcy5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9zaGFkZXItcHJvY2Vzc29yLW9wdGlvbnMuanMnKS5TaGFkZXJQcm9jZXNzb3JPcHRpb25zfSBwcm9jZXNzaW5nT3B0aW9ucyAtXG4gICAgICogVW5pZm9ybSBmb3JtYXRzLlxuICAgICAqIEByZXR1cm5zIHtvYmplY3R9IC0gVGhlIHVuaWZvcm0gZGF0YS4gUmV0dXJucyBhIHNoYWRlciBjb2RlIGJsb2NrIGNvbnRhaW5pbmcgdW5pZm9ybXMsIHRvIGJlXG4gICAgICogaW5zZXJ0ZWQgaW50byB0aGUgc2hhZGVyLCBhcyB3ZWxsIGFzIGdlbmVyYXRlZCB1bmlmb3JtIGZvcm1hdCBzdHJ1Y3R1cmVzIGZvciB0aGUgbWVzaCBsZXZlbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgcHJvY2Vzc1VuaWZvcm1zKGRldmljZSwgdW5pZm9ybXMsIHByb2Nlc3NpbmdPcHRpb25zKSB7XG5cbiAgICAgICAgLy8gc3BsaXQgdW5pZm9ybSBsaW5lcyBpbnRvIHNhbXBsZXJzIGFuZCB0aGUgcmVzdFxuICAgICAgICAvKiogQHR5cGUge0FycmF5PFVuaWZvcm1MaW5lPn0gKi9cbiAgICAgICAgY29uc3QgdW5pZm9ybUxpbmVzU2FtcGxlcnMgPSBbXTtcbiAgICAgICAgLyoqIEB0eXBlIHtBcnJheTxVbmlmb3JtTGluZT59ICovXG4gICAgICAgIGNvbnN0IHVuaWZvcm1MaW5lc05vblNhbXBsZXJzID0gW107XG4gICAgICAgIHVuaWZvcm1zLmZvckVhY2goKHVuaWZvcm0pID0+IHtcbiAgICAgICAgICAgIGlmICh1bmlmb3JtLmlzU2FtcGxlcikge1xuICAgICAgICAgICAgICAgIHVuaWZvcm1MaW5lc1NhbXBsZXJzLnB1c2godW5pZm9ybSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVuaWZvcm1MaW5lc05vblNhbXBsZXJzLnB1c2godW5pZm9ybSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGJ1aWxkIG1lc2ggdW5pZm9ybSBidWZmZXIgZm9ybWF0XG4gICAgICAgIGNvbnN0IG1lc2hVbmlmb3JtcyA9IFtdO1xuICAgICAgICB1bmlmb3JtTGluZXNOb25TYW1wbGVycy5mb3JFYWNoKCh1bmlmb3JtKSA9PiB7XG4gICAgICAgICAgICAvLyB1bmlmb3JtcyBub3QgYWxyZWFkeSBpbiBzdXBwbGllZCB1bmlmb3JtIGJ1ZmZlcnMgZ28gdG8gdGhlIG1lc2ggYnVmZmVyXG4gICAgICAgICAgICBpZiAoIXByb2Nlc3NpbmdPcHRpb25zLmhhc1VuaWZvcm0odW5pZm9ybS5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuaWZvcm1UeXBlID0gdW5pZm9ybVR5cGVUb05hbWUuaW5kZXhPZih1bmlmb3JtLnR5cGUpO1xuICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydCh1bmlmb3JtVHlwZSA+PSAwLCBgVW5pZm9ybSB0eXBlICR7dW5pZm9ybS50eXBlfSBpcyBub3QgcmVjb2duaXplZCBvbiBsaW5lIFske3VuaWZvcm0ubGluZX1dYCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pZm9ybUZvcm1hdCA9IG5ldyBVbmlmb3JtRm9ybWF0KHVuaWZvcm0ubmFtZSwgdW5pZm9ybVR5cGUpO1xuICAgICAgICAgICAgICAgIG1lc2hVbmlmb3Jtcy5wdXNoKHVuaWZvcm1Gb3JtYXQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB2YWxpZGF0ZSB0eXBlcyBpbiBlbHNlXG5cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG1lc2hVbmlmb3JtQnVmZmVyRm9ybWF0ID0gbWVzaFVuaWZvcm1zLmxlbmd0aCA/IG5ldyBVbmlmb3JtQnVmZmVyRm9ybWF0KGRldmljZSwgbWVzaFVuaWZvcm1zKSA6IG51bGw7XG5cbiAgICAgICAgLy8gYnVpbGQgbWVzaCBiaW5kIGdyb3VwIGZvcm1hdCAtIHN0YXJ0IHdpdGggdW5pZm9ybSBidWZmZXJcbiAgICAgICAgY29uc3QgYnVmZmVyRm9ybWF0cyA9IFtdO1xuICAgICAgICBpZiAobWVzaFVuaWZvcm1CdWZmZXJGb3JtYXQpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHdlIGNvdWxkIG9wdGltaXplIHZpc2liaWxpdHkgdG8gb25seSBzdGFnZXMgdGhhdCB1c2UgYW55IG9mIHRoZSBkYXRhXG4gICAgICAgICAgICBidWZmZXJGb3JtYXRzLnB1c2gobmV3IEJpbmRCdWZmZXJGb3JtYXQoVU5JRk9STV9CVUZGRVJfREVGQVVMVF9TTE9UX05BTUUsIFNIQURFUlNUQUdFX1ZFUlRFWCB8IFNIQURFUlNUQUdFX0ZSQUdNRU5UKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhZGQgdGV4dHVyZXMgdW5pZm9ybXNcbiAgICAgICAgY29uc3QgdGV4dHVyZUZvcm1hdHMgPSBbXTtcbiAgICAgICAgdW5pZm9ybUxpbmVzU2FtcGxlcnMuZm9yRWFjaCgodW5pZm9ybSkgPT4ge1xuICAgICAgICAgICAgLy8gdW5tYXRjaGVkIHRleHR1cmUgdW5pZm9ybXMgZ28gdG8gbWVzaCBibG9ja1xuICAgICAgICAgICAgaWYgKCFwcm9jZXNzaW5nT3B0aW9ucy5oYXNUZXh0dXJlKHVuaWZvcm0ubmFtZSkpIHtcblxuICAgICAgICAgICAgICAgIC8vIHNhbXBsZSB0eXBlXG4gICAgICAgICAgICAgICAgLy8gV2ViR3B1IGRvZXMgbm90IGN1cnJlbnRseSBzdXBwb3J0IGZpbHRlcmVkIGZsb2F0IGZvcm1hdCB0ZXh0dXJlcywgYW5kIHNvIHdlIG1hcCB0aGVtIHRvIHVuZmlsdGVyYWJsZSB0eXBlXG4gICAgICAgICAgICAgICAgLy8gYXMgd2Ugc2FtcGxlIHRoZW0gd2l0aG91dCBmaWx0ZXJpbmcgYW55d2F5c1xuICAgICAgICAgICAgICAgIGxldCBzYW1wbGVUeXBlID0gU0FNUExFVFlQRV9GTE9BVDtcbiAgICAgICAgICAgICAgICBpZiAodW5pZm9ybS5wcmVjaXNpb24gPT09ICdoaWdocCcpXG4gICAgICAgICAgICAgICAgICAgIHNhbXBsZVR5cGUgPSBTQU1QTEVUWVBFX1VORklMVEVSQUJMRV9GTE9BVDtcbiAgICAgICAgICAgICAgICBpZiAoc2hhZG93U2FtcGxlcnMuaGFzKHVuaWZvcm0udHlwZSkpXG4gICAgICAgICAgICAgICAgICAgIHNhbXBsZVR5cGUgPSBTQU1QTEVUWVBFX0RFUFRIO1xuXG4gICAgICAgICAgICAgICAgLy8gZGltZW5zaW9uXG4gICAgICAgICAgICAgICAgY29uc3QgZGltZW5zaW9uID0gdGV4dHVyZURpbWVuc2lvbnNbdW5pZm9ybS50eXBlXTtcblxuICAgICAgICAgICAgICAgIC8vIFRPRE86IHdlIGNvdWxkIG9wdGltaXplIHZpc2liaWxpdHkgdG8gb25seSBzdGFnZXMgdGhhdCB1c2UgYW55IG9mIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgdGV4dHVyZUZvcm1hdHMucHVzaChuZXcgQmluZFRleHR1cmVGb3JtYXQodW5pZm9ybS5uYW1lLCBTSEFERVJTVEFHRV9WRVJURVggfCBTSEFERVJTVEFHRV9GUkFHTUVOVCwgZGltZW5zaW9uLCBzYW1wbGVUeXBlKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHZhbGlkYXRlIHR5cGVzIGluIGVsc2VcblxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbWVzaEJpbmRHcm91cEZvcm1hdCA9IG5ldyBCaW5kR3JvdXBGb3JtYXQoZGV2aWNlLCBidWZmZXJGb3JtYXRzLCB0ZXh0dXJlRm9ybWF0cyk7XG5cbiAgICAgICAgLy8gZ2VuZXJhdGUgY29kZSBmb3IgdW5pZm9ybSBidWZmZXJzXG4gICAgICAgIGxldCBjb2RlID0gJyc7XG4gICAgICAgIHByb2Nlc3NpbmdPcHRpb25zLnVuaWZvcm1Gb3JtYXRzLmZvckVhY2goKGZvcm1hdCwgYmluZEdyb3VwSW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChmb3JtYXQpIHtcbiAgICAgICAgICAgICAgICBjb2RlICs9IGZvcm1hdC5nZXRTaGFkZXJEZWNsYXJhdGlvbihiaW5kR3JvdXBJbmRleCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFuZCBhbHNvIGZvciBnZW5lcmF0ZWQgbWVzaCBmb3JtYXQsIHdoaWNoIGlzIGF0IHRoZSBzbG90IDAgb2YgdGhlIGJpbmQgZ3JvdXBcbiAgICAgICAgY29kZSArPSBtZXNoVW5pZm9ybUJ1ZmZlckZvcm1hdC5nZXRTaGFkZXJEZWNsYXJhdGlvbihCSU5ER1JPVVBfTUVTSCwgMCk7XG5cbiAgICAgICAgLy8gZ2VuZXJhdGUgY29kZSBmb3IgdGV4dHVyZXNcbiAgICAgICAgcHJvY2Vzc2luZ09wdGlvbnMuYmluZEdyb3VwRm9ybWF0cy5mb3JFYWNoKChmb3JtYXQsIGJpbmRHcm91cEluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoZm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgY29kZSArPSBmb3JtYXQuZ2V0U2hhZGVyRGVjbGFyYXRpb25UZXh0dXJlcyhiaW5kR3JvdXBJbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFuZCBhbHNvIGZvciBnZW5lcmF0ZWQgbWVzaCBmb3JtYXRcbiAgICAgICAgY29kZSArPSBtZXNoQmluZEdyb3VwRm9ybWF0LmdldFNoYWRlckRlY2xhcmF0aW9uVGV4dHVyZXMoQklOREdST1VQX01FU0gpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb2RlLFxuICAgICAgICAgICAgbWVzaFVuaWZvcm1CdWZmZXJGb3JtYXQsXG4gICAgICAgICAgICBtZXNoQmluZEdyb3VwRm9ybWF0XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc3RhdGljIHByb2Nlc3NWYXJ5aW5ncyh2YXJ5aW5nTGluZXMsIHZhcnlpbmdNYXAsIGlzVmVydGV4KSB7XG4gICAgICAgIGxldCBibG9jayA9ICcnO1xuICAgICAgICBjb25zdCBvcCA9IGlzVmVydGV4ID8gJ291dCcgOiAnaW4nO1xuICAgICAgICB2YXJ5aW5nTGluZXMuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gU2hhZGVyUHJvY2Vzc29yLnNwbGl0VG9Xb3JkcyhsaW5lKTtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB3b3Jkc1swXTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB3b3Jkc1sxXTtcblxuICAgICAgICAgICAgaWYgKGlzVmVydGV4KSB7XG4gICAgICAgICAgICAgICAgLy8gc3RvcmUgaXQgaW4gdGhlIG1hcFxuICAgICAgICAgICAgICAgIHZhcnlpbmdNYXAuc2V0KG5hbWUsIGluZGV4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgRGVidWcuYXNzZXJ0KHZhcnlpbmdNYXAuaGFzKG5hbWUpLCBgRnJhZ21lbnQgc2hhZGVyIHJlcXVpcmVzIHZhcnlpbmcgWyR7bmFtZX1dIGJ1dCB2ZXJ0ZXggc2hhZGVyIGRvZXMgbm90IGdlbmVyYXRlIGl0LmApO1xuICAgICAgICAgICAgICAgIGluZGV4ID0gdmFyeWluZ01hcC5nZXQobmFtZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGdlbmVyYXRlczogJ2xheW91dChsb2NhdGlvbiA9IDApIGluIHZlYzQgcG9zaXRpb247J1xuICAgICAgICAgICAgYmxvY2sgKz0gYGxheW91dChsb2NhdGlvbiA9ICR7aW5kZXh9KSAke29wfSAke3R5cGV9ICR7bmFtZX07XFxuYDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBibG9jaztcbiAgICB9XG5cbiAgICBzdGF0aWMgcHJvY2Vzc091dHMob3V0c0xpbmVzKSB7XG4gICAgICAgIGxldCBibG9jayA9ICcnO1xuICAgICAgICBvdXRzTGluZXMuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIC8vIGdlbmVyYXRlczogJ2xheW91dChsb2NhdGlvbiA9IDApIG91dCB2ZWM0IGdsX0ZyYWdDb2xvcjsnXG4gICAgICAgICAgICBibG9jayArPSBgbGF5b3V0KGxvY2F0aW9uID0gJHtpbmRleH0pIG91dCAke2xpbmV9O1xcbmA7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYmxvY2s7XG4gICAgfVxuXG4gICAgc3RhdGljIHByb2Nlc3NBdHRyaWJ1dGVzKGF0dHJpYnV0ZUxpbmVzLCBzaGFkZXJEZWZpbml0aW9uQXR0cmlidXRlcykge1xuICAgICAgICBsZXQgYmxvY2sgPSAnJztcbiAgICAgICAgY29uc3QgdXNlZExvY2F0aW9ucyA9IHt9O1xuICAgICAgICBhdHRyaWJ1dGVMaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3b3JkcyA9IFNoYWRlclByb2Nlc3Nvci5zcGxpdFRvV29yZHMobGluZSk7XG4gICAgICAgICAgICBjb25zdCB0eXBlID0gd29yZHNbMF07XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gd29yZHNbMV07XG5cbiAgICAgICAgICAgIGlmIChzaGFkZXJEZWZpbml0aW9uQXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbWFudGljID0gc2hhZGVyRGVmaW5pdGlvbkF0dHJpYnV0ZXNbbmFtZV07XG4gICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSBzZW1hbnRpY1RvTG9jYXRpb25bc2VtYW50aWNdO1xuXG4gICAgICAgICAgICAgICAgRGVidWcuYXNzZXJ0KCF1c2VkTG9jYXRpb25zLmhhc093blByb3BlcnR5KGxvY2F0aW9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYFdBUk5JTkc6IFR3byB2ZXJ0ZXggYXR0cmlidXRlcyBhcmUgbWFwcGVkIHRvIHRoZSBzYW1lIGxvY2F0aW9uIGluIGEgc2hhZGVyOiAke3VzZWRMb2NhdGlvbnNbbG9jYXRpb25dfSBhbmQgJHtzZW1hbnRpY31gKTtcbiAgICAgICAgICAgICAgICB1c2VkTG9jYXRpb25zW2xvY2F0aW9uXSA9IHNlbWFudGljO1xuXG4gICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGVzOiAnbGF5b3V0KGxvY2F0aW9uID0gMCkgaW4gdmVjNCBwb3NpdGlvbjsnXG4gICAgICAgICAgICAgICAgYmxvY2sgKz0gYGxheW91dChsb2NhdGlvbiA9ICR7bG9jYXRpb259KSBpbiAke3R5cGV9ICR7bmFtZX07XFxuYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBibG9jaztcbiAgICB9XG5cbiAgICBzdGF0aWMgc3BsaXRUb1dvcmRzKGxpbmUpIHtcbiAgICAgICAgLy8gcmVtb3ZlIGFueSBkb3VibGUgc3BhY2VzXG4gICAgICAgIGxpbmUgPSBsaW5lLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gICAgICAgIHJldHVybiBsaW5lLnNwbGl0KCcgJyk7XG4gICAgfVxuXG4gICAgc3RhdGljIGN1dE91dChzcmMsIHN0YXJ0LCBlbmQsIHJlcGxhY2VtZW50KSB7XG4gICAgICAgIHJldHVybiBzcmMuc3Vic3RyaW5nKDAsIHN0YXJ0KSArIHJlcGxhY2VtZW50ICsgc3JjLnN1YnN0cmluZyhlbmQpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2hhZGVyUHJvY2Vzc29yIH07XG4iXSwibmFtZXMiOlsiS0VZV09SRCIsIktFWVdPUkRfTElORSIsIk1BUktFUiIsInByZWNpc2lvblF1YWxpZmllcnMiLCJTZXQiLCJzaGFkb3dTYW1wbGVycyIsInRleHR1cmVEaW1lbnNpb25zIiwic2FtcGxlcjJEIiwiVEVYVFVSRURJTUVOU0lPTl8yRCIsInNhbXBsZXIzRCIsIlRFWFRVUkVESU1FTlNJT05fM0QiLCJzYW1wbGVyQ3ViZSIsIlRFWFRVUkVESU1FTlNJT05fQ1VCRSIsInNhbXBsZXJDdWJlU2hhZG93Iiwic2FtcGxlcjJEU2hhZG93Iiwic2FtcGxlcjJEQXJyYXkiLCJURVhUVVJFRElNRU5TSU9OXzJEX0FSUkFZIiwic2FtcGxlcjJEQXJyYXlTaGFkb3ciLCJVbmlmb3JtTGluZSIsImNvbnN0cnVjdG9yIiwibGluZSIsIndvcmRzIiwidHJpbSIsInNwbGl0IiwicHJlY2lzaW9uIiwidW5kZWZpbmVkIiwidHlwZSIsIm5hbWUiLCJoYXMiLCJpc1NhbXBsZXIiLCJpbmRleE9mIiwiU2hhZGVyUHJvY2Vzc29yIiwicnVuIiwiZGV2aWNlIiwic2hhZGVyRGVmaW5pdGlvbiIsInNoYWRlciIsInZhcnlpbmdNYXAiLCJNYXAiLCJ2ZXJ0ZXhFeHRyYWN0ZWQiLCJleHRyYWN0IiwidnNoYWRlciIsImZyYWdtZW50RXh0cmFjdGVkIiwiZnNoYWRlciIsImF0dHJpYnV0ZXNCbG9jayIsInByb2Nlc3NBdHRyaWJ1dGVzIiwiYXR0cmlidXRlcyIsInZlcnRleFZhcnlpbmdzQmxvY2siLCJwcm9jZXNzVmFyeWluZ3MiLCJ2YXJ5aW5ncyIsImZyYWdtZW50VmFyeWluZ3NCbG9jayIsIm91dEJsb2NrIiwicHJvY2Vzc091dHMiLCJvdXRzIiwiY29uY2F0VW5pZm9ybXMiLCJ1bmlmb3JtcyIsImNvbmNhdCIsIkFycmF5IiwiZnJvbSIsInBhcnNlZFVuaWZvcm1zIiwibWFwIiwiRGVidWciLCJjYWxsIiwiZm9yRWFjaCIsInVuaSIsImV4aXN0aW5nIiwiZ2V0IiwiYXNzZXJ0Iiwic2V0IiwidW5pZm9ybXNEYXRhIiwicHJvY2Vzc1VuaWZvcm1zIiwicHJvY2Vzc2luZ09wdGlvbnMiLCJ2QmxvY2siLCJjb2RlIiwic3JjIiwicmVwbGFjZSIsImZCbG9jayIsIm1lc2hVbmlmb3JtQnVmZmVyRm9ybWF0IiwibWVzaEJpbmRHcm91cEZvcm1hdCIsInJlcGxhY2VtZW50IiwibWF0Y2giLCJleGVjIiwia2V5d29yZCIsImxhc3RJbmRleCIsImluZGV4IiwibGluZU1hdGNoIiwicHVzaCIsImN1dE91dCIsImxlbmd0aCIsInVuaWZvcm1MaW5lc1NhbXBsZXJzIiwidW5pZm9ybUxpbmVzTm9uU2FtcGxlcnMiLCJ1bmlmb3JtIiwibWVzaFVuaWZvcm1zIiwiaGFzVW5pZm9ybSIsInVuaWZvcm1UeXBlIiwidW5pZm9ybVR5cGVUb05hbWUiLCJ1bmlmb3JtRm9ybWF0IiwiVW5pZm9ybUZvcm1hdCIsIlVuaWZvcm1CdWZmZXJGb3JtYXQiLCJidWZmZXJGb3JtYXRzIiwiQmluZEJ1ZmZlckZvcm1hdCIsIlVOSUZPUk1fQlVGRkVSX0RFRkFVTFRfU0xPVF9OQU1FIiwiU0hBREVSU1RBR0VfVkVSVEVYIiwiU0hBREVSU1RBR0VfRlJBR01FTlQiLCJ0ZXh0dXJlRm9ybWF0cyIsImhhc1RleHR1cmUiLCJzYW1wbGVUeXBlIiwiU0FNUExFVFlQRV9GTE9BVCIsIlNBTVBMRVRZUEVfVU5GSUxURVJBQkxFX0ZMT0FUIiwiU0FNUExFVFlQRV9ERVBUSCIsImRpbWVuc2lvbiIsIkJpbmRUZXh0dXJlRm9ybWF0IiwiQmluZEdyb3VwRm9ybWF0IiwidW5pZm9ybUZvcm1hdHMiLCJmb3JtYXQiLCJiaW5kR3JvdXBJbmRleCIsImdldFNoYWRlckRlY2xhcmF0aW9uIiwiQklOREdST1VQX01FU0giLCJiaW5kR3JvdXBGb3JtYXRzIiwiZ2V0U2hhZGVyRGVjbGFyYXRpb25UZXh0dXJlcyIsInZhcnlpbmdMaW5lcyIsImlzVmVydGV4IiwiYmxvY2siLCJvcCIsInNwbGl0VG9Xb3JkcyIsIm91dHNMaW5lcyIsImF0dHJpYnV0ZUxpbmVzIiwic2hhZGVyRGVmaW5pdGlvbkF0dHJpYnV0ZXMiLCJ1c2VkTG9jYXRpb25zIiwiaGFzT3duUHJvcGVydHkiLCJzZW1hbnRpYyIsImxvY2F0aW9uIiwic2VtYW50aWNUb0xvY2F0aW9uIiwic3RhcnQiLCJlbmQiLCJzdWJzdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFj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
