/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
class WebgpuBuffer {
  constructor() {
    this.buffer = null;
  }
  destroy(device) {
    if (this.buffer) {
      this.buffer.destroy();
      this.buffer = null;
    }
  }
  get initialized() {
    return !!this.buffer;
  }
  loseContext() {}

  unlock(device, usage, target, storage) {
    var _storage$byteOffset, _storage$buffer;
    const wgpu = device.wgpu;

    if (!this.buffer) {
      const size = storage.byteLength + 3 & ~3;
      this.buffer = device.wgpu.createBuffer({
        size: size,
        usage: target | GPUBufferUsage.COPY_DST
      });

    }

    const srcOffset = (_storage$byteOffset = storage.byteOffset) != null ? _storage$byteOffset : 0;
    const srcData = new Uint8Array((_storage$buffer = storage.buffer) != null ? _storage$buffer : storage, srcOffset, storage.byteLength);
    const data = new Uint8Array(this.buffer.size);
    data.set(srcData);

    wgpu.queue.writeBuffer(this.buffer, 0, data, 0, data.length);

  }
}

export { WebgpuBuffer };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LWJ1ZmZlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2dyYXBoaWNzL3dlYmdwdS93ZWJncHUtYnVmZmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQSBXZWJHUFUgaW1wbGVtZW50YXRpb24gb2YgdGhlIEJ1ZmZlci5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFdlYmdwdUJ1ZmZlciB7XG4gICAgLy8gdHlwZSB7R1BVQnVmZmVyfVxuICAgIGJ1ZmZlciA9IG51bGw7XG5cbiAgICBkZXN0cm95KGRldmljZSkge1xuICAgICAgICBpZiAodGhpcy5idWZmZXIpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBpbml0aWFsaXplZCgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5idWZmZXI7XG4gICAgfVxuXG4gICAgbG9zZUNvbnRleHQoKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vd2ViZ3B1LWdyYXBoaWNzLWRldmljZS5qcycpLldlYmdwdUdyYXBoaWNzRGV2aWNlfSBkZXZpY2UgLSBHcmFwaGljcyBkZXZpY2UuXG4gICAgICogQHBhcmFtIHsqfSB1c2FnZSAtXG4gICAgICogQHBhcmFtIHsqfSB0YXJnZXQgLVxuICAgICAqIEBwYXJhbSB7Kn0gc3RvcmFnZSAtXG4gICAgICovXG4gICAgdW5sb2NrKGRldmljZSwgdXNhZ2UsIHRhcmdldCwgc3RvcmFnZSkge1xuXG4gICAgICAgIGNvbnN0IHdncHUgPSBkZXZpY2Uud2dwdTtcblxuICAgICAgICAvLyBvZmZzZXQgb2YgZ2V0TWFwcGVkUmFuZ2UgbXVzdCBtZSBhIG11bHRpcGxlIG9mIDhcbiAgICAgICAgLy8gc2l6ZSBvZiBnZXRNYXBwZWRSYW5nZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNFxuXG4gICAgICAgIGlmICghdGhpcy5idWZmZXIpIHtcbiAgICAgICAgICAgIC8vIHNpemUgbmVlZHMgdG8gYmUgYSBtdWx0aXBsZSBvZiA0XG4gICAgICAgICAgICBjb25zdCBzaXplID0gKHN0b3JhZ2UuYnl0ZUxlbmd0aCArIDMpICYgfjM7XG5cbiAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gZGV2aWNlLndncHUuY3JlYXRlQnVmZmVyKHtcbiAgICAgICAgICAgICAgICBzaXplOiBzaXplLFxuICAgICAgICAgICAgICAgIHVzYWdlOiB0YXJnZXQgfCBHUFVCdWZmZXJVc2FnZS5DT1BZX0RTVFxuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgLy8gbWFwcGVkQXRDcmVhdGlvbiBwYXRoIC0gdGhpcyBjb3VsZCBiZSB1c2VkIHdoZW4gdGhlIGRhdGEgaXMgcHJvdmlkZWRcblxuICAgICAgICAgICAgLy8gdGhpcy5idWZmZXIgPSBkZXZpY2Uud2dwdS5jcmVhdGVCdWZmZXIoe1xuICAgICAgICAgICAgLy8gICAgIHNpemU6IHNpemUsXG4gICAgICAgICAgICAvLyAgICAgdXNhZ2U6IHRhcmdldCxcbiAgICAgICAgICAgIC8vICAgICBtYXBwZWRBdENyZWF0aW9uOiB0cnVlXG4gICAgICAgICAgICAvLyB9KTtcblxuICAgICAgICAgICAgLy8gY29uc3QgZGVzdCA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyLmdldE1hcHBlZFJhbmdlKCkpO1xuICAgICAgICAgICAgLy8gY29uc3Qgc3JjID0gbmV3IFVpbnQ4QXJyYXkoc3RvcmFnZS5idWZmZXIgPyBzdG9yYWdlLmJ1ZmZlciA6IHN0b3JhZ2UpO1xuICAgICAgICAgICAgLy8gZGVzdC5zZXQoc3JjKTtcbiAgICAgICAgICAgIC8vIHRoaXMuYnVmZmVyLnVubWFwKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzcmMgc2l6ZSBuZWVkcyB0byBiZSBhIG11bHRpcGxlIG9mIDQgYXMgd2VsbFxuICAgICAgICBjb25zdCBzcmNPZmZzZXQgPSBzdG9yYWdlLmJ5dGVPZmZzZXQgPz8gMDtcbiAgICAgICAgY29uc3Qgc3JjRGF0YSA9IG5ldyBVaW50OEFycmF5KHN0b3JhZ2UuYnVmZmVyID8/IHN0b3JhZ2UsIHNyY09mZnNldCwgc3RvcmFnZS5ieXRlTGVuZ3RoKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyLnNpemUpO1xuICAgICAgICBkYXRhLnNldChzcmNEYXRhKTtcblxuICAgICAgICAvLyBjb3B5IGRhdGEgdG8gdGhlIGdwdSBidWZmZXJcbiAgICAgICAgd2dwdS5xdWV1ZS53cml0ZUJ1ZmZlcih0aGlzLmJ1ZmZlciwgMCwgZGF0YSwgMCwgZGF0YS5sZW5ndGgpO1xuXG4gICAgICAgIC8vIFRPRE86IGhhbmRsZSB1c2FnZSB0eXBlczpcbiAgICAgICAgLy8gLSBCVUZGRVJfU1RBVElDLCBCVUZGRVJfRFlOQU1JQywgQlVGRkVSX1NUUkVBTSwgQlVGRkVSX0dQVURZTkFNSUNcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdlYmdwdUJ1ZmZlciB9O1xuIl0sIm5hbWVzIjpbIldlYmdwdUJ1ZmZlciIsImJ1ZmZlciIsImRlc3Ryb3kiLCJkZXZpY2UiLCJpbml0aWFsaXplZCIsImxvc2VDb250ZXh0IiwidW5sb2NrIiwidXNhZ2UiLCJ0YXJnZXQiLCJzdG9yYWdlIiwid2dwdSIsInNpemUiLCJieXRlTGVuZ3RoIiwiY3JlYXRlQnVmZmVyIiwiR1BVQnVmZmVyVXNhZ2UiLCJDT1BZX0RTVCIsInNyY09mZnNldCIsImJ5dGVPZmZzZXQiLCJzcmNEYXRhIiwiVWludDhBcnJheSIsImRhdGEiLCJzZXQiLCJxdWV1ZSIsIndyaXRlQnVmZmVyIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7OztBQUtBLE1BQU1BLFlBQVksQ0FBQztBQUFBLEVBQUEsV0FBQSxHQUFBO0lBQUEsSUFFZkMsQ0FBQUEsTUFBTSxHQUFHLElBQUksQ0FBQTtBQUFBLEdBQUE7RUFFYkMsT0FBTyxDQUFDQyxNQUFNLEVBQUU7SUFDWixJQUFJLElBQUksQ0FBQ0YsTUFBTSxFQUFFO0FBQ2IsTUFBQSxJQUFJLENBQUNBLE1BQU0sQ0FBQ0MsT0FBTyxFQUFFLENBQUE7TUFDckIsSUFBSSxDQUFDRCxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ3RCLEtBQUE7QUFDSixHQUFBO0FBRUEsRUFBQSxJQUFJRyxXQUFXLEdBQUc7QUFDZCxJQUFBLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQ0gsTUFBTSxDQUFBO0FBQ3hCLEdBQUE7QUFFQUksRUFBQUEsV0FBVyxHQUFHLEVBQ2Q7O0VBUUFDLE1BQU0sQ0FBQ0gsTUFBTSxFQUFFSSxLQUFLLEVBQUVDLE1BQU0sRUFBRUMsT0FBTyxFQUFFO0FBQUEsSUFBQSxJQUFBLG1CQUFBLEVBQUEsZUFBQSxDQUFBO0FBRW5DLElBQUEsTUFBTUMsSUFBSSxHQUFHUCxNQUFNLENBQUNPLElBQUksQ0FBQTs7QUFLeEIsSUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDVCxNQUFNLEVBQUU7TUFFZCxNQUFNVSxJQUFJLEdBQUlGLE9BQU8sQ0FBQ0csVUFBVSxHQUFHLENBQUMsR0FBSSxDQUFDLENBQUMsQ0FBQTtNQUUxQyxJQUFJLENBQUNYLE1BQU0sR0FBR0UsTUFBTSxDQUFDTyxJQUFJLENBQUNHLFlBQVksQ0FBQztBQUNuQ0YsUUFBQUEsSUFBSSxFQUFFQSxJQUFJO0FBQ1ZKLFFBQUFBLEtBQUssRUFBRUMsTUFBTSxHQUFHTSxjQUFjLENBQUNDLFFBQUFBO0FBQ25DLE9BQUMsQ0FBQyxDQUFBOztBQWVOLEtBQUE7O0FBR0EsSUFBQSxNQUFNQyxTQUFTLEdBQUdQLENBQUFBLG1CQUFBQSxHQUFBQSxPQUFPLENBQUNRLFVBQVUsa0NBQUksQ0FBQyxDQUFBO0FBQ3pDLElBQUEsTUFBTUMsT0FBTyxHQUFHLElBQUlDLFVBQVUsQ0FBQSxDQUFBLGVBQUEsR0FBQ1YsT0FBTyxDQUFDUixNQUFNLEtBQUlRLElBQUFBLEdBQUFBLGVBQUFBLEdBQUFBLE9BQU8sRUFBRU8sU0FBUyxFQUFFUCxPQUFPLENBQUNHLFVBQVUsQ0FBQyxDQUFBO0lBQ3hGLE1BQU1RLElBQUksR0FBRyxJQUFJRCxVQUFVLENBQUMsSUFBSSxDQUFDbEIsTUFBTSxDQUFDVSxJQUFJLENBQUMsQ0FBQTtBQUM3Q1MsSUFBQUEsSUFBSSxDQUFDQyxHQUFHLENBQUNILE9BQU8sQ0FBQyxDQUFBOztBQUdqQlIsSUFBQUEsSUFBSSxDQUFDWSxLQUFLLENBQUNDLFdBQVcsQ0FBQyxJQUFJLENBQUN0QixNQUFNLEVBQUUsQ0FBQyxFQUFFbUIsSUFBSSxFQUFFLENBQUMsRUFBRUEsSUFBSSxDQUFDSSxNQUFNLENBQUMsQ0FBQTs7QUFJaEUsR0FBQTtBQUNKOzs7OyJ9
