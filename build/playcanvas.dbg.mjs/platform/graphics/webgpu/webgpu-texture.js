/**
 * @license
 * PlayCanvas Engine v1.63.0-dev revision 9f3635a4e (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug, DebugHelper } from '../../../core/debug.js';
import { PIXELFORMAT_DEPTHSTENCIL, SAMPLETYPE_DEPTH, SAMPLETYPE_UNFILTERABLE_FLOAT, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, pixelFormatByteSizes, PIXELFORMAT_A8, PIXELFORMAT_L8, PIXELFORMAT_LA8, PIXELFORMAT_RGB565, PIXELFORMAT_RGBA5551, PIXELFORMAT_RGBA4, PIXELFORMAT_RGB8, PIXELFORMAT_RGBA8, PIXELFORMAT_DXT1, PIXELFORMAT_DXT3, PIXELFORMAT_DXT5, PIXELFORMAT_RGB16F, PIXELFORMAT_RGB32F, PIXELFORMAT_R32F, PIXELFORMAT_DEPTH, PIXELFORMAT_111110F, PIXELFORMAT_SRGB, PIXELFORMAT_SRGBA, PIXELFORMAT_ETC1, PIXELFORMAT_ETC2_RGB, PIXELFORMAT_ETC2_RGBA, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1, PIXELFORMAT_PVRTC_4BPP_RGB_1, PIXELFORMAT_PVRTC_4BPP_RGBA_1, PIXELFORMAT_ASTC_4x4, PIXELFORMAT_ATC_RGB, PIXELFORMAT_ATC_RGBA, PIXELFORMAT_BGRA8, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT } from '../constants.js';
import { WebgpuDebug } from './webgpu-debug.js';

// map of PIXELFORMAT_*** to GPUTextureFormat
const gpuTextureFormats = [];
gpuTextureFormats[PIXELFORMAT_A8] = '';
gpuTextureFormats[PIXELFORMAT_L8] = 'r8unorm';
gpuTextureFormats[PIXELFORMAT_LA8] = 'rg8unorm';
gpuTextureFormats[PIXELFORMAT_RGB565] = '';
gpuTextureFormats[PIXELFORMAT_RGBA5551] = '';
gpuTextureFormats[PIXELFORMAT_RGBA4] = '';
gpuTextureFormats[PIXELFORMAT_RGB8] = 'rgba8unorm';
gpuTextureFormats[PIXELFORMAT_RGBA8] = 'rgba8unorm';
gpuTextureFormats[PIXELFORMAT_DXT1] = '';
gpuTextureFormats[PIXELFORMAT_DXT3] = '';
gpuTextureFormats[PIXELFORMAT_DXT5] = '';
gpuTextureFormats[PIXELFORMAT_RGB16F] = '';
gpuTextureFormats[PIXELFORMAT_RGBA16F] = 'rgba16float';
gpuTextureFormats[PIXELFORMAT_RGB32F] = '';
gpuTextureFormats[PIXELFORMAT_RGBA32F] = 'rgba32float';
gpuTextureFormats[PIXELFORMAT_R32F] = 'r32float';
gpuTextureFormats[PIXELFORMAT_DEPTH] = 'depth32float';
gpuTextureFormats[PIXELFORMAT_DEPTHSTENCIL] = 'depth24plus-stencil8';
gpuTextureFormats[PIXELFORMAT_111110F] = 'rg11b10ufloat';
gpuTextureFormats[PIXELFORMAT_SRGB] = '';
gpuTextureFormats[PIXELFORMAT_SRGBA] = '';
gpuTextureFormats[PIXELFORMAT_ETC1] = '';
gpuTextureFormats[PIXELFORMAT_ETC2_RGB] = '';
gpuTextureFormats[PIXELFORMAT_ETC2_RGBA] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_2BPP_RGB_1] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_2BPP_RGBA_1] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_4BPP_RGB_1] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_4BPP_RGBA_1] = '';
gpuTextureFormats[PIXELFORMAT_ASTC_4x4] = '';
gpuTextureFormats[PIXELFORMAT_ATC_RGB] = '';
gpuTextureFormats[PIXELFORMAT_ATC_RGBA] = '';
gpuTextureFormats[PIXELFORMAT_BGRA8] = 'bgra8unorm';

// map of ADDRESS_*** to GPUAddressMode
const gpuAddressModes = [];
gpuAddressModes[ADDRESS_REPEAT] = 'repeat';
gpuAddressModes[ADDRESS_CLAMP_TO_EDGE] = 'clamp-to-edge';
gpuAddressModes[ADDRESS_MIRRORED_REPEAT] = 'mirror-repeat';

/**
 * A WebGPU implementation of the Texture.
 *
 * @ignore
 */
class WebgpuTexture {
  /**
   * @type {GPUTexture}
   * @private
   */

  /**
   * @type {GPUTextureView}
   * @private
   */

  /**
   * An array of samplers, addressed by SAMPLETYPE_*** constant, allowing texture to be sampled
   * using different samplers. Most textures are sampled as interpolated floats, but some can
   * additionally be sampled using non-interpolated floats (raw data) or compare sampling
   * (shadow maps).
   *
   * @type {GPUSampler[]}
   * @private
   */

  /**
   * @type {GPUTextureDescriptor}
   * @private
   */

  /**
   * @type {GPUTextureFormat}
   * @private
   */

  constructor(texture) {
    this.gpuTexture = void 0;
    this.view = void 0;
    this.samplers = [];
    this.descr = void 0;
    this.format = void 0;
    /** @type {import('../texture.js').Texture} */
    this.texture = texture;
    this.format = gpuTextureFormats[texture.format];
    Debug.assert(this.format !== '', `WebGPU does not support texture format ${texture.format} for texture ${texture.name}`, texture);
    this.create(texture.device);
  }
  create(device) {
    const texture = this.texture;
    const wgpu = device.wgpu;
    this.descr = {
      size: {
        width: texture.width,
        height: texture.height,
        depthOrArrayLayers: texture.cubemap ? 6 : 1
      },
      format: this.format,
      mipLevelCount: 1,
      sampleCount: 1,
      dimension: texture.volume ? '3d' : '2d',
      // TODO: use only required usage flags
      // COPY_SRC - probably only needed on render target textures, to support copyRenderTarget (grab pass needs it)
      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC
    };
    WebgpuDebug.validate(device);
    this.gpuTexture = wgpu.createTexture(this.descr);
    DebugHelper.setLabel(this.gpuTexture, `${texture.name}${texture.cubemap ? '[cubemap]' : ''}${texture.volume ? '[3d]' : ''}`);
    WebgpuDebug.end(device, {
      descr: this.descr,
      texture
    });

    // default texture view descriptor
    let viewDescr;

    // some format require custom default texture view
    if (this.texture.format === PIXELFORMAT_DEPTHSTENCIL) {
      // we expose the depth part of the format
      viewDescr = {
        format: 'depth24plus',
        aspect: 'depth-only'
      };
    }
    this.view = this.createView(viewDescr);
  }
  destroy(device) {}

  /**
   * @param {any} device - The Graphics Device.
   * @returns {any} - Returns the view.
   */
  getView(device) {
    this.uploadImmediate(device, this.texture);
    Debug.assert(this.view);
    return this.view;
  }
  createView(viewDescr) {
    var _options$format, _options$dimension, _options$aspect, _options$baseMipLevel, _options$mipLevelCoun, _options$baseArrayLay, _options$arrayLayerCo;
    const options = viewDescr != null ? viewDescr : {};
    const textureDescr = this.descr;
    const texture = this.texture;

    // '1d', '2d', '2d-array', 'cube', 'cube-array', '3d'
    const defaultViewDimension = () => {
      if (texture.cubemap) return 'cube';
      if (texture.volume) return '3d';
      return '2d';
    };

    /** @type {GPUTextureViewDescriptor} */
    const descr = {
      format: (_options$format = options.format) != null ? _options$format : textureDescr.format,
      dimension: (_options$dimension = options.dimension) != null ? _options$dimension : defaultViewDimension(),
      aspect: (_options$aspect = options.aspect) != null ? _options$aspect : 'all',
      baseMipLevel: (_options$baseMipLevel = options.baseMipLevel) != null ? _options$baseMipLevel : 0,
      mipLevelCount: (_options$mipLevelCoun = options.mipLevelCount) != null ? _options$mipLevelCoun : textureDescr.mipLevelCount,
      baseArrayLayer: (_options$baseArrayLay = options.baseArrayLayer) != null ? _options$baseArrayLay : 0,
      arrayLayerCount: (_options$arrayLayerCo = options.arrayLayerCount) != null ? _options$arrayLayerCo : textureDescr.depthOrArrayLayers
    };
    const view = this.gpuTexture.createView(descr);
    DebugHelper.setLabel(view, `${viewDescr ? `CustomView${JSON.stringify(viewDescr)}` : 'DefaultView'}:${this.texture.name}`);
    return view;
  }

  // TODO: handle the case where those properties get changed
  // TODO: share a global map of samplers. Possibly even use shared samplers for bind group,
  // or maybe even have some attached in view bind group and use globally

  /**
   * @param {any} device - The Graphics Device.
   * @param {number} [sampleType] - A sample type for the sampler, SAMPLETYPE_*** constant. If not
   * specified, the sampler type is based on the texture format / texture sampling type.
   * @returns {any} - Returns the sampler.
   */
  getSampler(device, sampleType) {
    let sampler = this.samplers[sampleType];
    if (!sampler) {
      const texture = this.texture;
      let label;

      /** @type GPUSamplerDescriptor */
      const descr = {
        addressModeU: gpuAddressModes[texture.addressU],
        addressModeV: gpuAddressModes[texture.addressV],
        addressModeW: gpuAddressModes[texture.addressW]
      };

      // default for compare sampling of texture
      if (!sampleType && texture.compareOnRead) {
        sampleType = SAMPLETYPE_DEPTH;
      }
      if (sampleType === SAMPLETYPE_DEPTH) {
        // depth compare sampling
        descr.compare = 'less';
        descr.magFilter = 'linear';
        descr.minFilter = 'linear';
        label = 'Compare';
      } else if (sampleType === SAMPLETYPE_UNFILTERABLE_FLOAT) {
        // webgpu cannot currently filter float / half float textures
        descr.magFilter = 'nearest';
        descr.minFilter = 'nearest';
        descr.mipmapFilter = 'nearest';
        label = 'Unfilterable';
      } else {
        // TODO: this is temporary and needs to be made generic
        if (this.texture.format === PIXELFORMAT_RGBA32F || this.texture.format === PIXELFORMAT_DEPTHSTENCIL || this.texture.format === PIXELFORMAT_RGBA16F) {
          descr.magFilter = 'nearest';
          descr.minFilter = 'nearest';
          descr.mipmapFilter = 'nearest';
          label = 'Nearest';
        } else {
          descr.magFilter = 'linear';
          descr.minFilter = 'linear';
          descr.mipmapFilter = 'linear';
          label = 'Linear';
        }
      }
      sampler = device.wgpu.createSampler(descr);
      DebugHelper.setLabel(sampler, label);
      this.samplers[sampleType] = sampler;
    }
    return sampler;
  }
  loseContext() {}

  /**
   * @param {import('./webgpu-graphics-device.js').WebgpuGraphicsDevice} device - The graphics
   * device.
   * @param {import('../texture.js').Texture} texture - The texture.
   */
  uploadImmediate(device, texture) {
    if (texture._needsUpload || texture._needsMipmapsUpload) {
      this.uploadData(device);
      texture._needsUpload = false;
      texture._needsMipmapsUpload = false;
    }
  }

  /**
   * @param {import('./webgpu-graphics-device.js').WebgpuGraphicsDevice} device - The graphics
   * device.
   */
  uploadData(device) {
    const texture = this.texture;
    const wgpu = device.wgpu;
    if (this.texture.cubemap) {
      Debug.warn('Cubemap texture data upload is not supported yet', this.texture);
      return;
    }

    // upload texture data if any
    const mipLevel = 0;
    const mipObject = texture._levels[mipLevel];
    if (mipObject) {
      if (mipObject instanceof ImageBitmap) {
        wgpu.queue.copyExternalImageToTexture({
          source: mipObject
        }, {
          texture: this.gpuTexture
        }, this.descr.size);
      } else if (ArrayBuffer.isView(mipObject)) {
        // typed array

        this.uploadTypedArrayData(wgpu, mipObject);
      } else {
        Debug.error('Unsupported texture source data', mipObject);
      }
    }
  }
  uploadTypedArrayData(wgpu, data) {
    var _pixelFormatByteSizes;
    const texture = this.texture;

    /** @type {GPUImageCopyTexture} */
    const dest = {
      texture: this.gpuTexture,
      mipLevel: 0
    };

    // TODO: handle update to mipmap levels other than 0
    const pixelSize = (_pixelFormatByteSizes = pixelFormatByteSizes[texture.format]) != null ? _pixelFormatByteSizes : 0;
    Debug.assert(pixelSize);
    const bytesPerRow = texture.width * pixelSize;
    const byteSize = bytesPerRow * texture.height;
    Debug.assert(byteSize === data.byteLength, `Error uploading data to texture, the data byte size of ${data.byteLength} does not match required ${byteSize}`, texture);

    /** @type {GPUImageDataLayout} */
    const dataLayout = {
      offset: 0,
      bytesPerRow: bytesPerRow,
      rowsPerImage: texture.height
    };
    const size = {
      width: texture.width,
      height: texture.height,
      depthOrArrayLayers: 1
    };
    wgpu.queue.writeTexture(dest, data, dataLayout, size);
  }
}

export { WebgpuTexture };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXRleHR1cmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9ncmFwaGljcy93ZWJncHUvd2ViZ3B1LXRleHR1cmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcsIERlYnVnSGVscGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5cbmltcG9ydCB7XG4gICAgcGl4ZWxGb3JtYXRCeXRlU2l6ZXMsXG4gICAgQUREUkVTU19SRVBFQVQsIEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgQUREUkVTU19NSVJST1JFRF9SRVBFQVQsXG4gICAgUElYRUxGT1JNQVRfQTgsIFBJWEVMRk9STUFUX0w4LCBQSVhFTEZPUk1BVF9MQTgsIFBJWEVMRk9STUFUX1JHQjU2NSwgUElYRUxGT1JNQVRfUkdCQTU1NTEsIFBJWEVMRk9STUFUX1JHQkE0LFxuICAgIFBJWEVMRk9STUFUX1JHQjgsIFBJWEVMRk9STUFUX1JHQkE4LCBQSVhFTEZPUk1BVF9EWFQxLCBQSVhFTEZPUk1BVF9EWFQzLCBQSVhFTEZPUk1BVF9EWFQ1LFxuICAgIFBJWEVMRk9STUFUX1JHQjE2RiwgUElYRUxGT1JNQVRfUkdCQTE2RiwgUElYRUxGT1JNQVRfUkdCMzJGLCBQSVhFTEZPUk1BVF9SR0JBMzJGLCBQSVhFTEZPUk1BVF9SMzJGLCBQSVhFTEZPUk1BVF9ERVBUSCxcbiAgICBQSVhFTEZPUk1BVF9ERVBUSFNURU5DSUwsIFBJWEVMRk9STUFUXzExMTExMEYsIFBJWEVMRk9STUFUX1NSR0IsIFBJWEVMRk9STUFUX1NSR0JBLCBQSVhFTEZPUk1BVF9FVEMxLFxuICAgIFBJWEVMRk9STUFUX0VUQzJfUkdCLCBQSVhFTEZPUk1BVF9FVEMyX1JHQkEsIFBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCXzEsIFBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCQV8xLFxuICAgIFBJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCXzEsIFBJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCQV8xLCBQSVhFTEZPUk1BVF9BU1RDXzR4NCwgUElYRUxGT1JNQVRfQVRDX1JHQixcbiAgICBQSVhFTEZPUk1BVF9BVENfUkdCQSwgUElYRUxGT1JNQVRfQkdSQTgsIFNBTVBMRVRZUEVfVU5GSUxURVJBQkxFX0ZMT0FULCBTQU1QTEVUWVBFX0RFUFRIXG59IGZyb20gJy4uL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBXZWJncHVEZWJ1ZyB9IGZyb20gJy4vd2ViZ3B1LWRlYnVnLmpzJztcblxuLy8gbWFwIG9mIFBJWEVMRk9STUFUXyoqKiB0byBHUFVUZXh0dXJlRm9ybWF0XG5jb25zdCBncHVUZXh0dXJlRm9ybWF0cyA9IFtdO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfQThdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9MOF0gPSAncjh1bm9ybSc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9MQThdID0gJ3JnOHVub3JtJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQjU2NV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkE1NTUxXSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfUkdCQTRdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9SR0I4XSA9ICdyZ2JhOHVub3JtJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkE4XSA9ICdyZ2JhOHVub3JtJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0RYVDFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9EWFQzXSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfRFhUNV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQjE2Rl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkExNkZdID0gJ3JnYmExNmZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQjMyRl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkEzMkZdID0gJ3JnYmEzMmZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1IzMkZdID0gJ3IzMmZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0RFUFRIXSA9ICdkZXB0aDMyZmxvYXQnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfREVQVEhTVEVOQ0lMXSA9ICdkZXB0aDI0cGx1cy1zdGVuY2lsOCc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF8xMTExMTBGXSA9ICdyZzExYjEwdWZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1NSR0JdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9TUkdCQV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0VUQzFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9FVEMyX1JHQl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0VUQzJfUkdCQV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCXzFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9QVlJUQ18yQlBQX1JHQkFfMV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCXzFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9QVlJUQ180QlBQX1JHQkFfMV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0FTVENfNHg0XSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfQVRDX1JHQl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0FUQ19SR0JBXSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfQkdSQThdID0gJ2JncmE4dW5vcm0nO1xuXG4vLyBtYXAgb2YgQUREUkVTU18qKiogdG8gR1BVQWRkcmVzc01vZGVcbmNvbnN0IGdwdUFkZHJlc3NNb2RlcyA9IFtdO1xuZ3B1QWRkcmVzc01vZGVzW0FERFJFU1NfUkVQRUFUXSA9ICdyZXBlYXQnO1xuZ3B1QWRkcmVzc01vZGVzW0FERFJFU1NfQ0xBTVBfVE9fRURHRV0gPSAnY2xhbXAtdG8tZWRnZSc7XG5ncHVBZGRyZXNzTW9kZXNbQUREUkVTU19NSVJST1JFRF9SRVBFQVRdID0gJ21pcnJvci1yZXBlYXQnO1xuXG4vKipcbiAqIEEgV2ViR1BVIGltcGxlbWVudGF0aW9uIG9mIHRoZSBUZXh0dXJlLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV2ViZ3B1VGV4dHVyZSB7XG4gICAgLyoqXG4gICAgICogQHR5cGUge0dQVVRleHR1cmV9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBncHVUZXh0dXJlO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0dQVVRleHR1cmVWaWV3fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdmlldztcblxuICAgIC8qKlxuICAgICAqIEFuIGFycmF5IG9mIHNhbXBsZXJzLCBhZGRyZXNzZWQgYnkgU0FNUExFVFlQRV8qKiogY29uc3RhbnQsIGFsbG93aW5nIHRleHR1cmUgdG8gYmUgc2FtcGxlZFxuICAgICAqIHVzaW5nIGRpZmZlcmVudCBzYW1wbGVycy4gTW9zdCB0ZXh0dXJlcyBhcmUgc2FtcGxlZCBhcyBpbnRlcnBvbGF0ZWQgZmxvYXRzLCBidXQgc29tZSBjYW5cbiAgICAgKiBhZGRpdGlvbmFsbHkgYmUgc2FtcGxlZCB1c2luZyBub24taW50ZXJwb2xhdGVkIGZsb2F0cyAocmF3IGRhdGEpIG9yIGNvbXBhcmUgc2FtcGxpbmdcbiAgICAgKiAoc2hhZG93IG1hcHMpLlxuICAgICAqXG4gICAgICogQHR5cGUge0dQVVNhbXBsZXJbXX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHNhbXBsZXJzID0gW107XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7R1BVVGV4dHVyZURlc2NyaXB0b3J9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBkZXNjcjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtHUFVUZXh0dXJlRm9ybWF0fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZm9ybWF0O1xuXG4gICAgY29uc3RydWN0b3IodGV4dHVyZSkge1xuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi4vdGV4dHVyZS5qcycpLlRleHR1cmV9ICovXG4gICAgICAgIHRoaXMudGV4dHVyZSA9IHRleHR1cmU7XG5cbiAgICAgICAgdGhpcy5mb3JtYXQgPSBncHVUZXh0dXJlRm9ybWF0c1t0ZXh0dXJlLmZvcm1hdF07XG4gICAgICAgIERlYnVnLmFzc2VydCh0aGlzLmZvcm1hdCAhPT0gJycsIGBXZWJHUFUgZG9lcyBub3Qgc3VwcG9ydCB0ZXh0dXJlIGZvcm1hdCAke3RleHR1cmUuZm9ybWF0fSBmb3IgdGV4dHVyZSAke3RleHR1cmUubmFtZX1gLCB0ZXh0dXJlKTtcblxuICAgICAgICB0aGlzLmNyZWF0ZSh0ZXh0dXJlLmRldmljZSk7XG4gICAgfVxuXG4gICAgY3JlYXRlKGRldmljZSkge1xuXG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSB0aGlzLnRleHR1cmU7XG4gICAgICAgIGNvbnN0IHdncHUgPSBkZXZpY2Uud2dwdTtcblxuICAgICAgICB0aGlzLmRlc2NyID0ge1xuICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICAgIHdpZHRoOiB0ZXh0dXJlLndpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogdGV4dHVyZS5oZWlnaHQsXG4gICAgICAgICAgICAgICAgZGVwdGhPckFycmF5TGF5ZXJzOiB0ZXh0dXJlLmN1YmVtYXAgPyA2IDogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZvcm1hdDogdGhpcy5mb3JtYXQsXG4gICAgICAgICAgICBtaXBMZXZlbENvdW50OiAxLFxuICAgICAgICAgICAgc2FtcGxlQ291bnQ6IDEsXG4gICAgICAgICAgICBkaW1lbnNpb246IHRleHR1cmUudm9sdW1lID8gJzNkJyA6ICcyZCcsXG5cbiAgICAgICAgICAgIC8vIFRPRE86IHVzZSBvbmx5IHJlcXVpcmVkIHVzYWdlIGZsYWdzXG4gICAgICAgICAgICAvLyBDT1BZX1NSQyAtIHByb2JhYmx5IG9ubHkgbmVlZGVkIG9uIHJlbmRlciB0YXJnZXQgdGV4dHVyZXMsIHRvIHN1cHBvcnQgY29weVJlbmRlclRhcmdldCAoZ3JhYiBwYXNzIG5lZWRzIGl0KVxuICAgICAgICAgICAgdXNhZ2U6IEdQVVRleHR1cmVVc2FnZS5URVhUVVJFX0JJTkRJTkcgfCBHUFVUZXh0dXJlVXNhZ2UuQ09QWV9EU1QgfCBHUFVUZXh0dXJlVXNhZ2UuUkVOREVSX0FUVEFDSE1FTlQgfCBHUFVUZXh0dXJlVXNhZ2UuQ09QWV9TUkNcbiAgICAgICAgfTtcblxuICAgICAgICBXZWJncHVEZWJ1Zy52YWxpZGF0ZShkZXZpY2UpO1xuXG4gICAgICAgIHRoaXMuZ3B1VGV4dHVyZSA9IHdncHUuY3JlYXRlVGV4dHVyZSh0aGlzLmRlc2NyKTtcbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwodGhpcy5ncHVUZXh0dXJlLCBgJHt0ZXh0dXJlLm5hbWV9JHt0ZXh0dXJlLmN1YmVtYXAgPyAnW2N1YmVtYXBdJyA6ICcnfSR7dGV4dHVyZS52b2x1bWUgPyAnWzNkXScgOiAnJ31gKTtcblxuICAgICAgICBXZWJncHVEZWJ1Zy5lbmQoZGV2aWNlLCB7XG4gICAgICAgICAgICBkZXNjcjogdGhpcy5kZXNjcixcbiAgICAgICAgICAgIHRleHR1cmVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZGVmYXVsdCB0ZXh0dXJlIHZpZXcgZGVzY3JpcHRvclxuICAgICAgICBsZXQgdmlld0Rlc2NyO1xuXG4gICAgICAgIC8vIHNvbWUgZm9ybWF0IHJlcXVpcmUgY3VzdG9tIGRlZmF1bHQgdGV4dHVyZSB2aWV3XG4gICAgICAgIGlmICh0aGlzLnRleHR1cmUuZm9ybWF0ID09PSBQSVhFTEZPUk1BVF9ERVBUSFNURU5DSUwpIHtcbiAgICAgICAgICAgIC8vIHdlIGV4cG9zZSB0aGUgZGVwdGggcGFydCBvZiB0aGUgZm9ybWF0XG4gICAgICAgICAgICB2aWV3RGVzY3IgPSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0OiAnZGVwdGgyNHBsdXMnLFxuICAgICAgICAgICAgICAgIGFzcGVjdDogJ2RlcHRoLW9ubHknXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy52aWV3ID0gdGhpcy5jcmVhdGVWaWV3KHZpZXdEZXNjcik7XG4gICAgfVxuXG4gICAgZGVzdHJveShkZXZpY2UpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2FueX0gZGV2aWNlIC0gVGhlIEdyYXBoaWNzIERldmljZS5cbiAgICAgKiBAcmV0dXJucyB7YW55fSAtIFJldHVybnMgdGhlIHZpZXcuXG4gICAgICovXG4gICAgZ2V0VmlldyhkZXZpY2UpIHtcblxuICAgICAgICB0aGlzLnVwbG9hZEltbWVkaWF0ZShkZXZpY2UsIHRoaXMudGV4dHVyZSk7XG5cbiAgICAgICAgRGVidWcuYXNzZXJ0KHRoaXMudmlldyk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXc7XG4gICAgfVxuXG4gICAgY3JlYXRlVmlldyh2aWV3RGVzY3IpIHtcblxuICAgICAgICBjb25zdCBvcHRpb25zID0gdmlld0Rlc2NyID8/IHt9O1xuICAgICAgICBjb25zdCB0ZXh0dXJlRGVzY3IgPSB0aGlzLmRlc2NyO1xuICAgICAgICBjb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlO1xuXG4gICAgICAgIC8vICcxZCcsICcyZCcsICcyZC1hcnJheScsICdjdWJlJywgJ2N1YmUtYXJyYXknLCAnM2QnXG4gICAgICAgIGNvbnN0IGRlZmF1bHRWaWV3RGltZW5zaW9uID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRleHR1cmUuY3ViZW1hcCkgcmV0dXJuICdjdWJlJztcbiAgICAgICAgICAgIGlmICh0ZXh0dXJlLnZvbHVtZSkgcmV0dXJuICczZCc7XG4gICAgICAgICAgICByZXR1cm4gJzJkJztcbiAgICAgICAgfTtcblxuICAgICAgICAvKiogQHR5cGUge0dQVVRleHR1cmVWaWV3RGVzY3JpcHRvcn0gKi9cbiAgICAgICAgY29uc3QgZGVzY3IgPSB7XG4gICAgICAgICAgICBmb3JtYXQ6IG9wdGlvbnMuZm9ybWF0ID8/IHRleHR1cmVEZXNjci5mb3JtYXQsXG4gICAgICAgICAgICBkaW1lbnNpb246IG9wdGlvbnMuZGltZW5zaW9uID8/IGRlZmF1bHRWaWV3RGltZW5zaW9uKCksXG4gICAgICAgICAgICBhc3BlY3Q6IG9wdGlvbnMuYXNwZWN0ID8/ICdhbGwnLFxuICAgICAgICAgICAgYmFzZU1pcExldmVsOiBvcHRpb25zLmJhc2VNaXBMZXZlbCA/PyAwLFxuICAgICAgICAgICAgbWlwTGV2ZWxDb3VudDogb3B0aW9ucy5taXBMZXZlbENvdW50ID8/IHRleHR1cmVEZXNjci5taXBMZXZlbENvdW50LFxuICAgICAgICAgICAgYmFzZUFycmF5TGF5ZXI6IG9wdGlvbnMuYmFzZUFycmF5TGF5ZXIgPz8gMCxcbiAgICAgICAgICAgIGFycmF5TGF5ZXJDb3VudDogb3B0aW9ucy5hcnJheUxheWVyQ291bnQgPz8gdGV4dHVyZURlc2NyLmRlcHRoT3JBcnJheUxheWVyc1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLmdwdVRleHR1cmUuY3JlYXRlVmlldyhkZXNjcik7XG4gICAgICAgIERlYnVnSGVscGVyLnNldExhYmVsKHZpZXcsIGAke3ZpZXdEZXNjciA/IGBDdXN0b21WaWV3JHtKU09OLnN0cmluZ2lmeSh2aWV3RGVzY3IpfWAgOiAnRGVmYXVsdFZpZXcnfToke3RoaXMudGV4dHVyZS5uYW1lfWApO1xuXG4gICAgICAgIHJldHVybiB2aWV3O1xuICAgIH1cblxuICAgIC8vIFRPRE86IGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aG9zZSBwcm9wZXJ0aWVzIGdldCBjaGFuZ2VkXG4gICAgLy8gVE9ETzogc2hhcmUgYSBnbG9iYWwgbWFwIG9mIHNhbXBsZXJzLiBQb3NzaWJseSBldmVuIHVzZSBzaGFyZWQgc2FtcGxlcnMgZm9yIGJpbmQgZ3JvdXAsXG4gICAgLy8gb3IgbWF5YmUgZXZlbiBoYXZlIHNvbWUgYXR0YWNoZWQgaW4gdmlldyBiaW5kIGdyb3VwIGFuZCB1c2UgZ2xvYmFsbHlcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7YW55fSBkZXZpY2UgLSBUaGUgR3JhcGhpY3MgRGV2aWNlLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbc2FtcGxlVHlwZV0gLSBBIHNhbXBsZSB0eXBlIGZvciB0aGUgc2FtcGxlciwgU0FNUExFVFlQRV8qKiogY29uc3RhbnQuIElmIG5vdFxuICAgICAqIHNwZWNpZmllZCwgdGhlIHNhbXBsZXIgdHlwZSBpcyBiYXNlZCBvbiB0aGUgdGV4dHVyZSBmb3JtYXQgLyB0ZXh0dXJlIHNhbXBsaW5nIHR5cGUuXG4gICAgICogQHJldHVybnMge2FueX0gLSBSZXR1cm5zIHRoZSBzYW1wbGVyLlxuICAgICAqL1xuICAgIGdldFNhbXBsZXIoZGV2aWNlLCBzYW1wbGVUeXBlKSB7XG4gICAgICAgIGxldCBzYW1wbGVyID0gdGhpcy5zYW1wbGVyc1tzYW1wbGVUeXBlXTtcbiAgICAgICAgaWYgKCFzYW1wbGVyKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPSB0aGlzLnRleHR1cmU7XG4gICAgICAgICAgICBsZXQgbGFiZWw7XG5cbiAgICAgICAgICAgIC8qKiBAdHlwZSBHUFVTYW1wbGVyRGVzY3JpcHRvciAqL1xuICAgICAgICAgICAgY29uc3QgZGVzY3IgPSB7XG4gICAgICAgICAgICAgICAgYWRkcmVzc01vZGVVOiBncHVBZGRyZXNzTW9kZXNbdGV4dHVyZS5hZGRyZXNzVV0sXG4gICAgICAgICAgICAgICAgYWRkcmVzc01vZGVWOiBncHVBZGRyZXNzTW9kZXNbdGV4dHVyZS5hZGRyZXNzVl0sXG4gICAgICAgICAgICAgICAgYWRkcmVzc01vZGVXOiBncHVBZGRyZXNzTW9kZXNbdGV4dHVyZS5hZGRyZXNzV11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGRlZmF1bHQgZm9yIGNvbXBhcmUgc2FtcGxpbmcgb2YgdGV4dHVyZVxuICAgICAgICAgICAgaWYgKCFzYW1wbGVUeXBlICYmIHRleHR1cmUuY29tcGFyZU9uUmVhZCkge1xuICAgICAgICAgICAgICAgIHNhbXBsZVR5cGUgPSBTQU1QTEVUWVBFX0RFUFRIO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2FtcGxlVHlwZSA9PT0gU0FNUExFVFlQRV9ERVBUSCkge1xuXG4gICAgICAgICAgICAgICAgLy8gZGVwdGggY29tcGFyZSBzYW1wbGluZ1xuICAgICAgICAgICAgICAgIGRlc2NyLmNvbXBhcmUgPSAnbGVzcyc7XG4gICAgICAgICAgICAgICAgZGVzY3IubWFnRmlsdGVyID0gJ2xpbmVhcic7XG4gICAgICAgICAgICAgICAgZGVzY3IubWluRmlsdGVyID0gJ2xpbmVhcic7XG4gICAgICAgICAgICAgICAgbGFiZWwgPSAnQ29tcGFyZSc7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2FtcGxlVHlwZSA9PT0gU0FNUExFVFlQRV9VTkZJTFRFUkFCTEVfRkxPQVQpIHtcblxuICAgICAgICAgICAgICAgIC8vIHdlYmdwdSBjYW5ub3QgY3VycmVudGx5IGZpbHRlciBmbG9hdCAvIGhhbGYgZmxvYXQgdGV4dHVyZXNcbiAgICAgICAgICAgICAgICBkZXNjci5tYWdGaWx0ZXIgPSAnbmVhcmVzdCc7XG4gICAgICAgICAgICAgICAgZGVzY3IubWluRmlsdGVyID0gJ25lYXJlc3QnO1xuICAgICAgICAgICAgICAgIGRlc2NyLm1pcG1hcEZpbHRlciA9ICduZWFyZXN0JztcbiAgICAgICAgICAgICAgICBsYWJlbCA9ICdVbmZpbHRlcmFibGUnO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogdGhpcyBpcyB0ZW1wb3JhcnkgYW5kIG5lZWRzIHRvIGJlIG1hZGUgZ2VuZXJpY1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRleHR1cmUuZm9ybWF0ID09PSBQSVhFTEZPUk1BVF9SR0JBMzJGIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dHVyZS5mb3JtYXQgPT09IFBJWEVMRk9STUFUX0RFUFRIU1RFTkNJTCB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHR1cmUuZm9ybWF0ID09PSBQSVhFTEZPUk1BVF9SR0JBMTZGKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlc2NyLm1hZ0ZpbHRlciA9ICduZWFyZXN0JztcbiAgICAgICAgICAgICAgICAgICAgZGVzY3IubWluRmlsdGVyID0gJ25lYXJlc3QnO1xuICAgICAgICAgICAgICAgICAgICBkZXNjci5taXBtYXBGaWx0ZXIgPSAnbmVhcmVzdCc7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsID0gJ05lYXJlc3QnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlc2NyLm1hZ0ZpbHRlciA9ICdsaW5lYXInO1xuICAgICAgICAgICAgICAgICAgICBkZXNjci5taW5GaWx0ZXIgPSAnbGluZWFyJztcbiAgICAgICAgICAgICAgICAgICAgZGVzY3IubWlwbWFwRmlsdGVyID0gJ2xpbmVhcic7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsID0gJ0xpbmVhcic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzYW1wbGVyID0gZGV2aWNlLndncHUuY3JlYXRlU2FtcGxlcihkZXNjcik7XG4gICAgICAgICAgICBEZWJ1Z0hlbHBlci5zZXRMYWJlbChzYW1wbGVyLCBsYWJlbCk7XG4gICAgICAgICAgICB0aGlzLnNhbXBsZXJzW3NhbXBsZVR5cGVdID0gc2FtcGxlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzYW1wbGVyO1xuICAgIH1cblxuICAgIGxvc2VDb250ZXh0KCkge1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL3dlYmdwdS1ncmFwaGljcy1kZXZpY2UuanMnKS5XZWJncHVHcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlIGdyYXBoaWNzXG4gICAgICogZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi90ZXh0dXJlLmpzJykuVGV4dHVyZX0gdGV4dHVyZSAtIFRoZSB0ZXh0dXJlLlxuICAgICAqL1xuICAgIHVwbG9hZEltbWVkaWF0ZShkZXZpY2UsIHRleHR1cmUpIHtcblxuICAgICAgICBpZiAodGV4dHVyZS5fbmVlZHNVcGxvYWQgfHwgdGV4dHVyZS5fbmVlZHNNaXBtYXBzVXBsb2FkKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZERhdGEoZGV2aWNlKTtcblxuICAgICAgICAgICAgdGV4dHVyZS5fbmVlZHNVcGxvYWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRleHR1cmUuX25lZWRzTWlwbWFwc1VwbG9hZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vd2ViZ3B1LWdyYXBoaWNzLWRldmljZS5qcycpLldlYmdwdUdyYXBoaWNzRGV2aWNlfSBkZXZpY2UgLSBUaGUgZ3JhcGhpY3NcbiAgICAgKiBkZXZpY2UuXG4gICAgICovXG4gICAgdXBsb2FkRGF0YShkZXZpY2UpIHtcblxuICAgICAgICBjb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlO1xuICAgICAgICBjb25zdCB3Z3B1ID0gZGV2aWNlLndncHU7XG5cbiAgICAgICAgaWYgKHRoaXMudGV4dHVyZS5jdWJlbWFwKSB7XG4gICAgICAgICAgICBEZWJ1Zy53YXJuKCdDdWJlbWFwIHRleHR1cmUgZGF0YSB1cGxvYWQgaXMgbm90IHN1cHBvcnRlZCB5ZXQnLCB0aGlzLnRleHR1cmUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBsb2FkIHRleHR1cmUgZGF0YSBpZiBhbnlcbiAgICAgICAgY29uc3QgbWlwTGV2ZWwgPSAwO1xuICAgICAgICBjb25zdCBtaXBPYmplY3QgPSB0ZXh0dXJlLl9sZXZlbHNbbWlwTGV2ZWxdO1xuICAgICAgICBpZiAobWlwT2JqZWN0KSB7XG5cbiAgICAgICAgICAgIGlmIChtaXBPYmplY3QgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCkge1xuXG4gICAgICAgICAgICAgICAgd2dwdS5xdWV1ZS5jb3B5RXh0ZXJuYWxJbWFnZVRvVGV4dHVyZSh7IHNvdXJjZTogbWlwT2JqZWN0IH0sIHsgdGV4dHVyZTogdGhpcy5ncHVUZXh0dXJlIH0sIHRoaXMuZGVzY3Iuc2l6ZSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KG1pcE9iamVjdCkpIHsgLy8gdHlwZWQgYXJyYXlcblxuICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkVHlwZWRBcnJheURhdGEod2dwdSwgbWlwT2JqZWN0KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIERlYnVnLmVycm9yKCdVbnN1cHBvcnRlZCB0ZXh0dXJlIHNvdXJjZSBkYXRhJywgbWlwT2JqZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwbG9hZFR5cGVkQXJyYXlEYXRhKHdncHUsIGRhdGEpIHtcblxuICAgICAgICBjb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7R1BVSW1hZ2VDb3B5VGV4dHVyZX0gKi9cbiAgICAgICAgY29uc3QgZGVzdCA9IHtcbiAgICAgICAgICAgIHRleHR1cmU6IHRoaXMuZ3B1VGV4dHVyZSxcbiAgICAgICAgICAgIG1pcExldmVsOiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gVE9ETzogaGFuZGxlIHVwZGF0ZSB0byBtaXBtYXAgbGV2ZWxzIG90aGVyIHRoYW4gMFxuICAgICAgICBjb25zdCBwaXhlbFNpemUgPSBwaXhlbEZvcm1hdEJ5dGVTaXplc1t0ZXh0dXJlLmZvcm1hdF0gPz8gMDtcbiAgICAgICAgRGVidWcuYXNzZXJ0KHBpeGVsU2l6ZSk7XG4gICAgICAgIGNvbnN0IGJ5dGVzUGVyUm93ID0gdGV4dHVyZS53aWR0aCAqIHBpeGVsU2l6ZTtcbiAgICAgICAgY29uc3QgYnl0ZVNpemUgPSBieXRlc1BlclJvdyAqIHRleHR1cmUuaGVpZ2h0O1xuXG4gICAgICAgIERlYnVnLmFzc2VydChieXRlU2l6ZSA9PT0gZGF0YS5ieXRlTGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgYEVycm9yIHVwbG9hZGluZyBkYXRhIHRvIHRleHR1cmUsIHRoZSBkYXRhIGJ5dGUgc2l6ZSBvZiAke2RhdGEuYnl0ZUxlbmd0aH0gZG9lcyBub3QgbWF0Y2ggcmVxdWlyZWQgJHtieXRlU2l6ZX1gLCB0ZXh0dXJlKTtcblxuICAgICAgICAvKiogQHR5cGUge0dQVUltYWdlRGF0YUxheW91dH0gKi9cbiAgICAgICAgY29uc3QgZGF0YUxheW91dCA9IHtcbiAgICAgICAgICAgIG9mZnNldDogMCxcbiAgICAgICAgICAgIGJ5dGVzUGVyUm93OiBieXRlc1BlclJvdyxcbiAgICAgICAgICAgIHJvd3NQZXJJbWFnZTogdGV4dHVyZS5oZWlnaHRcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzaXplID0ge1xuICAgICAgICAgICAgd2lkdGg6IHRleHR1cmUud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRleHR1cmUuaGVpZ2h0LFxuICAgICAgICAgICAgZGVwdGhPckFycmF5TGF5ZXJzOiAxXG4gICAgICAgIH07XG5cbiAgICAgICAgd2dwdS5xdWV1ZS53cml0ZVRleHR1cmUoZGVzdCwgZGF0YSwgZGF0YUxheW91dCwgc2l6ZSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBXZWJncHVUZXh0dXJlIH07XG4iXSwibmFtZXMiOlsiZ3B1VGV4dHVyZUZvcm1hdHMiLCJQSVhFTEZPUk1BVF9BOCIsIlBJWEVMRk9STUFUX0w4IiwiUElYRUxGT1JNQVRfTEE4IiwiUElYRUxGT1JNQVRfUkdCNTY1IiwiUElYRUxGT1JNQVRfUkdCQTU1NTEiLCJQSVhFTEZPUk1BVF9SR0JBNCIsIlBJWEVMRk9STUFUX1JHQjgiLCJQSVhFTEZPUk1BVF9SR0JBOCIsIlBJWEVMRk9STUFUX0RYVDEiLCJQSVhFTEZPUk1BVF9EWFQzIiwiUElYRUxGT1JNQVRfRFhUNSIsIlBJWEVMRk9STUFUX1JHQjE2RiIsIlBJWEVMRk9STUFUX1JHQkExNkYiLCJQSVhFTEZPUk1BVF9SR0IzMkYiLCJQSVhFTEZPUk1BVF9SR0JBMzJGIiwiUElYRUxGT1JNQVRfUjMyRiIsIlBJWEVMRk9STUFUX0RFUFRIIiwiUElYRUxGT1JNQVRfREVQVEhTVEVOQ0lMIiwiUElYRUxGT1JNQVRfMTExMTEwRiIsIlBJWEVMRk9STUFUX1NSR0IiLCJQSVhFTEZPUk1BVF9TUkdCQSIsIlBJWEVMRk9STUFUX0VUQzEiLCJQSVhFTEZPUk1BVF9FVEMyX1JHQiIsIlBJWEVMRk9STUFUX0VUQzJfUkdCQSIsIlBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCXzEiLCJQSVhFTEZPUk1BVF9QVlJUQ18yQlBQX1JHQkFfMSIsIlBJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCXzEiLCJQSVhFTEZPUk1BVF9QVlJUQ180QlBQX1JHQkFfMSIsIlBJWEVMRk9STUFUX0FTVENfNHg0IiwiUElYRUxGT1JNQVRfQVRDX1JHQiIsIlBJWEVMRk9STUFUX0FUQ19SR0JBIiwiUElYRUxGT1JNQVRfQkdSQTgiLCJncHVBZGRyZXNzTW9kZXMiLCJBRERSRVNTX1JFUEVBVCIsIkFERFJFU1NfQ0xBTVBfVE9fRURHRSIsIkFERFJFU1NfTUlSUk9SRURfUkVQRUFUIiwiV2ViZ3B1VGV4dHVyZSIsImNvbnN0cnVjdG9yIiwidGV4dHVyZSIsImdwdVRleHR1cmUiLCJ2aWV3Iiwic2FtcGxlcnMiLCJkZXNjciIsImZvcm1hdCIsIkRlYnVnIiwiYXNzZXJ0IiwibmFtZSIsImNyZWF0ZSIsImRldmljZSIsIndncHUiLCJzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aE9yQXJyYXlMYXllcnMiLCJjdWJlbWFwIiwibWlwTGV2ZWxDb3VudCIsInNhbXBsZUNvdW50IiwiZGltZW5zaW9uIiwidm9sdW1lIiwidXNhZ2UiLCJHUFVUZXh0dXJlVXNhZ2UiLCJURVhUVVJFX0JJTkRJTkciLCJDT1BZX0RTVCIsIlJFTkRFUl9BVFRBQ0hNRU5UIiwiQ09QWV9TUkMiLCJXZWJncHVEZWJ1ZyIsInZhbGlkYXRlIiwiY3JlYXRlVGV4dHVyZSIsIkRlYnVnSGVscGVyIiwic2V0TGFiZWwiLCJlbmQiLCJ2aWV3RGVzY3IiLCJhc3BlY3QiLCJjcmVhdGVWaWV3IiwiZGVzdHJveSIsImdldFZpZXciLCJ1cGxvYWRJbW1lZGlhdGUiLCJfb3B0aW9ucyRmb3JtYXQiLCJfb3B0aW9ucyRkaW1lbnNpb24iLCJfb3B0aW9ucyRhc3BlY3QiLCJfb3B0aW9ucyRiYXNlTWlwTGV2ZWwiLCJfb3B0aW9ucyRtaXBMZXZlbENvdW4iLCJfb3B0aW9ucyRiYXNlQXJyYXlMYXkiLCJfb3B0aW9ucyRhcnJheUxheWVyQ28iLCJvcHRpb25zIiwidGV4dHVyZURlc2NyIiwiZGVmYXVsdFZpZXdEaW1lbnNpb24iLCJiYXNlTWlwTGV2ZWwiLCJiYXNlQXJyYXlMYXllciIsImFycmF5TGF5ZXJDb3VudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRTYW1wbGVyIiwic2FtcGxlVHlwZSIsInNhbXBsZXIiLCJsYWJlbCIsImFkZHJlc3NNb2RlVSIsImFkZHJlc3NVIiwiYWRkcmVzc01vZGVWIiwiYWRkcmVzc1YiLCJhZGRyZXNzTW9kZVciLCJhZGRyZXNzVyIsImNvbXBhcmVPblJlYWQiLCJTQU1QTEVUWVBFX0RFUFRIIiwiY29tcGFyZSIsIm1hZ0ZpbHRlciIsIm1pbkZpbHRlciIsIlNBTVBMRVRZUEVfVU5GSUxURVJBQkxFX0ZMT0FUIiwibWlwbWFwRmlsdGVyIiwiY3JlYXRlU2FtcGxlciIsImxvc2VDb250ZXh0IiwiX25lZWRzVXBsb2FkIiwiX25lZWRzTWlwbWFwc1VwbG9hZCIsInVwbG9hZERhdGEiLCJ3YXJuIiwibWlwTGV2ZWwiLCJtaXBPYmplY3QiLCJfbGV2ZWxzIiwiSW1hZ2VCaXRtYXAiLCJxdWV1ZSIsImNvcHlFeHRlcm5hbEltYWdlVG9UZXh0dXJlIiwic291cmNlIiwiQXJyYXlCdWZmZXIiLCJpc1ZpZXciLCJ1cGxvYWRUeXBlZEFycmF5RGF0YSIsImVycm9yIiwiZGF0YSIsIl9waXhlbEZvcm1hdEJ5dGVTaXplcyIsImRlc3QiLCJwaXhlbFNpemUiLCJwaXhlbEZvcm1hdEJ5dGVTaXplcyIsImJ5dGVzUGVyUm93IiwiYnl0ZVNpemUiLCJieXRlTGVuZ3RoIiwiZGF0YUxheW91dCIsIm9mZnNldCIsInJvd3NQZXJJbWFnZSIsIndyaXRlVGV4dHVyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZUE7QUFDQSxNQUFNQSxpQkFBaUIsR0FBRyxFQUFFLENBQUE7QUFDNUJBLGlCQUFpQixDQUFDQyxjQUFjLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDdENELGlCQUFpQixDQUFDRSxjQUFjLENBQUMsR0FBRyxTQUFTLENBQUE7QUFDN0NGLGlCQUFpQixDQUFDRyxlQUFlLENBQUMsR0FBRyxVQUFVLENBQUE7QUFDL0NILGlCQUFpQixDQUFDSSxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUMxQ0osaUJBQWlCLENBQUNLLG9CQUFvQixDQUFDLEdBQUcsRUFBRSxDQUFBO0FBQzVDTCxpQkFBaUIsQ0FBQ00saUJBQWlCLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDekNOLGlCQUFpQixDQUFDTyxnQkFBZ0IsQ0FBQyxHQUFHLFlBQVksQ0FBQTtBQUNsRFAsaUJBQWlCLENBQUNRLGlCQUFpQixDQUFDLEdBQUcs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
