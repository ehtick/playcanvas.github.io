/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug, DebugHelper } from '../../../core/debug.js';
import { PIXELFORMAT_DEPTHSTENCIL, PIXELFORMAT_RGBA32F, PIXELFORMAT_A8, PIXELFORMAT_L8, PIXELFORMAT_LA8, PIXELFORMAT_RGB565, PIXELFORMAT_RGBA5551, PIXELFORMAT_RGBA4, PIXELFORMAT_RGB8, PIXELFORMAT_RGBA8, PIXELFORMAT_DXT1, PIXELFORMAT_DXT3, PIXELFORMAT_DXT5, PIXELFORMAT_RGB16F, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGB32F, PIXELFORMAT_R32F, PIXELFORMAT_DEPTH, PIXELFORMAT_111110F, PIXELFORMAT_SRGB, PIXELFORMAT_SRGBA, PIXELFORMAT_ETC1, PIXELFORMAT_ETC2_RGB, PIXELFORMAT_ETC2_RGBA, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1, PIXELFORMAT_PVRTC_4BPP_RGB_1, PIXELFORMAT_PVRTC_4BPP_RGBA_1, PIXELFORMAT_ASTC_4x4, PIXELFORMAT_ATC_RGB, PIXELFORMAT_ATC_RGBA, PIXELFORMAT_BGRA8, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT } from '../constants.js';

const gpuTextureFormats = [];
gpuTextureFormats[PIXELFORMAT_A8] = '';
gpuTextureFormats[PIXELFORMAT_L8] = '';
gpuTextureFormats[PIXELFORMAT_LA8] = '';
gpuTextureFormats[PIXELFORMAT_RGB565] = '';
gpuTextureFormats[PIXELFORMAT_RGBA5551] = '';
gpuTextureFormats[PIXELFORMAT_RGBA4] = '';
gpuTextureFormats[PIXELFORMAT_RGB8] = 'rgba8unorm';
gpuTextureFormats[PIXELFORMAT_RGBA8] = 'rgba8unorm';
gpuTextureFormats[PIXELFORMAT_DXT1] = '';
gpuTextureFormats[PIXELFORMAT_DXT3] = '';
gpuTextureFormats[PIXELFORMAT_DXT5] = '';
gpuTextureFormats[PIXELFORMAT_RGB16F] = '';
gpuTextureFormats[PIXELFORMAT_RGBA16F] = 'rgba16float';
gpuTextureFormats[PIXELFORMAT_RGB32F] = '';
gpuTextureFormats[PIXELFORMAT_RGBA32F] = 'rgba32float';
gpuTextureFormats[PIXELFORMAT_R32F] = 'r32float';
gpuTextureFormats[PIXELFORMAT_DEPTH] = 'depth32float';
gpuTextureFormats[PIXELFORMAT_DEPTHSTENCIL] = 'depth24plus-stencil8';
gpuTextureFormats[PIXELFORMAT_111110F] = 'rg11b10ufloat';
gpuTextureFormats[PIXELFORMAT_SRGB] = '';
gpuTextureFormats[PIXELFORMAT_SRGBA] = '';
gpuTextureFormats[PIXELFORMAT_ETC1] = '';
gpuTextureFormats[PIXELFORMAT_ETC2_RGB] = '';
gpuTextureFormats[PIXELFORMAT_ETC2_RGBA] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_2BPP_RGB_1] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_2BPP_RGBA_1] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_4BPP_RGB_1] = '';
gpuTextureFormats[PIXELFORMAT_PVRTC_4BPP_RGBA_1] = '';
gpuTextureFormats[PIXELFORMAT_ASTC_4x4] = '';
gpuTextureFormats[PIXELFORMAT_ATC_RGB] = '';
gpuTextureFormats[PIXELFORMAT_ATC_RGBA] = '';
gpuTextureFormats[PIXELFORMAT_BGRA8] = 'bgra8unorm';

const gpuAddressModes = [];
gpuAddressModes[ADDRESS_REPEAT] = 'repeat';
gpuAddressModes[ADDRESS_CLAMP_TO_EDGE] = 'clamp-to-edge';
gpuAddressModes[ADDRESS_MIRRORED_REPEAT] = 'mirror-repeat';

class WebgpuTexture {

  constructor(texture) {
    this.gpuTexture = void 0;
    this.view = void 0;
    this.sampler = void 0;
    this.descr = void 0;
    this.format = void 0;
    this.texture = texture;
    this.format = gpuTextureFormats[texture.format];
    Debug.assert(this.format !== '', `WebGPU does not support texture format ${texture.format} for texture ${texture.name}`, texture);
    this.create(texture.device);
  }
  create(device) {
    const texture = this.texture;
    const wgpu = device.wgpu;
    this.descr = {
      size: {
        width: texture.width,
        height: texture.height,
        depthOrArrayLayers: texture.cubemap ? 6 : 1
      },
      format: this.format,
      mipLevelCount: 1,
      sampleCount: 1,
      dimension: texture.volume ? '3d' : '2d',
      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC
    };
    this.gpuTexture = wgpu.createTexture(this.descr);
    DebugHelper.setLabel(this.gpuTexture, `${texture.name}${texture.cubemap ? '[cubemap]' : ''}${texture.volume ? '[3d]' : ''}`);

    let viewDescr;

    if (this.texture.format === PIXELFORMAT_DEPTHSTENCIL) {
      viewDescr = {
        format: 'depth24plus',
        aspect: 'depth-only'
      };
    }
    this.view = this.createView(viewDescr);
  }
  destroy(device) {}
  getView(device) {
    this.uploadImmediate(device, this.texture);
    Debug.assert(this.view);
    return this.view;
  }
  createView(viewDescr) {
    var _options$format, _options$dimension, _options$aspect, _options$baseMipLevel, _options$mipLevelCoun, _options$baseArrayLay, _options$arrayLayerCo;
    const options = viewDescr != null ? viewDescr : {};
    const textureDescr = this.descr;
    const texture = this.texture;

    const defaultViewDimension = () => {
      if (texture.cubemap) return 'cube';
      if (texture.volume) return '3d';
      return '2d';
    };

    const descr = {
      format: (_options$format = options.format) != null ? _options$format : textureDescr.format,
      dimension: (_options$dimension = options.dimension) != null ? _options$dimension : defaultViewDimension(),
      aspect: (_options$aspect = options.aspect) != null ? _options$aspect : 'all',
      baseMipLevel: (_options$baseMipLevel = options.baseMipLevel) != null ? _options$baseMipLevel : 0,
      mipLevelCount: (_options$mipLevelCoun = options.mipLevelCount) != null ? _options$mipLevelCoun : textureDescr.mipLevelCount,
      baseArrayLayer: (_options$baseArrayLay = options.baseArrayLayer) != null ? _options$baseArrayLay : 0,
      arrayLayerCount: (_options$arrayLayerCo = options.arrayLayerCount) != null ? _options$arrayLayerCo : textureDescr.depthOrArrayLayers
    };
    const view = this.gpuTexture.createView(descr);
    DebugHelper.setLabel(view, `${viewDescr ? `CustomView${JSON.stringify(viewDescr)}` : 'DefaultView'}:${this.texture.name}`);
    return view;
  }

  getSampler(device) {
    if (!this.sampler) {
      const texture = this.texture;

      const descr = {
        addressModeU: gpuAddressModes[texture.addressU],
        addressModeV: gpuAddressModes[texture.addressV],
        addressModeW: gpuAddressModes[texture.addressW]
      };

      if (this.texture.format === PIXELFORMAT_RGBA32F || this.texture.format === PIXELFORMAT_DEPTHSTENCIL) {
        descr.magFilter = 'nearest';
        descr.minFilter = 'nearest';
        descr.mipmapFilter = 'nearest';
      } else {
        descr.magFilter = 'linear';
        descr.minFilter = 'linear';
        descr.mipmapFilter = 'linear';
      }
      this.sampler = device.wgpu.createSampler(descr);
      DebugHelper.setLabel(this.sampler, `LinearSampler`);
    }
    return this.sampler;
  }
  loseContext() {}

  uploadImmediate(device, texture) {
    if (texture._needsUpload || texture._needsMipmapsUpload) {
      this.uploadData(device);
      texture._needsUpload = false;
      texture._needsMipmapsUpload = false;
    }
  }

  uploadData(device) {
    const texture = this.texture;
    const wgpu = device.wgpu;
    if (this.texture.cubemap) {
      Debug.warn('Cubemap texture data upload is not supported yet', this.texture);
      return;
    }

    const mipLevel = 0;
    const mipObject = texture._levels[mipLevel];
    if (mipObject) {
      if (mipObject instanceof ImageBitmap) {
        wgpu.queue.copyExternalImageToTexture({
          source: mipObject
        }, {
          texture: this.gpuTexture
        }, this.descr.size);
      } else if (ArrayBuffer.isView(mipObject)) {

        this.uploadTypedArrayData(wgpu, mipObject);
      } else {
        Debug.error('Unsupported texture source data', mipObject);
      }
    }
  }
  uploadTypedArrayData(wgpu, data) {
    const texture = this.texture;

    const dest = {
      texture: this.gpuTexture,
      mipLevel: 0
    };

    const numElementsPerPixel = 4;

    const dataLayout = {
      offset: 0,
      bytesPerRow: texture.width * data.BYTES_PER_ELEMENT * numElementsPerPixel,
      rowsPerImage: texture.height
    };
    const size = {
      width: texture.width,
      height: texture.height,
      depthOrArrayLayers: 1
    };
    wgpu.queue.writeTexture(dest, data, dataLayout, size);
  }
}

export { WebgpuTexture };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXRleHR1cmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9ncmFwaGljcy93ZWJncHUvd2ViZ3B1LXRleHR1cmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcsIERlYnVnSGVscGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5cbmltcG9ydCB7XG4gICAgQUREUkVTU19SRVBFQVQsIEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgQUREUkVTU19NSVJST1JFRF9SRVBFQVQsXG4gICAgUElYRUxGT1JNQVRfQTgsIFBJWEVMRk9STUFUX0w4LCBQSVhFTEZPUk1BVF9MQTgsIFBJWEVMRk9STUFUX1JHQjU2NSwgUElYRUxGT1JNQVRfUkdCQTU1NTEsIFBJWEVMRk9STUFUX1JHQkE0LFxuICAgIFBJWEVMRk9STUFUX1JHQjgsIFBJWEVMRk9STUFUX1JHQkE4LCBQSVhFTEZPUk1BVF9EWFQxLCBQSVhFTEZPUk1BVF9EWFQzLCBQSVhFTEZPUk1BVF9EWFQ1LFxuICAgIFBJWEVMRk9STUFUX1JHQjE2RiwgUElYRUxGT1JNQVRfUkdCQTE2RiwgUElYRUxGT1JNQVRfUkdCMzJGLCBQSVhFTEZPUk1BVF9SR0JBMzJGLCBQSVhFTEZPUk1BVF9SMzJGLCBQSVhFTEZPUk1BVF9ERVBUSCxcbiAgICBQSVhFTEZPUk1BVF9ERVBUSFNURU5DSUwsIFBJWEVMRk9STUFUXzExMTExMEYsIFBJWEVMRk9STUFUX1NSR0IsIFBJWEVMRk9STUFUX1NSR0JBLCBQSVhFTEZPUk1BVF9FVEMxLFxuICAgIFBJWEVMRk9STUFUX0VUQzJfUkdCLCBQSVhFTEZPUk1BVF9FVEMyX1JHQkEsIFBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCXzEsIFBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCQV8xLFxuICAgIFBJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCXzEsIFBJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCQV8xLCBQSVhFTEZPUk1BVF9BU1RDXzR4NCwgUElYRUxGT1JNQVRfQVRDX1JHQixcbiAgICBQSVhFTEZPUk1BVF9BVENfUkdCQSwgUElYRUxGT1JNQVRfQkdSQThcbn0gZnJvbSAnLi4vY29uc3RhbnRzLmpzJztcblxuLy8gbWFwIG9mIFBJWEVMRk9STUFUXyoqKiB0byBHUFVUZXh0dXJlRm9ybWF0XG5jb25zdCBncHVUZXh0dXJlRm9ybWF0cyA9IFtdO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfQThdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9MOF0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0xBOF0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQjU2NV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkE1NTUxXSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfUkdCQTRdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9SR0I4XSA9ICdyZ2JhOHVub3JtJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkE4XSA9ICdyZ2JhOHVub3JtJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0RYVDFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9EWFQzXSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfRFhUNV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQjE2Rl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkExNkZdID0gJ3JnYmExNmZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQjMyRl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1JHQkEzMkZdID0gJ3JnYmEzMmZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1IzMkZdID0gJ3IzMmZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0RFUFRIXSA9ICdkZXB0aDMyZmxvYXQnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfREVQVEhTVEVOQ0lMXSA9ICdkZXB0aDI0cGx1cy1zdGVuY2lsOCc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF8xMTExMTBGXSA9ICdyZzExYjEwdWZsb2F0JztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1NSR0JdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9TUkdCQV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0VUQzFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9FVEMyX1JHQl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0VUQzJfUkdCQV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCXzFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9QVlJUQ18yQlBQX1JHQkFfMV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX1BWUlRDXzRCUFBfUkdCXzFdID0gJyc7XG5ncHVUZXh0dXJlRm9ybWF0c1tQSVhFTEZPUk1BVF9QVlJUQ180QlBQX1JHQkFfMV0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0FTVENfNHg0XSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfQVRDX1JHQl0gPSAnJztcbmdwdVRleHR1cmVGb3JtYXRzW1BJWEVMRk9STUFUX0FUQ19SR0JBXSA9ICcnO1xuZ3B1VGV4dHVyZUZvcm1hdHNbUElYRUxGT1JNQVRfQkdSQThdID0gJ2JncmE4dW5vcm0nO1xuXG4vLyBtYXAgb2YgQUREUkVTU18qKiogdG8gR1BVQWRkcmVzc01vZGVcbmNvbnN0IGdwdUFkZHJlc3NNb2RlcyA9IFtdO1xuZ3B1QWRkcmVzc01vZGVzW0FERFJFU1NfUkVQRUFUXSA9ICdyZXBlYXQnO1xuZ3B1QWRkcmVzc01vZGVzW0FERFJFU1NfQ0xBTVBfVE9fRURHRV0gPSAnY2xhbXAtdG8tZWRnZSc7XG5ncHVBZGRyZXNzTW9kZXNbQUREUkVTU19NSVJST1JFRF9SRVBFQVRdID0gJ21pcnJvci1yZXBlYXQnO1xuXG4vKipcbiAqIEEgV2ViR1BVIGltcGxlbWVudGF0aW9uIG9mIHRoZSBUZXh0dXJlLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV2ViZ3B1VGV4dHVyZSB7XG4gICAgLy8gdHlwZSB7R1BVVGV4dHVyZX1cbiAgICBncHVUZXh0dXJlO1xuXG4gICAgLy8gdHlwZSB7R1BVVGV4dHVyZVZpZXd9XG4gICAgdmlldztcblxuICAgIC8vIHR5cGUge0dQVVNhbXBsZXJ9XG4gICAgc2FtcGxlcjtcblxuICAgIC8vIHR5cGUge0dQVVRleHR1cmVEZXNjcmlwdG9yfVxuICAgIGRlc2NyO1xuXG4gICAgLy8gdHlwZSB7R1BVVGV4dHVyZUZvcm1hdH1cbiAgICBmb3JtYXQ7XG5cbiAgICBjb25zdHJ1Y3Rvcih0ZXh0dXJlKSB7XG4gICAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuLi90ZXh0dXJlLmpzJykuVGV4dHVyZX0gKi9cbiAgICAgICAgdGhpcy50ZXh0dXJlID0gdGV4dHVyZTtcblxuICAgICAgICB0aGlzLmZvcm1hdCA9IGdwdVRleHR1cmVGb3JtYXRzW3RleHR1cmUuZm9ybWF0XTtcbiAgICAgICAgRGVidWcuYXNzZXJ0KHRoaXMuZm9ybWF0ICE9PSAnJywgYFdlYkdQVSBkb2VzIG5vdCBzdXBwb3J0IHRleHR1cmUgZm9ybWF0ICR7dGV4dHVyZS5mb3JtYXR9IGZvciB0ZXh0dXJlICR7dGV4dHVyZS5uYW1lfWAsIHRleHR1cmUpO1xuXG4gICAgICAgIHRoaXMuY3JlYXRlKHRleHR1cmUuZGV2aWNlKTtcbiAgICB9XG5cbiAgICBjcmVhdGUoZGV2aWNlKSB7XG5cbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZTtcbiAgICAgICAgY29uc3Qgd2dwdSA9IGRldmljZS53Z3B1O1xuXG4gICAgICAgIHRoaXMuZGVzY3IgPSB7XG4gICAgICAgICAgICBzaXplOiB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHRleHR1cmUud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiB0ZXh0dXJlLmhlaWdodCxcbiAgICAgICAgICAgICAgICBkZXB0aE9yQXJyYXlMYXllcnM6IHRleHR1cmUuY3ViZW1hcCA/IDYgOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmZvcm1hdCxcbiAgICAgICAgICAgIG1pcExldmVsQ291bnQ6IDEsXG4gICAgICAgICAgICBzYW1wbGVDb3VudDogMSxcbiAgICAgICAgICAgIGRpbWVuc2lvbjogdGV4dHVyZS52b2x1bWUgPyAnM2QnIDogJzJkJyxcblxuICAgICAgICAgICAgLy8gVE9ETzogdXNlIG9ubHkgcmVxdWlyZWQgdXNhZ2UgZmxhZ3NcbiAgICAgICAgICAgIC8vIENPUFlfU1JDIC0gcHJvYmFibHkgb25seSBuZWVkZWQgb24gcmVuZGVyIHRhcmdldCB0ZXh0dXJlcywgdG8gc3VwcG9ydCBjb3B5UmVuZGVyVGFyZ2V0IChncmFiIHBhc3MgbmVlZHMgaXQpXG4gICAgICAgICAgICB1c2FnZTogR1BVVGV4dHVyZVVzYWdlLlRFWFRVUkVfQklORElORyB8IEdQVVRleHR1cmVVc2FnZS5DT1BZX0RTVCB8IEdQVVRleHR1cmVVc2FnZS5SRU5ERVJfQVRUQUNITUVOVCB8IEdQVVRleHR1cmVVc2FnZS5DT1BZX1NSQ1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ3B1VGV4dHVyZSA9IHdncHUuY3JlYXRlVGV4dHVyZSh0aGlzLmRlc2NyKTtcbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwodGhpcy5ncHVUZXh0dXJlLCBgJHt0ZXh0dXJlLm5hbWV9JHt0ZXh0dXJlLmN1YmVtYXAgPyAnW2N1YmVtYXBdJyA6ICcnfSR7dGV4dHVyZS52b2x1bWUgPyAnWzNkXScgOiAnJ31gKTtcblxuICAgICAgICAvLyBkZWZhdWx0IHRleHR1cmUgdmlldyBkZXNjcmlwdG9yXG4gICAgICAgIGxldCB2aWV3RGVzY3I7XG5cbiAgICAgICAgLy8gc29tZSBmb3JtYXQgcmVxdWlyZSBjdXN0b20gZGVmYXVsdCB0ZXh0dXJlIHZpZXdcbiAgICAgICAgaWYgKHRoaXMudGV4dHVyZS5mb3JtYXQgPT09IFBJWEVMRk9STUFUX0RFUFRIU1RFTkNJTCkge1xuICAgICAgICAgICAgLy8gd2UgZXhwb3NlIHRoZSBkZXB0aCBwYXJ0IG9mIHRoZSBmb3JtYXRcbiAgICAgICAgICAgIHZpZXdEZXNjciA9IHtcbiAgICAgICAgICAgICAgICBmb3JtYXQ6ICdkZXB0aDI0cGx1cycsXG4gICAgICAgICAgICAgICAgYXNwZWN0OiAnZGVwdGgtb25seSdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnZpZXcgPSB0aGlzLmNyZWF0ZVZpZXcodmlld0Rlc2NyKTtcbiAgICB9XG5cbiAgICBkZXN0cm95KGRldmljZSkge1xuICAgIH1cblxuICAgIGdldFZpZXcoZGV2aWNlKSB7XG5cbiAgICAgICAgdGhpcy51cGxvYWRJbW1lZGlhdGUoZGV2aWNlLCB0aGlzLnRleHR1cmUpO1xuXG4gICAgICAgIERlYnVnLmFzc2VydCh0aGlzLnZpZXcpO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3O1xuICAgIH1cblxuICAgIGNyZWF0ZVZpZXcodmlld0Rlc2NyKSB7XG5cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHZpZXdEZXNjciA/PyB7fTtcbiAgICAgICAgY29uc3QgdGV4dHVyZURlc2NyID0gdGhpcy5kZXNjcjtcbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZTtcblxuICAgICAgICAvLyAnMWQnLCAnMmQnLCAnMmQtYXJyYXknLCAnY3ViZScsICdjdWJlLWFycmF5JywgJzNkJ1xuICAgICAgICBjb25zdCBkZWZhdWx0Vmlld0RpbWVuc2lvbiA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0ZXh0dXJlLmN1YmVtYXApIHJldHVybiAnY3ViZSc7XG4gICAgICAgICAgICBpZiAodGV4dHVyZS52b2x1bWUpIHJldHVybiAnM2QnO1xuICAgICAgICAgICAgcmV0dXJuICcyZCc7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gdHlwZSB7R1BVVGV4dHVyZVZpZXdEZXNjcmlwdG9yfVxuICAgICAgICBjb25zdCBkZXNjciA9IHtcbiAgICAgICAgICAgIGZvcm1hdDogb3B0aW9ucy5mb3JtYXQgPz8gdGV4dHVyZURlc2NyLmZvcm1hdCxcbiAgICAgICAgICAgIGRpbWVuc2lvbjogb3B0aW9ucy5kaW1lbnNpb24gPz8gZGVmYXVsdFZpZXdEaW1lbnNpb24oKSxcbiAgICAgICAgICAgIGFzcGVjdDogb3B0aW9ucy5hc3BlY3QgPz8gJ2FsbCcsXG4gICAgICAgICAgICBiYXNlTWlwTGV2ZWw6IG9wdGlvbnMuYmFzZU1pcExldmVsID8/IDAsXG4gICAgICAgICAgICBtaXBMZXZlbENvdW50OiBvcHRpb25zLm1pcExldmVsQ291bnQgPz8gdGV4dHVyZURlc2NyLm1pcExldmVsQ291bnQsXG4gICAgICAgICAgICBiYXNlQXJyYXlMYXllcjogb3B0aW9ucy5iYXNlQXJyYXlMYXllciA/PyAwLFxuICAgICAgICAgICAgYXJyYXlMYXllckNvdW50OiBvcHRpb25zLmFycmF5TGF5ZXJDb3VudCA/PyB0ZXh0dXJlRGVzY3IuZGVwdGhPckFycmF5TGF5ZXJzXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuZ3B1VGV4dHVyZS5jcmVhdGVWaWV3KGRlc2NyKTtcbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwodmlldywgYCR7dmlld0Rlc2NyID8gYEN1c3RvbVZpZXcke0pTT04uc3RyaW5naWZ5KHZpZXdEZXNjcil9YCA6ICdEZWZhdWx0Vmlldyd9OiR7dGhpcy50ZXh0dXJlLm5hbWV9YCk7XG5cbiAgICAgICAgcmV0dXJuIHZpZXc7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRob3NlIHByb3BlcnRpZXMgZ2V0IGNoYW5nZWRcblxuICAgIGdldFNhbXBsZXIoZGV2aWNlKSB7XG4gICAgICAgIGlmICghdGhpcy5zYW1wbGVyKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPSB0aGlzLnRleHR1cmU7XG5cbiAgICAgICAgICAgIC8vIHR5cGUgR1BVU2FtcGxlckRlc2NyaXB0b3JcbiAgICAgICAgICAgIGNvbnN0IGRlc2NyID0ge1xuICAgICAgICAgICAgICAgIGFkZHJlc3NNb2RlVTogZ3B1QWRkcmVzc01vZGVzW3RleHR1cmUuYWRkcmVzc1VdLFxuICAgICAgICAgICAgICAgIGFkZHJlc3NNb2RlVjogZ3B1QWRkcmVzc01vZGVzW3RleHR1cmUuYWRkcmVzc1ZdLFxuICAgICAgICAgICAgICAgIGFkZHJlc3NNb2RlVzogZ3B1QWRkcmVzc01vZGVzW3RleHR1cmUuYWRkcmVzc1ddXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBUT0RPOiB0aGlzIGlzIHRlbXBvcmFyeSBhbmQgbmVlZHMgdG8gYmUgbWFkZSBnZW5lcmljXG4gICAgICAgICAgICBpZiAodGhpcy50ZXh0dXJlLmZvcm1hdCA9PT0gUElYRUxGT1JNQVRfUkdCQTMyRiB8fCB0aGlzLnRleHR1cmUuZm9ybWF0ID09PSBQSVhFTEZPUk1BVF9ERVBUSFNURU5DSUwpIHtcbiAgICAgICAgICAgICAgICBkZXNjci5tYWdGaWx0ZXIgPSAnbmVhcmVzdCc7XG4gICAgICAgICAgICAgICAgZGVzY3IubWluRmlsdGVyID0gJ25lYXJlc3QnO1xuICAgICAgICAgICAgICAgIGRlc2NyLm1pcG1hcEZpbHRlciA9ICduZWFyZXN0JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVzY3IubWFnRmlsdGVyID0gJ2xpbmVhcic7XG4gICAgICAgICAgICAgICAgZGVzY3IubWluRmlsdGVyID0gJ2xpbmVhcic7XG4gICAgICAgICAgICAgICAgZGVzY3IubWlwbWFwRmlsdGVyID0gJ2xpbmVhcic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2FtcGxlciA9IGRldmljZS53Z3B1LmNyZWF0ZVNhbXBsZXIoZGVzY3IpO1xuICAgICAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwodGhpcy5zYW1wbGVyLCBgTGluZWFyU2FtcGxlcmApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc2FtcGxlcjtcbiAgICB9XG5cbiAgICBsb3NlQ29udGV4dCgpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi93ZWJncHUtZ3JhcGhpY3MtZGV2aWNlLmpzJykuV2ViZ3B1R3JhcGhpY3NEZXZpY2V9IGRldmljZSAtIFRoZSBncmFwaGljc1xuICAgICAqIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vdGV4dHVyZS5qcycpLlRleHR1cmV9IHRleHR1cmUgLSBUaGUgdGV4dHVyZS5cbiAgICAgKi9cbiAgICB1cGxvYWRJbW1lZGlhdGUoZGV2aWNlLCB0ZXh0dXJlKSB7XG5cbiAgICAgICAgaWYgKHRleHR1cmUuX25lZWRzVXBsb2FkIHx8IHRleHR1cmUuX25lZWRzTWlwbWFwc1VwbG9hZCkge1xuICAgICAgICAgICAgdGhpcy51cGxvYWREYXRhKGRldmljZSk7XG5cbiAgICAgICAgICAgIHRleHR1cmUuX25lZWRzVXBsb2FkID0gZmFsc2U7XG4gICAgICAgICAgICB0ZXh0dXJlLl9uZWVkc01pcG1hcHNVcGxvYWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL3dlYmdwdS1ncmFwaGljcy1kZXZpY2UuanMnKS5XZWJncHVHcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlIGdyYXBoaWNzXG4gICAgICogZGV2aWNlLlxuICAgICAqL1xuICAgIHVwbG9hZERhdGEoZGV2aWNlKSB7XG5cbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZTtcbiAgICAgICAgY29uc3Qgd2dwdSA9IGRldmljZS53Z3B1O1xuXG4gICAgICAgIGlmICh0aGlzLnRleHR1cmUuY3ViZW1hcCkge1xuICAgICAgICAgICAgRGVidWcud2FybignQ3ViZW1hcCB0ZXh0dXJlIGRhdGEgdXBsb2FkIGlzIG5vdCBzdXBwb3J0ZWQgeWV0JywgdGhpcy50ZXh0dXJlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVwbG9hZCB0ZXh0dXJlIGRhdGEgaWYgYW55XG4gICAgICAgIGNvbnN0IG1pcExldmVsID0gMDtcbiAgICAgICAgY29uc3QgbWlwT2JqZWN0ID0gdGV4dHVyZS5fbGV2ZWxzW21pcExldmVsXTtcbiAgICAgICAgaWYgKG1pcE9iamVjdCkge1xuXG4gICAgICAgICAgICBpZiAobWlwT2JqZWN0IGluc3RhbmNlb2YgSW1hZ2VCaXRtYXApIHtcblxuICAgICAgICAgICAgICAgIHdncHUucXVldWUuY29weUV4dGVybmFsSW1hZ2VUb1RleHR1cmUoeyBzb3VyY2U6IG1pcE9iamVjdCB9LCB7IHRleHR1cmU6IHRoaXMuZ3B1VGV4dHVyZSB9LCB0aGlzLmRlc2NyLnNpemUpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhtaXBPYmplY3QpKSB7IC8vIHR5cGVkIGFycmF5XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZFR5cGVkQXJyYXlEYXRhKHdncHUsIG1pcE9iamVjdCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBEZWJ1Zy5lcnJvcignVW5zdXBwb3J0ZWQgdGV4dHVyZSBzb3VyY2UgZGF0YScsIG1pcE9iamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGxvYWRUeXBlZEFycmF5RGF0YSh3Z3B1LCBkYXRhKSB7XG5cbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZTtcblxuICAgICAgICAvLyB0eXBlIHtHUFVJbWFnZUNvcHlUZXh0dXJlfVxuICAgICAgICBjb25zdCBkZXN0ID0ge1xuICAgICAgICAgICAgdGV4dHVyZTogdGhpcy5ncHVUZXh0dXJlLFxuICAgICAgICAgICAgbWlwTGV2ZWw6IDBcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBUT0RPOiBSR0JBIG9ubHkgZm9yIG5vdywgbmVlZHMgdG8gYmUgbW9yZSBnZW5lcmljXG4gICAgICAgIGNvbnN0IG51bUVsZW1lbnRzUGVyUGl4ZWwgPSA0O1xuXG4gICAgICAgIC8vIHR5cGUge0dQVUltYWdlRGF0YUxheW91dH1cbiAgICAgICAgY29uc3QgZGF0YUxheW91dCA9IHtcbiAgICAgICAgICAgIG9mZnNldDogMCxcbiAgICAgICAgICAgIGJ5dGVzUGVyUm93OiB0ZXh0dXJlLndpZHRoICogZGF0YS5CWVRFU19QRVJfRUxFTUVOVCAqIG51bUVsZW1lbnRzUGVyUGl4ZWwsXG4gICAgICAgICAgICByb3dzUGVySW1hZ2U6IHRleHR1cmUuaGVpZ2h0XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgc2l6ZSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiB0ZXh0dXJlLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiB0ZXh0dXJlLmhlaWdodCxcbiAgICAgICAgICAgIGRlcHRoT3JBcnJheUxheWVyczogMVxuICAgICAgICB9O1xuXG4gICAgICAgIHdncHUucXVldWUud3JpdGVUZXh0dXJlKGRlc3QsIGRhdGEsIGRhdGFMYXlvdXQsIHNpemUpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgV2ViZ3B1VGV4dHVyZSB9O1xuIl0sIm5hbWVzIjpbImdwdVRleHR1cmVGb3JtYXRzIiwiUElYRUxGT1JNQVRfQTgiLCJQSVhFTEZPUk1BVF9MOCIsIlBJWEVMRk9STUFUX0xBOCIsIlBJWEVMRk9STUFUX1JHQjU2NSIsIlBJWEVMRk9STUFUX1JHQkE1NTUxIiwiUElYRUxGT1JNQVRfUkdCQTQiLCJQSVhFTEZPUk1BVF9SR0I4IiwiUElYRUxGT1JNQVRfUkdCQTgiLCJQSVhFTEZPUk1BVF9EWFQxIiwiUElYRUxGT1JNQVRfRFhUMyIsIlBJWEVMRk9STUFUX0RYVDUiLCJQSVhFTEZPUk1BVF9SR0IxNkYiLCJQSVhFTEZPUk1BVF9SR0JBMTZGIiwiUElYRUxGT1JNQVRfUkdCMzJGIiwiUElYRUxGT1JNQVRfUkdCQTMyRiIsIlBJWEVMRk9STUFUX1IzMkYiLCJQSVhFTEZPUk1BVF9ERVBUSCIsIlBJWEVMRk9STUFUX0RFUFRIU1RFTkNJTCIsIlBJWEVMRk9STUFUXzExMTExMEYiLCJQSVhFTEZPUk1BVF9TUkdCIiwiUElYRUxGT1JNQVRfU1JHQkEiLCJQSVhFTEZPUk1BVF9FVEMxIiwiUElYRUxGT1JNQVRfRVRDMl9SR0IiLCJQSVhFTEZPUk1BVF9FVEMyX1JHQkEiLCJQSVhFTEZPUk1BVF9QVlJUQ18yQlBQX1JHQl8xIiwiUElYRUxGT1JNQVRfUFZSVENfMkJQUF9SR0JBXzEiLCJQSVhFTEZPUk1BVF9QVlJUQ180QlBQX1JHQl8xIiwiUElYRUxGT1JNQVRfUFZSVENfNEJQUF9SR0JBXzEiLCJQSVhFTEZPUk1BVF9BU1RDXzR4NCIsIlBJWEVMRk9STUFUX0FUQ19SR0IiLCJQSVhFTEZPUk1BVF9BVENfUkdCQSIsIlBJWEVMRk9STUFUX0JHUkE4IiwiZ3B1QWRkcmVzc01vZGVzIiwiQUREUkVTU19SRVBFQVQiLCJBRERSRVNTX0NMQU1QX1RPX0VER0UiLCJBRERSRVNTX01JUlJPUkVEX1JFUEVBVCIsIldlYmdwdVRleHR1cmUiLCJjb25zdHJ1Y3RvciIsInRleHR1cmUiLCJncHVUZXh0dXJlIiwidmlldyIsInNhbXBsZXIiLCJkZXNjciIsImZvcm1hdCIsIkRlYnVnIiwiYXNzZXJ0IiwibmFtZSIsImNyZWF0ZSIsImRldmljZSIsIndncHUiLCJzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aE9yQXJyYXlMYXllcnMiLCJjdWJlbWFwIiwibWlwTGV2ZWxDb3VudCIsInNhbXBsZUNvdW50IiwiZGltZW5zaW9uIiwidm9sdW1lIiwidXNhZ2UiLCJHUFVUZXh0dXJlVXNhZ2UiLCJURVhUVVJFX0JJTkRJTkciLCJDT1BZX0RTVCIsIlJFTkRFUl9BVFRBQ0hNRU5UIiwiQ09QWV9TUkMiLCJjcmVhdGVUZXh0dXJlIiwiRGVidWdIZWxwZXIiLCJzZXRMYWJlbCIsInZpZXdEZXNjciIsImFzcGVjdCIsImNyZWF0ZVZpZXciLCJkZXN0cm95IiwiZ2V0VmlldyIsInVwbG9hZEltbWVkaWF0ZSIsIm9wdGlvbnMiLCJ0ZXh0dXJlRGVzY3IiLCJkZWZhdWx0Vmlld0RpbWVuc2lvbiIsImJhc2VNaXBMZXZlbCIsImJhc2VBcnJheUxheWVyIiwiYXJyYXlMYXllckNvdW50IiwiSlNPTiIsInN0cmluZ2lmeSIsImdldFNhbXBsZXIiLCJhZGRyZXNzTW9kZVUiLCJhZGRyZXNzVSIsImFkZHJlc3NNb2RlViIsImFkZHJlc3NWIiwiYWRkcmVzc01vZGVXIiwiYWRkcmVzc1ciLCJtYWdGaWx0ZXIiLCJtaW5GaWx0ZXIiLCJtaXBtYXBGaWx0ZXIiLCJjcmVhdGVTYW1wbGVyIiwibG9zZUNvbnRleHQiLCJfbmVlZHNVcGxvYWQiLCJfbmVlZHNNaXBtYXBzVXBsb2FkIiwidXBsb2FkRGF0YSIsIndhcm4iLCJtaXBMZXZlbCIsIm1pcE9iamVjdCIsIl9sZXZlbHMiLCJJbWFnZUJpdG1hcCIsInF1ZXVlIiwiY29weUV4dGVybmFsSW1hZ2VUb1RleHR1cmUiLCJzb3VyY2UiLCJBcnJheUJ1ZmZlciIsImlzVmlldyIsInVwbG9hZFR5cGVkQXJyYXlEYXRhIiwiZXJyb3IiLCJkYXRhIiwiZGVzdCIsIm51bUVsZW1lbnRzUGVyUGl4ZWwiLCJkYXRhTGF5b3V0Iiwib2Zmc2V0IiwiYnl0ZXNQZXJSb3ciLCJCWVRFU19QRVJfRUxFTUVOVCIsInJvd3NQZXJJbWFnZSIsIndyaXRlVGV4dHVyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7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
