/**
 * @license
 * PlayCanvas Engine v1.59.0-preview revision 797466563 (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../../core/debug.js';
import { semanticToLocation, TYPE_FLOAT32, TYPE_INT8, TYPE_UINT8, TYPE_INT16, TYPE_UINT16, TYPE_INT32, TYPE_UINT32 } from '../constants.js';

const gpuVertexFormats = [];
gpuVertexFormats[TYPE_INT8] = 'sint8';
gpuVertexFormats[TYPE_UINT8] = 'uint8';
gpuVertexFormats[TYPE_INT16] = 'sint16';
gpuVertexFormats[TYPE_UINT16] = 'uint16';
gpuVertexFormats[TYPE_INT32] = 'sint32';
gpuVertexFormats[TYPE_UINT32] = 'uint32';
gpuVertexFormats[TYPE_FLOAT32] = 'float32';

class WebgpuVertexBufferLayout {
  constructor() {
    this.cache = new Map();
  }
  get(vertexFormat0, vertexFormat1 = null) {
    const key = this.getKey(vertexFormat0, vertexFormat1);
    let layout = this.cache.get(key);
    if (!layout) {
      layout = this.create(vertexFormat0, vertexFormat1);
      this.cache.set(key, layout);
    }
    return layout;
  }
  getKey(vertexFormat0, vertexFormat1 = null) {
    return vertexFormat0.renderingingHashString + (vertexFormat1 ? vertexFormat1.renderingingHashString : '');
  }

  create(vertexFormat0, vertexFormat1) {
    const layout = [];
    const addFormat = format => {
      const interleaved = format.interleaved;
      const stepMode = format.instancing ? 'instance' : 'vertex';
      let attributes = [];
      const elementCount = format.elements.length;
      for (let i = 0; i < elementCount; i++) {
        const element = format.elements[i];
        const location = semanticToLocation[element.name];

        Debug.assert(element.dataType === TYPE_FLOAT32, `Only float vertex attributes are supported, ${element.dataType} is not supported, semantic: ${element.name}.`, element);
        attributes.push({
          shaderLocation: location,
          offset: interleaved ? element.offset : 0,
          format: `${gpuVertexFormats[element.dataType]}${element.numComponents > 1 ? 'x' + element.numComponents : ''}`
        });
        if (!interleaved || i === elementCount - 1) {
          layout.push({
            attributes: attributes,
            arrayStride: element.stride,
            stepMode: stepMode
          });
          attributes = [];
        }
      }
    };
    addFormat(vertexFormat0);
    if (vertexFormat1) {
      addFormat(vertexFormat1);
    }
    return layout;
  }
}

export { WebgpuVertexBufferLayout };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXZlcnRleC1idWZmZXItbGF5b3V0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3Mvd2ViZ3B1L3dlYmdwdS12ZXJ0ZXgtYnVmZmVyLWxheW91dC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2RlYnVnLmpzXCI7XG5cbmltcG9ydCB7XG4gICAgc2VtYW50aWNUb0xvY2F0aW9uLFxuICAgIFRZUEVfSU5UOCwgVFlQRV9VSU5UOCwgVFlQRV9JTlQxNiwgVFlQRV9VSU5UMTYsIFRZUEVfSU5UMzIsIFRZUEVfVUlOVDMyLCBUWVBFX0ZMT0FUMzJcbn0gZnJvbSAnLi4vY29uc3RhbnRzLmpzJztcblxuLy8gbWFwIG9mIFRZUEVfKioqIHRvIEdQVVZlcnRleEZvcm1hdFxuY29uc3QgZ3B1VmVydGV4Rm9ybWF0cyA9IFtdO1xuZ3B1VmVydGV4Rm9ybWF0c1tUWVBFX0lOVDhdID0gJ3NpbnQ4JztcbmdwdVZlcnRleEZvcm1hdHNbVFlQRV9VSU5UOF0gPSAndWludDgnO1xuZ3B1VmVydGV4Rm9ybWF0c1tUWVBFX0lOVDE2XSA9ICdzaW50MTYnO1xuZ3B1VmVydGV4Rm9ybWF0c1tUWVBFX1VJTlQxNl0gPSAndWludDE2JztcbmdwdVZlcnRleEZvcm1hdHNbVFlQRV9JTlQzMl0gPSAnc2ludDMyJztcbmdwdVZlcnRleEZvcm1hdHNbVFlQRV9VSU5UMzJdID0gJ3VpbnQzMic7XG5ncHVWZXJ0ZXhGb3JtYXRzW1RZUEVfRkxPQVQzMl0gPSAnZmxvYXQzMic7XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBXZWJncHVWZXJ0ZXhCdWZmZXJMYXlvdXQge1xuICAgIC8vIHR5cGUge01hcDxzdHJpbmcsIEdQVVZlcnRleEJ1ZmZlckxheW91dFtdPn1cbiAgICBjYWNoZSA9IG5ldyBNYXAoKTtcblxuICAgIC8qKlxuICAgICAqIE9idGFpbiBhIHZlcnRleCBsYXlvdXQgb2Ygb25lIG9yIHR3byB2ZXJ0ZXggZm9ybWF0cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi92ZXJ0ZXgtZm9ybWF0LmpzJykuVmVydGV4Rm9ybWF0fSB2ZXJ0ZXhGb3JtYXQwIC0gVGhlIGZpcnN0IHZlcnRleCBmb3JtYXQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL3ZlcnRleC1mb3JtYXQuanMnKS5WZXJ0ZXhGb3JtYXR9IFt2ZXJ0ZXhGb3JtYXQxXSAtIFRoZSBzZWNvbmQgdmVydGV4IGZvcm1hdC5cbiAgICAgKiBAcmV0dXJucyB7YW55W119IC0gVGhlIHZlcnRleCBsYXlvdXQuXG4gICAgICovXG4gICAgZ2V0KHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEgPSBudWxsKSB7XG5cbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSk7XG4gICAgICAgIGxldCBsYXlvdXQgPSB0aGlzLmNhY2hlLmdldChrZXkpO1xuICAgICAgICBpZiAoIWxheW91dCkge1xuICAgICAgICAgICAgbGF5b3V0ID0gdGhpcy5jcmVhdGUodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLnNldChrZXksIGxheW91dCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxheW91dDtcbiAgICB9XG5cbiAgICBnZXRLZXkodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSA9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZlcnRleEZvcm1hdDAucmVuZGVyaW5naW5nSGFzaFN0cmluZyArICh2ZXJ0ZXhGb3JtYXQxID8gdmVydGV4Rm9ybWF0MS5yZW5kZXJpbmdpbmdIYXNoU3RyaW5nIDogJycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi92ZXJ0ZXgtZm9ybWF0LmpzJykuVmVydGV4Rm9ybWF0fSB2ZXJ0ZXhGb3JtYXQwIC0gVGhlIGZpcnN0IHZlcnRleCBmb3JtYXQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL3ZlcnRleC1mb3JtYXQuanMnKS5WZXJ0ZXhGb3JtYXR9IHZlcnRleEZvcm1hdDEgLSBUaGUgc2Vjb25kIHZlcnRleCBmb3JtYXQuXG4gICAgICogQHJldHVybnMge2FueVtdfSAtIFRoZSB2ZXJ0ZXggYnVmZmVyIGxheW91dC5cbiAgICAgKi9cbiAgICBjcmVhdGUodmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSkge1xuXG4gICAgICAgIC8vIHR5cGUgIHtHUFVWZXJ0ZXhCdWZmZXJMYXlvdXRbXX1cbiAgICAgICAgY29uc3QgbGF5b3V0ID0gW107XG5cbiAgICAgICAgY29uc3QgYWRkRm9ybWF0ID0gKGZvcm1hdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJsZWF2ZWQgPSBmb3JtYXQuaW50ZXJsZWF2ZWQ7XG4gICAgICAgICAgICBjb25zdCBzdGVwTW9kZSA9IGZvcm1hdC5pbnN0YW5jaW5nID8gJ2luc3RhbmNlJyA6ICd2ZXJ0ZXgnO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRDb3VudCA9IGZvcm1hdC5lbGVtZW50cy5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGZvcm1hdC5lbGVtZW50c1tpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHNlbWFudGljVG9Mb2NhdGlvbltlbGVtZW50Lm5hbWVdO1xuXG4gICAgICAgICAgICAgICAgLy8gQSBXR0wgc2hhZGVyIG5lZWRzIGF0dHJpYnV0ZXMgdG8gaGF2ZSBtYXRjaGluZyB0eXBlcywgYnV0IGdsc2xhbmcgdHJhbnNsYXRvciB3ZSB1c2UgZG9lcyBub3QgYWxsb3cgdXMgdG8gc2V0IHRob3NlXG4gICAgICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGVsZW1lbnQuZGF0YVR5cGUgPT09IFRZUEVfRkxPQVQzMiwgYE9ubHkgZmxvYXQgdmVydGV4IGF0dHJpYnV0ZXMgYXJlIHN1cHBvcnRlZCwgJHtlbGVtZW50LmRhdGFUeXBlfSBpcyBub3Qgc3VwcG9ydGVkLCBzZW1hbnRpYzogJHtlbGVtZW50Lm5hbWV9LmAsIGVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2hhZGVyTG9jYXRpb246IGxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IGludGVybGVhdmVkID8gZWxlbWVudC5vZmZzZXQgOiAwLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGAke2dwdVZlcnRleEZvcm1hdHNbZWxlbWVudC5kYXRhVHlwZV19JHtlbGVtZW50Lm51bUNvbXBvbmVudHMgPiAxID8gJ3gnICsgZWxlbWVudC5udW1Db21wb25lbnRzIDogJyd9YFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpbnRlcmxlYXZlZCB8fCBpID09PSBlbGVtZW50Q291bnQgLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGxheW91dC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJheVN0cmlkZTogZWxlbWVudC5zdHJpZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwTW9kZTogc3RlcE1vZGVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgYWRkRm9ybWF0KHZlcnRleEZvcm1hdDApO1xuICAgICAgICBpZiAodmVydGV4Rm9ybWF0MSkge1xuICAgICAgICAgICAgYWRkRm9ybWF0KHZlcnRleEZvcm1hdDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGxheW91dDtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdlYmdwdVZlcnRleEJ1ZmZlckxheW91dCB9O1xuIl0sIm5hbWVzIjpbImdwdVZlcnRleEZvcm1hdHMiLCJUWVBFX0lOVDgiLCJUWVBFX1VJTlQ4IiwiVFlQRV9JTlQxNiIsIlRZUEVfVUlOVDE2IiwiVFlQRV9JTlQzMiIsIlRZUEVfVUlOVDMyIiwiVFlQRV9GTE9BVDMyIiwiV2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0IiwiY2FjaGUiLCJNYXAiLCJnZXQiLCJ2ZXJ0ZXhGb3JtYXQwIiwidmVydGV4Rm9ybWF0MSIsImtleSIsImdldEtleSIsImxheW91dCIsImNyZWF0ZSIsInNldCIsInJlbmRlcmluZ2luZ0hhc2hTdHJpbmciLCJhZGRGb3JtYXQiLCJmb3JtYXQiLCJpbnRlcmxlYXZlZCIsInN0ZXBNb2RlIiwiaW5zdGFuY2luZyIsImF0dHJpYnV0ZXMiLCJlbGVtZW50Q291bnQiLCJlbGVtZW50cyIsImxlbmd0aCIsImkiLCJlbGVtZW50IiwibG9jYXRpb24iLCJzZW1hbnRpY1RvTG9jYXRpb24iLCJuYW1lIiwiRGVidWciLCJhc3NlcnQiLCJkYXRhVHlwZSIsInB1c2giLCJzaGFkZXJMb2NhdGlvbiIsIm9mZnNldCIsIm51bUNvbXBvbmVudHMiLCJhcnJheVN0cmlkZSIsInN0cmlkZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFRQSxNQUFNQSxnQkFBZ0IsR0FBRyxFQUFFLENBQUE7QUFDM0JBLGdCQUFnQixDQUFDQyxTQUFTLENBQUMsR0FBRyxPQUFPLENBQUE7QUFDckNELGdCQUFnQixDQUFDRSxVQUFVLENBQUMsR0FBRyxPQUFPLENBQUE7QUFDdENGLGdCQUFnQixDQUFDRyxVQUFVLENBQUMsR0FBRyxRQUFRLENBQUE7QUFDdkNILGdCQUFnQixDQUFDSSxXQUFXLENBQUMsR0FBRyxRQUFRLENBQUE7QUFDeENKLGdCQUFnQixDQUFDSyxVQUFVLENBQUMsR0FBRyxRQUFRLENBQUE7QUFDdkNMLGdCQUFnQixDQUFDTSxXQUFXLENBQUMsR0FBRyxRQUFRLENBQUE7QUFDeENOLGdCQUFnQixDQUFDTyxZQUFZLENBQUMsR0FBRyxTQUFTLENBQUE7O0FBSzFDLE1BQU1DLHdCQUF3QixDQUFDO0FBQUEsRUFBQSxXQUFBLEdBQUE7QUFBQSxJQUFBLElBQUEsQ0FFM0JDLEtBQUssR0FBRyxJQUFJQyxHQUFHLEVBQUUsQ0FBQTtBQUFBLEdBQUE7QUFTakJDLEVBQUFBLEdBQUcsQ0FBQ0MsYUFBYSxFQUFFQyxhQUFhLEdBQUcsSUFBSSxFQUFFO0lBRXJDLE1BQU1DLEdBQUcsR0FBRyxJQUFJLENBQUNDLE1BQU0sQ0FBQ0gsYUFBYSxFQUFFQyxhQUFhLENBQUMsQ0FBQTtJQUNyRCxJQUFJRyxNQUFNLEdBQUcsSUFBSSxDQUFDUCxLQUFLLENBQUNFLEdBQUcsQ0FBQ0csR0FBRyxDQUFDLENBQUE7SUFDaEMsSUFBSSxDQUFDRSxNQUFNLEVBQUU7TUFDVEEsTUFBTSxHQUFHLElBQUksQ0FBQ0MsTUFBTSxDQUFDTCxhQUFhLEVBQUVDLGFBQWEsQ0FBQyxDQUFBO01BQ2xELElBQUksQ0FBQ0osS0FBSyxDQUFDUyxHQUFHLENBQUNKLEdBQUcsRUFBRUUsTUFBTSxDQUFDLENBQUE7QUFDL0IsS0FBQTtBQUNBLElBQUEsT0FBT0EsTUFBTSxDQUFBO0FBQ2pCLEdBQUE7QUFFQUQsRUFBQUEsTUFBTSxDQUFDSCxhQUFhLEVBQUVDLGFBQWEsR0FBRyxJQUFJLEVBQUU7SUFDeEMsT0FBT0QsYUFBYSxDQUFDTyxzQkFBc0IsSUFBSU4sYUFBYSxHQUFHQSxhQUFhLENBQUNNLHNCQUFzQixHQUFHLEVBQUUsQ0FBQyxDQUFBO0FBQzdHLEdBQUE7O0FBT0FGLEVBQUFBLE1BQU0sQ0FBQ0wsYUFBYSxFQUFFQyxhQUFhLEVBQUU7SUFHakMsTUFBTUcsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUVqQixNQUFNSSxTQUFTLEdBQUlDLE1BQU0sSUFBSztBQUMxQixNQUFBLE1BQU1DLFdBQVcsR0FBR0QsTUFBTSxDQUFDQyxXQUFXLENBQUE7TUFDdEMsTUFBTUMsUUFBUSxHQUFHRixNQUFNLENBQUNHLFVBQVUsR0FBRyxVQUFVLEdBQUcsUUFBUSxDQUFBO01BQzFELElBQUlDLFVBQVUsR0FBRyxFQUFFLENBQUE7QUFDbkIsTUFBQSxNQUFNQyxZQUFZLEdBQUdMLE1BQU0sQ0FBQ00sUUFBUSxDQUFDQyxNQUFNLENBQUE7TUFDM0MsS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdILFlBQVksRUFBRUcsQ0FBQyxFQUFFLEVBQUU7QUFDbkMsUUFBQSxNQUFNQyxPQUFPLEdBQUdULE1BQU0sQ0FBQ00sUUFBUSxDQUFDRSxDQUFDLENBQUMsQ0FBQTtBQUNsQyxRQUFBLE1BQU1FLFFBQVEsR0FBR0Msa0JBQWtCLENBQUNGLE9BQU8sQ0FBQ0csSUFBSSxDQUFDLENBQUE7O1FBR2pEQyxLQUFLLENBQUNDLE1BQU0sQ0FBQ0wsT0FBTyxDQUFDTSxRQUFRLEtBQUs3QixZQUFZLEVBQUcsQ0FBQSw0Q0FBQSxFQUE4Q3VCLE9BQU8sQ0FBQ00sUUFBUyxnQ0FBK0JOLE9BQU8sQ0FBQ0csSUFBSyxDQUFFLENBQUEsQ0FBQSxFQUFFSCxPQUFPLENBQUMsQ0FBQTtRQUV4S0wsVUFBVSxDQUFDWSxJQUFJLENBQUM7QUFDWkMsVUFBQUEsY0FBYyxFQUFFUCxRQUFRO0FBQ3hCUSxVQUFBQSxNQUFNLEVBQUVqQixXQUFXLEdBQUdRLE9BQU8sQ0FBQ1MsTUFBTSxHQUFHLENBQUM7VUFDeENsQixNQUFNLEVBQUcsR0FBRXJCLGdCQUFnQixDQUFDOEIsT0FBTyxDQUFDTSxRQUFRLENBQUUsQ0FBRU4sRUFBQUEsT0FBTyxDQUFDVSxhQUFhLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBR1YsT0FBTyxDQUFDVSxhQUFhLEdBQUcsRUFBRyxDQUFBLENBQUE7QUFDakgsU0FBQyxDQUFDLENBQUE7UUFFRixJQUFJLENBQUNsQixXQUFXLElBQUlPLENBQUMsS0FBS0gsWUFBWSxHQUFHLENBQUMsRUFBRTtVQUN4Q1YsTUFBTSxDQUFDcUIsSUFBSSxDQUFDO0FBQ1JaLFlBQUFBLFVBQVUsRUFBRUEsVUFBVTtZQUN0QmdCLFdBQVcsRUFBRVgsT0FBTyxDQUFDWSxNQUFNO0FBQzNCbkIsWUFBQUEsUUFBUSxFQUFFQSxRQUFBQTtBQUNkLFdBQUMsQ0FBQyxDQUFBO0FBQ0ZFLFVBQUFBLFVBQVUsR0FBRyxFQUFFLENBQUE7QUFDbkIsU0FBQTtBQUNKLE9BQUE7S0FDSCxDQUFBO0lBRURMLFNBQVMsQ0FBQ1IsYUFBYSxDQUFDLENBQUE7QUFDeEIsSUFBQSxJQUFJQyxhQUFhLEVBQUU7TUFDZk8sU0FBUyxDQUFDUCxhQUFhLENBQUMsQ0FBQTtBQUM1QixLQUFBO0FBRUEsSUFBQSxPQUFPRyxNQUFNLENBQUE7QUFDakIsR0FBQTtBQUNKOzs7OyJ9
