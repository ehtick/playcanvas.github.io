/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug, DebugHelper } from '../../../core/debug.js';

/**
 * A WebGPU implementation of the RenderTarget.
 *
 * @ignore
 */
class WebgpuRenderTarget {
  /** @type {boolean} */

  /** @type {string} */

  /**
   * Unique key used by render pipeline creation
   *
   * @type {string}
   */

  /** @type {string} */

  /** @type {boolean} */

  /**
   * @type {GPUTexture}
   * @private
   */

  /**
   * @type {GPUTexture}
   * @private
   */

  /**
   * True if the depthTexture is internally allocated / owned
   *
   * @type {boolean}
   */

  /**
   * Texture assigned each frame, and not owned by this render target. This is used on the
   * framebuffer to assign per frame texture obtained from the context.
   *
   * @type {GPUTexture}
   * @private
   */

  /**
   * Render pass descriptor used when starting a render pass for this render target.
   *
   * @type {GPURenderPassDescriptor}
   * @private
   */

  /**
   * @param {import('../render-target.js').RenderTarget} renderTarget - The render target owning
   * this implementation.
   */
  constructor(renderTarget) {
    this.initialized = false;
    this.colorFormat = void 0;
    this.key = void 0;
    this.depthFormat = void 0;
    this.hasStencil = void 0;
    this.multisampledColorBuffer = void 0;
    this.depthTexture = null;
    this.depthTextureInternal = false;
    this.assignedColorTexture = null;
    this.renderPassDescriptor = {};
    this.renderTarget = renderTarget;

    // color format is based on the texture
    if (renderTarget.colorBuffer) {
      this.colorFormat = renderTarget.colorBuffer.impl.format;
    }
    this.updateKey();
  }

  /**
   * @param {import('../webgpu/webgpu-graphics-device.js').WebgpuGraphicsDevice} device - The
   * graphics device.
   */
  destroy(device) {
    var _this$multisampledCol;
    this.initialized = false;
    this.renderPassDescriptor = null;
    if (this.depthTextureInternal) {
      var _this$depthTexture;
      (_this$depthTexture = this.depthTexture) == null ? void 0 : _this$depthTexture.destroy();
      this.depthTexture = null;
    }
    this.assignedColorTexture = null;
    (_this$multisampledCol = this.multisampledColorBuffer) == null ? void 0 : _this$multisampledCol.destroy();
    this.multisampledColorBuffer = null;
  }
  updateKey() {
    // key used by render pipeline creation
    const rt = this.renderTarget;
    this.key = `${this.colorFormat}-${rt.depth ? this.depthFormat : ''}-${rt.samples}`;
  }
  setDepthFormat(depthFormat) {
    Debug.assert(depthFormat);
    this.depthFormat = depthFormat;
    this.hasStencil = depthFormat === 'depth24plus-stencil8';
  }

  /**
   * Assign a color buffer. This allows the color buffer of the main framebuffer
   * to be swapped each frame to a buffer provided by the context.
   *
   * @param {any} gpuTexture - The color buffer.
   */
  assignColorTexture(gpuTexture) {
    Debug.assert(gpuTexture);
    this.assignedColorTexture = gpuTexture;
    const view = gpuTexture.createView();

    // use it as render buffer or resolve target
    const colorAttachment = this.renderPassDescriptor.colorAttachments[0];
    const samples = this.renderTarget.samples;
    if (samples > 1) {
      colorAttachment.resolveTarget = view;
    } else {
      colorAttachment.view = view;
    }

    // for main framebuffer, this is how the format is obtained
    this.colorFormat = gpuTexture.format;
    this.updateKey();
  }

  /**
   * Initialize render target for rendering one time.
   *
   * @param {import('../webgpu/webgpu-graphics-device.js').WebgpuGraphicsDevice} device - The
   * graphics device.
   * @param {import('../render-target.js').RenderTarget} renderTarget - The render target.
   */
  init(device, renderTarget) {
    Debug.assert(!this.initialized);
    const wgpu = device.wgpu;
    const {
      samples,
      width,
      height,
      depth,
      depthBuffer
    } = renderTarget;

    // depth buffer that we render to (single or multi-sampled). We don't create resolve
    // depth buffer as we don't currently resolve it. This might need to change in the future.
    if (depth || depthBuffer) {
      // allocate depth buffer if not provided
      if (!depthBuffer) {
        // TODO: support rendering to 32bit depth without a stencil as well
        this.setDepthFormat('depth24plus-stencil8');

        /** @type {GPUTextureDescriptor} */
        const depthTextureDesc = {
          size: [width, height, 1],
          dimension: '2d',
          sampleCount: samples,
          format: this.depthFormat,
          usage: GPUTextureUsage.RENDER_ATTACHMENT
        };

        // single sampled depth buffer can be copied out (grab pass), multisampled cannot
        // TODO: we should not enable this for shadow maps, as this is not needed it
        if (samples <= 1) {
          depthTextureDesc.usage |= GPUTextureUsage.COPY_SRC;
        }

        // allocate depth buffer
        this.depthTexture = wgpu.createTexture(depthTextureDesc);
        this.depthTextureInternal = true;
      } else {
        // use provided depth buffer
        this.depthTexture = depthBuffer.impl.gpuTexture;
        this.setDepthFormat(depthBuffer.impl.format);
      }
      Debug.assert(this.depthTexture);
      DebugHelper.setLabel(this.depthTexture, `${renderTarget.name}.depthTexture`);

      // @type {GPURenderPassDepthStencilAttachment}
      this.renderPassDescriptor.depthStencilAttachment = {
        view: this.depthTexture.createView()
      };
    }

    // Single-sampled color buffer gets passed in:
    // - for normal render target, constructor takes the color buffer as an option
    // - for the main framebuffer, the device supplies the buffer each frame
    // And so we only need to create multi-sampled color buffer if needed here.
    /** @type {GPURenderPassColorAttachment} */
    const colorAttachment = {};
    this.renderPassDescriptor.colorAttachments = [];
    const colorBuffer = renderTarget.colorBuffer;
    let colorView = null;
    if (colorBuffer) {
      colorView = colorBuffer.impl.getView(device);

      // cubemap face view - face is a single 2d array layer in order [+X, -X, +Y, -Y, +Z, -Z]
      if (colorBuffer.cubemap) {
        colorView = colorBuffer.impl.createView({
          dimension: '2d',
          baseArrayLayer: renderTarget.face,
          arrayLayerCount: 1
        });
      }
    }

    // multi-sampled color buffer
    if (samples > 1) {
      /** @type {GPUTextureDescriptor} */
      const multisampledTextureDesc = {
        size: [width, height, 1],
        dimension: '2d',
        sampleCount: samples,
        format: this.colorFormat,
        usage: GPUTextureUsage.RENDER_ATTACHMENT
      };

      // allocate multi-sampled color buffer
      this.multisampledColorBuffer = wgpu.createTexture(multisampledTextureDesc);
      colorAttachment.view = this.multisampledColorBuffer.createView();
      colorAttachment.resolveTarget = colorView;
    } else {
      colorAttachment.view = colorView;
    }
    if (colorAttachment.view) {
      this.renderPassDescriptor.colorAttachments.push(colorAttachment);
    }
    this.initialized = true;
  }

  /**
   * Update WebGPU render pass descriptor by RenderPass settings.
   *
   * @param {import('../render-pass.js').RenderPass} renderPass - The render pass to start.
   */
  setupForRenderPass(renderPass) {
    var _this$renderPassDescr;
    Debug.assert(this.renderPassDescriptor);
    const colorAttachment = (_this$renderPassDescr = this.renderPassDescriptor.colorAttachments) == null ? void 0 : _this$renderPassDescr[0];
    if (colorAttachment) {
      colorAttachment.clearValue = renderPass.colorOps.clearValue;
      colorAttachment.loadOp = renderPass.colorOps.clear ? 'clear' : 'load';
      colorAttachment.storeOp = renderPass.colorOps.store ? 'store' : 'discard';
    }
    const depthAttachment = this.renderPassDescriptor.depthStencilAttachment;
    if (depthAttachment) {
      depthAttachment.depthClearValue = renderPass.depthStencilOps.clearDepthValue;
      depthAttachment.depthLoadOp = renderPass.depthStencilOps.clearDepth ? 'clear' : 'load';
      depthAttachment.depthStoreOp = renderPass.depthStencilOps.storeDepth ? 'store' : 'discard';
      depthAttachment.depthReadOnly = false;
      if (this.hasStencil) {
        depthAttachment.stencilClearValue = renderPass.depthStencilOps.clearStencilValue;
        depthAttachment.stencilLoadOp = renderPass.depthStencilOps.clearStencil ? 'clear' : 'load';
        depthAttachment.stencilStoreOp = renderPass.depthStencilOps.storeStencil ? 'store' : 'discard';
        depthAttachment.stencilReadOnly = false;
      }
    }
  }
  loseContext() {
    this.initialized = false;
  }
  resolve(device, target, color, depth) {}
}

export { WebgpuRenderTarget };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXJlbmRlci10YXJnZXQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9ncmFwaGljcy93ZWJncHUvd2ViZ3B1LXJlbmRlci10YXJnZXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcsIERlYnVnSGVscGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5cbi8qKlxuICogQSBXZWJHUFUgaW1wbGVtZW50YXRpb24gb2YgdGhlIFJlbmRlclRhcmdldC5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFdlYmdwdVJlbmRlclRhcmdldCB7XG4gICAgLyoqIEB0eXBlIHtib29sZWFufSAqL1xuICAgIGluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgICAvKiogQHR5cGUge3N0cmluZ30gKi9cbiAgICBjb2xvckZvcm1hdDtcblxuICAgIC8qKlxuICAgICAqIFVuaXF1ZSBrZXkgdXNlZCBieSByZW5kZXIgcGlwZWxpbmUgY3JlYXRpb25cbiAgICAgKlxuICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICovXG4gICAga2V5O1xuXG4gICAgLyoqIEB0eXBlIHtzdHJpbmd9ICovXG4gICAgZGVwdGhGb3JtYXQ7XG5cbiAgICAvKiogQHR5cGUge2Jvb2xlYW59ICovXG4gICAgaGFzU3RlbmNpbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtHUFVUZXh0dXJlfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgbXVsdGlzYW1wbGVkQ29sb3JCdWZmZXI7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7R1BVVGV4dHVyZX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGRlcHRoVGV4dHVyZSA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBUcnVlIGlmIHRoZSBkZXB0aFRleHR1cmUgaXMgaW50ZXJuYWxseSBhbGxvY2F0ZWQgLyBvd25lZFxuICAgICAqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgZGVwdGhUZXh0dXJlSW50ZXJuYWwgPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIFRleHR1cmUgYXNzaWduZWQgZWFjaCBmcmFtZSwgYW5kIG5vdCBvd25lZCBieSB0aGlzIHJlbmRlciB0YXJnZXQuIFRoaXMgaXMgdXNlZCBvbiB0aGVcbiAgICAgKiBmcmFtZWJ1ZmZlciB0byBhc3NpZ24gcGVyIGZyYW1lIHRleHR1cmUgb2J0YWluZWQgZnJvbSB0aGUgY29udGV4dC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtHUFVUZXh0dXJlfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgYXNzaWduZWRDb2xvclRleHR1cmUgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIHBhc3MgZGVzY3JpcHRvciB1c2VkIHdoZW4gc3RhcnRpbmcgYSByZW5kZXIgcGFzcyBmb3IgdGhpcyByZW5kZXIgdGFyZ2V0LlxuICAgICAqXG4gICAgICogQHR5cGUge0dQVVJlbmRlclBhc3NEZXNjcmlwdG9yfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcmVuZGVyUGFzc0Rlc2NyaXB0b3IgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9yZW5kZXItdGFyZ2V0LmpzJykuUmVuZGVyVGFyZ2V0fSByZW5kZXJUYXJnZXQgLSBUaGUgcmVuZGVyIHRhcmdldCBvd25pbmdcbiAgICAgKiB0aGlzIGltcGxlbWVudGF0aW9uLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlclRhcmdldCkge1xuICAgICAgICB0aGlzLnJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDtcblxuICAgICAgICAvLyBjb2xvciBmb3JtYXQgaXMgYmFzZWQgb24gdGhlIHRleHR1cmVcbiAgICAgICAgaWYgKHJlbmRlclRhcmdldC5jb2xvckJ1ZmZlcikge1xuICAgICAgICAgICAgdGhpcy5jb2xvckZvcm1hdCA9IHJlbmRlclRhcmdldC5jb2xvckJ1ZmZlci5pbXBsLmZvcm1hdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlS2V5KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL3dlYmdwdS93ZWJncHUtZ3JhcGhpY3MtZGV2aWNlLmpzJykuV2ViZ3B1R3JhcGhpY3NEZXZpY2V9IGRldmljZSAtIFRoZVxuICAgICAqIGdyYXBoaWNzIGRldmljZS5cbiAgICAgKi9cbiAgICBkZXN0cm95KGRldmljZSkge1xuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVuZGVyUGFzc0Rlc2NyaXB0b3IgPSBudWxsO1xuXG4gICAgICAgIGlmICh0aGlzLmRlcHRoVGV4dHVyZUludGVybmFsKSB7XG4gICAgICAgICAgICB0aGlzLmRlcHRoVGV4dHVyZT8uZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5kZXB0aFRleHR1cmUgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hc3NpZ25lZENvbG9yVGV4dHVyZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5tdWx0aXNhbXBsZWRDb2xvckJ1ZmZlcj8uZGVzdHJveSgpO1xuICAgICAgICB0aGlzLm11bHRpc2FtcGxlZENvbG9yQnVmZmVyID0gbnVsbDtcbiAgICB9XG5cbiAgICB1cGRhdGVLZXkoKSB7XG4gICAgICAgIC8vIGtleSB1c2VkIGJ5IHJlbmRlciBwaXBlbGluZSBjcmVhdGlvblxuICAgICAgICBjb25zdCBydCA9IHRoaXMucmVuZGVyVGFyZ2V0O1xuICAgICAgICB0aGlzLmtleSA9IGAke3RoaXMuY29sb3JGb3JtYXR9LSR7cnQuZGVwdGggPyB0aGlzLmRlcHRoRm9ybWF0IDogJyd9LSR7cnQuc2FtcGxlc31gO1xuICAgIH1cblxuICAgIHNldERlcHRoRm9ybWF0KGRlcHRoRm9ybWF0KSB7XG4gICAgICAgIERlYnVnLmFzc2VydChkZXB0aEZvcm1hdCk7XG4gICAgICAgIHRoaXMuZGVwdGhGb3JtYXQgPSBkZXB0aEZvcm1hdDtcbiAgICAgICAgdGhpcy5oYXNTdGVuY2lsID0gZGVwdGhGb3JtYXQgPT09ICdkZXB0aDI0cGx1cy1zdGVuY2lsOCc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWduIGEgY29sb3IgYnVmZmVyLiBUaGlzIGFsbG93cyB0aGUgY29sb3IgYnVmZmVyIG9mIHRoZSBtYWluIGZyYW1lYnVmZmVyXG4gICAgICogdG8gYmUgc3dhcHBlZCBlYWNoIGZyYW1lIHRvIGEgYnVmZmVyIHByb3ZpZGVkIGJ5IHRoZSBjb250ZXh0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHthbnl9IGdwdVRleHR1cmUgLSBUaGUgY29sb3IgYnVmZmVyLlxuICAgICAqL1xuICAgIGFzc2lnbkNvbG9yVGV4dHVyZShncHVUZXh0dXJlKSB7XG5cbiAgICAgICAgRGVidWcuYXNzZXJ0KGdwdVRleHR1cmUpO1xuICAgICAgICB0aGlzLmFzc2lnbmVkQ29sb3JUZXh0dXJlID0gZ3B1VGV4dHVyZTtcblxuICAgICAgICBjb25zdCB2aWV3ID0gZ3B1VGV4dHVyZS5jcmVhdGVWaWV3KCk7XG5cbiAgICAgICAgLy8gdXNlIGl0IGFzIHJlbmRlciBidWZmZXIgb3IgcmVzb2x2ZSB0YXJnZXRcbiAgICAgICAgY29uc3QgY29sb3JBdHRhY2htZW50ID0gdGhpcy5yZW5kZXJQYXNzRGVzY3JpcHRvci5jb2xvckF0dGFjaG1lbnRzWzBdO1xuICAgICAgICBjb25zdCBzYW1wbGVzID0gdGhpcy5yZW5kZXJUYXJnZXQuc2FtcGxlcztcbiAgICAgICAgaWYgKHNhbXBsZXMgPiAxKSB7XG4gICAgICAgICAgICBjb2xvckF0dGFjaG1lbnQucmVzb2x2ZVRhcmdldCA9IHZpZXc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb2xvckF0dGFjaG1lbnQudmlldyA9IHZpZXc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmb3IgbWFpbiBmcmFtZWJ1ZmZlciwgdGhpcyBpcyBob3cgdGhlIGZvcm1hdCBpcyBvYnRhaW5lZFxuICAgICAgICB0aGlzLmNvbG9yRm9ybWF0ID0gZ3B1VGV4dHVyZS5mb3JtYXQ7XG4gICAgICAgIHRoaXMudXBkYXRlS2V5KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSByZW5kZXIgdGFyZ2V0IGZvciByZW5kZXJpbmcgb25lIHRpbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vd2ViZ3B1L3dlYmdwdS1ncmFwaGljcy1kZXZpY2UuanMnKS5XZWJncHVHcmFwaGljc0RldmljZX0gZGV2aWNlIC0gVGhlXG4gICAgICogZ3JhcGhpY3MgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9yZW5kZXItdGFyZ2V0LmpzJykuUmVuZGVyVGFyZ2V0fSByZW5kZXJUYXJnZXQgLSBUaGUgcmVuZGVyIHRhcmdldC5cbiAgICAgKi9cbiAgICBpbml0KGRldmljZSwgcmVuZGVyVGFyZ2V0KSB7XG5cbiAgICAgICAgRGVidWcuYXNzZXJ0KCF0aGlzLmluaXRpYWxpemVkKTtcbiAgICAgICAgY29uc3Qgd2dwdSA9IGRldmljZS53Z3B1O1xuXG4gICAgICAgIGNvbnN0IHsgc2FtcGxlcywgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGRlcHRoQnVmZmVyIH0gPSByZW5kZXJUYXJnZXQ7XG5cbiAgICAgICAgLy8gZGVwdGggYnVmZmVyIHRoYXQgd2UgcmVuZGVyIHRvIChzaW5nbGUgb3IgbXVsdGktc2FtcGxlZCkuIFdlIGRvbid0IGNyZWF0ZSByZXNvbHZlXG4gICAgICAgIC8vIGRlcHRoIGJ1ZmZlciBhcyB3ZSBkb24ndCBjdXJyZW50bHkgcmVzb2x2ZSBpdC4gVGhpcyBtaWdodCBuZWVkIHRvIGNoYW5nZSBpbiB0aGUgZnV0dXJlLlxuICAgICAgICBpZiAoZGVwdGggfHwgZGVwdGhCdWZmZXIpIHtcblxuICAgICAgICAgICAgLy8gYWxsb2NhdGUgZGVwdGggYnVmZmVyIGlmIG5vdCBwcm92aWRlZFxuICAgICAgICAgICAgaWYgKCFkZXB0aEJ1ZmZlcikge1xuXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogc3VwcG9ydCByZW5kZXJpbmcgdG8gMzJiaXQgZGVwdGggd2l0aG91dCBhIHN0ZW5jaWwgYXMgd2VsbFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVwdGhGb3JtYXQoJ2RlcHRoMjRwbHVzLXN0ZW5jaWw4Jyk7XG5cbiAgICAgICAgICAgICAgICAvKiogQHR5cGUge0dQVVRleHR1cmVEZXNjcmlwdG9yfSAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlcHRoVGV4dHVyZURlc2MgPSB7XG4gICAgICAgICAgICAgICAgICAgIHNpemU6IFt3aWR0aCwgaGVpZ2h0LCAxXSxcbiAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uOiAnMmQnLFxuICAgICAgICAgICAgICAgICAgICBzYW1wbGVDb3VudDogc2FtcGxlcyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRlcHRoRm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICB1c2FnZTogR1BVVGV4dHVyZVVzYWdlLlJFTkRFUl9BVFRBQ0hNRU5UXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIHNpbmdsZSBzYW1wbGVkIGRlcHRoIGJ1ZmZlciBjYW4gYmUgY29waWVkIG91dCAoZ3JhYiBwYXNzKSwgbXVsdGlzYW1wbGVkIGNhbm5vdFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IHdlIHNob3VsZCBub3QgZW5hYmxlIHRoaXMgZm9yIHNoYWRvdyBtYXBzLCBhcyB0aGlzIGlzIG5vdCBuZWVkZWQgaXRcbiAgICAgICAgICAgICAgICBpZiAoc2FtcGxlcyA8PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcHRoVGV4dHVyZURlc2MudXNhZ2UgfD0gR1BVVGV4dHVyZVVzYWdlLkNPUFlfU1JDO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFsbG9jYXRlIGRlcHRoIGJ1ZmZlclxuICAgICAgICAgICAgICAgIHRoaXMuZGVwdGhUZXh0dXJlID0gd2dwdS5jcmVhdGVUZXh0dXJlKGRlcHRoVGV4dHVyZURlc2MpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVwdGhUZXh0dXJlSW50ZXJuYWwgPSB0cnVlO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgLy8gdXNlIHByb3ZpZGVkIGRlcHRoIGJ1ZmZlclxuICAgICAgICAgICAgICAgIHRoaXMuZGVwdGhUZXh0dXJlID0gZGVwdGhCdWZmZXIuaW1wbC5ncHVUZXh0dXJlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGVwdGhGb3JtYXQoZGVwdGhCdWZmZXIuaW1wbC5mb3JtYXQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEZWJ1Zy5hc3NlcnQodGhpcy5kZXB0aFRleHR1cmUpO1xuICAgICAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwodGhpcy5kZXB0aFRleHR1cmUsIGAke3JlbmRlclRhcmdldC5uYW1lfS5kZXB0aFRleHR1cmVgKTtcblxuICAgICAgICAgICAgLy8gQHR5cGUge0dQVVJlbmRlclBhc3NEZXB0aFN0ZW5jaWxBdHRhY2htZW50fVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJQYXNzRGVzY3JpcHRvci5kZXB0aFN0ZW5jaWxBdHRhY2htZW50ID0ge1xuICAgICAgICAgICAgICAgIHZpZXc6IHRoaXMuZGVwdGhUZXh0dXJlLmNyZWF0ZVZpZXcoKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNpbmdsZS1zYW1wbGVkIGNvbG9yIGJ1ZmZlciBnZXRzIHBhc3NlZCBpbjpcbiAgICAgICAgLy8gLSBmb3Igbm9ybWFsIHJlbmRlciB0YXJnZXQsIGNvbnN0cnVjdG9yIHRha2VzIHRoZSBjb2xvciBidWZmZXIgYXMgYW4gb3B0aW9uXG4gICAgICAgIC8vIC0gZm9yIHRoZSBtYWluIGZyYW1lYnVmZmVyLCB0aGUgZGV2aWNlIHN1cHBsaWVzIHRoZSBidWZmZXIgZWFjaCBmcmFtZVxuICAgICAgICAvLyBBbmQgc28gd2Ugb25seSBuZWVkIHRvIGNyZWF0ZSBtdWx0aS1zYW1wbGVkIGNvbG9yIGJ1ZmZlciBpZiBuZWVkZWQgaGVyZS5cbiAgICAgICAgLyoqIEB0eXBlIHtHUFVSZW5kZXJQYXNzQ29sb3JBdHRhY2htZW50fSAqL1xuICAgICAgICBjb25zdCBjb2xvckF0dGFjaG1lbnQgPSB7fTtcbiAgICAgICAgdGhpcy5yZW5kZXJQYXNzRGVzY3JpcHRvci5jb2xvckF0dGFjaG1lbnRzID0gW107XG5cbiAgICAgICAgY29uc3QgY29sb3JCdWZmZXIgPSByZW5kZXJUYXJnZXQuY29sb3JCdWZmZXI7XG4gICAgICAgIGxldCBjb2xvclZpZXcgPSBudWxsO1xuICAgICAgICBpZiAoY29sb3JCdWZmZXIpIHtcbiAgICAgICAgICAgIGNvbG9yVmlldyA9IGNvbG9yQnVmZmVyLmltcGwuZ2V0VmlldyhkZXZpY2UpO1xuXG4gICAgICAgICAgICAvLyBjdWJlbWFwIGZhY2UgdmlldyAtIGZhY2UgaXMgYSBzaW5nbGUgMmQgYXJyYXkgbGF5ZXIgaW4gb3JkZXIgWytYLCAtWCwgK1ksIC1ZLCArWiwgLVpdXG4gICAgICAgICAgICBpZiAoY29sb3JCdWZmZXIuY3ViZW1hcCkge1xuICAgICAgICAgICAgICAgIGNvbG9yVmlldyA9IGNvbG9yQnVmZmVyLmltcGwuY3JlYXRlVmlldyh7XG4gICAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogJzJkJyxcbiAgICAgICAgICAgICAgICAgICAgYmFzZUFycmF5TGF5ZXI6IHJlbmRlclRhcmdldC5mYWNlLFxuICAgICAgICAgICAgICAgICAgICBhcnJheUxheWVyQ291bnQ6IDFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG11bHRpLXNhbXBsZWQgY29sb3IgYnVmZmVyXG4gICAgICAgIGlmIChzYW1wbGVzID4gMSkge1xuXG4gICAgICAgICAgICAvKiogQHR5cGUge0dQVVRleHR1cmVEZXNjcmlwdG9yfSAqL1xuICAgICAgICAgICAgY29uc3QgbXVsdGlzYW1wbGVkVGV4dHVyZURlc2MgPSB7XG4gICAgICAgICAgICAgICAgc2l6ZTogW3dpZHRoLCBoZWlnaHQsIDFdLFxuICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogJzJkJyxcbiAgICAgICAgICAgICAgICBzYW1wbGVDb3VudDogc2FtcGxlcyxcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuY29sb3JGb3JtYXQsXG4gICAgICAgICAgICAgICAgdXNhZ2U6IEdQVVRleHR1cmVVc2FnZS5SRU5ERVJfQVRUQUNITUVOVFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gYWxsb2NhdGUgbXVsdGktc2FtcGxlZCBjb2xvciBidWZmZXJcbiAgICAgICAgICAgIHRoaXMubXVsdGlzYW1wbGVkQ29sb3JCdWZmZXIgPSB3Z3B1LmNyZWF0ZVRleHR1cmUobXVsdGlzYW1wbGVkVGV4dHVyZURlc2MpO1xuXG4gICAgICAgICAgICBjb2xvckF0dGFjaG1lbnQudmlldyA9IHRoaXMubXVsdGlzYW1wbGVkQ29sb3JCdWZmZXIuY3JlYXRlVmlldygpO1xuICAgICAgICAgICAgY29sb3JBdHRhY2htZW50LnJlc29sdmVUYXJnZXQgPSBjb2xvclZpZXc7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgY29sb3JBdHRhY2htZW50LnZpZXcgPSBjb2xvclZpZXc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29sb3JBdHRhY2htZW50LnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyUGFzc0Rlc2NyaXB0b3IuY29sb3JBdHRhY2htZW50cy5wdXNoKGNvbG9yQXR0YWNobWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgV2ViR1BVIHJlbmRlciBwYXNzIGRlc2NyaXB0b3IgYnkgUmVuZGVyUGFzcyBzZXR0aW5ncy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9yZW5kZXItcGFzcy5qcycpLlJlbmRlclBhc3N9IHJlbmRlclBhc3MgLSBUaGUgcmVuZGVyIHBhc3MgdG8gc3RhcnQuXG4gICAgICovXG4gICAgc2V0dXBGb3JSZW5kZXJQYXNzKHJlbmRlclBhc3MpIHtcblxuICAgICAgICBEZWJ1Zy5hc3NlcnQodGhpcy5yZW5kZXJQYXNzRGVzY3JpcHRvcik7XG5cbiAgICAgICAgY29uc3QgY29sb3JBdHRhY2htZW50ID0gdGhpcy5yZW5kZXJQYXNzRGVzY3JpcHRvci5jb2xvckF0dGFjaG1lbnRzPy5bMF07XG4gICAgICAgIGlmIChjb2xvckF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgIGNvbG9yQXR0YWNobWVudC5jbGVhclZhbHVlID0gcmVuZGVyUGFzcy5jb2xvck9wcy5jbGVhclZhbHVlO1xuICAgICAgICAgICAgY29sb3JBdHRhY2htZW50LmxvYWRPcCA9IHJlbmRlclBhc3MuY29sb3JPcHMuY2xlYXIgPyAnY2xlYXInIDogJ2xvYWQnO1xuICAgICAgICAgICAgY29sb3JBdHRhY2htZW50LnN0b3JlT3AgPSByZW5kZXJQYXNzLmNvbG9yT3BzLnN0b3JlID8gJ3N0b3JlJyA6ICdkaXNjYXJkJztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlcHRoQXR0YWNobWVudCA9IHRoaXMucmVuZGVyUGFzc0Rlc2NyaXB0b3IuZGVwdGhTdGVuY2lsQXR0YWNobWVudDtcbiAgICAgICAgaWYgKGRlcHRoQXR0YWNobWVudCkge1xuICAgICAgICAgICAgZGVwdGhBdHRhY2htZW50LmRlcHRoQ2xlYXJWYWx1ZSA9IHJlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLmNsZWFyRGVwdGhWYWx1ZTtcbiAgICAgICAgICAgIGRlcHRoQXR0YWNobWVudC5kZXB0aExvYWRPcCA9IHJlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLmNsZWFyRGVwdGggPyAnY2xlYXInIDogJ2xvYWQnO1xuICAgICAgICAgICAgZGVwdGhBdHRhY2htZW50LmRlcHRoU3RvcmVPcCA9IHJlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLnN0b3JlRGVwdGggPyAnc3RvcmUnIDogJ2Rpc2NhcmQnO1xuICAgICAgICAgICAgZGVwdGhBdHRhY2htZW50LmRlcHRoUmVhZE9ubHkgPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzU3RlbmNpbCkge1xuICAgICAgICAgICAgICAgIGRlcHRoQXR0YWNobWVudC5zdGVuY2lsQ2xlYXJWYWx1ZSA9IHJlbmRlclBhc3MuZGVwdGhTdGVuY2lsT3BzLmNsZWFyU3RlbmNpbFZhbHVlO1xuICAgICAgICAgICAgICAgIGRlcHRoQXR0YWNobWVudC5zdGVuY2lsTG9hZE9wID0gcmVuZGVyUGFzcy5kZXB0aFN0ZW5jaWxPcHMuY2xlYXJTdGVuY2lsID8gJ2NsZWFyJyA6ICdsb2FkJztcbiAgICAgICAgICAgICAgICBkZXB0aEF0dGFjaG1lbnQuc3RlbmNpbFN0b3JlT3AgPSByZW5kZXJQYXNzLmRlcHRoU3RlbmNpbE9wcy5zdG9yZVN0ZW5jaWwgPyAnc3RvcmUnIDogJ2Rpc2NhcmQnO1xuICAgICAgICAgICAgICAgIGRlcHRoQXR0YWNobWVudC5zdGVuY2lsUmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxvc2VDb250ZXh0KCkge1xuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmVzb2x2ZShkZXZpY2UsIHRhcmdldCwgY29sb3IsIGRlcHRoKSB7XG4gICAgfVxufVxuXG5leHBvcnQgeyBXZWJncHVSZW5kZXJUYXJnZXQgfTtcbiJdLCJuYW1lcyI6WyJXZWJncHVSZW5kZXJUYXJnZXQiLCJjb25zdHJ1Y3RvciIsInJlbmRlclRhcmdldCIsImluaXRpYWxpemVkIiwiY29sb3JGb3JtYXQiLCJrZXkiLCJkZXB0aEZvcm1hdCIsImhhc1N0ZW5jaWwiLCJtdWx0aXNhbXBsZWRDb2xvckJ1ZmZlciIsImRlcHRoVGV4dHVyZSIsImRlcHRoVGV4dHVyZUludGVybmFsIiwiYXNzaWduZWRDb2xvclRleHR1cmUiLCJyZW5kZXJQYXNzRGVzY3JpcHRvciIsImNvbG9yQnVmZmVyIiwiaW1wbCIsImZvcm1hdCIsInVwZGF0ZUtleSIsImRlc3Ryb3kiLCJkZXZpY2UiLCJydCIsImRlcHRoIiwic2FtcGxlcyIsInNldERlcHRoRm9ybWF0IiwiRGVidWciLCJhc3NlcnQiLCJhc3NpZ25Db2xvclRleHR1cmUiLCJncHVUZXh0dXJlIiwidmlldyIsImNyZWF0ZVZpZXciLCJjb2xvckF0dGFjaG1lbnQiLCJjb2xvckF0dGFjaG1lbnRzIiwicmVzb2x2ZVRhcmdldCIsImluaXQiLCJ3Z3B1Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aEJ1ZmZlciIsImRlcHRoVGV4dHVyZURlc2MiLCJzaXplIiwiZGltZW5zaW9uIiwic2FtcGxlQ291bnQiLCJ1c2FnZSIsIkdQVVRleHR1cmVVc2FnZSIsIlJFTkRFUl9BVFRBQ0hNRU5UIiwiQ09QWV9TUkMiLCJjcmVhdGVUZXh0dXJlIiwiRGVidWdIZWxwZXIiLCJzZXRMYWJlbCIsIm5hbWUiLCJkZXB0aFN0ZW5jaWxBdHRhY2htZW50IiwiY29sb3JWaWV3IiwiZ2V0VmlldyIsImN1YmVtYXAiLCJiYXNlQXJyYXlMYXllciIsImZhY2UiLCJhcnJheUxheWVyQ291bnQiLCJtdWx0aXNhbXBsZWRUZXh0dXJlRGVzYyIsInB1c2giLCJzZXR1cEZvclJlbmRlclBhc3MiLCJyZW5kZXJQYXNzIiwiY2xlYXJWYWx1ZSIsImNvbG9yT3BzIiwibG9hZE9wIiwiY2xlYXIiLCJzdG9yZU9wIiwic3RvcmUiLCJkZXB0aEF0dGFjaG1lbnQiLCJkZXB0aENsZWFyVmFsdWUiLCJkZXB0aFN0ZW5jaWxPcHMiLCJjbGVhckRlcHRoVmFsdWUiLCJkZXB0aExvYWRPcCIsImNsZWFyRGVwdGgiLCJkZXB0aFN0b3JlT3AiLCJzdG9yZURlcHRoIiwiZGVwdGhSZWFkT25seSIsInN0ZW5jaWxDbGVhclZhbHVlIiwiY2xlYXJTdGVuY2lsVmFsdWUiLCJzdGVuY2lsTG9hZE9wIiwiY2xlYXJTdGVuY2lsIiwic3RlbmNpbFN0b3JlT3AiLCJzdG9yZVN0ZW5jaWwiLCJzdGVuY2lsUmVhZE9ubHkiLCJsb3NlQ29udGV4dCIsInJlc29sdmUiLCJ0YXJnZXQiLCJjb2xvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxrQkFBa0IsQ0FBQztBQUNyQjs7QUFHQTs7QUFHQTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUdJOztBQUdBOztBQUdBO0FBQ0o7QUFDQTtBQUNBOztBQUdJO0FBQ0o7QUFDQTtBQUNBOztBQUdJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBR0k7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0k7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdJO0FBQ0o7QUFDQTtBQUNBO0VBQ0lDLFdBQVcsQ0FBQ0MsWUFBWSxFQUFFO0lBQUEsSUExRDFCQyxDQUFBQSxXQUFXLEdBQUcsS0FBSyxDQUFBO0FBQUEsSUFBQSxJQUFBLENBR25CQyxXQUFXLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FPWEMsR0FBRyxHQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQUEsSUFBQSxJQUFBLENBR0hDLFdBQVcsR0FBQSxLQUFBLENBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQSxDQUdYQyxVQUFVLEdBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FNVkMsdUJBQXVCLEdBQUEsS0FBQSxDQUFBLENBQUE7SUFBQSxJQU12QkMsQ0FBQUEsWUFBWSxHQUFHLElBQUksQ0FBQTtJQUFBLElBT25CQyxDQUFBQSxvQkFBb0IsR0FBRyxLQUFLLENBQUE7SUFBQSxJQVM1QkMsQ0FBQUEsb0JBQW9CLEdBQUcsSUFBSSxDQUFBO0lBQUEsSUFRM0JDLENBQUFBLG9CQUFvQixHQUFHLEVBQUUsQ0FBQTtJQU9yQixJQUFJLENBQUNWLFlBQVksR0FBR0EsWUFBWSxDQUFBOztBQUVoQztJQUNBLElBQUlBLFlBQVksQ0FBQ1csV0FBVyxFQUFFO01BQzFCLElBQUksQ0FBQ1QsV0FBVyxHQUFHRixZQUFZLENBQUNXLFdBQVcsQ0FBQ0MsSUFBSSxDQUFDQyxNQUFNLENBQUE7QUFDM0QsS0FBQTtJQUVBLElBQUksQ0FBQ0MsU0FBUyxFQUFFLENBQUE7QUFDcEIsR0FBQTs7QUFFQTtBQUNKO0FBQ0E7QUFDQTtFQUNJQyxPQUFPLENBQUNDLE1BQU0sRUFBRTtBQUFBLElBQUEsSUFBQSxxQkFBQSxDQUFBO0lBQ1osSUFBSSxDQUFDZixXQUFXLEdBQUcsS0FBSyxDQUFBO0lBQ3hCLElBQUksQ0FBQ1Msb0JBQW9CLEdBQUcsSUFBSSxDQUFBO0lBRWhDLElBQUksSUFBSSxDQUFDRixvQkFBb0IsRUFBRTtBQUFBLE1BQUEsSUFBQSxrQkFBQSxDQUFBO0FBQzNCLE1BQUEsQ0FBQSxrQkFBQSxHQUFBLElBQUksQ0FBQ0QsWUFBWSxLQUFqQixJQUFBLEdBQUEsS0FBQSxDQUFBLEdBQUEsa0JBQUEsQ0FBbUJRLE9BQU8sRUFBRSxDQUFBO01BQzVCLElBQUksQ0FBQ1IsWUFBWSxHQUFHLElBQUksQ0FBQTtBQUM1QixLQUFBO0lBRUEsSUFBSSxDQUFDRSxvQkFBb0IsR0FBRyxJQUFJLENBQUE7QUFFaEMsSUFBQSxDQUFBLHFCQUFBLEdBQUEsSUFBSSxDQUFDSCx1QkFBdUIsS0FBNUIsSUFBQSxHQUFBLEtBQUEsQ0FBQSxHQUFBLHFCQUFBLENBQThCUyxPQUFPLEVBQUUsQ0FBQTtJQUN2QyxJQUFJLENBQUNULHVCQUF1QixHQUFHLElBQUksQ0FBQTtBQUN2QyxHQUFBO0FBRUFRLEVBQUFBLFNBQVMsR0FBRztBQUNSO0FBQ0EsSUFBQSxNQUFNRyxFQUFFLEdBQUcsSUFBSSxDQUFDakIsWUFBWSxDQUFBO0lBQzVCLElBQUksQ0FBQ0csR0FBRyxHQUFJLENBQUEsRUFBRSxJQUFJLENBQUNELFdBQVksSUFBR2UsRUFBRSxDQUFDQyxLQUFLLEdBQUcsSUFBSSxDQUFDZCxXQUFXLEdBQUcsRUFBRyxDQUFHYSxDQUFBQSxFQUFBQSxFQUFFLENBQUNFLE9BQVEsQ0FBQyxDQUFBLENBQUE7QUFDdEYsR0FBQTtFQUVBQyxjQUFjLENBQUNoQixXQUFXLEVBQUU7QUFDeEJpQixJQUFBQSxLQUFLLENBQUNDLE1BQU0sQ0FBQ2xCLFdBQVcsQ0FBQyxDQUFBO0lBQ3pCLElBQUksQ0FBQ0EsV0FBVyxHQUFHQSxXQUFXLENBQUE7QUFDOUIsSUFBQSxJQUFJLENBQUNDLFVBQVUsR0FBR0QsV0FBVyxLQUFLLHNCQUFzQixDQUFBO0FBQzVELEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0ltQixrQkFBa0IsQ0FBQ0MsVUFBVSxFQUFFO0FBRTNCSCxJQUFBQSxLQUFLLENBQUNDLE1BQU0sQ0FBQ0UsVUFBVSxDQUFDLENBQUE7SUFDeEIsSUFBSSxDQUFDZixvQkFBb0IsR0FBR2UsVUFBVSxDQUFBO0FBRXRDLElBQUEsTUFBTUMsSUFBSSxHQUFHRCxVQUFVLENBQUNFLFVBQVUsRUFBRSxDQUFBOztBQUVwQztJQUNBLE1BQU1DLGVBQWUsR0FBRyxJQUFJLENBQUNqQixvQkFBb0IsQ0FBQ2tCLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ3JFLElBQUEsTUFBTVQsT0FBTyxHQUFHLElBQUksQ0FBQ25CLFlBQVksQ0FBQ21CLE9BQU8sQ0FBQTtJQUN6QyxJQUFJQSxPQUFPLEdBQUcsQ0FBQyxFQUFFO01BQ2JRLGVBQWUsQ0FBQ0UsYUFBYSxHQUFHSixJQUFJLENBQUE7QUFDeEMsS0FBQyxNQUFNO01BQ0hFLGVBQWUsQ0FBQ0YsSUFBSSxHQUFHQSxJQUFJLENBQUE7QUFDL0IsS0FBQTs7QUFFQTtBQUNBLElBQUEsSUFBSSxDQUFDdkIsV0FBVyxHQUFHc0IsVUFBVSxDQUFDWCxNQUFNLENBQUE7SUFDcEMsSUFBSSxDQUFDQyxTQUFTLEVBQUUsQ0FBQTtBQUNwQixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0lnQixFQUFBQSxJQUFJLENBQUNkLE1BQU0sRUFBRWhCLFlBQVksRUFBRTtBQUV2QnFCLElBQUFBLEtBQUssQ0FBQ0MsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDckIsV0FBVyxDQUFDLENBQUE7QUFDL0IsSUFBQSxNQUFNOEIsSUFBSSxHQUFHZixNQUFNLENBQUNlLElBQUksQ0FBQTtJQUV4QixNQUFNO01BQUVaLE9BQU87TUFBRWEsS0FBSztNQUFFQyxNQUFNO01BQUVmLEtBQUs7QUFBRWdCLE1BQUFBLFdBQUFBO0FBQVksS0FBQyxHQUFHbEMsWUFBWSxDQUFBOztBQUVuRTtBQUNBO0lBQ0EsSUFBSWtCLEtBQUssSUFBSWdCLFdBQVcsRUFBRTtBQUV0QjtNQUNBLElBQUksQ0FBQ0EsV0FBVyxFQUFFO0FBRWQ7QUFDQSxRQUFBLElBQUksQ0FBQ2QsY0FBYyxDQUFDLHNCQUFzQixDQUFDLENBQUE7O0FBRTNDO0FBQ0EsUUFBQSxNQUFNZSxnQkFBZ0IsR0FBRztBQUNyQkMsVUFBQUEsSUFBSSxFQUFFLENBQUNKLEtBQUssRUFBRUMsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUN4QkksVUFBQUEsU0FBUyxFQUFFLElBQUk7QUFDZkMsVUFBQUEsV0FBVyxFQUFFbkIsT0FBTztVQUNwQk4sTUFBTSxFQUFFLElBQUksQ0FBQ1QsV0FBVztVQUN4Qm1DLEtBQUssRUFBRUMsZUFBZSxDQUFDQyxpQkFBQUE7U0FDMUIsQ0FBQTs7QUFFRDtBQUNBO1FBQ0EsSUFBSXRCLE9BQU8sSUFBSSxDQUFDLEVBQUU7QUFDZGdCLFVBQUFBLGdCQUFnQixDQUFDSSxLQUFLLElBQUlDLGVBQWUsQ0FBQ0UsUUFBUSxDQUFBO0FBQ3RELFNBQUE7O0FBRUE7UUFDQSxJQUFJLENBQUNuQyxZQUFZLEdBQUd3QixJQUFJLENBQUNZLGFBQWEsQ0FBQ1IsZ0JBQWdCLENBQUMsQ0FBQTtRQUN4RCxJQUFJLENBQUMzQixvQkFBb0IsR0FBRyxJQUFJLENBQUE7QUFFcEMsT0FBQyxNQUFNO0FBRUg7QUFDQSxRQUFBLElBQUksQ0FBQ0QsWUFBWSxHQUFHMkIsV0FBVyxDQUFDdEIsSUFBSSxDQUFDWSxVQUFVLENBQUE7UUFDL0MsSUFBSSxDQUFDSixjQUFjLENBQUNjLFdBQVcsQ0FBQ3RCLElBQUksQ0FBQ0MsTUFBTSxDQUFDLENBQUE7QUFDaEQsT0FBQTtBQUVBUSxNQUFBQSxLQUFLLENBQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUNmLFlBQVksQ0FBQyxDQUFBO0FBQy9CcUMsTUFBQUEsV0FBVyxDQUFDQyxRQUFRLENBQUMsSUFBSSxDQUFDdEMsWUFBWSxFQUFHLENBQUEsRUFBRVAsWUFBWSxDQUFDOEMsSUFBSyxDQUFBLGFBQUEsQ0FBYyxDQUFDLENBQUE7O0FBRTVFO0FBQ0EsTUFBQSxJQUFJLENBQUNwQyxvQkFBb0IsQ0FBQ3FDLHNCQUFzQixHQUFHO0FBQy9DdEIsUUFBQUEsSUFBSSxFQUFFLElBQUksQ0FBQ2xCLFlBQVksQ0FBQ21CLFVBQVUsRUFBQTtPQUNyQyxDQUFBO0FBQ0wsS0FBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0lBQ0EsTUFBTUMsZUFBZSxHQUFHLEVBQUUsQ0FBQTtBQUMxQixJQUFBLElBQUksQ0FBQ2pCLG9CQUFvQixDQUFDa0IsZ0JBQWdCLEdBQUcsRUFBRSxDQUFBO0FBRS9DLElBQUEsTUFBTWpCLFdBQVcsR0FBR1gsWUFBWSxDQUFDVyxXQUFXLENBQUE7SUFDNUMsSUFBSXFDLFNBQVMsR0FBRyxJQUFJLENBQUE7QUFDcEIsSUFBQSxJQUFJckMsV0FBVyxFQUFFO01BQ2JxQyxTQUFTLEdBQUdyQyxXQUFXLENBQUNDLElBQUksQ0FBQ3FDLE9BQU8sQ0FBQ2pDLE1BQU0sQ0FBQyxDQUFBOztBQUU1QztNQUNBLElBQUlMLFdBQVcsQ0FBQ3VDLE9BQU8sRUFBRTtBQUNyQkYsUUFBQUEsU0FBUyxHQUFHckMsV0FBVyxDQUFDQyxJQUFJLENBQUNjLFVBQVUsQ0FBQztBQUNwQ1csVUFBQUEsU0FBUyxFQUFFLElBQUk7VUFDZmMsY0FBYyxFQUFFbkQsWUFBWSxDQUFDb0QsSUFBSTtBQUNqQ0MsVUFBQUEsZUFBZSxFQUFFLENBQUE7QUFDckIsU0FBQyxDQUFDLENBQUE7QUFDTixPQUFBO0FBQ0osS0FBQTs7QUFFQTtJQUNBLElBQUlsQyxPQUFPLEdBQUcsQ0FBQyxFQUFFO0FBRWI7QUFDQSxNQUFBLE1BQU1tQyx1QkFBdUIsR0FBRztBQUM1QmxCLFFBQUFBLElBQUksRUFBRSxDQUFDSixLQUFLLEVBQUVDLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDeEJJLFFBQUFBLFNBQVMsRUFBRSxJQUFJO0FBQ2ZDLFFBQUFBLFdBQVcsRUFBRW5CLE9BQU87UUFDcEJOLE1BQU0sRUFBRSxJQUFJLENBQUNYLFdBQVc7UUFDeEJxQyxLQUFLLEVBQUVDLGVBQWUsQ0FBQ0MsaUJBQUFBO09BQzFCLENBQUE7O0FBRUQ7TUFDQSxJQUFJLENBQUNuQyx1QkFBdUIsR0FBR3lCLElBQUksQ0FBQ1ksYUFBYSxDQUFDVyx1QkFBdUIsQ0FBQyxDQUFBO01BRTFFM0IsZUFBZSxDQUFDRixJQUFJLEdBQUcsSUFBSSxDQUFDbkIsdUJBQXVCLENBQUNvQixVQUFVLEVBQUUsQ0FBQTtNQUNoRUMsZUFBZSxDQUFDRSxhQUFhLEdBQUdtQixTQUFTLENBQUE7QUFFN0MsS0FBQyxNQUFNO01BRUhyQixlQUFlLENBQUNGLElBQUksR0FBR3VCLFNBQVMsQ0FBQTtBQUNwQyxLQUFBO0lBRUEsSUFBSXJCLGVBQWUsQ0FBQ0YsSUFBSSxFQUFFO01BQ3RCLElBQUksQ0FBQ2Ysb0JBQW9CLENBQUNrQixnQkFBZ0IsQ0FBQzJCLElBQUksQ0FBQzVCLGVBQWUsQ0FBQyxDQUFBO0FBQ3BFLEtBQUE7SUFFQSxJQUFJLENBQUMxQixXQUFXLEdBQUcsSUFBSSxDQUFBO0FBQzNCLEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0E7QUFDQTtFQUNJdUQsa0JBQWtCLENBQUNDLFVBQVUsRUFBRTtBQUFBLElBQUEsSUFBQSxxQkFBQSxDQUFBO0FBRTNCcEMsSUFBQUEsS0FBSyxDQUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDWixvQkFBb0IsQ0FBQyxDQUFBO0lBRXZDLE1BQU1pQixlQUFlLEdBQUcsQ0FBQSxxQkFBQSxHQUFBLElBQUksQ0FBQ2pCLG9CQUFvQixDQUFDa0IsZ0JBQWdCLEtBQUEsSUFBQSxHQUFBLEtBQUEsQ0FBQSxHQUExQyxxQkFBNkMsQ0FBQSxDQUFDLENBQUMsQ0FBQTtBQUN2RSxJQUFBLElBQUlELGVBQWUsRUFBRTtBQUNqQkEsTUFBQUEsZUFBZSxDQUFDK0IsVUFBVSxHQUFHRCxVQUFVLENBQUNFLFFBQVEsQ0FBQ0QsVUFBVSxDQUFBO01BQzNEL0IsZUFBZSxDQUFDaUMsTUFBTSxHQUFHSCxVQUFVLENBQUNFLFFBQVEsQ0FBQ0UsS0FBSyxHQUFHLE9BQU8sR0FBRyxNQUFNLENBQUE7TUFDckVsQyxlQUFlLENBQUNtQyxPQUFPLEdBQUdMLFVBQVUsQ0FBQ0UsUUFBUSxDQUFDSSxLQUFLLEdBQUcsT0FBTyxHQUFHLFNBQVMsQ0FBQTtBQUM3RSxLQUFBO0FBRUEsSUFBQSxNQUFNQyxlQUFlLEdBQUcsSUFBSSxDQUFDdEQsb0JBQW9CLENBQUNxQyxzQkFBc0IsQ0FBQTtBQUN4RSxJQUFBLElBQUlpQixlQUFlLEVBQUU7QUFDakJBLE1BQUFBLGVBQWUsQ0FBQ0MsZUFBZSxHQUFHUixVQUFVLENBQUNTLGVBQWUsQ0FBQ0MsZUFBZSxDQUFBO01BQzVFSCxlQUFlLENBQUNJLFdBQVcsR0FBR1gsVUFBVSxDQUFDUyxlQUFlLENBQUNHLFVBQVUsR0FBRyxPQUFPLEdBQUcsTUFBTSxDQUFBO01BQ3RGTCxlQUFlLENBQUNNLFlBQVksR0FBR2IsVUFBVSxDQUFDUyxlQUFlLENBQUNLLFVBQVUsR0FBRyxPQUFPLEdBQUcsU0FBUyxDQUFBO01BQzFGUCxlQUFlLENBQUNRLGFBQWEsR0FBRyxLQUFLLENBQUE7TUFFckMsSUFBSSxJQUFJLENBQUNuRSxVQUFVLEVBQUU7QUFDakIyRCxRQUFBQSxlQUFlLENBQUNTLGlCQUFpQixHQUFHaEIsVUFBVSxDQUFDUyxlQUFlLENBQUNRLGlCQUFpQixDQUFBO1FBQ2hGVixlQUFlLENBQUNXLGFBQWEsR0FBR2xCLFVBQVUsQ0FBQ1MsZUFBZSxDQUFDVSxZQUFZLEdBQUcsT0FBTyxHQUFHLE1BQU0sQ0FBQTtRQUMxRlosZUFBZSxDQUFDYSxjQUFjLEdBQUdwQixVQUFVLENBQUNTLGVBQWUsQ0FBQ1ksWUFBWSxHQUFHLE9BQU8sR0FBRyxTQUFTLENBQUE7UUFDOUZkLGVBQWUsQ0FBQ2UsZUFBZSxHQUFHLEtBQUssQ0FBQTtBQUMzQyxPQUFBO0FBQ0osS0FBQTtBQUNKLEdBQUE7QUFFQUMsRUFBQUEsV0FBVyxHQUFHO0lBQ1YsSUFBSSxDQUFDL0UsV0FBVyxHQUFHLEtBQUssQ0FBQTtBQUM1QixHQUFBO0VBRUFnRixPQUFPLENBQUNqRSxNQUFNLEVBQUVrRSxNQUFNLEVBQUVDLEtBQUssRUFBRWpFLEtBQUssRUFBRSxFQUN0QztBQUNKOzs7OyJ9
