/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { Debug, DebugHelper } from '../../../core/debug.js';
import { TRACEID_PIPELINELAYOUT_ALLOC, TRACEID_RENDERPIPELINE_ALLOC } from '../../../core/constants.js';
import { WebgpuVertexBufferLayout } from './webgpu-vertex-buffer-layout.js';

let _pipelineId = 0;
let _layoutId = 0;
const _primitiveTopology = ['point-list',
// PRIMITIVE_POINTS
'line-list',
// PRIMITIVE_LINES
undefined,
// PRIMITIVE_LINELOOP
'line-strip',
// PRIMITIVE_LINESTRIP
'triangle-list',
// PRIMITIVE_TRIANGLES
'triangle-strip',
// PRIMITIVE_TRISTRIP
undefined // PRIMITIVE_TRIFAN
];

const _blendOperation = ['add',
// BLENDEQUATION_ADD
'subtract',
// BLENDEQUATION_SUBTRACT
'reverse-subtract',
// BLENDEQUATION_REVERSE_SUBTRACT
'min',
// BLENDEQUATION_MIN
'max' // BLENDEQUATION_MAX
];

const _blendFactor = ['zero',
// BLENDMODE_ZERO
'one',
// BLENDMODE_ONE
'src',
// BLENDMODE_SRC_COLOR
'one-minus-src',
// BLENDMODE_ONE_MINUS_SRC_COLOR
'dst',
// BLENDMODE_DST_COLOR
'one-minus-dst',
// BLENDMODE_ONE_MINUS_DST_COLOR
'src-alpha',
// BLENDMODE_SRC_ALPHA
'src-alpha-saturated',
// BLENDMODE_SRC_ALPHA_SATURATE
'one-minus-src-alpha',
// BLENDMODE_ONE_MINUS_SRC_ALPHA
'dst-alpha',
// BLENDMODE_DST_ALPHA
'one-minus-dst-alpha',
// BLENDMODE_ONE_MINUS_DST_ALPHA
'constant',
// BLENDMODE_CONSTANT_COLOR
'one-minus-constant',
// BLENDMODE_ONE_MINUS_CONSTANT_COLOR
undefined,
// BLENDMODE_CONSTANT_ALPHA
undefined // BLENDMODE_ONE_MINUS_CONSTANT_ALPHA
];

// temp array to avoid allocation
const _bindGroupLayouts = [];

/**
 * @ignore
 */
class WebgpuRenderPipeline {
  constructor(device) {
    /** @type {import('./webgpu-graphics-device.js').WebgpuGraphicsDevice} */
    this.device = device;

    /**
     * The cache of vertex buffer layouts
     *
     * @type {WebgpuVertexBufferLayout}
     */
    this.vertexBufferLayout = new WebgpuVertexBufferLayout();

    /**
     * The cache of render pipelines
     *
     * @type {Map<string, object>}
     */
    this.cache = new Map();
  }
  get(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, renderState) {
    // render pipeline unique key
    const key = this.getKey(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, renderState);

    // cached pipeline
    let pipeline = this.cache.get(key);
    if (!pipeline) {
      const primitiveTopology = _primitiveTopology[primitive.type];
      Debug.assert(primitiveTopology, `Unsupported primitive topology ${primitive}`);

      // pipeline layout
      const pipelineLayout = this.getPipelineLayout(bindGroupFormats);

      // vertex buffer layout
      const vertexBufferLayout = this.vertexBufferLayout.get(vertexFormat0, vertexFormat1);

      // pipeline
      pipeline = this.create(primitiveTopology, shader.impl, renderTarget, pipelineLayout, renderState, vertexBufferLayout);
      this.cache.set(key, pipeline);
    }
    return pipeline;
  }

  /**
   * Generate a unique key for the render pipeline. Keep this function as lean as possible,
   * as it executes for each draw call.
   */
  getKey(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, renderState) {
    let bindGroupKey = '';
    for (let i = 0; i < bindGroupFormats.length; i++) {
      bindGroupKey += bindGroupFormats[i].key;
    }
    const vertexBufferLayoutKey = this.vertexBufferLayout.getKey(vertexFormat0, vertexFormat1);
    const renderTargetKey = renderTarget.impl.key;
    const renderStateKey = renderState.blendKey;
    return vertexBufferLayoutKey + shader.impl.vertexCode + shader.impl.fragmentCode + renderTargetKey + renderStateKey + primitive.type + bindGroupKey;
  }

  // TODO: this could be cached using bindGroupKey

  /**
   * @param {import('../bind-group-format.js').BindGroupFormat[]} bindGroupFormats - An array
   * of bind group formats.
   * @returns {any} Returns the pipeline layout.
   */
  getPipelineLayout(bindGroupFormats) {
    bindGroupFormats.forEach(format => {
      _bindGroupLayouts.push(format.bindGroupLayout);
    });
    const descr = {
      bindGroupLayouts: _bindGroupLayouts
    };
    _layoutId++;
    DebugHelper.setLabel(descr, `PipelineLayoutDescr-${_layoutId}`);

    /** @type {GPUPipelineLayout} */
    const pipelineLayout = this.device.wgpu.createPipelineLayout(descr);
    DebugHelper.setLabel(pipelineLayout, `PipelineLayout-${_layoutId}`);
    Debug.trace(TRACEID_PIPELINELAYOUT_ALLOC, `Alloc: Id ${_layoutId}`, descr);
    _bindGroupLayouts.length = 0;
    return pipelineLayout;
  }
  getBlend(renderState) {
    // blend needs to be undefined when blending is disabled
    let blend;
    if (renderState.blending) {
      /** @type {GPUBlendState} */
      blend = {
        color: {
          operation: _blendOperation[renderState.blendEquationColor],
          srcFactor: _blendFactor[renderState.blendSrcColor],
          dstFactor: _blendFactor[renderState.blendDstColor]
        },
        alpha: {
          operation: _blendOperation[renderState.blendEquationAlpha],
          srcFactor: _blendFactor[renderState.blendSrcAlpha],
          dstFactor: _blendFactor[renderState.blendDstAlpha]
        }
      };

      // unsupported blend factors
      Debug.assert(blend.color.srcFactor !== undefined);
      Debug.assert(blend.color.dstFactor !== undefined);
      Debug.assert(blend.alpha.srcFactor !== undefined);
      Debug.assert(blend.alpha.dstFactor !== undefined);
    }
    return blend;
  }
  create(primitiveTopology, webgpuShader, renderTarget, pipelineLayout, renderState, vertexBufferLayout) {
    const wgpu = this.device.wgpu;

    /** @type {GPUDepthStencilState} */
    const depthStencil = renderTarget.depth ? {
      depthWriteEnabled: true,
      depthCompare: 'less',
      format: renderTarget.impl.depthFormat
    } : undefined;
    const vertexModule = wgpu.createShaderModule({
      code: webgpuShader.vertexCode
    });
    DebugHelper.setLabel(vertexModule, `Vertex ${webgpuShader.shader.label}`);

    /** @type {GPURenderPipelineDescriptor} */
    const descr = {
      vertex: {
        module: vertexModule,
        entryPoint: 'main',
        buffers: vertexBufferLayout
      },
      primitive: {
        topology: primitiveTopology,
        cullMode: "none"
      },
      depthStencil,
      multisample: {
        count: renderTarget.samples
      },
      // uniform / texture binding layout
      layout: pipelineLayout
    };

    // provide fragment state only when render target contains color buffer, otherwise rendering to depth only
    // TODO: the exclusion of fragment here should be reflected in the key generation (no blend, no frag ..)
    const colorFormat = renderTarget.impl.colorFormat;
    if (colorFormat) {
      const fragmentModule = wgpu.createShaderModule({
        code: webgpuShader.fragmentCode
      });
      DebugHelper.setLabel(fragmentModule, `Fragment ${webgpuShader.shader.label}`);

      /** @type {GPUFragmentState} */
      descr.fragment = {
        module: fragmentModule,
        entryPoint: 'main',
        targets: [{
          format: renderTarget.impl.colorFormat,
          writeMask: GPUColorWrite.ALL,
          blend: this.getBlend(renderState)
        }]
      };
    }
    _pipelineId++;
    DebugHelper.setLabel(descr, `RenderPipelineDescr-${_pipelineId}`);
    const pipeline = wgpu.createRenderPipeline(descr);
    DebugHelper.setLabel(pipeline, `RenderPipeline-${_pipelineId}`);
    Debug.trace(TRACEID_RENDERPIPELINE_ALLOC, `Alloc: Id ${_pipelineId}`, descr);
    return pipeline;
  }
}

export { WebgpuRenderPipeline };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXJlbmRlci1waXBlbGluZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2dyYXBoaWNzL3dlYmdwdS93ZWJncHUtcmVuZGVyLXBpcGVsaW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnLCBEZWJ1Z0hlbHBlciB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2RlYnVnLmpzXCI7XG5pbXBvcnQgeyBUUkFDRUlEX1JFTkRFUlBJUEVMSU5FX0FMTE9DLCBUUkFDRUlEX1BJUEVMSU5FTEFZT1VUX0FMTE9DIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvY29uc3RhbnRzLmpzXCI7XG5cbmltcG9ydCB7IFdlYmdwdVZlcnRleEJ1ZmZlckxheW91dCB9IGZyb20gXCIuL3dlYmdwdS12ZXJ0ZXgtYnVmZmVyLWxheW91dC5qc1wiO1xuXG5sZXQgX3BpcGVsaW5lSWQgPSAwO1xubGV0IF9sYXlvdXRJZCA9IDA7XG5cbmNvbnN0IF9wcmltaXRpdmVUb3BvbG9neSA9IFtcbiAgICAncG9pbnQtbGlzdCcsICAgICAgIC8vIFBSSU1JVElWRV9QT0lOVFNcbiAgICAnbGluZS1saXN0JywgICAgICAgIC8vIFBSSU1JVElWRV9MSU5FU1xuICAgIHVuZGVmaW5lZCwgICAgICAgICAgLy8gUFJJTUlUSVZFX0xJTkVMT09QXG4gICAgJ2xpbmUtc3RyaXAnLCAgICAgICAvLyBQUklNSVRJVkVfTElORVNUUklQXG4gICAgJ3RyaWFuZ2xlLWxpc3QnLCAgICAvLyBQUklNSVRJVkVfVFJJQU5HTEVTXG4gICAgJ3RyaWFuZ2xlLXN0cmlwJywgICAvLyBQUklNSVRJVkVfVFJJU1RSSVBcbiAgICB1bmRlZmluZWQgICAgICAgICAgIC8vIFBSSU1JVElWRV9UUklGQU5cbl07XG5cbmNvbnN0IF9ibGVuZE9wZXJhdGlvbiA9IFtcbiAgICAnYWRkJywgICAgICAgICAgICAgIC8vIEJMRU5ERVFVQVRJT05fQUREXG4gICAgJ3N1YnRyYWN0JywgICAgICAgICAvLyBCTEVOREVRVUFUSU9OX1NVQlRSQUNUXG4gICAgJ3JldmVyc2Utc3VidHJhY3QnLCAvLyBCTEVOREVRVUFUSU9OX1JFVkVSU0VfU1VCVFJBQ1RcbiAgICAnbWluJywgICAgICAgICAgICAgIC8vIEJMRU5ERVFVQVRJT05fTUlOXG4gICAgJ21heCcgICAgICAgICAgICAgICAvLyBCTEVOREVRVUFUSU9OX01BWFxuXTtcblxuY29uc3QgX2JsZW5kRmFjdG9yID0gW1xuICAgICd6ZXJvJywgICAgICAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9aRVJPXG4gICAgJ29uZScsICAgICAgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX09ORVxuICAgICdzcmMnLCAgICAgICAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9TUkNfQ09MT1JcbiAgICAnb25lLW1pbnVzLXNyYycsICAgICAgICAvLyBCTEVORE1PREVfT05FX01JTlVTX1NSQ19DT0xPUlxuICAgICdkc3QnLCAgICAgICAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9EU1RfQ09MT1JcbiAgICAnb25lLW1pbnVzLWRzdCcsICAgICAgICAvLyBCTEVORE1PREVfT05FX01JTlVTX0RTVF9DT0xPUlxuICAgICdzcmMtYWxwaGEnLCAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9TUkNfQUxQSEFcbiAgICAnc3JjLWFscGhhLXNhdHVyYXRlZCcsICAvLyBCTEVORE1PREVfU1JDX0FMUEhBX1NBVFVSQVRFXG4gICAgJ29uZS1taW51cy1zcmMtYWxwaGEnLCAgLy8gQkxFTkRNT0RFX09ORV9NSU5VU19TUkNfQUxQSEFcbiAgICAnZHN0LWFscGhhJywgICAgICAgICAgICAvLyBCTEVORE1PREVfRFNUX0FMUEhBXG4gICAgJ29uZS1taW51cy1kc3QtYWxwaGEnLCAgLy8gQkxFTkRNT0RFX09ORV9NSU5VU19EU1RfQUxQSEFcbiAgICAnY29uc3RhbnQnLCAgICAgICAgICAgICAvLyBCTEVORE1PREVfQ09OU1RBTlRfQ09MT1JcbiAgICAnb25lLW1pbnVzLWNvbnN0YW50JywgICAvLyBCTEVORE1PREVfT05FX01JTlVTX0NPTlNUQU5UX0NPTE9SXG4gICAgdW5kZWZpbmVkLCAgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX0NPTlNUQU5UX0FMUEhBXG4gICAgdW5kZWZpbmVkICAgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX09ORV9NSU5VU19DT05TVEFOVF9BTFBIQVxuXTtcblxuLy8gdGVtcCBhcnJheSB0byBhdm9pZCBhbGxvY2F0aW9uXG5jb25zdCBfYmluZEdyb3VwTGF5b3V0cyA9IFtdO1xuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV2ViZ3B1UmVuZGVyUGlwZWxpbmUge1xuICAgIGNvbnN0cnVjdG9yKGRldmljZSkge1xuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi93ZWJncHUtZ3JhcGhpY3MtZGV2aWNlLmpzJykuV2ViZ3B1R3JhcGhpY3NEZXZpY2V9ICovXG4gICAgICAgIHRoaXMuZGV2aWNlID0gZGV2aWNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY2FjaGUgb2YgdmVydGV4IGJ1ZmZlciBsYXlvdXRzXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtXZWJncHVWZXJ0ZXhCdWZmZXJMYXlvdXR9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZlcnRleEJ1ZmZlckxheW91dCA9IG5ldyBXZWJncHVWZXJ0ZXhCdWZmZXJMYXlvdXQoKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhY2hlIG9mIHJlbmRlciBwaXBlbGluZXNcbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge01hcDxzdHJpbmcsIG9iamVjdD59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhY2hlID0gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIGdldChwcmltaXRpdmUsIHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEsIHNoYWRlciwgcmVuZGVyVGFyZ2V0LCBiaW5kR3JvdXBGb3JtYXRzLCByZW5kZXJTdGF0ZSkge1xuXG4gICAgICAgIC8vIHJlbmRlciBwaXBlbGluZSB1bmlxdWUga2V5XG4gICAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KHByaW1pdGl2ZSwgdmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSwgc2hhZGVyLCByZW5kZXJUYXJnZXQsIGJpbmRHcm91cEZvcm1hdHMsIHJlbmRlclN0YXRlKTtcblxuICAgICAgICAvLyBjYWNoZWQgcGlwZWxpbmVcbiAgICAgICAgbGV0IHBpcGVsaW5lID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFwaXBlbGluZSkge1xuXG4gICAgICAgICAgICBjb25zdCBwcmltaXRpdmVUb3BvbG9neSA9IF9wcmltaXRpdmVUb3BvbG9neVtwcmltaXRpdmUudHlwZV07XG4gICAgICAgICAgICBEZWJ1Zy5hc3NlcnQocHJpbWl0aXZlVG9wb2xvZ3ksIGBVbnN1cHBvcnRlZCBwcmltaXRpdmUgdG9wb2xvZ3kgJHtwcmltaXRpdmV9YCk7XG5cbiAgICAgICAgICAgIC8vIHBpcGVsaW5lIGxheW91dFxuICAgICAgICAgICAgY29uc3QgcGlwZWxpbmVMYXlvdXQgPSB0aGlzLmdldFBpcGVsaW5lTGF5b3V0KGJpbmRHcm91cEZvcm1hdHMpO1xuXG4gICAgICAgICAgICAvLyB2ZXJ0ZXggYnVmZmVyIGxheW91dFxuICAgICAgICAgICAgY29uc3QgdmVydGV4QnVmZmVyTGF5b3V0ID0gdGhpcy52ZXJ0ZXhCdWZmZXJMYXlvdXQuZ2V0KHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEpO1xuXG4gICAgICAgICAgICAvLyBwaXBlbGluZVxuICAgICAgICAgICAgcGlwZWxpbmUgPSB0aGlzLmNyZWF0ZShwcmltaXRpdmVUb3BvbG9neSwgc2hhZGVyLmltcGwsIHJlbmRlclRhcmdldCwgcGlwZWxpbmVMYXlvdXQsIHJlbmRlclN0YXRlLCB2ZXJ0ZXhCdWZmZXJMYXlvdXQpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZS5zZXQoa2V5LCBwaXBlbGluZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGlwZWxpbmU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgYSB1bmlxdWUga2V5IGZvciB0aGUgcmVuZGVyIHBpcGVsaW5lLiBLZWVwIHRoaXMgZnVuY3Rpb24gYXMgbGVhbiBhcyBwb3NzaWJsZSxcbiAgICAgKiBhcyBpdCBleGVjdXRlcyBmb3IgZWFjaCBkcmF3IGNhbGwuXG4gICAgICovXG4gICAgZ2V0S2V5KHByaW1pdGl2ZSwgdmVydGV4Rm9ybWF0MCwgdmVydGV4Rm9ybWF0MSwgc2hhZGVyLCByZW5kZXJUYXJnZXQsIGJpbmRHcm91cEZvcm1hdHMsIHJlbmRlclN0YXRlKSB7XG5cbiAgICAgICAgbGV0IGJpbmRHcm91cEtleSA9ICcnO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbmRHcm91cEZvcm1hdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGJpbmRHcm91cEtleSArPSBiaW5kR3JvdXBGb3JtYXRzW2ldLmtleTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHZlcnRleEJ1ZmZlckxheW91dEtleSA9IHRoaXMudmVydGV4QnVmZmVyTGF5b3V0LmdldEtleSh2ZXJ0ZXhGb3JtYXQwLCB2ZXJ0ZXhGb3JtYXQxKTtcbiAgICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0S2V5ID0gcmVuZGVyVGFyZ2V0LmltcGwua2V5O1xuICAgICAgICBjb25zdCByZW5kZXJTdGF0ZUtleSA9IHJlbmRlclN0YXRlLmJsZW5kS2V5O1xuXG4gICAgICAgIHJldHVybiB2ZXJ0ZXhCdWZmZXJMYXlvdXRLZXkgKyBzaGFkZXIuaW1wbC52ZXJ0ZXhDb2RlICsgc2hhZGVyLmltcGwuZnJhZ21lbnRDb2RlICtcbiAgICAgICAgICAgIHJlbmRlclRhcmdldEtleSArIHJlbmRlclN0YXRlS2V5ICsgcHJpbWl0aXZlLnR5cGUgKyBiaW5kR3JvdXBLZXk7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogdGhpcyBjb3VsZCBiZSBjYWNoZWQgdXNpbmcgYmluZEdyb3VwS2V5XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYmluZC1ncm91cC1mb3JtYXQuanMnKS5CaW5kR3JvdXBGb3JtYXRbXX0gYmluZEdyb3VwRm9ybWF0cyAtIEFuIGFycmF5XG4gICAgICogb2YgYmluZCBncm91cCBmb3JtYXRzLlxuICAgICAqIEByZXR1cm5zIHthbnl9IFJldHVybnMgdGhlIHBpcGVsaW5lIGxheW91dC5cbiAgICAgKi9cbiAgICBnZXRQaXBlbGluZUxheW91dChiaW5kR3JvdXBGb3JtYXRzKSB7XG5cbiAgICAgICAgYmluZEdyb3VwRm9ybWF0cy5mb3JFYWNoKChmb3JtYXQpID0+IHtcbiAgICAgICAgICAgIF9iaW5kR3JvdXBMYXlvdXRzLnB1c2goZm9ybWF0LmJpbmRHcm91cExheW91dCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlc2NyID0ge1xuICAgICAgICAgICAgYmluZEdyb3VwTGF5b3V0czogX2JpbmRHcm91cExheW91dHNcbiAgICAgICAgfTtcblxuICAgICAgICBfbGF5b3V0SWQrKztcbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwoZGVzY3IsIGBQaXBlbGluZUxheW91dERlc2NyLSR7X2xheW91dElkfWApO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7R1BVUGlwZWxpbmVMYXlvdXR9ICovXG4gICAgICAgIGNvbnN0IHBpcGVsaW5lTGF5b3V0ID0gdGhpcy5kZXZpY2Uud2dwdS5jcmVhdGVQaXBlbGluZUxheW91dChkZXNjcik7XG4gICAgICAgIERlYnVnSGVscGVyLnNldExhYmVsKHBpcGVsaW5lTGF5b3V0LCBgUGlwZWxpbmVMYXlvdXQtJHtfbGF5b3V0SWR9YCk7XG4gICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSURfUElQRUxJTkVMQVlPVVRfQUxMT0MsIGBBbGxvYzogSWQgJHtfbGF5b3V0SWR9YCwgZGVzY3IpO1xuXG4gICAgICAgIF9iaW5kR3JvdXBMYXlvdXRzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgcmV0dXJuIHBpcGVsaW5lTGF5b3V0O1xuICAgIH1cblxuICAgIGdldEJsZW5kKHJlbmRlclN0YXRlKSB7XG5cbiAgICAgICAgLy8gYmxlbmQgbmVlZHMgdG8gYmUgdW5kZWZpbmVkIHdoZW4gYmxlbmRpbmcgaXMgZGlzYWJsZWRcbiAgICAgICAgbGV0IGJsZW5kO1xuXG4gICAgICAgIGlmIChyZW5kZXJTdGF0ZS5ibGVuZGluZykge1xuXG4gICAgICAgICAgICAvKiogQHR5cGUge0dQVUJsZW5kU3RhdGV9ICovXG4gICAgICAgICAgICBibGVuZCA9IHtcbiAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb246IF9ibGVuZE9wZXJhdGlvbltyZW5kZXJTdGF0ZS5ibGVuZEVxdWF0aW9uQ29sb3JdLFxuICAgICAgICAgICAgICAgICAgICBzcmNGYWN0b3I6IF9ibGVuZEZhY3RvcltyZW5kZXJTdGF0ZS5ibGVuZFNyY0NvbG9yXSxcbiAgICAgICAgICAgICAgICAgICAgZHN0RmFjdG9yOiBfYmxlbmRGYWN0b3JbcmVuZGVyU3RhdGUuYmxlbmREc3RDb2xvcl1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFscGhhOiB7XG4gICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogX2JsZW5kT3BlcmF0aW9uW3JlbmRlclN0YXRlLmJsZW5kRXF1YXRpb25BbHBoYV0sXG4gICAgICAgICAgICAgICAgICAgIHNyY0ZhY3RvcjogX2JsZW5kRmFjdG9yW3JlbmRlclN0YXRlLmJsZW5kU3JjQWxwaGFdLFxuICAgICAgICAgICAgICAgICAgICBkc3RGYWN0b3I6IF9ibGVuZEZhY3RvcltyZW5kZXJTdGF0ZS5ibGVuZERzdEFscGhhXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIHVuc3VwcG9ydGVkIGJsZW5kIGZhY3RvcnNcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChibGVuZC5jb2xvci5zcmNGYWN0b3IgIT09IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBEZWJ1Zy5hc3NlcnQoYmxlbmQuY29sb3IuZHN0RmFjdG9yICE9PSB1bmRlZmluZWQpO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGJsZW5kLmFscGhhLnNyY0ZhY3RvciAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChibGVuZC5hbHBoYS5kc3RGYWN0b3IgIT09IHVuZGVmaW5lZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmxlbmQ7XG4gICAgfVxuXG4gICAgY3JlYXRlKHByaW1pdGl2ZVRvcG9sb2d5LCB3ZWJncHVTaGFkZXIsIHJlbmRlclRhcmdldCwgcGlwZWxpbmVMYXlvdXQsIHJlbmRlclN0YXRlLCB2ZXJ0ZXhCdWZmZXJMYXlvdXQpIHtcblxuICAgICAgICBjb25zdCB3Z3B1ID0gdGhpcy5kZXZpY2Uud2dwdTtcblxuICAgICAgICAvKiogQHR5cGUge0dQVURlcHRoU3RlbmNpbFN0YXRlfSAqL1xuICAgICAgICBjb25zdCBkZXB0aFN0ZW5jaWwgPSByZW5kZXJUYXJnZXQuZGVwdGggPyB7XG4gICAgICAgICAgICBkZXB0aFdyaXRlRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIGRlcHRoQ29tcGFyZTogJ2xlc3MnLFxuICAgICAgICAgICAgZm9ybWF0OiByZW5kZXJUYXJnZXQuaW1wbC5kZXB0aEZvcm1hdFxuICAgICAgICB9IDogdW5kZWZpbmVkO1xuXG4gICAgICAgIGNvbnN0IHZlcnRleE1vZHVsZSA9IHdncHUuY3JlYXRlU2hhZGVyTW9kdWxlKHtcbiAgICAgICAgICAgIGNvZGU6IHdlYmdwdVNoYWRlci52ZXJ0ZXhDb2RlXG4gICAgICAgIH0pO1xuICAgICAgICBEZWJ1Z0hlbHBlci5zZXRMYWJlbCh2ZXJ0ZXhNb2R1bGUsIGBWZXJ0ZXggJHt3ZWJncHVTaGFkZXIuc2hhZGVyLmxhYmVsfWApO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7R1BVUmVuZGVyUGlwZWxpbmVEZXNjcmlwdG9yfSAqL1xuICAgICAgICBjb25zdCBkZXNjciA9IHtcbiAgICAgICAgICAgIHZlcnRleDoge1xuICAgICAgICAgICAgICAgIG1vZHVsZTogdmVydGV4TW9kdWxlLFxuICAgICAgICAgICAgICAgIGVudHJ5UG9pbnQ6ICdtYWluJyxcbiAgICAgICAgICAgICAgICBidWZmZXJzOiB2ZXJ0ZXhCdWZmZXJMYXlvdXRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcmltaXRpdmU6IHtcbiAgICAgICAgICAgICAgICB0b3BvbG9neTogcHJpbWl0aXZlVG9wb2xvZ3ksXG4gICAgICAgICAgICAgICAgY3VsbE1vZGU6IFwibm9uZVwiXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBkZXB0aFN0ZW5jaWwsXG5cbiAgICAgICAgICAgIG11bHRpc2FtcGxlOiB7XG4gICAgICAgICAgICAgICAgY291bnQ6IHJlbmRlclRhcmdldC5zYW1wbGVzXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyB1bmlmb3JtIC8gdGV4dHVyZSBiaW5kaW5nIGxheW91dFxuICAgICAgICAgICAgbGF5b3V0OiBwaXBlbGluZUxheW91dFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHByb3ZpZGUgZnJhZ21lbnQgc3RhdGUgb25seSB3aGVuIHJlbmRlciB0YXJnZXQgY29udGFpbnMgY29sb3IgYnVmZmVyLCBvdGhlcndpc2UgcmVuZGVyaW5nIHRvIGRlcHRoIG9ubHlcbiAgICAgICAgLy8gVE9ETzogdGhlIGV4Y2x1c2lvbiBvZiBmcmFnbWVudCBoZXJlIHNob3VsZCBiZSByZWZsZWN0ZWQgaW4gdGhlIGtleSBnZW5lcmF0aW9uIChubyBibGVuZCwgbm8gZnJhZyAuLilcbiAgICAgICAgY29uc3QgY29sb3JGb3JtYXQgPSByZW5kZXJUYXJnZXQuaW1wbC5jb2xvckZvcm1hdDtcbiAgICAgICAgaWYgKGNvbG9yRm9ybWF0KSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50TW9kdWxlID0gd2dwdS5jcmVhdGVTaGFkZXJNb2R1bGUoe1xuICAgICAgICAgICAgICAgIGNvZGU6IHdlYmdwdVNoYWRlci5mcmFnbWVudENvZGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwoZnJhZ21lbnRNb2R1bGUsIGBGcmFnbWVudCAke3dlYmdwdVNoYWRlci5zaGFkZXIubGFiZWx9YCk7XG5cbiAgICAgICAgICAgIC8qKiBAdHlwZSB7R1BVRnJhZ21lbnRTdGF0ZX0gKi9cbiAgICAgICAgICAgIGRlc2NyLmZyYWdtZW50ID0ge1xuICAgICAgICAgICAgICAgIG1vZHVsZTogZnJhZ21lbnRNb2R1bGUsXG4gICAgICAgICAgICAgICAgZW50cnlQb2ludDogJ21haW4nLFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFt7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDogcmVuZGVyVGFyZ2V0LmltcGwuY29sb3JGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlTWFzazogR1BVQ29sb3JXcml0ZS5BTEwsXG4gICAgICAgICAgICAgICAgICAgIGJsZW5kOiB0aGlzLmdldEJsZW5kKHJlbmRlclN0YXRlKVxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgX3BpcGVsaW5lSWQrKztcbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwoZGVzY3IsIGBSZW5kZXJQaXBlbGluZURlc2NyLSR7X3BpcGVsaW5lSWR9YCk7XG5cbiAgICAgICAgY29uc3QgcGlwZWxpbmUgPSB3Z3B1LmNyZWF0ZVJlbmRlclBpcGVsaW5lKGRlc2NyKTtcblxuICAgICAgICBEZWJ1Z0hlbHBlci5zZXRMYWJlbChwaXBlbGluZSwgYFJlbmRlclBpcGVsaW5lLSR7X3BpcGVsaW5lSWR9YCk7XG4gICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSURfUkVOREVSUElQRUxJTkVfQUxMT0MsIGBBbGxvYzogSWQgJHtfcGlwZWxpbmVJZH1gLCBkZXNjcik7XG5cbiAgICAgICAgcmV0dXJuIHBpcGVsaW5lO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgV2ViZ3B1UmVuZGVyUGlwZWxpbmUgfTtcbiJdLCJuYW1lcyI6WyJfcGlwZWxpbmVJZCIsIl9sYXlvdXRJZCIsIl9wcmltaXRpdmVUb3BvbG9neSIsInVuZGVmaW5lZCIsIl9ibGVuZE9wZXJhdGlvbiIsIl9ibGVuZEZhY3RvciIsIl9iaW5kR3JvdXBMYXlvdXRzIiwiV2ViZ3B1UmVuZGVyUGlwZWxpbmUiLCJjb25zdHJ1Y3RvciIsImRldmljZSIsInZlcnRleEJ1ZmZlckxheW91dCIsIldlYmdwdVZlcnRleEJ1ZmZlckxheW91dCIsImNhY2hlIiwiTWFwIiwiZ2V0IiwicHJpbWl0aXZlIiwidmVydGV4Rm9ybWF0MCIsInZlcnRleEZvcm1hdDEiLCJzaGFkZXIiLCJyZW5kZXJUYXJnZXQiLCJiaW5kR3JvdXBGb3JtYXRzIiwicmVuZGVyU3RhdGUiLCJrZXkiLCJnZXRLZXkiLCJwaXBlbGluZSIsInByaW1pdGl2ZVRvcG9sb2d5IiwidHlwZSIsIkRlYnVnIiwiYXNzZXJ0IiwicGlwZWxpbmVMYXlvdXQiLCJnZXRQaXBlbGluZUxheW91dCIsImNyZWF0ZSIsImltcGwiLCJzZXQiLCJiaW5kR3JvdXBLZXkiLCJpIiwibGVuZ3RoIiwidmVydGV4QnVmZmVyTGF5b3V0S2V5IiwicmVuZGVyVGFyZ2V0S2V5IiwicmVuZGVyU3RhdGVLZXkiLCJibGVuZEtleSIsInZlcnRleENvZGUiLCJmcmFnbWVudENvZGUiLCJmb3JFYWNoIiwiZm9ybWF0IiwicHVzaCIsImJpbmRHcm91cExheW91dCIsImRlc2NyIiwiYmluZEdyb3VwTGF5b3V0cyIsIkRlYnVnSGVscGVyIiwic2V0TGFiZWwiLCJ3Z3B1IiwiY3JlYXRlUGlwZWxpbmVMYXlvdXQiLCJ0cmFjZSIsIlRSQUNFSURfUElQRUxJTkVMQVlPVVRfQUxMT0MiLCJnZXRCbGVuZCIsImJsZW5kIiwiYmxlbmRpbmciLCJjb2xvciIsIm9wZXJhdGlvbiIsImJsZW5kRXF1YXRpb25Db2xvciIsInNyY0ZhY3RvciIsImJsZW5kU3JjQ29sb3IiLCJkc3RGYWN0b3IiLCJibGVuZERzdENvbG9yIiwiYWxwaGEiLCJibGVuZEVxdWF0aW9uQWxwaGEiLCJibGVuZFNyY0FscGhhIiwiYmxlbmREc3RBbHBoYSIsIndlYmdwdVNoYWRlciIsImRlcHRoU3RlbmNpbCIsImRlcHRoIiwiZGVwdGhXcml0ZUVuYWJsZWQiLCJkZXB0aENvbXBhcmUiLCJkZXB0aEZvcm1hdCIsInZlcnRleE1vZHVsZSIsImNyZWF0ZVNoYWRlck1vZHVsZSIsImNvZGUiLCJsYWJlbCIsInZlcnRleCIsIm1vZHVsZSIsImVudHJ5UG9pbnQiLCJidWZmZXJzIiwidG9wb2xvZ3kiLCJjdWxsTW9kZSIsIm11bHRpc2FtcGxlIiwiY291bnQiLCJzYW1wbGVzIiwibGF5b3V0IiwiY29sb3JGb3JtYXQiLCJmcmFnbWVudE1vZHVsZSIsImZyYWdtZW50IiwidGFyZ2V0cyIsIndyaXRlTWFzayIsIkdQVUNvbG9yV3JpdGUiLCJBTEwiLCJjcmVhdGVSZW5kZXJQaXBlbGluZSIsIlRSQUNFSURfUkVOREVSUElQRUxJTkVfQUxMT0MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUtBLElBQUlBLFdBQVcsR0FBRyxDQUFDLENBQUE7QUFDbkIsSUFBSUMsU0FBUyxHQUFHLENBQUMsQ0FBQTtBQUVqQixNQUFNQyxrQkFBa0IsR0FBRyxDQUN2QixZQUFZO0FBQVE7QUFDcEIsV0FBVztBQUFTO0FBQ3BCQyxTQUFTO0FBQVc7QUFDcEIsWUFBWTtBQUFRO0FBQ3BCLGVBQWU7QUFBSztBQUNwQixnQkFBZ0I7QUFBSTtBQUNwQkEsU0FBUztBQUFXLENBQ3ZCLENBQUE7O0FBRUQsTUFBTUMsZUFBZSxHQUFHLENBQ3BCLEtBQUs7QUFBZTtBQUNwQixVQUFVO0FBQVU7QUFDcEIsa0JBQWtCO0FBQUU7QUFDcEIsS0FBSztBQUFlO0FBQ3BCLEtBQUs7QUFBZSxDQUN2QixDQUFBOztBQUVELE1BQU1DLFlBQVksR0FBRyxDQUNq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
