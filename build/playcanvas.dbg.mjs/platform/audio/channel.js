/**
 * @license
 * PlayCanvas Engine v1.62.0-dev revision 7d088032c (DEBUG PROFILER)
 * Copyright 2011-2023 PlayCanvas Ltd. All rights reserved.
 */
import { math } from '../../core/math/math.js';
import { hasAudioContext } from './capabilities.js';

/**
 * A channel is created when the {@link SoundManager} begins playback of a {@link Sound}. Usually
 * created internally by {@link SoundManager#playSound} or {@link SoundManager#playSound3d}.
 * Developers usually won't have to create Channels manually.
 *
 * @ignore
 */
class Channel {
  /**
   * Create a new Channel instance.
   *
   * @param {import('../sound/manager.js').SoundManager} manager - The SoundManager instance.
   * @param {import('../sound/sound.js').Sound} sound - The sound to playback.
   * @param {object} [options] - Optional options object.
   * @param {number} [options.volume=1] - The playback volume, between 0 and 1.
   * @param {number} [options.pitch=1] - The relative pitch, default of 1, plays at normal pitch.
   * @param {boolean} [options.loop=false] - Whether the sound should loop when it reaches the
   * end or not.
   */
  constructor(manager, sound, options = {}) {
    this.volume = options.volume === undefined ? 1 : options.volume;
    this.loop = options.loop === undefined ? false : options.loop;
    this.pitch = options.pitch === undefined ? 1 : options.pitch;
    this.sound = sound;
    this.paused = false;
    this.suspended = false;
    this.manager = manager;
    this.source = null;
    if (hasAudioContext()) {
      this.startTime = 0;
      this.startOffset = 0;
      const context = manager.context;
      this.gain = context.createGain();
    } else if (sound.audio) {
      // handle the case where sound was
      this.source = sound.audio.cloneNode(false);
      this.source.pause(); // not initially playing
    }
  }

  /**
   * Get the current value for the volume. Between 0 and 1.
   *
   * @returns {number} The volume of the channel.
   */
  getVolume() {
    return this.volume;
  }

  /**
   * Get the current looping state of the Channel.
   *
   * @returns {boolean} The loop property for the channel.
   */
  getLoop() {
    return this.loop;
  }

  /**
   * Enable/disable the loop property to make the sound restart from the beginning when it
   * reaches the end.
   *
   * @param {boolean} loop - True to loop the sound, false otherwise.
   */
  setLoop(loop) {
    this.loop = loop;
    if (this.source) {
      this.source.loop = loop;
    }
  }

  /**
   * Get the current pitch of the Channel.
   *
   * @returns {number} The pitch of the channel.
   */
  getPitch() {
    return this.pitch;
  }

  /**
   * Handle the manager's 'volumechange' event.
   */
  onManagerVolumeChange() {
    this.setVolume(this.getVolume());
  }

  /**
   * Handle the manager's 'suspend' event.
   */
  onManagerSuspend() {
    if (this.isPlaying() && !this.suspended) {
      this.suspended = true;
      this.pause();
    }
  }

  /**
   * Handle the manager's 'resume' event.
   */
  onManagerResume() {
    if (this.suspended) {
      this.suspended = false;
      this.unpause();
    }
  }

  /**
   * Begin playback of sound.
   */
  play() {
    if (this.source) {
      throw new Error('Call stop() before calling play()');
    }
    this._createSource();
    if (!this.source) {
      return;
    }
    this.startTime = this.manager.context.currentTime;
    this.source.start(0, this.startOffset % this.source.buffer.duration);

    // Initialize volume and loop - note moved to be after start() because of Chrome bug
    this.setVolume(this.volume);
    this.setLoop(this.loop);
    this.setPitch(this.pitch);
    this.manager.on('volumechange', this.onManagerVolumeChange, this);
    this.manager.on('suspend', this.onManagerSuspend, this);
    this.manager.on('resume', this.onManagerResume, this);

    // suspend immediately if manager is suspended
    if (this.manager.suspended) this.onManagerSuspend();
  }

  /**
   * Pause playback of sound. Call unpause() to resume playback from the same position.
   */
  pause() {
    if (this.source) {
      this.paused = true;
      this.startOffset += this.manager.context.currentTime - this.startTime;
      this.source.stop(0);
      this.source = null;
    }
  }

  /**
   * Resume playback of the sound. Playback resumes at the point that the audio was paused.
   */
  unpause() {
    if (this.source || !this.paused) {
      console.warn('Call pause() before unpausing.');
      return;
    }
    this._createSource();
    if (!this.source) {
      return;
    }
    this.startTime = this.manager.context.currentTime;
    this.source.start(0, this.startOffset % this.source.buffer.duration);

    // Initialize parameters
    this.setVolume(this.volume);
    this.setLoop(this.loop);
    this.setPitch(this.pitch);
    this.paused = false;
  }

  /**
   * Stop playback of sound. Calling play() again will restart playback from the beginning of the
   * sound.
   */
  stop() {
    if (this.source) {
      this.source.stop(0);
      this.source = null;
    }
    this.manager.off('volumechange', this.onManagerVolumeChange, this);
    this.manager.off('suspend', this.onManagerSuspend, this);
    this.manager.off('resume', this.onManagerResume, this);
  }

  /**
   * Set the volume of playback between 0 and 1.
   *
   * @param {number} volume - The volume of the sound. Will be clamped between 0 and 1.
   */
  setVolume(volume) {
    volume = math.clamp(volume, 0, 1);
    this.volume = volume;
    if (this.gain) {
      this.gain.gain.value = volume * this.manager.volume;
    }
  }
  setPitch(pitch) {
    this.pitch = pitch;
    if (this.source) {
      this.source.playbackRate.value = pitch;
    }
  }
  isPlaying() {
    return !this.paused && this.source.playbackState === this.source.PLAYING_STATE;
  }
  getDuration() {
    return this.source ? this.source.buffer.duration : 0;
  }
  _createSource() {
    const context = this.manager.context;
    if (this.sound.buffer) {
      this.source = context.createBufferSource();
      this.source.buffer = this.sound.buffer;

      // Connect up the nodes
      this.source.connect(this.gain);
      this.gain.connect(context.destination);
      if (!this.loop) {
        // mark source as paused when it ends
        this.source.onended = this.pause.bind(this);
      }
    }
  }
}
if (!hasAudioContext()) {
  Object.assign(Channel.prototype, {
    play: function () {
      if (this.source) {
        this.paused = false;
        this.setVolume(this.volume);
        this.setLoop(this.loop);
        this.setPitch(this.pitch);
        this.source.play();
      }
      this.manager.on('volumechange', this.onManagerVolumeChange, this);
      this.manager.on('suspend', this.onManagerSuspend, this);
      this.manager.on('resume', this.onManagerResume, this);

      // suspend immediately if manager is suspended
      if (this.manager.suspended) this.onManagerSuspend();
    },
    pause: function () {
      if (this.source) {
        this.paused = true;
        this.source.pause();
      }
    },
    unpause: function () {
      if (this.source) {
        this.paused = false;
        this.source.play();
      }
    },
    stop: function () {
      if (this.source) {
        this.source.pause();
      }
      this.manager.off('volumechange', this.onManagerVolumeChange, this);
      this.manager.off('suspend', this.onManagerSuspend, this);
      this.manager.off('resume', this.onManagerResume, this);
    },
    setVolume: function (volume) {
      volume = math.clamp(volume, 0, 1);
      this.volume = volume;
      if (this.source) {
        this.source.volume = volume * this.manager.volume;
      }
    },
    setPitch: function (pitch) {
      this.pitch = pitch;
      if (this.source) {
        this.source.playbackRate = pitch;
      }
    },
    getDuration: function () {
      return this.source && !isNaN(this.source.duration) ? this.source.duration : 0;
    },
    isPlaying: function () {
      return !this.source.paused;
    }
  });
}

export { Channel };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbm5lbC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2F1ZGlvL2NoYW5uZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWF0aCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9tYXRoLmpzJztcblxuaW1wb3J0IHsgaGFzQXVkaW9Db250ZXh0IH0gZnJvbSAnLi9jYXBhYmlsaXRpZXMuanMnO1xuXG4vKipcbiAqIEEgY2hhbm5lbCBpcyBjcmVhdGVkIHdoZW4gdGhlIHtAbGluayBTb3VuZE1hbmFnZXJ9IGJlZ2lucyBwbGF5YmFjayBvZiBhIHtAbGluayBTb3VuZH0uIFVzdWFsbHlcbiAqIGNyZWF0ZWQgaW50ZXJuYWxseSBieSB7QGxpbmsgU291bmRNYW5hZ2VyI3BsYXlTb3VuZH0gb3Ige0BsaW5rIFNvdW5kTWFuYWdlciNwbGF5U291bmQzZH0uXG4gKiBEZXZlbG9wZXJzIHVzdWFsbHkgd29uJ3QgaGF2ZSB0byBjcmVhdGUgQ2hhbm5lbHMgbWFudWFsbHkuXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBDaGFubmVsIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbm5lbCBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9zb3VuZC9tYW5hZ2VyLmpzJykuU291bmRNYW5hZ2VyfSBtYW5hZ2VyIC0gVGhlIFNvdW5kTWFuYWdlciBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vc291bmQvc291bmQuanMnKS5Tb3VuZH0gc291bmQgLSBUaGUgc291bmQgdG8gcGxheWJhY2suXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIE9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy52b2x1bWU9MV0gLSBUaGUgcGxheWJhY2sgdm9sdW1lLCBiZXR3ZWVuIDAgYW5kIDEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnBpdGNoPTFdIC0gVGhlIHJlbGF0aXZlIHBpdGNoLCBkZWZhdWx0IG9mIDEsIHBsYXlzIGF0IG5vcm1hbCBwaXRjaC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmxvb3A9ZmFsc2VdIC0gV2hldGhlciB0aGUgc291bmQgc2hvdWxkIGxvb3Agd2hlbiBpdCByZWFjaGVzIHRoZVxuICAgICAqIGVuZCBvciBub3QuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobWFuYWdlciwgc291bmQsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLnZvbHVtZSA9IChvcHRpb25zLnZvbHVtZSA9PT0gdW5kZWZpbmVkKSA/IDEgOiBvcHRpb25zLnZvbHVtZTtcbiAgICAgICAgdGhpcy5sb29wID0gKG9wdGlvbnMubG9vcCA9PT0gdW5kZWZpbmVkKSA/IGZhbHNlIDogb3B0aW9ucy5sb29wO1xuICAgICAgICB0aGlzLnBpdGNoID0gKG9wdGlvbnMucGl0Y2ggPT09IHVuZGVmaW5lZCA/IDEgOiBvcHRpb25zLnBpdGNoKTtcblxuICAgICAgICB0aGlzLnNvdW5kID0gc291bmQ7XG5cbiAgICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdXNwZW5kZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xuXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcblxuICAgICAgICBpZiAoaGFzQXVkaW9Db250ZXh0KCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRPZmZzZXQgPSAwO1xuXG4gICAgICAgICAgICBjb25zdCBjb250ZXh0ID0gbWFuYWdlci5jb250ZXh0O1xuICAgICAgICAgICAgdGhpcy5nYWluID0gY29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc291bmQuYXVkaW8pIHtcbiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSBzb3VuZCB3YXNcbiAgICAgICAgICAgIHRoaXMuc291cmNlID0gc291bmQuYXVkaW8uY2xvbmVOb2RlKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuc291cmNlLnBhdXNlKCk7IC8vIG5vdCBpbml0aWFsbHkgcGxheWluZ1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJyZW50IHZhbHVlIGZvciB0aGUgdm9sdW1lLiBCZXR3ZWVuIDAgYW5kIDEuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdm9sdW1lIG9mIHRoZSBjaGFubmVsLlxuICAgICAqL1xuICAgIGdldFZvbHVtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudm9sdW1lO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCBsb29waW5nIHN0YXRlIG9mIHRoZSBDaGFubmVsLlxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBsb29wIHByb3BlcnR5IGZvciB0aGUgY2hhbm5lbC5cbiAgICAgKi9cbiAgICBnZXRMb29wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb29wO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZS9kaXNhYmxlIHRoZSBsb29wIHByb3BlcnR5IHRvIG1ha2UgdGhlIHNvdW5kIHJlc3RhcnQgZnJvbSB0aGUgYmVnaW5uaW5nIHdoZW4gaXRcbiAgICAgKiByZWFjaGVzIHRoZSBlbmQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGxvb3AgLSBUcnVlIHRvIGxvb3AgdGhlIHNvdW5kLCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICovXG4gICAgc2V0TG9vcChsb29wKSB7XG4gICAgICAgIHRoaXMubG9vcCA9IGxvb3A7XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgdGhpcy5zb3VyY2UubG9vcCA9IGxvb3A7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcGl0Y2ggb2YgdGhlIENoYW5uZWwuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcGl0Y2ggb2YgdGhlIGNoYW5uZWwuXG4gICAgICovXG4gICAgZ2V0UGl0Y2goKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBpdGNoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgbWFuYWdlcidzICd2b2x1bWVjaGFuZ2UnIGV2ZW50LlxuICAgICAqL1xuICAgIG9uTWFuYWdlclZvbHVtZUNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5zZXRWb2x1bWUodGhpcy5nZXRWb2x1bWUoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBtYW5hZ2VyJ3MgJ3N1c3BlbmQnIGV2ZW50LlxuICAgICAqL1xuICAgIG9uTWFuYWdlclN1c3BlbmQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUGxheWluZygpICYmICF0aGlzLnN1c3BlbmRlZCkge1xuICAgICAgICAgICAgdGhpcy5zdXNwZW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHRoZSBtYW5hZ2VyJ3MgJ3Jlc3VtZScgZXZlbnQuXG4gICAgICovXG4gICAgb25NYW5hZ2VyUmVzdW1lKCkge1xuICAgICAgICBpZiAodGhpcy5zdXNwZW5kZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3VzcGVuZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnVucGF1c2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJlZ2luIHBsYXliYWNrIG9mIHNvdW5kLlxuICAgICAqL1xuICAgIHBsYXkoKSB7XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsIHN0b3AoKSBiZWZvcmUgY2FsbGluZyBwbGF5KCknKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NyZWF0ZVNvdXJjZSgpO1xuICAgICAgICBpZiAoIXRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdGhpcy5tYW5hZ2VyLmNvbnRleHQuY3VycmVudFRpbWU7XG4gICAgICAgIHRoaXMuc291cmNlLnN0YXJ0KDAsIHRoaXMuc3RhcnRPZmZzZXQgJSB0aGlzLnNvdXJjZS5idWZmZXIuZHVyYXRpb24pO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgdm9sdW1lIGFuZCBsb29wIC0gbm90ZSBtb3ZlZCB0byBiZSBhZnRlciBzdGFydCgpIGJlY2F1c2Ugb2YgQ2hyb21lIGJ1Z1xuICAgICAgICB0aGlzLnNldFZvbHVtZSh0aGlzLnZvbHVtZSk7XG4gICAgICAgIHRoaXMuc2V0TG9vcCh0aGlzLmxvb3ApO1xuICAgICAgICB0aGlzLnNldFBpdGNoKHRoaXMucGl0Y2gpO1xuXG4gICAgICAgIHRoaXMubWFuYWdlci5vbigndm9sdW1lY2hhbmdlJywgdGhpcy5vbk1hbmFnZXJWb2x1bWVDaGFuZ2UsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3N1c3BlbmQnLCB0aGlzLm9uTWFuYWdlclN1c3BlbmQsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3Jlc3VtZScsIHRoaXMub25NYW5hZ2VyUmVzdW1lLCB0aGlzKTtcblxuICAgICAgICAvLyBzdXNwZW5kIGltbWVkaWF0ZWx5IGlmIG1hbmFnZXIgaXMgc3VzcGVuZGVkXG4gICAgICAgIGlmICh0aGlzLm1hbmFnZXIuc3VzcGVuZGVkKVxuICAgICAgICAgICAgdGhpcy5vbk1hbmFnZXJTdXNwZW5kKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGF1c2UgcGxheWJhY2sgb2Ygc291bmQuIENhbGwgdW5wYXVzZSgpIHRvIHJlc3VtZSBwbGF5YmFjayBmcm9tIHRoZSBzYW1lIHBvc2l0aW9uLlxuICAgICAqL1xuICAgIHBhdXNlKCkge1xuICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcblxuICAgICAgICAgICAgdGhpcy5zdGFydE9mZnNldCArPSB0aGlzLm1hbmFnZXIuY29udGV4dC5jdXJyZW50VGltZSAtIHRoaXMuc3RhcnRUaW1lO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2Uuc3RvcCgwKTtcbiAgICAgICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3VtZSBwbGF5YmFjayBvZiB0aGUgc291bmQuIFBsYXliYWNrIHJlc3VtZXMgYXQgdGhlIHBvaW50IHRoYXQgdGhlIGF1ZGlvIHdhcyBwYXVzZWQuXG4gICAgICovXG4gICAgdW5wYXVzZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc291cmNlIHx8ICF0aGlzLnBhdXNlZCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYWxsIHBhdXNlKCkgYmVmb3JlIHVucGF1c2luZy4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NyZWF0ZVNvdXJjZSgpO1xuICAgICAgICBpZiAoIXRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IHRoaXMubWFuYWdlci5jb250ZXh0LmN1cnJlbnRUaW1lO1xuICAgICAgICB0aGlzLnNvdXJjZS5zdGFydCgwLCB0aGlzLnN0YXJ0T2Zmc2V0ICUgdGhpcy5zb3VyY2UuYnVmZmVyLmR1cmF0aW9uKTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHBhcmFtZXRlcnNcbiAgICAgICAgdGhpcy5zZXRWb2x1bWUodGhpcy52b2x1bWUpO1xuICAgICAgICB0aGlzLnNldExvb3AodGhpcy5sb29wKTtcbiAgICAgICAgdGhpcy5zZXRQaXRjaCh0aGlzLnBpdGNoKTtcblxuICAgICAgICB0aGlzLnBhdXNlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0b3AgcGxheWJhY2sgb2Ygc291bmQuIENhbGxpbmcgcGxheSgpIGFnYWluIHdpbGwgcmVzdGFydCBwbGF5YmFjayBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlXG4gICAgICogc291bmQuXG4gICAgICovXG4gICAgc3RvcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5zdG9wKDApO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tYW5hZ2VyLm9mZigndm9sdW1lY2hhbmdlJywgdGhpcy5vbk1hbmFnZXJWb2x1bWVDaGFuZ2UsIHRoaXMpO1xuICAgICAgICB0aGlzLm1hbmFnZXIub2ZmKCdzdXNwZW5kJywgdGhpcy5vbk1hbmFnZXJTdXNwZW5kLCB0aGlzKTtcbiAgICAgICAgdGhpcy5tYW5hZ2VyLm9mZigncmVzdW1lJywgdGhpcy5vbk1hbmFnZXJSZXN1bWUsIHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgdm9sdW1lIG9mIHBsYXliYWNrIGJldHdlZW4gMCBhbmQgMS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2b2x1bWUgLSBUaGUgdm9sdW1lIG9mIHRoZSBzb3VuZC4gV2lsbCBiZSBjbGFtcGVkIGJldHdlZW4gMCBhbmQgMS5cbiAgICAgKi9cbiAgICBzZXRWb2x1bWUodm9sdW1lKSB7XG4gICAgICAgIHZvbHVtZSA9IG1hdGguY2xhbXAodm9sdW1lLCAwLCAxKTtcbiAgICAgICAgdGhpcy52b2x1bWUgPSB2b2x1bWU7XG4gICAgICAgIGlmICh0aGlzLmdhaW4pIHtcbiAgICAgICAgICAgIHRoaXMuZ2Fpbi5nYWluLnZhbHVlID0gdm9sdW1lICogdGhpcy5tYW5hZ2VyLnZvbHVtZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldFBpdGNoKHBpdGNoKSB7XG4gICAgICAgIHRoaXMucGl0Y2ggPSBwaXRjaDtcbiAgICAgICAgaWYgKHRoaXMuc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5wbGF5YmFja1JhdGUudmFsdWUgPSBwaXRjaDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzUGxheWluZygpIHtcbiAgICAgICAgcmV0dXJuICghdGhpcy5wYXVzZWQgJiYgKHRoaXMuc291cmNlLnBsYXliYWNrU3RhdGUgPT09IHRoaXMuc291cmNlLlBMQVlJTkdfU1RBVEUpKTtcbiAgICB9XG5cbiAgICBnZXREdXJhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlID8gdGhpcy5zb3VyY2UuYnVmZmVyLmR1cmF0aW9uIDogMDtcbiAgICB9XG5cbiAgICBfY3JlYXRlU291cmNlKCkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5tYW5hZ2VyLmNvbnRleHQ7XG5cbiAgICAgICAgaWYgKHRoaXMuc291bmQuYnVmZmVyKSB7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9IGNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5idWZmZXIgPSB0aGlzLnNvdW5kLmJ1ZmZlcjtcblxuICAgICAgICAgICAgLy8gQ29ubmVjdCB1cCB0aGUgbm9kZXNcbiAgICAgICAgICAgIHRoaXMuc291cmNlLmNvbm5lY3QodGhpcy5nYWluKTtcbiAgICAgICAgICAgIHRoaXMuZ2Fpbi5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMubG9vcCkge1xuICAgICAgICAgICAgICAgIC8vIG1hcmsgc291cmNlIGFzIHBhdXNlZCB3aGVuIGl0IGVuZHNcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS5vbmVuZGVkID0gdGhpcy5wYXVzZS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5pZiAoIWhhc0F1ZGlvQ29udGV4dCgpKSB7XG4gICAgT2JqZWN0LmFzc2lnbihDaGFubmVsLnByb3RvdHlwZSwge1xuICAgICAgICBwbGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Vm9sdW1lKHRoaXMudm9sdW1lKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldExvb3AodGhpcy5sb29wKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBpdGNoKHRoaXMucGl0Y2gpO1xuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLnBsYXkoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLm9uKCd2b2x1bWVjaGFuZ2UnLCB0aGlzLm9uTWFuYWdlclZvbHVtZUNoYW5nZSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIub24oJ3N1c3BlbmQnLCB0aGlzLm9uTWFuYWdlclN1c3BlbmQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLm9uKCdyZXN1bWUnLCB0aGlzLm9uTWFuYWdlclJlc3VtZSwgdGhpcyk7XG5cbiAgICAgICAgICAgIC8vIHN1c3BlbmQgaW1tZWRpYXRlbHkgaWYgbWFuYWdlciBpcyBzdXNwZW5kZWRcbiAgICAgICAgICAgIGlmICh0aGlzLm1hbmFnZXIuc3VzcGVuZGVkKVxuICAgICAgICAgICAgICAgIHRoaXMub25NYW5hZ2VyU3VzcGVuZCgpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS5wYXVzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVucGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGF1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLnBhdXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5vZmYoJ3ZvbHVtZWNoYW5nZScsIHRoaXMub25NYW5hZ2VyVm9sdW1lQ2hhbmdlLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5vZmYoJ3N1c3BlbmQnLCB0aGlzLm9uTWFuYWdlclN1c3BlbmQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLm9mZigncmVzdW1lJywgdGhpcy5vbk1hbmFnZXJSZXN1bWUsIHRoaXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFZvbHVtZTogZnVuY3Rpb24gKHZvbHVtZSkge1xuICAgICAgICAgICAgdm9sdW1lID0gbWF0aC5jbGFtcCh2b2x1bWUsIDAsIDEpO1xuICAgICAgICAgICAgdGhpcy52b2x1bWUgPSB2b2x1bWU7XG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS52b2x1bWUgPSB2b2x1bWUgKiB0aGlzLm1hbmFnZXIudm9sdW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldFBpdGNoOiBmdW5jdGlvbiAocGl0Y2gpIHtcbiAgICAgICAgICAgIHRoaXMucGl0Y2ggPSBwaXRjaDtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLnBsYXliYWNrUmF0ZSA9IHBpdGNoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2UgJiYgIWlzTmFOKHRoaXMuc291cmNlLmR1cmF0aW9uKSA/IHRoaXMuc291cmNlLmR1cmF0aW9uIDogMDtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1BsYXlpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5zb3VyY2UucGF1c2VkO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmV4cG9ydCB7IENoYW5uZWwgfTtcbiJdLCJuYW1lcyI6WyJDaGFubmVsIiwiY29uc3RydWN0b3IiLCJtYW5hZ2VyIiwic291bmQiLCJvcHRpb25zIiwidm9sdW1lIiwidW5kZWZpbmVkIiwibG9vcCIsInBpdGNoIiwicGF1c2VkIiwic3VzcGVuZGVkIiwic291cmNlIiwiaGFzQXVkaW9Db250ZXh0Iiwic3RhcnRUaW1lIiwic3RhcnRPZmZzZXQiLCJjb250ZXh0IiwiZ2FpbiIsImNyZWF0ZUdhaW4iLCJhdWRpbyIsImNsb25lTm9kZSIsInBhdXNlIiwiZ2V0Vm9sdW1lIiwiZ2V0TG9vcCIsInNldExvb3AiLCJnZXRQaXRjaCIsIm9uTWFuYWdlclZvbHVtZUNoYW5nZSIsInNldFZvbHVtZSIsIm9uTWFuYWdlclN1c3BlbmQiLCJpc1BsYXlpbmciLCJvbk1hbmFnZXJSZXN1bWUiLCJ1bnBhdXNlIiwicGxheSIsIkVycm9yIiwiX2NyZWF0ZVNvdXJjZSIsImN1cnJlbnRUaW1lIiwic3RhcnQiLCJidWZmZXIiLCJkdXJhdGlvbiIsInNldFBpdGNoIiwib24iLCJzdG9wIiwiY29uc29sZSIsIndhcm4iLCJvZmYiLCJtYXRoIiwiY2xhbXAiLCJ2YWx1ZSIsInBsYXliYWNrUmF0ZSIsInBsYXliYWNrU3RhdGUiLCJQTEFZSU5HX1NUQVRFIiwiZ2V0RHVyYXRpb24iLCJjcmVhdGVCdWZmZXJTb3VyY2UiLCJjb25uZWN0IiwiZGVzdGluYXRpb24iLCJvbmVuZGVkIiwiYmluZCIsIk9iamVjdCIsImFzc2lnbiIsInByb3RvdHlwZSIsImlzTmFOIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsT0FBTyxDQUFDO0FBQ1Y7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXLENBQUNDLE9BQU8sRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEdBQUcsRUFBRSxFQUFFO0FBQ3RDLElBQUEsSUFBSSxDQUFDQyxNQUFNLEdBQUlELE9BQU8sQ0FBQ0MsTUFBTSxLQUFLQyxTQUFTLEdBQUksQ0FBQyxHQUFHRixPQUFPLENBQUNDLE1BQU0sQ0FBQTtBQUNqRSxJQUFBLElBQUksQ0FBQ0UsSUFBSSxHQUFJSCxPQUFPLENBQUNHLElBQUksS0FBS0QsU0FBUyxHQUFJLEtBQUssR0FBR0YsT0FBTyxDQUFDRyxJQUFJLENBQUE7QUFDL0QsSUFBQSxJQUFJLENBQUNDLEtBQUssR0FBSUosT0FBTyxDQUFDSSxLQUFLLEtBQUtGLFNBQVMsR0FBRyxDQUFDLEdBQUdGLE9BQU8sQ0FBQ0ksS0FBTSxDQUFBO0lBRTlELElBQUksQ0FBQ0wsS0FBSyxHQUFHQSxLQUFLLENBQUE7SUFFbEIsSUFBSSxDQUFDTSxNQUFNLEdBQUcsS0FBSyxDQUFBO0lBQ25CLElBQUksQ0FBQ0MsU0FBUyxHQUFHLEtBQUssQ0FBQTtJQUV0QixJQUFJLENBQUNSLE9BQU8sR0FBR0EsT0FBTyxDQUFBO0lBRXRCLElBQUksQ0FBQ1MsTUFBTSxHQUFHLElBQUksQ0FBQTtJQUVsQixJQUFJQyxlQUFlLEVBQUUsRUFBRTtNQUNuQixJQUFJLENBQUNDLFNBQVMsR0FBRyxDQUFDLENBQUE7TUFDbEIsSUFBSSxDQUFDQyxXQUFXLEdBQUcsQ0FB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
